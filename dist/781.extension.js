"use strict";exports.id=781,exports.ids=[781],exports.modules={2781:(e,s,o)=>{o.d(s,{fromSSO:()=>p});var t=o(3052),n=o(6437),i=o(1626),r=o(3579),a=o(244),l=o(1355),g=o(4757);const c=!1,f=async({ssoStartUrl:e,ssoSession:s,ssoAccountId:n,ssoRegion:i,ssoRoleName:r,ssoClient:f,clientConfig:p,parentClientConfig:h,profile:d,filepath:C,configFilepath:_,ignoreCache:u,logger:w})=>{let S;const m="To refresh this SSO session run aws sso login with the corresponding profile.";if(s)try{const e=await(0,l.Y)({profile:d,filepath:C,configFilepath:_,ignoreCache:u})();S={accessToken:e.token,expiresAt:new Date(e.expiration).toISOString()}}catch(e){throw new t.C(e.message,{tryNextLink:c,logger:w})}else try{S=await(0,g.v)(e)}catch(e){throw new t.C(`The SSO session associated with this profile is invalid. ${m}`,{tryNextLink:c,logger:w})}if(new Date(S.expiresAt).getTime()-Date.now()<=0)throw new t.C(`The SSO session associated with this profile has expired. ${m}`,{tryNextLink:c,logger:w});const{accessToken:y}=S,{SSOClient:x,GetRoleCredentialsCommand:A}=await o.e(563).then(o.bind(o,2563)),k=f||new x(Object.assign({},p??{},{logger:p?.logger??h?.logger,region:p?.region??i,userAgentAppId:p?.userAgentAppId??h?.userAgentAppId}));let I;try{I=await k.send(new A({accountId:n,roleName:r,accessToken:y}))}catch(e){throw new t.C(e,{tryNextLink:c,logger:w})}const{roleCredentials:{accessKeyId:N,secretAccessKey:O,sessionToken:R,expiration:L,credentialScope:T,accountId:v}={}}=I;if(!(N&&O&&R&&L))throw new t.C("SSO returns an invalid temporary credential.",{tryNextLink:c,logger:w});const $={accessKeyId:N,secretAccessKey:O,sessionToken:R,expiration:new Date(L),...T&&{credentialScope:T},...v&&{accountId:v}};return s?(0,a.g)($,"CREDENTIALS_SSO","s"):(0,a.g)($,"CREDENTIALS_SSO_LEGACY","u"),$},p=(e={})=>async({callerClientConfig:s}={})=>{e.logger?.debug("@aws-sdk/credential-provider-sso - fromSSO");const{ssoStartUrl:o,ssoAccountId:a,ssoRegion:l,ssoRoleName:g,ssoSession:c}=e,{ssoClient:p}=e,h=(0,n.Bz)({profile:e.profile??s?.profile});if(o||a||l||g||c){if(o&&a&&l&&g)return f({ssoStartUrl:o,ssoSession:c,ssoAccountId:a,ssoRegion:l,ssoRoleName:g,ssoClient:p,clientConfig:e.clientConfig,parentClientConfig:e.parentClientConfig,profile:h,filepath:e.filepath,configFilepath:e.configFilepath,ignoreCache:e.ignoreCache,logger:e.logger});throw new t.C('Incomplete configuration. The fromSSO() argument hash must include "ssoStartUrl", "ssoAccountId", "ssoRegion", "ssoRoleName"',{tryNextLink:!1,logger:e.logger})}{const s=(await(0,i.Y)(e))[h];if(!s)throw new t.C(`Profile ${h} was not found.`,{logger:e.logger});if(!(d=s)||"string"!=typeof d.sso_start_url&&"string"!=typeof d.sso_account_id&&"string"!=typeof d.sso_session&&"string"!=typeof d.sso_region&&"string"!=typeof d.sso_role_name)throw new t.C(`Profile ${h} is not configured with SSO credentials.`,{logger:e.logger});if(s?.sso_session){const n=(await(0,r.q)(e))[s.sso_session],i=` configurations in profile ${h} and sso-session ${s.sso_session}`;if(l&&l!==n.sso_region)throw new t.C("Conflicting SSO region"+i,{tryNextLink:!1,logger:e.logger});if(o&&o!==n.sso_start_url)throw new t.C("Conflicting SSO start_url"+i,{tryNextLink:!1,logger:e.logger});s.sso_region=n.sso_region,s.sso_start_url=n.sso_start_url}const{sso_start_url:n,sso_account_id:a,sso_region:g,sso_role_name:c,sso_session:C}=((e,s)=>{const{sso_start_url:o,sso_account_id:n,sso_region:i,sso_role_name:r}=e;if(!(o&&n&&i&&r))throw new t.C(`Profile is configured with invalid SSO credentials. Required parameters "sso_account_id", "sso_region", "sso_role_name", "sso_start_url". Got ${Object.keys(e).join(", ")}\nReference: https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sso.html`,{tryNextLink:!1,logger:s});return e})(s,e.logger);return f({ssoStartUrl:n,ssoSession:C,ssoAccountId:a,ssoRegion:g,ssoRoleName:c,ssoClient:p,clientConfig:e.clientConfig,parentClientConfig:e.parentClientConfig,profile:h,filepath:e.filepath,configFilepath:e.configFilepath,ignoreCache:e.ignoreCache,logger:e.logger})}var d}}};