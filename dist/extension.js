(()=>{var t,e={181:t=>{"use strict";t.exports=require("buffer")},212:(t,e,n)=>{"use strict";n.d(e,{e:()=>i});const i=t=>null!=t},244:(t,e,n)=>{"use strict";function i(t,e,n){return t.$source||(t.$source={}),t.$source[e]=n,t}n.d(e,{g:()=>i})},468:(t,e,n)=>{"use strict";n.d(e,{m:()=>i});const i={}},612:(t,e,n)=>{"use strict";n.d(e,{h:()=>i});class i{authSchemes=new Map;constructor(t){for(const[e,n]of Object.entries(t))void 0!==n&&this.authSchemes.set(e,n)}getIdentityProvider(t){return this.authSchemes.get(t)}}},643:(t,e,n)=>{"use strict";n.d(e,{UF:()=>l,vL:()=>c});var i=n(468),s=n(8883),r=n(1466);const o=(t,e=!1)=>{if(e){for(const e of t.split("."))if(!o(e))return!1;return!0}return!(!(0,s.X)(t)||t.length<3||t.length>63||t!==t.toLowerCase()||(0,r.o)(t))};let a=JSON.parse('{"partitions":[{"id":"aws","outputs":{"dnsSuffix":"amazonaws.com","dualStackDnsSuffix":"api.aws","implicitGlobalRegion":"us-east-1","name":"aws","supportsDualStack":true,"supportsFIPS":true},"regionRegex":"^(us|eu|ap|sa|ca|me|af|il|mx)\\\\-\\\\w+\\\\-\\\\d+$","regions":{"af-south-1":{"description":"Africa (Cape Town)"},"ap-east-1":{"description":"Asia Pacific (Hong Kong)"},"ap-east-2":{"description":"Asia Pacific (Taipei)"},"ap-northeast-1":{"description":"Asia Pacific (Tokyo)"},"ap-northeast-2":{"description":"Asia Pacific (Seoul)"},"ap-northeast-3":{"description":"Asia Pacific (Osaka)"},"ap-south-1":{"description":"Asia Pacific (Mumbai)"},"ap-south-2":{"description":"Asia Pacific (Hyderabad)"},"ap-southeast-1":{"description":"Asia Pacific (Singapore)"},"ap-southeast-2":{"description":"Asia Pacific (Sydney)"},"ap-southeast-3":{"description":"Asia Pacific (Jakarta)"},"ap-southeast-4":{"description":"Asia Pacific (Melbourne)"},"ap-southeast-5":{"description":"Asia Pacific (Malaysia)"},"ap-southeast-6":{"description":"Asia Pacific (New Zealand)"},"ap-southeast-7":{"description":"Asia Pacific (Thailand)"},"aws-global":{"description":"aws global region"},"ca-central-1":{"description":"Canada (Central)"},"ca-west-1":{"description":"Canada West (Calgary)"},"eu-central-1":{"description":"Europe (Frankfurt)"},"eu-central-2":{"description":"Europe (Zurich)"},"eu-north-1":{"description":"Europe (Stockholm)"},"eu-south-1":{"description":"Europe (Milan)"},"eu-south-2":{"description":"Europe (Spain)"},"eu-west-1":{"description":"Europe (Ireland)"},"eu-west-2":{"description":"Europe (London)"},"eu-west-3":{"description":"Europe (Paris)"},"il-central-1":{"description":"Israel (Tel Aviv)"},"me-central-1":{"description":"Middle East (UAE)"},"me-south-1":{"description":"Middle East (Bahrain)"},"mx-central-1":{"description":"Mexico (Central)"},"sa-east-1":{"description":"South America (Sao Paulo)"},"us-east-1":{"description":"US East (N. Virginia)"},"us-east-2":{"description":"US East (Ohio)"},"us-west-1":{"description":"US West (N. California)"},"us-west-2":{"description":"US West (Oregon)"}}},{"id":"aws-cn","outputs":{"dnsSuffix":"amazonaws.com.cn","dualStackDnsSuffix":"api.amazonwebservices.com.cn","implicitGlobalRegion":"cn-northwest-1","name":"aws-cn","supportsDualStack":true,"supportsFIPS":true},"regionRegex":"^cn\\\\-\\\\w+\\\\-\\\\d+$","regions":{"aws-cn-global":{"description":"aws-cn global region"},"cn-north-1":{"description":"China (Beijing)"},"cn-northwest-1":{"description":"China (Ningxia)"}}},{"id":"aws-eusc","outputs":{"dnsSuffix":"amazonaws.eu","dualStackDnsSuffix":"api.amazonwebservices.eu","implicitGlobalRegion":"eusc-de-east-1","name":"aws-eusc","supportsDualStack":true,"supportsFIPS":true},"regionRegex":"^eusc\\\\-(de)\\\\-\\\\w+\\\\-\\\\d+$","regions":{"eusc-de-east-1":{"description":"EU (Germany)"}}},{"id":"aws-iso","outputs":{"dnsSuffix":"c2s.ic.gov","dualStackDnsSuffix":"api.aws.ic.gov","implicitGlobalRegion":"us-iso-east-1","name":"aws-iso","supportsDualStack":true,"supportsFIPS":true},"regionRegex":"^us\\\\-iso\\\\-\\\\w+\\\\-\\\\d+$","regions":{"aws-iso-global":{"description":"aws-iso global region"},"us-iso-east-1":{"description":"US ISO East"},"us-iso-west-1":{"description":"US ISO WEST"}}},{"id":"aws-iso-b","outputs":{"dnsSuffix":"sc2s.sgov.gov","dualStackDnsSuffix":"api.aws.scloud","implicitGlobalRegion":"us-isob-east-1","name":"aws-iso-b","supportsDualStack":true,"supportsFIPS":true},"regionRegex":"^us\\\\-isob\\\\-\\\\w+\\\\-\\\\d+$","regions":{"aws-iso-b-global":{"description":"aws-iso-b global region"},"us-isob-east-1":{"description":"US ISOB East (Ohio)"},"us-isob-west-1":{"description":"US ISOB West"}}},{"id":"aws-iso-e","outputs":{"dnsSuffix":"cloud.adc-e.uk","dualStackDnsSuffix":"api.cloud-aws.adc-e.uk","implicitGlobalRegion":"eu-isoe-west-1","name":"aws-iso-e","supportsDualStack":true,"supportsFIPS":true},"regionRegex":"^eu\\\\-isoe\\\\-\\\\w+\\\\-\\\\d+$","regions":{"aws-iso-e-global":{"description":"aws-iso-e global region"},"eu-isoe-west-1":{"description":"EU ISOE West"}}},{"id":"aws-iso-f","outputs":{"dnsSuffix":"csp.hci.ic.gov","dualStackDnsSuffix":"api.aws.hci.ic.gov","implicitGlobalRegion":"us-isof-south-1","name":"aws-iso-f","supportsDualStack":true,"supportsFIPS":true},"regionRegex":"^us\\\\-isof\\\\-\\\\w+\\\\-\\\\d+$","regions":{"aws-iso-f-global":{"description":"aws-iso-f global region"},"us-isof-east-1":{"description":"US ISOF EAST"},"us-isof-south-1":{"description":"US ISOF SOUTH"}}},{"id":"aws-us-gov","outputs":{"dnsSuffix":"amazonaws.com","dualStackDnsSuffix":"api.aws","implicitGlobalRegion":"us-gov-west-1","name":"aws-us-gov","supportsDualStack":true,"supportsFIPS":true},"regionRegex":"^us\\\\-gov\\\\-\\\\w+\\\\-\\\\d+$","regions":{"aws-us-gov-global":{"description":"aws-us-gov global region"},"us-gov-east-1":{"description":"AWS GovCloud (US-East)"},"us-gov-west-1":{"description":"AWS GovCloud (US-West)"}}}],"version":"1.1"}');const c=()=>"",l={isVirtualHostableS3Bucket:o,parseArn:t=>{const e=t.split(":");if(e.length<6)return null;const[n,i,s,r,o,...a]=e;return"arn"!==n||""===i||""===s||""===a.join(":")?null:{partition:i,service:s,region:r,accountId:o,resourceId:a.map(t=>t.split("/")).flat()}},partition:t=>{const{partitions:e}=a;for(const n of e){const{regions:e,outputs:i}=n;for(const[n,s]of Object.entries(e))if(n===t)return{...i,...s}}for(const n of e){const{regionRegex:e,outputs:i}=n;if(new RegExp(e).test(t))return{...i}}const n=e.find(t=>"aws"===t.id);if(!n)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...n.outputs}}};i.m.aws=l},649:(t,e,n)=>{"use strict";n.d(e,{vK:()=>o});var i=n(7324);const s="content-length",r={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},o=t=>({applyToStack:e=>{var n;e.add((n=t.bodyLengthChecker,t=>async e=>{const r=e.request;if(i.K.isInstance(r)){const{body:t,headers:e}=r;if(t&&-1===Object.keys(e).map(t=>t.toLowerCase()).indexOf(s))try{const e=n(t);r.headers={...r.headers,[s]:String(e)}}catch(t){}}return t({...e,request:r})}),r)}})},666:(t,e,n)=>{"use strict";n.d(e,{l:()=>i});const i=t=>{switch(t){case"standard":case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}}},857:t=>{"use strict";t.exports=require("os")},1095:(t,e,n)=>{"use strict";n.d(e,{OV:()=>s,TC:()=>o});var i=n(7324);function s(t){return t}const r={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},o=t=>({applyToStack:e=>{e.add((t=>e=>async n=>{if(!i.K.isInstance(n.request))return e(n);const{request:s}=n,{handlerProtocol:r=""}=t.requestHandler.metadata||{};if(r.indexOf("h2")>=0&&!s.headers[":authority"])delete s.headers.host,s.headers[":authority"]=s.hostname+(s.port?":"+s.port:"");else if(!s.headers.host){let t=s.hostname;null!=s.port&&(t+=`:${s.port}`),s.headers.host=t}return e(n)})(t),r)}})},1226:(t,e,n)=>{"use strict";function i(t,e,n){let i,s,a;if(void 0===e&&void 0===n)i={},a=t;else{if(i=t,"function"==typeof e)return s=e,a=n,r(i,s,a);a=e}for(const t of Object.keys(a))Array.isArray(a[t])?o(i,null,a,t):i[t]=a[t];return i}n.d(e,{Tj:()=>i,s:()=>s});const s=(t,e)=>{const n={};for(const i in e)o(n,t,e,i);return n},r=(t,e,n)=>i(t,Object.entries(n).reduce((t,[n,i])=>(Array.isArray(i)?t[n]=i:t[n]="function"==typeof i?[e,i()]:[e,i],t),{})),o=(t,e,n,i)=>{if(null!==e){let s=n[i];"function"==typeof s&&(s=[,s]);const[r=a,o=c,l=i]=s;return void(("function"==typeof r&&r(e[l])||"function"!=typeof r&&r)&&(t[i]=o(e[l])))}let[s,r]=n[i];if("function"==typeof r){let e;const n=void 0===s&&null!=(e=r()),o="function"==typeof s&&!!s(void 0)||"function"!=typeof s&&!!s;n?t[i]=e:o&&(t[i]=r())}else{const e=void 0===s&&null!=r,n="function"==typeof s&&!!s(r)||"function"!=typeof s&&!!s;(e||n)&&(t[i]=r)}},a=t=>null!=t,c=t=>t},1355:(t,e,n)=>{"use strict";n.d(e,{Y:()=>f});var i=n(7513),s=n(1626),r=n(6437),o=n(3579),a=n(4757);const c="To refresh this SSO session run 'aws sso login' with the corresponding profile.",l=t=>{if(t.expiration&&t.expiration.getTime()<Date.now())throw new i.J(`Token is expired. ${c}`,!1)},h=(t,e,n=!1)=>{if(void 0===e)throw new i.J(`Value not present for '${t}' in SSO Token${n?". Cannot refresh":""}. ${c}`,!1)};var d=n(2594),u=n(9896);const{writeFile:p}=u.promises,g=new Date(0),f=(t={})=>async({callerClientConfig:e}={})=>{const u={...t,parentClientConfig:{...e,...t.parentClientConfig}};u.logger?.debug("@aws-sdk/token-providers - fromSso");const f=await(0,s.Y)(u),m=(0,r.Bz)({profile:u.profile??e?.profile}),v=f[m];if(!v)throw new i.J(`Profile '${m}' could not be found in shared credentials file.`,!1);if(!v.sso_session)throw new i.J(`Profile '${m}' is missing required property 'sso_session'.`);const y=v.sso_session,b=(await(0,o.q)(u))[y];if(!b)throw new i.J(`Sso session '${y}' could not be found in shared credentials file.`,!1);for(const t of["sso_start_url","sso_region"])if(!b[t])throw new i.J(`Sso session '${y}' is missing required property '${t}'.`,!1);b.sso_start_url;const w=b.sso_region;let A;try{A=await(0,a.v)(y)}catch(t){throw new i.J(`The SSO session token associated with profile=${m} was not found or is invalid. ${c}`,!1)}h("accessToken",A.accessToken),h("expiresAt",A.expiresAt);const{accessToken:x,expiresAt:S}=A,E={token:x,expiration:new Date(S)};if(E.expiration.getTime()-Date.now()>3e5)return E;if(Date.now()-g.getTime()<3e4)return l(E),E;h("clientId",A.clientId,!0),h("clientSecret",A.clientSecret,!0),h("refreshToken",A.refreshToken,!0);try{g.setTime(Date.now());const t=await(async(t,e,i={})=>{const{CreateTokenCommand:s}=await n.e(521).then(n.bind(n,5521)),r=await(async(t,e={})=>{const{SSOOIDCClient:i}=await n.e(521).then(n.bind(n,5521)),s=t=>e.clientConfig?.[t]??e.parentClientConfig?.[t];return new i(Object.assign({},e.clientConfig??{},{region:t??e.clientConfig?.region,logger:s("logger"),userAgentAppId:s("userAgentAppId")}))})(e,i);return r.send(new s({clientId:t.clientId,clientSecret:t.clientSecret,refreshToken:t.refreshToken,grantType:"refresh_token"}))})(A,w,u);h("accessToken",t.accessToken),h("expiresIn",t.expiresIn);const e=new Date(Date.now()+1e3*t.expiresIn);try{await((t,e)=>{const n=(0,d.C)(t),i=JSON.stringify(e,null,2);return p(n,i)})(y,{...A,accessToken:t.accessToken,expiresAt:e.toISOString(),refreshToken:t.refreshToken})}catch(t){}return{token:t.accessToken,expiration:e}}catch(t){return l(E),E}}},1395:(t,e,n)=>{"use strict";n.d(e,{E:()=>r});var i=n(9290);const s=/^[A-Za-z0-9+/]*={0,2}$/,r=t=>{if(3*t.length%4!=0)throw new TypeError("Incorrect padding on base64 string.");if(!s.exec(t))throw new TypeError("Invalid base64 string.");const e=(0,i.s)(t,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}},1398:t=>{"use strict";t.exports=require("vscode")},1431:(t,e,n)=>{"use strict";n.d(e,{K4:()=>r,OC:()=>i,e:()=>s});const i=function(t){return s(t)&&t.expiration.getTime()-Date.now()<3e5};const s=t=>void 0!==t.expiration,r=(t,e,n)=>{if(void 0===t)return;const i="function"!=typeof t?async()=>Promise.resolve(t):t;let s,r,o,a=!1;const c=async t=>{r||(r=i(t));try{s=await r,o=!0,a=!1}finally{r=void 0}return s};return void 0===e?async t=>(o&&!t?.forceRefresh||(s=await c(t)),s):async t=>(o&&!t?.forceRefresh||(s=await c(t)),a?s:n(s)?e(s)?(await c(t),s):s:(a=!0,s))}},1466:(t,e,n)=>{"use strict";n.d(e,{o:()=>s});const i=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),s=t=>i.test(t)||t.startsWith("[")&&t.endsWith("]")},1476:(t,e,n)=>{"use strict";n.d(e,{A:()=>a});var i=n(5578),s=n(9094);const r=/^([\w-]+)\s(["'])?([\w-@\+\.%:/]+)\2$/,o=["__proto__","profile __proto__"],a=t=>{const e={};let n,a;for(const c of t.split(/\r?\n/)){const t=c.split(/(^|\s)[;#]/)[0].trim();if("["===t[0]&&"]"===t[t.length-1]){n=void 0,a=void 0;const e=t.substring(1,t.length-1),c=r.exec(e);if(c){const[,t,,e]=c;Object.values(i.I).includes(t)&&(n=[t,e].join(s.Q))}else n=e;if(o.includes(e))throw new Error(`Found invalid profile name "${e}"`)}else if(n){const i=t.indexOf("=");if(![0,-1].includes(i)){const[r,o]=[t.substring(0,i).trim(),t.substring(i+1).trim()];if(""===o)a=r;else{a&&c.trimStart()===c&&(a=void 0),e[n]=e[n]||{};const t=a?[a,r].join(s.Q):r;e[n][t]=o}}}}return e}},1478:(t,e,n)=>{"use strict";n.d(e,{pi:()=>o,sF:()=>a,yG:()=>r});var i=n(244),s=n(3052);const r="AWS_ACCESS_KEY_ID",o="AWS_SECRET_ACCESS_KEY",a=t=>async()=>{t?.logger?.debug("@aws-sdk/credential-provider-env - fromEnv");const e=process.env[r],n=process.env[o],a=process.env.AWS_SESSION_TOKEN,c=process.env.AWS_CREDENTIAL_EXPIRATION,l=process.env.AWS_CREDENTIAL_SCOPE,h=process.env.AWS_ACCOUNT_ID;if(e&&n){const t={accessKeyId:e,secretAccessKey:n,...a&&{sessionToken:a},...c&&{expiration:new Date(c)},...l&&{credentialScope:l},...h&&{accountId:h}};return(0,i.g)(t,"CREDENTIALS_ENV_VARS","g"),t}throw new s.C("Unable to find environment variable credentials.",{logger:t?.logger})}},1482:(t,e,n)=>{"use strict";n.d(e,{n:()=>s});const i=require("node:fs"),s=t=>{if(!t)return 0;if("string"==typeof t)return Buffer.byteLength(t);if("number"==typeof t.byteLength)return t.byteLength;if("number"==typeof t.size)return t.size;if("number"==typeof t.start&&"number"==typeof t.end)return t.end+1-t.start;if(t instanceof i.ReadStream){if(null!=t.path)return(0,i.lstatSync)(t.path).size;if("number"==typeof t.fd)return(0,i.fstatSync)(t.fd).size}throw new Error(`Body Length computation failed for ${t}`)}},1544:(t,e,n)=>{"use strict";n.d(e,{R:()=>i});const i=t=>`AWS_BEARER_TOKEN_${t.replace(/[\s-]/g,"_").toUpperCase()}`},1620:(t,e,n)=>{"use strict";n.d(e,{I:()=>h});var i=n(4836),s=n(4013),r=n(3783);const o="AWS_REGION",a="AWS_DEFAULT_REGION",c=["in-region","cross-region","mobile","standard","legacy"],l={environmentVariableSelector:t=>t.AWS_DEFAULTS_MODE,configFileSelector:t=>t.defaults_mode,default:"legacy"},h=({region:t=(0,s.Z)(i.GG),defaultsMode:e=(0,s.Z)(l)}={})=>(0,r.B)(async()=>{const n="function"==typeof e?await e():e;switch(n?.toLowerCase()){case"auto":return d(t);case"in-region":case"cross-region":case"mobile":case"standard":case"legacy":return Promise.resolve(n?.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${c.join(", ")}, got ${n}`)}}),d=async t=>{if(t){const e="function"==typeof t?await t():t,n=await u();return n?e===n?"in-region":"cross-region":"standard"}return"standard"},u=async()=>{if(process.env.AWS_EXECUTION_ENV&&(process.env[o]||process.env[a]))return process.env[o]??process.env[a];if(!process.env.AWS_EC2_METADATA_DISABLED)try{const{getInstanceMetadataEndpoint:t,httpRequest:e}=await n.e(897).then(n.bind(n,7897)),i=await t();return(await e({...i,path:"/latest/meta-data/placement/region"})).toString()}catch(t){}}},1626:(t,e,n)=>{"use strict";n.d(e,{Y:()=>s});var i=n(5546);const s=async t=>{const e=await(0,i.p)(t);return((...t)=>{const e={};for(const n of t)for(const[t,i]of Object.entries(n))void 0!==e[t]?Object.assign(e[t],i):e[t]=i;return e})(e.configFile,e.credentialsFile)}},1671:(t,e,n)=>{"use strict";n.d(e,{o:()=>r});const i=(t,e)=>{const n=[];if(t&&n.push(t),e)for(const t of e)n.push(t);return n},s=(t,e)=>`${t||"anonymous"}${e&&e.length>0?` (a.k.a. ${e.join(",")})`:""}`,r=()=>{let t=[],e=[],n=!1;const c=new Set,l=n=>(t.forEach(t=>{n.add(t.middleware,{...t})}),e.forEach(t=>{n.addRelativeTo(t.middleware,{...t})}),n.identifyOnResolve?.(u.identifyOnResolve()),n),h=t=>{const e=[];return t.before.forEach(t=>{0===t.before.length&&0===t.after.length?e.push(t):e.push(...h(t))}),e.push(t),t.after.reverse().forEach(t=>{0===t.before.length&&0===t.after.length?e.push(t):e.push(...h(t))}),e},d=(n=!1)=>{const r=[],c=[],l={};var d;return t.forEach(t=>{const e={...t,before:[],after:[]};for(const t of i(e.name,e.aliases))l[t]=e;r.push(e)}),e.forEach(t=>{const e={...t,before:[],after:[]};for(const t of i(e.name,e.aliases))l[t]=e;c.push(e)}),c.forEach(t=>{if(t.toMiddleware){const e=l[t.toMiddleware];if(void 0===e){if(n)return;throw new Error(`${t.toMiddleware} is not found when adding ${s(t.name,t.aliases)} middleware ${t.relation} ${t.toMiddleware}`)}"after"===t.relation&&e.after.push(t),"before"===t.relation&&e.before.push(t)}}),(d=r,d.sort((t,e)=>o[e.step]-o[t.step]||a[e.priority||"normal"]-a[t.priority||"normal"])).map(h).reduce((t,e)=>(t.push(...e),t),[])},u={add:(e,n={})=>{const{name:r,override:o,aliases:a}=n,l={step:"initialize",priority:"normal",middleware:e,...n},h=i(r,a);if(h.length>0){if(h.some(t=>c.has(t))){if(!o)throw new Error(`Duplicate middleware name '${s(r,a)}'`);for(const e of h){const n=t.findIndex(t=>t.name===e||t.aliases?.some(t=>t===e));if(-1===n)continue;const i=t[n];if(i.step!==l.step||l.priority!==i.priority)throw new Error(`"${s(i.name,i.aliases)}" middleware with ${i.priority} priority in ${i.step} step cannot be overridden by "${s(r,a)}" middleware with ${l.priority} priority in ${l.step} step.`);t.splice(n,1)}}for(const t of h)c.add(t)}t.push(l)},addRelativeTo:(t,n)=>{const{name:r,override:o,aliases:a}=n,l={middleware:t,...n},h=i(r,a);if(h.length>0){if(h.some(t=>c.has(t))){if(!o)throw new Error(`Duplicate middleware name '${s(r,a)}'`);for(const t of h){const n=e.findIndex(e=>e.name===t||e.aliases?.some(e=>e===t));if(-1===n)continue;const i=e[n];if(i.toMiddleware!==l.toMiddleware||i.relation!==l.relation)throw new Error(`"${s(i.name,i.aliases)}" middleware ${i.relation} "${i.toMiddleware}" middleware cannot be overridden by "${s(r,a)}" middleware ${l.relation} "${l.toMiddleware}" middleware.`);e.splice(n,1)}}for(const t of h)c.add(t)}e.push(l)},clone:()=>l(r()),use:t=>{t.applyToStack(u)},remove:n=>"string"==typeof n?(n=>{let s=!1;const r=t=>{const e=i(t.name,t.aliases);if(e.includes(n)){s=!0;for(const t of e)c.delete(t);return!1}return!0};return t=t.filter(r),e=e.filter(r),s})(n):(n=>{let s=!1;const r=t=>{if(t.middleware===n){s=!0;for(const e of i(t.name,t.aliases))c.delete(e);return!1}return!0};return t=t.filter(r),e=e.filter(r),s})(n),removeByTag:n=>{let s=!1;const r=t=>{const{tags:e,name:r,aliases:o}=t;if(e&&e.includes(n)){const t=i(r,o);for(const e of t)c.delete(e);return s=!0,!1}return!0};return t=t.filter(r),e=e.filter(r),s},concat:t=>{const e=l(r());return e.use(t),e.identifyOnResolve(n||e.identifyOnResolve()||(t.identifyOnResolve?.()??!1)),e},applyToStack:l,identify:()=>d(!0).map(t=>{const e=t.step??t.relation+" "+t.toMiddleware;return s(t.name,t.aliases)+" - "+e}),identifyOnResolve:t=>("boolean"==typeof t&&(n=t),n),resolve:(t,e)=>{for(const n of d().map(t=>t.middleware).reverse())t=n(t,e);return n&&console.log(u.identify()),t}};return u},o={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},a={high:3,normal:2,low:1}},1698:(t,e,n)=>{"use strict";n.d(e,{TM:()=>l,Ou:()=>c});var i=n(4094);const s=(t,e)=>(n,s)=>async o=>{const{response:a}=await n(o);try{return{response:a,output:await e(a,t)}}catch(t){if(Object.defineProperty(t,"$response",{value:a}),!("$metadata"in t)){const e="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";try{t.message+="\n  "+e}catch(t){s.logger&&"NoOpLogger"!==s.logger?.constructor?.name?s.logger?.warn?.(e):console.warn(e)}void 0!==t.$responseBodyText&&t.$response&&(t.$response.body=t.$responseBodyText);try{if(i.c.isInstance(a)){const{headers:e={}}=a,n=Object.entries(e);t.$metadata={httpStatusCode:a.statusCode,requestId:r(/^x-[\w-]+-request-?id$/,n),extendedRequestId:r(/^x-[\w-]+-id-2$/,n),cfId:r(/^x-[\w-]+-cf-id$/,n)}}}catch(t){}}throw t}},r=(t,e)=>(e.find(([e])=>e.match(t))||[void 0,void 0])[1],o=(t,e)=>(n,i)=>async s=>{const r=t,o=i.endpointV2?.url&&r.urlParser?async()=>r.urlParser(i.endpointV2.url):r.endpoint;if(!o)throw new Error("No valid endpoint provider available.");const a=await e(s.input,{...t,endpoint:o});return n({...s,request:a})},a={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},c={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function l(t,e,n){return{applyToStack:i=>{i.add(s(t,n),a),i.add(o(t,e),c)}}}},1701:(t,e,n)=>{"use strict";n.d(e,{V:()=>a});var i=n(9290),s=n(4424),r=n(181),o=n(6982);class a{algorithmIdentifier;secret;hash;constructor(t,e){this.algorithmIdentifier=t,this.secret=e,this.reset()}update(t,e){this.hash.update((0,s.F)(c(t,e)))}digest(){return Promise.resolve(this.hash.digest())}reset(){this.hash=this.secret?(0,o.createHmac)(this.algorithmIdentifier,c(this.secret)):(0,o.createHash)(this.algorithmIdentifier)}}function c(t,e){return r.Buffer.isBuffer(t)?t:"string"==typeof t?(0,i.s)(t,e):ArrayBuffer.isView(t)?(0,i.Q)(t.buffer,t.byteOffset,t.byteLength):(0,i.Q)(t)}},1871:(t,e,n)=>{"use strict";n.d(e,{EI:()=>o,t_:()=>c});var i=n(6460);const s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?[zZ]$/),o=t=>{if(null==t)return;if("string"!=typeof t)throw new TypeError("RFC-3339 date-times must be expressed as strings");const e=r.exec(t);if(!e)throw new TypeError("Invalid RFC-3339 date-time value");const[n,s,o,a,c,h,d,u]=e,g=(0,i.zi)(m(s)),f=p(o,"month",1,12),v=p(a,"day",1,31);return l(g,f,v,{hours:c,minutes:h,seconds:d,fractionalMilliseconds:u})},a=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(([-+]\d{2}\:\d{2})|[zZ])$/),c=t=>{if(null==t)return;if("string"!=typeof t)throw new TypeError("RFC-3339 date-times must be expressed as strings");const e=a.exec(t);if(!e)throw new TypeError("Invalid RFC-3339 date-time value");const[n,s,r,o,c,h,d,u,g]=e,v=(0,i.zi)(m(s)),y=p(r,"month",1,12),b=p(o,"day",1,31),w=l(v,y,b,{hours:c,minutes:h,seconds:d,fractionalMilliseconds:u});return"Z"!=g.toUpperCase()&&w.setTime(w.getTime()-f(g)),w},l=(t,e,n,i)=>{const s=e-1;return d(t,s,n),new Date(Date.UTC(t,s,n,p(i.hours,"hour",0,23),p(i.minutes,"minute",0,59),p(i.seconds,"seconds",0,60),g(i.fractionalMilliseconds)))},h=[31,28,31,30,31,30,31,31,30,31,30,31],d=(t,e,n)=>{let i=h[e];if(1===e&&u(t)&&(i=29),n>i)throw new TypeError(`Invalid day for ${s[e]} in ${t}: ${n}`)},u=t=>t%4==0&&(t%100!=0||t%400==0),p=(t,e,n,s)=>{const r=(0,i.tW)(m(t));if(r<n||r>s)throw new TypeError(`${e} must be between ${n} and ${s}, inclusive`);return r},g=t=>null==t?0:1e3*(0,i.UO)("0."+t),f=t=>{const e=t[0];let n=1;if("+"==e)n=1;else{if("-"!=e)throw new TypeError(`Offset direction, ${e}, must be "+" or "-"`);n=-1}return n*(60*Number(t.substring(1,3))+Number(t.substring(4,6)))*60*1e3},m=t=>{let e=0;for(;e<t.length-1&&"0"===t.charAt(e);)e++;return 0===e?t:t.slice(e)}},1919:(t,e,n)=>{"use strict";n.d(e,{CG:()=>r,Y2:()=>s,cJ:()=>o});var i=n(8218);const s=(t,e)=>(0,i.w)(t,e).then(t=>{if(t.length)try{return JSON.parse(t)}catch(e){throw"SyntaxError"===e?.name&&Object.defineProperty(e,"$responseBodyText",{value:t}),e}return{}}),r=async(t,e)=>{const n=await s(t,e);return n.message=n.message??n.Message,n},o=(t,e)=>{const n=(t,e)=>Object.keys(t).find(t=>t.toLowerCase()===e.toLowerCase()),i=t=>{let e=t;return"number"==typeof e&&(e=e.toString()),e.indexOf(",")>=0&&(e=e.split(",")[0]),e.indexOf(":")>=0&&(e=e.split(":")[0]),e.indexOf("#")>=0&&(e=e.split("#")[1]),e},s=n(t.headers,"x-amzn-errortype");if(void 0!==s)return i(t.headers[s]);if(e&&"object"==typeof e){const t=n(e,"code");if(t&&void 0!==e[t])return i(e[t]);if(void 0!==e.__type)return i(e.__type)}}},1943:t=>{"use strict";t.exports=require("fs/promises")},2184:(t,e,n)=>{"use strict";n.d(e,{e$:()=>r});var i=n(5938),s=n(3466);const r={environmentVariableSelector:t=>(0,i.Q)(t,"AWS_USE_DUALSTACK_ENDPOINT",s.c.ENV),configFileSelector:t=>(0,i.Q)(t,"use_dualstack_endpoint",s.c.CONFIG),default:!1}},2203:t=>{"use strict";t.exports=require("stream")},2339:(t,e,n)=>{"use strict";n.d(e,{I:()=>s});let i=!1;const s=t=>{t&&!i&&parseInt(t.substring(1,t.indexOf(".")))<16&&(i=!0)}},2404:(t,e,n)=>{"use strict";n.d(e,{w:()=>r});var i=n(6116);const s={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},r=(t,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:n})=>({applyToStack:r=>{r.addRelativeTo(((t,e)=>(n,s)=>async r=>{const o=((t,e)=>{if(!e||0===e.length)return t;const n=[];for(const i of e)for(const e of t)e.schemeId.split("#")[1]===i&&n.push(e);for(const e of t)n.find(({schemeId:t})=>t===e.schemeId)||n.push(e);return n})(t.httpAuthSchemeProvider(await e.httpAuthSchemeParametersProvider(t,s,r.input)),t.authSchemePreference?await t.authSchemePreference():[]),a=function(t){const e=new Map;for(const n of t)e.set(n.schemeId,n);return e}(t.httpAuthSchemes),c=(0,i.u)(s),l=[];for(const n of o){const i=a.get(n.schemeId);if(!i){l.push(`HttpAuthScheme \`${n.schemeId}\` was not enabled for this service.`);continue}const r=i.identityProvider(await e.identityProviderConfigProvider(t));if(!r){l.push(`HttpAuthScheme \`${n.schemeId}\` did not have an IdentityProvider configured.`);continue}const{identityProperties:o={},signingProperties:h={}}=n.propertiesExtractor?.(t,s)||{};n.identityProperties=Object.assign(n.identityProperties||{},o),n.signingProperties=Object.assign(n.signingProperties||{},h),c.selectedHttpAuthScheme={httpAuthOption:n,identity:await r(n.identityProperties),signer:i.signer};break}if(!c.selectedHttpAuthScheme)throw new Error(l.join("\n"));return n(r)})(t,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:n}),s)}})},2432:(t,e,n)=>{"use strict";n.d(e,{g:()=>r});var i=n(6928),s=n(7029);const r=()=>process.env.AWS_CONFIG_FILE||(0,i.join)((0,s.R)(),".aws","config")},2531:(t,e,n)=>{"use strict";n.d(e,{o:()=>i});const i=t=>encodeURIComponent(t).replace(/[!'()*]/g,s),s=t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`},2594:(t,e,n)=>{"use strict";n.d(e,{C:()=>o});var i=n(6982),s=n(6928),r=n(7029);const o=t=>{const e=(0,i.createHash)("sha1").update(t).digest("hex");return(0,s.join)((0,r.R)(),".aws","sso","cache",`${e}.json`)}},2641:(t,e,n)=>{"use strict";n.d(e,{D:()=>i});const i=t=>{if("string"==typeof t)return i(new URL(t));const{hostname:e,pathname:n,port:s,protocol:r,search:o}=t;let a;return o&&(a=function(t){const e={};if(t=t.replace(/^\?/,""))for(const n of t.split("&")){let[t,i=null]=n.split("=");t=decodeURIComponent(t),i&&(i=decodeURIComponent(i)),t in e?Array.isArray(e[t])?e[t].push(i):e[t]=[e[t],i]:e[t]=i}return e}(o)),{hostname:e,port:s?parseInt(s):void 0,protocol:r,path:n,query:a}}},2795:(t,e,n)=>{"use strict";n.d(e,{C:()=>o});var i=n(8947),s=n(8829),r=n(8462);const o=t=>{const e=t.tls??!0,{endpoint:n,useDualstackEndpoint:o,useFipsEndpoint:a}=t,c=null!=n?async()=>(0,r.a)(await(0,i.t)(n)()):void 0,l=!!n,h=Object.assign(t,{endpoint:c,tls:e,isCustomEndpoint:l,useDualstackEndpoint:(0,i.t)(o??!1),useFipsEndpoint:(0,i.t)(a??!1)});let d;return h.serviceConfiguredEndpoint=async()=>(t.serviceId&&!d&&(d=(0,s.k)(t.serviceId)),d),h}},2809:(t,e,n)=>{"use strict";n.d(e,{$:()=>i});const i="***SensitiveInformation***"},2927:(t,e,n)=>{"use strict";n.d(e,{e:()=>i,j:()=>s});const i=t=>({setHttpHandler(e){t.httpHandler=e},httpHandler:()=>t.httpHandler,updateHttpClientConfig(e,n){t.httpHandler?.updateHttpClientConfig(e,n)},httpHandlerConfigs:()=>t.httpHandler.httpHandlerConfigs()}),s=t=>({httpHandler:t.httpHandler()})},2967:(t,e,n)=>{"use strict";n.d(e,{j:()=>s});var i=n(4384);const s=t=>({output:e,parsedBody:n,errorCode:s})=>{(({output:t,parsedBody:e,exceptionCtor:n,errorCode:s})=>{const o=r(t),a=o.httpStatusCode?o.httpStatusCode+"":void 0,c=new n({name:e?.code||e?.Code||s||a||"UnknownError",$fault:"client",$metadata:o});throw(0,i.M)(c,e)})({output:e,parsedBody:n,exceptionCtor:t,errorCode:s})},r=t=>({httpStatusCode:t.statusCode,requestId:t.headers["x-amzn-requestid"]??t.headers["x-amzn-request-id"]??t.headers["x-amz-request-id"],extendedRequestId:t.headers["x-amz-id-2"],cfId:t.headers["x-amz-cf-id"]})},3052:(t,e,n)=>{"use strict";n.d(e,{C:()=>s});var i=n(6014);class s extends i.m{name="CredentialsProviderError";constructor(t,e=!0){super(t,e),Object.setPrototypeOf(this,s.prototype)}}},3062:(t,e,n)=>{"use strict";n.d(e,{s:()=>k});const i="endpoints";function s(t){return"object"!=typeof t||null==t?t:"ref"in t?`$${s(t.ref)}`:"fn"in t?`${t.fn}(${(t.argv||[]).map(s).join(", ")})`:JSON.stringify(t,null,2)}class r extends Error{constructor(t){super(t),this.name="EndpointError"}}var o=n(468);const a=(t,e)=>(t=>{const e=t.split("."),n=[];for(const i of e){const e=i.indexOf("[");if(-1!==e){if(i.indexOf("]")!==i.length-1)throw new r(`Path: '${t}' does not end with ']'`);const s=i.slice(e+1,-1);if(Number.isNaN(parseInt(s)))throw new r(`Invalid array index: '${s}' in path: '${t}'`);0!==e&&n.push(i.slice(0,e)),n.push(s)}else n.push(i)}return n})(e).reduce((n,i)=>{if("object"!=typeof n)throw new r(`Index '${i}' in '${e}' not found in '${JSON.stringify(t)}'`);return Array.isArray(n)?n[parseInt(i)]:n[i]},t);var c,l=n(8883);!function(t){t.HTTP="http",t.HTTPS="https"}(c||(c={}));var h=n(1466);const d={[c.HTTP]:80,[c.HTTPS]:443},u={booleanEquals:(t,e)=>t===e,getAttr:a,isSet:t=>null!=t,isValidHostLabel:l.X,not:t=>!t,parseURL:t=>{const e=(()=>{try{if(t instanceof URL)return t;if("object"==typeof t&&"hostname"in t){const{hostname:e,port:n,protocol:i="",path:s="",query:r={}}=t,o=new URL(`${i}//${e}${n?`:${n}`:""}${s}`);return o.search=Object.entries(r).map(([t,e])=>`${t}=${e}`).join("&"),o}return new URL(t)}catch(t){return null}})();if(!e)return console.error(`Unable to parse ${JSON.stringify(t)} as a whatwg URL.`),null;const n=e.href,{host:i,hostname:s,pathname:r,protocol:o,search:a}=e;if(a)return null;const l=o.slice(0,-1);if(!Object.values(c).includes(l))return null;const u=(0,h.o)(s);return{scheme:l,authority:`${i}${n.includes(`${i}:${d[l]}`)||"string"==typeof t&&t.includes(`${i}:${d[l]}`)?`:${d[l]}`:""}`,path:r,normalizedPath:r.endsWith("/")?r:`${r}/`,isIp:u}},stringEquals:(t,e)=>t===e,substring:(t,e,n,i)=>e>=n||t.length<n?null:i?t.substring(t.length-n,t.length-e):t.substring(e,n),uriEncode:t=>encodeURIComponent(t).replace(/[!*'()]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`)},p=(t,e)=>{const n=[],i={...e.endpointParams,...e.referenceRecord};let s=0;for(;s<t.length;){const e=t.indexOf("{",s);if(-1===e){n.push(t.slice(s));break}n.push(t.slice(s,e));const r=t.indexOf("}",e);if(-1===r){n.push(t.slice(e));break}"{"===t[e+1]&&"}"===t[r+1]&&(n.push(t.slice(e+1,r)),s=r+2);const o=t.substring(e+1,r);if(o.includes("#")){const[t,e]=o.split("#");n.push(a(i[t],e))}else n.push(i[o]);s=r+1}return n.join("")},g=(t,e,n)=>{if("string"==typeof t)return p(t,n);if(t.fn)return m.callFunction(t,n);if(t.ref)return(({ref:t},e)=>({...e.endpointParams,...e.referenceRecord}[t]))(t,n);throw new r(`'${e}': ${String(t)} is not a string, function or reference.`)},f=({fn:t,argv:e},n)=>{const i=e.map(t=>["boolean","number"].includes(typeof t)?t:m.evaluateExpression(t,"arg",n)),s=t.split(".");return s[0]in o.m&&null!=s[1]?o.m[s[0]][s[1]](...i):u[t](...i)},m={evaluateExpression:g,callFunction:f},v=({assign:t,...e},n)=>{if(t&&t in n.referenceRecord)throw new r(`'${t}' is already defined in Reference Record.`);const o=f(e,n);return n.logger?.debug?.(`${i} evaluateCondition: ${s(e)} = ${s(o)}`),{result:""===o||!!o,...null!=t&&{toAssign:{name:t,value:o}}}},y=(t=[],e)=>{const n={};for(const r of t){const{result:t,toAssign:o}=v(r,{...e,referenceRecord:{...e.referenceRecord,...n}});if(!t)return{result:t};o&&(n[o.name]=o.value,e.logger?.debug?.(`${i} assign: ${o.name} := ${s(o.value)}`))}return{result:!0,referenceRecord:n}},b=(t,e)=>Object.entries(t).reduce((t,[n,i])=>({...t,[n]:i.map(t=>{const i=g(t,"Header value entry",e);if("string"!=typeof i)throw new r(`Header '${n}' value '${i}' is not a string`);return i})}),{}),w=(t,e)=>Object.entries(t).reduce((t,[n,i])=>({...t,[n]:x.getEndpointProperty(i,e)}),{}),A=(t,e)=>{if(Array.isArray(t))return t.map(t=>A(t,e));switch(typeof t){case"string":return p(t,e);case"object":if(null===t)throw new r(`Unexpected endpoint property: ${t}`);return x.getEndpointProperties(t,e);case"boolean":return t;default:throw new r("Unexpected endpoint property type: "+typeof t)}},x={getEndpointProperty:A,getEndpointProperties:w},S=(t,e)=>{const n=g(t,"Endpoint URL",e);if("string"==typeof n)try{return new URL(n)}catch(t){throw console.error(`Failed to construct URL with ${n}`,t),t}throw new r("Endpoint URL must be a string, got "+typeof n)},E=(t,e)=>{const{conditions:n,endpoint:r}=t,{result:o,referenceRecord:a}=y(n,e);if(!o)return;const c={...e,referenceRecord:{...e.referenceRecord,...a}},{url:l,properties:h,headers:d}=r;return e.logger?.debug?.(`${i} Resolving endpoint from template: ${s(r)}`),{...null!=d&&{headers:b(d,c)},...null!=h&&{properties:w(h,c)},url:S(l,c)}},_=(t,e)=>{const{conditions:n,error:i}=t,{result:s,referenceRecord:o}=y(n,e);if(s)throw new r(g(i,"Error",{...e,referenceRecord:{...e.referenceRecord,...o}}))},C=(t,e)=>{for(const n of t)if("endpoint"===n.type){const t=E(n,e);if(t)return t}else if("error"===n.type)_(n,e);else{if("tree"!==n.type)throw new r(`Unknown endpoint rule: ${n}`);{const t=T.evaluateTreeRule(n,e);if(t)return t}}throw new r("Rules evaluation failed")},T={evaluateRules:C,evaluateTreeRule:(t,e)=>{const{conditions:n,rules:i}=t,{result:s,referenceRecord:r}=y(n,e);if(s)return T.evaluateRules(i,{...e,referenceRecord:{...e.referenceRecord,...r}})}},k=(t,e)=>{const{endpointParams:n,logger:o}=e,{parameters:a,rules:c}=t;e.logger?.debug?.(`${i} Initial EndpointParams: ${s(n)}`);const l=Object.entries(a).filter(([,t])=>null!=t.default).map(([t,e])=>[t,e.default]);if(l.length>0)for(const[t,e]of l)n[t]=n[t]??e;const h=Object.entries(a).filter(([,t])=>t.required).map(([t])=>t);for(const t of h)if(null==n[t])throw new r(`Missing required parameter: '${t}'`);const d=C(c,{endpointParams:n,logger:o,referenceRecord:{}});return e.logger?.debug?.(`${i} Resolved endpoint: ${s(d)}`),d}},3127:function(t,e,n){"use strict";var i,s=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(e,n);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,s)}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||(i=function(t){return i=Object.getOwnPropertyNames||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[e.length]=n);return e},i(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n=i(t),o=0;o<n.length;o++)"default"!==n[o]&&s(e,t,n[o]);return r(e,t),e});Object.defineProperty(e,"__esModule",{value:!0}),e.gatherFolderContext=async function(t){const e=c.dirname(t),i=a.readdirSync(e);let s="";const r=a.readFileSync(t,"utf-8");s+=`### Current Document: ${c.basename(t)}\n${r}\n\n`;const o=[".md",".txt",".html",".htm",".xml",".json",".csv",".js",".ts",".jsx",".tsx",".py",".java",".c",".cpp",".h",".css",".scss",".yaml",".yml",".toml",".ini",".cfg",".conf"];for(const n of i){const i=c.join(e,n),r=c.extname(n).toLowerCase();if(o.includes(r)&&i!==t)try{s+=`### ${n}\n${a.readFileSync(i,"utf-8")}\n\n`}catch(t){console.log(`Skipping ${n}: ${t instanceof Error?t.message:String(t)}`)}}for(const t of i)if(t.endsWith(".pdf"))try{const{PDFParse:i}=n(9317),r=a.readFileSync(c.join(e,t));s+=`### ${t}\n${(await i(r)).text}\n\n`}catch(e){console.log(`Skipping ${t}: ${e instanceof Error?e.message:String(e)}`)}return s};const a=o(n(9896)),c=o(n(6928))},3360:(t,e,n)=>{"use strict";n.d(e,{f:()=>o});var i=n(2203),s=n(7260);const r=6e3;async function o(t,e,n=r,o=!1){const a=e.headers??{},c=a.Expect||a.expect;let l=-1,h=!0;o||"100-continue"!==c||(h=await Promise.race([new Promise(t=>{l=Number(s.N.setTimeout(()=>t(!0),Math.max(r,n)))}),new Promise(e=>{t.on("continue",()=>{s.N.clearTimeout(l),e(!0)}),t.on("response",()=>{s.N.clearTimeout(l),e(!1)}),t.on("error",()=>{s.N.clearTimeout(l),e(!1)})})])),h&&function(t,e){if(e instanceof i.Readable)e.pipe(t);else{if(e){if(Buffer.isBuffer(e)||"string"==typeof e)return void t.end(e);const n=e;return"object"==typeof n&&n.buffer&&"number"==typeof n.byteOffset&&"number"==typeof n.byteLength?void t.end(Buffer.from(n.buffer,n.byteOffset,n.byteLength)):void t.end(Buffer.from(e))}t.end()}}(t,e.body)}},3368:(t,e,n)=>{"use strict";n.r(e),n.d(e,{$Command:()=>Pe.u,AccessDeniedException:()=>Le,ApplyGuardrailCommand:()=>ia,ApplyGuardrailRequestFilterSensitiveLog:()=>ui,ApplyGuardrailResponseFilterSensitiveLog:()=>Ti,AsyncInvokeOutputDataConfig:()=>ke,AsyncInvokeStatus:()=>Ne,AsyncInvokeSummaryFilterSensitiveLog:()=>oi,BedrockRuntime:()=>wa,BedrockRuntimeClient:()=>Te,BedrockRuntimeServiceException:()=>Oe,BidirectionalInputPayloadPartFilterSensitiveLog:()=>Ji,BidirectionalOutputPayloadPartFilterSensitiveLog:()=>ts,CachePointType:()=>fn,CitationGeneratedContent:()=>yn,CitationLocation:()=>mn,CitationSourceContent:()=>vn,ConflictException:()=>ze,ContentBlock:()=>On,ContentBlockDelta:()=>Xn,ContentBlockDeltaEventFilterSensitiveLog:()=>Gi,ContentBlockDeltaFilterSensitiveLog:()=>Hi,ContentBlockFilterSensitiveLog:()=>Di,ContentBlockStart:()=>Jn,ConversationRole:()=>Ln,ConverseCommand:()=>sa,ConverseOutput:()=>zn,ConverseOutputFilterSensitiveLog:()=>Fi,ConverseRequestFilterSensitiveLog:()=>Ni,ConverseResponseFilterSensitiveLog:()=>$i,ConverseStreamCommand:()=>ra,ConverseStreamMetadataEventFilterSensitiveLog:()=>Wi,ConverseStreamOutput:()=>Qn,ConverseStreamOutputFilterSensitiveLog:()=>qi,ConverseStreamRequestFilterSensitiveLog:()=>ji,ConverseStreamResponseFilterSensitiveLog:()=>Ki,ConverseStreamTraceFilterSensitiveLog:()=>Vi,ConverseTokensRequestFilterSensitiveLog:()=>as,ConverseTraceFilterSensitiveLog:()=>Ui,CountTokensCommand:()=>oa,CountTokensInput:()=>si,CountTokensInputFilterSensitiveLog:()=>ls,CountTokensRequestFilterSensitiveLog:()=>hs,DocumentContentBlock:()=>wn,DocumentFormat:()=>bn,DocumentSource:()=>An,GetAsyncInvokeCommand:()=>aa,GetAsyncInvokeResponseFilterSensitiveLog:()=>ri,GuardrailAction:()=>Qe,GuardrailAssessmentFilterSensitiveLog:()=>Ci,GuardrailAutomatedReasoningFinding:()=>tn,GuardrailAutomatedReasoningFindingFilterSensitiveLog:()=>Ei,GuardrailAutomatedReasoningImpossibleFindingFilterSensitiveLog:()=>vi,GuardrailAutomatedReasoningInputTextReferenceFilterSensitiveLog:()=>fi,GuardrailAutomatedReasoningInvalidFindingFilterSensitiveLog:()=>yi,GuardrailAutomatedReasoningLogicWarningFilterSensitiveLog:()=>gi,GuardrailAutomatedReasoningLogicWarningType:()=>Ze,GuardrailAutomatedReasoningPolicyAssessmentFilterSensitiveLog:()=>_i,GuardrailAutomatedReasoningSatisfiableFindingFilterSensitiveLog:()=>wi,GuardrailAutomatedReasoningScenarioFilterSensitiveLog:()=>bi,GuardrailAutomatedReasoningStatementFilterSensitiveLog:()=>pi,GuardrailAutomatedReasoningTranslationAmbiguousFindingFilterSensitiveLog:()=>xi,GuardrailAutomatedReasoningTranslationFilterSensitiveLog:()=>mi,GuardrailAutomatedReasoningTranslationOptionFilterSensitiveLog:()=>Ai,GuardrailAutomatedReasoningValidFindingFilterSensitiveLog:()=>Si,GuardrailContentBlock:()=>Ye,GuardrailContentBlockFilterSensitiveLog:()=>di,GuardrailContentFilterConfidence:()=>nn,GuardrailContentFilterStrength:()=>sn,GuardrailContentFilterType:()=>rn,GuardrailContentPolicyAction:()=>en,GuardrailContentQualifier:()=>Ke,GuardrailContentSource:()=>Je,GuardrailContextualGroundingFilterType:()=>an,GuardrailContextualGroundingPolicyAction:()=>on,GuardrailConverseContentBlock:()=>_n,GuardrailConverseContentBlockFilterSensitiveLog:()=>Ii,GuardrailConverseContentQualifier:()=>En,GuardrailConverseImageBlockFilterSensitiveLog:()=>Ri,GuardrailConverseImageFormat:()=>xn,GuardrailConverseImageSource:()=>Sn,GuardrailConverseImageSourceFilterSensitiveLog:()=>ki,GuardrailImageBlockFilterSensitiveLog:()=>hi,GuardrailImageFormat:()=>We,GuardrailImageSource:()=>qe,GuardrailImageSourceFilterSensitiveLog:()=>li,GuardrailManagedWordType:()=>pn,GuardrailOutputScope:()=>Xe,GuardrailPiiEntityType:()=>ln,GuardrailSensitiveInformationPolicyAction:()=>cn,GuardrailStreamProcessingMode:()=>qn,GuardrailTopicPolicyAction:()=>hn,GuardrailTopicType:()=>dn,GuardrailTrace:()=>gn,GuardrailTraceAssessmentFilterSensitiveLog:()=>Bi,GuardrailWordPolicyAction:()=>un,ImageFormat:()=>Cn,ImageSource:()=>Tn,InternalServerException:()=>Fe,InvokeModelCommand:()=>ca,InvokeModelRequestFilterSensitiveLog:()=>Yi,InvokeModelResponseFilterSensitiveLog:()=>Xi,InvokeModelTokensRequestFilterSensitiveLog:()=>cs,InvokeModelWithBidirectionalStreamCommand:()=>fa,InvokeModelWithBidirectionalStreamInput:()=>ei,InvokeModelWithBidirectionalStreamInputFilterSensitiveLog:()=>Qi,InvokeModelWithBidirectionalStreamOutput:()=>ni,InvokeModelWithBidirectionalStreamOutputFilterSensitiveLog:()=>es,InvokeModelWithBidirectionalStreamRequestFilterSensitiveLog:()=>Zi,InvokeModelWithBidirectionalStreamResponseFilterSensitiveLog:()=>ns,InvokeModelWithResponseStreamCommand:()=>ma,InvokeModelWithResponseStreamRequestFilterSensitiveLog:()=>is,InvokeModelWithResponseStreamResponseFilterSensitiveLog:()=>os,ListAsyncInvokesCommand:()=>va,ListAsyncInvokesResponseFilterSensitiveLog:()=>ai,MessageFilterSensitiveLog:()=>Oi,ModelErrorException:()=>Gn,ModelNotReadyException:()=>Vn,ModelStreamErrorException:()=>Zn,ModelTimeoutException:()=>Wn,PayloadPartFilterSensitiveLog:()=>ss,PerformanceConfigLatency:()=>Nn,PromptVariableValues:()=>Fn,ReasoningContentBlock:()=>kn,ReasoningContentBlockDelta:()=>Kn,ReasoningContentBlockDeltaFilterSensitiveLog:()=>zi,ReasoningContentBlockFilterSensitiveLog:()=>Mi,ReasoningTextBlockFilterSensitiveLog:()=>Pi,ResourceNotFoundException:()=>He,ResponseStream:()=>ii,ResponseStreamFilterSensitiveLog:()=>rs,ServiceQuotaExceededException:()=>Ge,ServiceUnavailableException:()=>Ve,SortAsyncInvocationBy:()=>$e,SortOrder:()=>je,StartAsyncInvokeCommand:()=>ya,StartAsyncInvokeRequestFilterSensitiveLog:()=>ci,StopReason:()=>Hn,SystemContentBlock:()=>Bn,SystemContentBlockFilterSensitiveLog:()=>Li,ThrottlingException:()=>Be,Tool:()=>jn,ToolChoice:()=>Un,ToolInputSchema:()=>$n,ToolResultBlockDelta:()=>Yn,ToolResultContentBlock:()=>Pn,ToolResultStatus:()=>Mn,ToolUseType:()=>Dn,Trace:()=>ti,ValidationException:()=>Ue,VideoFormat:()=>Rn,VideoSource:()=>In,__Client:()=>y.K,paginateListAsyncInvokes:()=>Sa});var i=n(1095),s=n(7813),r=n(8879),o=n(7287),a=n(8059),c=n(7324);class l{signer;constructor(t){this.signer=t.signer}presign(t,e={}){return this.signer.presign(t,e)}async sign(t,e){return!c.K.isInstance(t)||"ws:"!==(n=t).protocol&&"wss:"!==n.protocol?this.signer.sign(t,e):{...await this.signer.presign({...t,body:""},{...e,expiresIn:60,unsignableHeaders:new Set(Object.keys(t.headers).filter(t=>"host"!==t))}),body:t.body};var n}}var h=n(4014),d=n(2404),u=n(612),p=n(5172),g=n(649),f=n(2795),m=n(5963),v=n(9774),y=n(7821),b=n(7389),w=n(1431),A=n(6116),x=n(8947);const S=async(t,e,n)=>({operation:(0,A.u)(e).operation,region:await(0,x.t)(t.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()}),E=t=>{const e=[];return t.operation,e.push(function(t){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"bedrock",region:t.region},propertiesExtractor:(t,e)=>({signingProperties:{config:t,context:e}})}}(t)),e.push({schemeId:"smithy.api#httpBearerAuth",propertiesExtractor:({profile:t,filepath:e,configFilepath:n,ignoreCache:i},s)=>({identityProperties:{profile:t,filepath:e,configFilepath:n,ignoreCache:i}})}),e},_={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};var C=n(5122),T=n(4653),k=n(6228),R=n(1478),I=n(3052),P=n(6437),M=n(8062);const D="AWS_EC2_METADATA_DISABLED";let O=!1;const L=(t={})=>function(t,e){const n=(t=>async e=>{let n;for(const i of t)try{return await i(e)}catch(t){if(n=t,t?.tryNextLink)continue;throw t}throw n})(t);let i,s,r;const o=async t=>{if(t?.forceRefresh)return await n(t);if(r?.expiration&&r?.expiration?.getTime()<Date.now()&&(r=void 0),i)await i;else if(!r||e?.(r)){if(!r)return i=n(t).then(t=>{r=t,i=void 0}),o(t);s||(s=n(t).then(t=>{r=t,s=void 0}))}return r};return o}([async()=>{if(t.profile??process.env[P.Ch])throw process.env[R.yG]&&process.env[R.pi]&&!O&&((t.logger?.warn&&"NoOpLogger"!==t.logger?.constructor?.name?t.logger.warn.bind(t.logger):console.warn)("@aws-sdk/credential-provider-node - defaultProvider::fromEnv WARNING:\n    Multiple credential sources detected: \n    Both AWS_PROFILE and the pair AWS_ACCESS_KEY_ID/AWS_SECRET_ACCESS_KEY static credentials are set.\n    This SDK will proceed with the AWS_PROFILE value.\n    \n    However, a future version may change this behavior to prefer the ENV static credentials.\n    Please ensure that your environment only sets either the AWS_PROFILE or the\n    AWS_ACCESS_KEY_ID/AWS_SECRET_ACCESS_KEY pair.\n"),O=!0),new I.C("AWS_PROFILE is set, skipping fromEnv provider.",{logger:t.logger,tryNextLink:!0});return t.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromEnv"),(0,R.sF)(t)()},async e=>{t.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromSSO");const{ssoStartUrl:i,ssoAccountId:s,ssoRegion:r,ssoRoleName:o,ssoSession:a}=t;if(!(i||s||r||o||a))throw new I.C("Skipping SSO provider in default chain (inputs do not include SSO fields).",{logger:t.logger});const{fromSSO:c}=await n.e(781).then(n.bind(n,2781));return c(t)(e)},async e=>{t.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromIni");const{fromIni:i}=await n.e(789).then(n.bind(n,2789));return i(t)(e)},async e=>{t.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromProcess");const{fromProcess:i}=await n.e(109).then(n.bind(n,5109));return i(t)(e)},async e=>{t.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromTokenFile");const{fromTokenFile:i}=await n.e(819).then(n.bind(n,7819));return i(t)(e)},async()=>(t.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::remoteProvider"),(await(async t=>{const{ENV_CMDS_FULL_URI:e,ENV_CMDS_RELATIVE_URI:i,fromContainerMetadata:s,fromInstanceMetadata:r}=await n.e(897).then(n.bind(n,7897));if(process.env[i]||process.env[e]){t.logger?.debug("@aws-sdk/credential-provider-node - remoteProvider::fromHttp/fromContainerMetadata");const{fromHttp:e}=await n.e(703).then(n.bind(n,8703));return(0,M.c)(e(t),s(t))}return process.env[D]&&"false"!==process.env[D]?async()=>{throw new I.C("EC2 Instance Metadata Service access disabled",{logger:t.logger})}:(t.logger?.debug("@aws-sdk/credential-provider-node - remoteProvider::fromInstanceMetadata"),r(t))})(t))()),async()=>{throw new I.C("Could not load credentials from any providers",{tryNextLink:!1,logger:t.logger})}],N),N=t=>void 0!==t?.expiration&&t.expiration.getTime()-Date.now()<3e5;Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var F=n(181),B="undefined"!=typeof Buffer&&Buffer.from?function(t){return Buffer.from(t,"utf8")}:t=>{const e=((t,e)=>{if("string"!=typeof t)throw new TypeError(`The "input" argument must be of type string. Received type ${typeof t} (${t})`);return e?F.Buffer.from(t,e):F.Buffer.from(t)})(t,"utf8");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT)};!function(){function t(){this.crc32=new $}t.prototype.update=function(t){var e;("string"==typeof(e=t)?0!==e.length:0!==e.byteLength)&&this.crc32.update(function(t){return t instanceof Uint8Array?t:"string"==typeof t?B(t):ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(t)}(t))},t.prototype.digest=function(){return t=this,e=void 0,i=function(){return function(t,e){var n,i,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(r=0)),r;)try{if(n=1,i&&(s=2&a[0]?i.return:a[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,a[1])).done)return s;switch(i=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!((s=(s=r.trys).length>0&&s[s.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){r.label=a[1];break}if(6===a[0]&&r.label<s[1]){r.label=s[1],s=a;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(a);break}s[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],i=0}finally{n=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(t){return[2,(e=this.crc32.digest(),new Uint8Array([(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))];var e})},new((n=void 0)||(n=Promise))(function(s,r){function o(t){try{c(i.next(t))}catch(t){r(t)}}function a(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())});var t,e,n,i},t.prototype.reset=function(){this.crc32=new $}}();var U,$=function(){function t(){this.checksum=4294967295}return t.prototype.update=function(t){var e,n;try{for(var i=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),s=i.next();!s.done;s=i.next()){var r=s.value;this.checksum=this.checksum>>>8^j[255&(this.checksum^r)]}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return this},t.prototype.digest=function(){return(4294967295^this.checksum)>>>0},t}(),j=function(t){if(!Uint32Array.from){for(var e=new Uint32Array(t.length),n=0;n<t.length;)e[n]=t[n],n+=1;return e}return Uint32Array.from(t)}([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]),z=n(8004);class H{bytes;constructor(t){if(this.bytes=t,8!==t.byteLength)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(t){if(t>0x8000000000000000||t<-0x8000000000000000)throw new Error(`${t} is too large (or, if negative, too small) to represent as an Int64`);const e=new Uint8Array(8);for(let n=7,i=Math.abs(Math.round(t));n>-1&&i>0;n--,i/=256)e[n]=i;return t<0&&G(e),new H(e)}valueOf(){const t=this.bytes.slice(0),e=128&t[0];return e&&G(t),parseInt((0,z.n)(t),16)*(e?-1:1)}toString(){return String(this.valueOf())}}function G(t){for(let e=0;e<8;e++)t[e]^=255;for(let e=7;e>-1&&(t[e]++,0===t[e]);e--);}class V{toUtf8;fromUtf8;constructor(t,e){this.toUtf8=t,this.fromUtf8=e}format(t){const e=[];for(const n of Object.keys(t)){const i=this.fromUtf8(n);e.push(Uint8Array.from([i.byteLength]),i,this.formatHeaderValue(t[n]))}const n=new Uint8Array(e.reduce((t,e)=>t+e.byteLength,0));let i=0;for(const t of e)n.set(t,i),i+=t.byteLength;return n}formatHeaderValue(t){switch(t.type){case"boolean":return Uint8Array.from([t.value?0:1]);case"byte":return Uint8Array.from([2,t.value]);case"short":const e=new DataView(new ArrayBuffer(3));return e.setUint8(0,3),e.setInt16(1,t.value,!1),new Uint8Array(e.buffer);case"integer":const n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,t.value,!1),new Uint8Array(n.buffer);case"long":const i=new Uint8Array(9);return i[0]=5,i.set(t.value.bytes,1),i;case"binary":const s=new DataView(new ArrayBuffer(3+t.value.byteLength));s.setUint8(0,6),s.setUint16(1,t.value.byteLength,!1);const r=new Uint8Array(s.buffer);return r.set(t.value,3),r;case"string":const o=this.fromUtf8(t.value),a=new DataView(new ArrayBuffer(3+o.byteLength));a.setUint8(0,7),a.setUint16(1,o.byteLength,!1);const c=new Uint8Array(a.buffer);return c.set(o,3),c;case"timestamp":const l=new Uint8Array(9);return l[0]=8,l.set(H.fromNumber(t.value.valueOf()).bytes,1),l;case"uuid":if(!et.test(t.value))throw new Error(`Invalid UUID received: ${t.value}`);const h=new Uint8Array(17);return h[0]=9,h.set((0,z.a)(t.value.replace(/\-/g,"")),1),h}}parse(t){const e={};let n=0;for(;n<t.byteLength;){const i=t.getUint8(n++),s=this.toUtf8(new Uint8Array(t.buffer,t.byteOffset+n,i));switch(n+=i,t.getUint8(n++)){case 0:e[s]={type:W,value:!0};break;case 1:e[s]={type:W,value:!1};break;case 2:e[s]={type:q,value:t.getInt8(n++)};break;case 3:e[s]={type:K,value:t.getInt16(n,!1)},n+=2;break;case 4:e[s]={type:Y,value:t.getInt32(n,!1)},n+=4;break;case 5:e[s]={type:X,value:new H(new Uint8Array(t.buffer,t.byteOffset+n,8))},n+=8;break;case 6:const i=t.getUint16(n,!1);n+=2,e[s]={type:J,value:new Uint8Array(t.buffer,t.byteOffset+n,i)},n+=i;break;case 7:const r=t.getUint16(n,!1);n+=2,e[s]={type:Q,value:this.toUtf8(new Uint8Array(t.buffer,t.byteOffset+n,r))},n+=r;break;case 8:e[s]={type:Z,value:new Date(new H(new Uint8Array(t.buffer,t.byteOffset+n,8)).valueOf())},n+=8;break;case 9:const o=new Uint8Array(t.buffer,t.byteOffset+n,16);n+=16,e[s]={type:tt,value:`${(0,z.n)(o.subarray(0,4))}-${(0,z.n)(o.subarray(4,6))}-${(0,z.n)(o.subarray(6,8))}-${(0,z.n)(o.subarray(8,10))}-${(0,z.n)(o.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return e}}!function(t){t[t.boolTrue=0]="boolTrue",t[t.boolFalse=1]="boolFalse",t[t.byte=2]="byte",t[t.short=3]="short",t[t.integer=4]="integer",t[t.long=5]="long",t[t.byteArray=6]="byteArray",t[t.string=7]="string",t[t.timestamp=8]="timestamp",t[t.uuid=9]="uuid"}(U||(U={}));const W="boolean",q="byte",K="short",Y="integer",X="long",J="binary",Q="string",Z="timestamp",tt="uuid",et=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;class nt{headerMarshaller;messageBuffer;isEndOfStream;constructor(t,e){this.headerMarshaller=new V(t,e),this.messageBuffer=[],this.isEndOfStream=!1}feed(t){this.messageBuffer.push(this.decode(t))}endOfStream(){this.isEndOfStream=!0}getMessage(){const t=this.messageBuffer.pop(),e=this.isEndOfStream;return{getMessage:()=>t,isEndOfStream:()=>e}}getAvailableMessages(){const t=this.messageBuffer;this.messageBuffer=[];const e=this.isEndOfStream;return{getMessages:()=>t,isEndOfStream:()=>e}}encode({headers:t,body:e}){const n=this.headerMarshaller.format(t),i=n.byteLength+e.byteLength+16,s=new Uint8Array(i),r=new DataView(s.buffer,s.byteOffset,s.byteLength),o=new $;return r.setUint32(0,i,!1),r.setUint32(4,n.byteLength,!1),r.setUint32(8,o.update(s.subarray(0,8)).digest(),!1),s.set(n,12),s.set(e,n.byteLength+12),r.setUint32(i-4,o.update(s.subarray(8,i-4)).digest(),!1),s}decode(t){const{headers:e,body:n}=function({byteLength:t,byteOffset:e,buffer:n}){if(t<16)throw new Error("Provided message too short to accommodate event stream message overhead");const i=new DataView(n,e,t),s=i.getUint32(0,!1);if(t!==s)throw new Error("Reported message length does not match received message length");const r=i.getUint32(4,!1),o=i.getUint32(8,!1),a=i.getUint32(t-4,!1),c=(new $).update(new Uint8Array(n,e,8));if(o!==c.digest())throw new Error(`The prelude checksum specified in the message (${o}) does not match the calculated CRC32 checksum (${c.digest()})`);if(c.update(new Uint8Array(n,e+8,t-12)),a!==c.digest())throw new Error(`The message checksum (${c.digest()}) did not match the expected value of ${a}`);return{headers:new DataView(n,e+8+4,r),body:new Uint8Array(n,e+8+4+r,s-r-16)}}(t);return{headers:this.headerMarshaller.parse(e),body:n}}formatHeaders(t){return this.headerMarshaller.format(t)}}var it=n(2203);class st extends it.Transform{priorSignature;messageSigner;eventStreamCodec;systemClockOffsetProvider;constructor(t){super({autoDestroy:!0,readableObjectMode:!0,writableObjectMode:!0,...t}),this.priorSignature=t.priorSignature,this.eventStreamCodec=t.eventStreamCodec,this.messageSigner=t.messageSigner,this.systemClockOffsetProvider=t.systemClockOffsetProvider}async _transform(t,e,n){try{const e=new Date(Date.now()+await this.systemClockOffsetProvider()),i={":date":{type:"timestamp",value:e}},s=await this.messageSigner.sign({message:{body:t,headers:i},priorSignature:this.priorSignature},{signingDate:e});this.priorSignature=s.signature;const r=this.eventStreamCodec.encode({headers:{...i,":chunk-signature":{type:"binary",value:rt(s.signature)}},body:t});return this.push(r),n()}catch(t){n(t)}}}function rt(t){const e=Buffer.from(t,"hex");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT)}class ot{messageSigner;eventStreamCodec;systemClockOffsetProvider;constructor(t){this.messageSigner=t.messageSigner,this.eventStreamCodec=new nt(t.utf8Encoder,t.utf8Decoder),this.systemClockOffsetProvider=async()=>t.systemClockOffset??0}async handle(t,e,n={}){const i=e.request,{body:s,query:r}=i;if(!(s instanceof it.Readable))throw new Error("Eventstream payload must be a Readable stream.");const o=s;i.body=new it.PassThrough({objectMode:!0});const a=i.headers?.authorization?.match(/Signature=([\w]+)$/),c=new st({priorSignature:a?.[1]??r?.["X-Amz-Signature"]??"",eventStreamCodec:this.eventStreamCodec,messageSigner:await this.messageSigner(),systemClockOffsetProvider:this.systemClockOffsetProvider});let l;(0,it.pipeline)(o,c,i.body,t=>{if(t)throw t});try{l=await t(e)}catch(t){throw i.body.end(),t}return l}}const at=t=>new ot(t);var ct=n(1544),lt=n(7513),ht=n(3783),dt=n(1355),ut=n(8246),pt=n(9915),gt=n(4836),ft=n(2184),mt=n(4570);class vt{async sign(t,e,n){const i=c.K.clone(t);if(!e.token)throw new Error("request could not be signed with `token` since the `token` is not defined");return i.headers.Authorization=`Bearer ${e.token}`,i}}class yt{options;constructor(t){this.options=t}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const t of this.options.messageStream){const e=await this.options.deserializer(t);void 0!==e&&(yield e)}}}class bt{options;constructor(t){this.options=t}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const t of this.options.inputStream){const e=this.options.decoder.decode(t);yield e}}}class wt{options;constructor(t){this.options=t}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const t of this.options.messageStream){const e=this.options.encoder.encode(t);yield e}this.options.includeEndFrame&&(yield new Uint8Array(0))}}class At{options;constructor(t){this.options=t}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const t of this.options.inputStream){const e=this.options.serializer(t);yield e}}}function xt(t,e){return async function(n){const{value:i}=n.headers[":message-type"];if("error"===i){const t=new Error(n.headers[":error-message"].value||"UnknownError");throw t.name=n.headers[":error-code"].value,t}if("exception"===i){const i=n.headers[":exception-type"].value,s={[i]:n},r=await t(s);if(r.$unknown){const t=new Error(e(n.body));throw t.name=i,t}throw r[i]}if("event"===i){const e={[n.headers[":event-type"].value]:n},i=await t(e);if(i.$unknown)return;return i}throw Error(`Unrecognizable event type: ${n.headers[":event-type"].value}`)}}class St{eventStreamCodec;utfEncoder;constructor({utf8Encoder:t,utf8Decoder:e}){this.eventStreamCodec=new nt(t,e),this.utfEncoder=t}deserialize(t,e){const n=function(t){let e=0,n=0,i=null,s=null;const r=t=>{if("number"!=typeof t)throw new Error("Attempted to allocate an event message where size was not a number: "+t);e=t,n=4,i=new Uint8Array(t),new DataView(i.buffer).setUint32(0,t,!1)};return{[Symbol.asyncIterator]:async function*(){const o=t[Symbol.asyncIterator]();for(;;){const{value:t,done:a}=await o.next();if(a){if(!e)return;if(e!==n)throw new Error("Truncated event message received.");return void(yield i)}const c=t.length;let l=0;for(;l<c;){if(!i){const e=c-l;s||(s=new Uint8Array(4));const i=Math.min(4-n,e);if(s.set(t.slice(l,l+i),n),n+=i,l+=i,n<4)break;r(new DataView(s.buffer).getUint32(0,!1)),s=null}const o=Math.min(e-n,c-l);i.set(t.slice(l,l+o),n),n+=o,l+=o,e&&e===n&&(yield i,i=null,e=0,n=0)}}}}}(t);return new yt({messageStream:new bt({inputStream:n,decoder:this.eventStreamCodec}),deserializer:xt(e,this.utfEncoder)})}serialize(t,e){return new wt({messageStream:new At({inputStream:t,serializer:e}),encoder:this.eventStreamCodec,includeEndFrame:!0})}}class Et{universalMarshaller;constructor({utf8Encoder:t,utf8Decoder:e}){this.universalMarshaller=new St({utf8Decoder:e,utf8Encoder:t})}deserialize(t,e){const n="function"==typeof t[Symbol.asyncIterator]?t:async function*(t){let e=!1,n=!1;const i=new Array;for(t.on("error",t=>{if(e||(e=!0),t)throw t}),t.on("data",t=>{i.push(t)}),t.on("end",()=>{e=!0});!n;){const t=await new Promise(t=>setTimeout(()=>t(i.shift()),0));t&&(yield t),n=e&&0===i.length}}(t);return this.universalMarshaller.deserialize(n,e)}serialize(t,e){return it.Readable.from(this.universalMarshaller.serialize(t,e))}}const _t=t=>new Et(t);var Ct=n(1701),Tt=n(4013),kt=n(4094),Rt=n(5901);const It=require("http2");var Pt=n.n(It),Mt=n(6035);class Dt{sessions=[];constructor(t){this.sessions=t??[]}poll(){if(this.sessions.length>0)return this.sessions.shift()}offerLast(t){this.sessions.push(t)}contains(t){return this.sessions.includes(t)}remove(t){this.sessions=this.sessions.filter(e=>e!==t)}[Symbol.iterator](){return this.sessions[Symbol.iterator]()}destroy(t){for(const e of this.sessions)e===t&&(e.destroyed||e.destroy())}}class Ot{constructor(t){if(this.config=t,this.config.maxConcurrency&&this.config.maxConcurrency<=0)throw new RangeError("maxConcurrency must be greater than zero.")}config;sessionCache=new Map;lease(t,e){const n=this.getUrlString(t),i=this.sessionCache.get(n);if(i){const t=i.poll();if(t&&!this.config.disableConcurrency)return t}const s=Pt().connect(n);this.config.maxConcurrency&&s.settings({maxConcurrentStreams:this.config.maxConcurrency},e=>{if(e)throw new Error("Fail to set maxConcurrentStreams to "+this.config.maxConcurrency+"when creating new session for "+t.destination.toString())}),s.unref();const r=()=>{s.destroy(),this.deleteSession(n,s)};s.on("goaway",r),s.on("error",r),s.on("frameError",r),s.on("close",()=>this.deleteSession(n,s)),e.requestTimeout&&s.setTimeout(e.requestTimeout,r);const o=this.sessionCache.get(n)||new Dt;return o.offerLast(s),this.sessionCache.set(n,o),s}deleteSession(t,e){const n=this.sessionCache.get(t);n&&n.contains(e)&&(n.remove(e),this.sessionCache.set(t,n))}release(t,e){const n=this.getUrlString(t);this.sessionCache.get(n)?.offerLast(e)}destroy(){for(const[t,e]of this.sessionCache){for(const t of e)t.destroyed||t.destroy(),e.remove(t);this.sessionCache.delete(t)}}setMaxConcurrentStreams(t){if(t&&t<=0)throw new RangeError("maxConcurrentStreams must be greater than zero.");this.config.maxConcurrency=t}setDisableConcurrentStreams(t){this.config.disableConcurrency=t}getUrlString(t){return t.destination.toString()}}var Lt=n(3360);class Nt{config;configProvider;metadata={handlerProtocol:"h2"};connectionManager=new Ot({});static create(t){return"function"==typeof t?.handle?t:new Nt(t)}constructor(t){this.configProvider=new Promise((e,n)=>{"function"==typeof t?t().then(t=>{e(t||{})}).catch(n):e(t||{})})}destroy(){this.connectionManager.destroy()}async handle(t,{abortSignal:e,requestTimeout:n}={}){this.config||(this.config=await this.configProvider,this.connectionManager.setDisableConcurrentStreams(this.config.disableConcurrentStreams||!1),this.config.maxConcurrentStreams&&this.connectionManager.setMaxConcurrentStreams(this.config.maxConcurrentStreams));const{requestTimeout:i,disableConcurrentStreams:s}=this.config,r=n??i;return new Promise((n,i)=>{let o,a=!1;const c=async t=>{await o,i(t)};if(e?.aborted){a=!0;const t=new Error("Request aborted");return t.name="AbortError",void c(t)}const{hostname:l,method:h,port:d,protocol:u,query:p}=t;let g="";null==t.username&&null==t.password||(g=`${t.username??""}:${t.password??""}@`);const f=`${u}//${g}${l}${d?`:${d}`:""}`,m={destination:new URL(f)},v=this.connectionManager.lease(m,{requestTimeout:this.config?.sessionTimeout,disableConcurrentStreams:s||!1}),y=t=>{s&&this.destroySession(v),a=!0,c(t)},b=(0,Rt.G)(p||{});let w=t.path;b&&(w+=`?${b}`),t.fragment&&(w+=`#${t.fragment}`);const A=v.request({...t.headers,[It.constants.HTTP2_HEADER_PATH]:w,[It.constants.HTTP2_HEADER_METHOD]:h});if(v.ref(),A.on("response",t=>{const e=new kt.c({statusCode:t[":status"]||-1,headers:(0,Mt.u)(t),body:A});a=!0,(async t=>{await o,n(t)})({response:e}),s&&(v.close(),this.connectionManager.deleteSession(f,v))}),r&&A.setTimeout(r,()=>{A.close();const t=new Error(`Stream timed out because of no activity for ${r} ms`);t.name="TimeoutError",y(t)}),e){const t=()=>{A.close();const t=new Error("Request aborted");t.name="AbortError",y(t)};if("function"==typeof e.addEventListener){const n=e;n.addEventListener("abort",t,{once:!0}),A.once("close",()=>n.removeEventListener("abort",t))}else e.onabort=t}A.on("frameError",(t,e,n)=>{y(new Error(`Frame type id ${t} in stream id ${n} has failed with code ${e}.`))}),A.on("error",y),A.on("aborted",()=>{y(new Error(`HTTP/2 stream is abnormally aborted in mid-communication with result code ${A.rstCode}.`))}),A.on("close",()=>{v.unref(),s&&v.destroy(),a||y(new Error("Unexpected error: http2 request did not get a response"))}),o=(0,Lt.f)(A,t,r)})}updateHttpClientConfig(t,e){this.config=void 0,this.configProvider=this.configProvider.then(n=>({...n,[t]:e}))}httpHandlerConfigs(){return this.config??{}}destroySession(t){t.destroyed||t.destroy()}}var Ft=n(5178),Bt=n(1482),Ut=n(7355),$t=n(4098),jt=n(2641),zt=n(1395),Ht=n(9718),Gt=n(7459),Vt=n(7638),Wt=n(643),qt=n(7461),Kt=n(3062),Yt=n(468);const Xt="required",Jt="fn",Qt="argv",Zt="ref",te=!0,ee="isSet",ne="booleanEquals",ie="error",se="endpoint",re="tree",oe="PartitionResult",ae={[Xt]:!1,type:"string"},ce={[Xt]:!0,default:!1,type:"boolean"},le={[Zt]:"Endpoint"},he={[Jt]:ne,[Qt]:[{[Zt]:"UseFIPS"},!0]},de={[Jt]:ne,[Qt]:[{[Zt]:"UseDualStack"},!0]},ue={},pe={[Jt]:"getAttr",[Qt]:[{[Zt]:oe},"supportsFIPS"]},ge={[Jt]:ne,[Qt]:[!0,{[Jt]:"getAttr",[Qt]:[{[Zt]:oe},"supportsDualStack"]}]},fe=[he],me=[de],ve=[{[Zt]:"Region"}],ye={version:"1.0",parameters:{Region:ae,UseDualStack:ce,UseFIPS:ce,Endpoint:ae},rules:[{conditions:[{[Jt]:ee,[Qt]:[le]}],rules:[{conditions:fe,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:ie},{rules:[{conditions:me,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:ie},{endpoint:{url:le,properties:ue,headers:ue},type:se}],type:re}],type:re},{rules:[{conditions:[{[Jt]:ee,[Qt]:ve}],rules:[{conditions:[{[Jt]:"aws.partition",[Qt]:ve,assign:oe}],rules:[{conditions:[he,de],rules:[{conditions:[{[Jt]:ne,[Qt]:[te,pe]},ge],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:ue,headers:ue},type:se}],type:re}],type:re},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:ie}],type:re},{conditions:fe,rules:[{conditions:[{[Jt]:ne,[Qt]:[pe,te]}],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dnsSuffix}",properties:ue,headers:ue},type:se}],type:re}],type:re},{error:"FIPS is enabled but this partition does not support FIPS",type:ie}],type:re},{conditions:me,rules:[{conditions:[ge],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:ue,headers:ue},type:se}],type:re}],type:re},{error:"DualStack is enabled but this partition does not support DualStack",type:ie}],type:re},{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dnsSuffix}",properties:ue,headers:ue},type:se}],type:re}],type:re}],type:re},{error:"Invalid Configuration: Missing Region",type:ie}],type:re}]},be=new qt.k({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),we=(t,e={})=>be.get(t,()=>(0,Kt.s)(ye,{endpointParams:t,logger:e.logger}));Yt.m.aws=Wt.UF;var Ae=n(666),xe=n(1620),Se=n(2339);var Ee=n(4163),_e=n(2927),Ce=n(9984);class Te extends y.K{config;constructor(...[t]){const e=(t=>{(0,Se.I)(process.version);const e=(0,xe.I)(t),n=()=>e().then(Ae.l),i=(t=>({apiVersion:"2023-09-30",base64Decoder:t?.base64Decoder??zt.E,base64Encoder:t?.base64Encoder??Ht.n,disableHostPrefix:t?.disableHostPrefix??!1,endpointProvider:t?.endpointProvider??we,extensions:t?.extensions??[],httpAuthSchemeProvider:t?.httpAuthSchemeProvider??E,httpAuthSchemes:t?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:t=>t.getIdentityProvider("aws.auth#sigv4"),signer:new k.f2},{schemeId:"smithy.api#httpBearerAuth",identityProvider:t=>t.getIdentityProvider("smithy.api#httpBearerAuth"),signer:new vt}],logger:t?.logger??new $t.N,serviceId:t?.serviceId??"Bedrock Runtime",urlParser:t?.urlParser??jt.D,utf8Decoder:t?.utf8Decoder??Gt.a,utf8Encoder:t?.utf8Encoder??Vt.P}))(t);(0,C.I)(process.version);const s={profile:t?.profile,logger:i.logger,signingName:"bedrock"};return{...i,...t,runtime:"node",defaultsMode:e,authSchemePreference:t?.authSchemePreference??(0,Tt.Z)(T.$,s),bodyLengthChecker:t?.bodyLengthChecker??Bt.n,credentialDefaultProvider:t?.credentialDefaultProvider??L,defaultUserAgentProvider:t?.defaultUserAgentProvider??(0,ut.pf)({serviceId:i.serviceId,clientVersion:"3.928.0"}),eventStreamPayloadHandlerProvider:t?.eventStreamPayloadHandlerProvider??at,eventStreamSerdeProvider:t?.eventStreamSerdeProvider??_t,httpAuthSchemes:t?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:t=>t.getIdentityProvider("aws.auth#sigv4"),signer:new k.f2},{schemeId:"smithy.api#httpBearerAuth",identityProvider:t=>t.getIdentityProvider("smithy.api#httpBearerAuth")||(async t=>{try{return await(({logger:t,signingName:e}={})=>async()=>{if(t?.debug?.("@aws-sdk/token-providers - fromEnvSigningName"),!e)throw new lt.J("Please pass 'signingName' to compute environment variable key",{logger:t});const n=(0,ct.R)(e);if(!(n in process.env))throw new lt.J(`Token not present in '${n}' environment variable`,{logger:t});const i={token:process.env[n]};return function(t){t.$source||(t.$source={}),t.$source.BEARER_SERVICE_ENV_VARS="3"}(i),i})({signingName:"bedrock"})()}catch(e){return await((t={})=>(0,ht.B)((0,M.c)((0,dt.Y)(t),async()=>{throw new lt.J("Could not load token from any providers",!1)}),t=>void 0!==t.expiration&&t.expiration.getTime()-Date.now()<3e5,t=>void 0!==t.expiration))(t)(t)}}),signer:new vt}],maxAttempts:t?.maxAttempts??(0,Tt.Z)(m.qs,t),region:t?.region??(0,Tt.Z)(gt.GG,{...gt.zH,...s}),requestHandler:Nt.create(t?.requestHandler??(async()=>({...await n(),disableConcurrentStreams:!0}))),retryMode:t?.retryMode??(0,Tt.Z)({...m.kN,default:async()=>(await n()).retryMode||Ut.L0},t),sha256:t?.sha256??Ct.V.bind(null,"sha256"),streamCollector:t?.streamCollector??Ft.k,useDualstackEndpoint:t?.useDualstackEndpoint??(0,Tt.Z)(ft.e$,s),useFipsEndpoint:t?.useFipsEndpoint??(0,Tt.Z)(mt.Ko,s),userAgentAppId:t?.userAgentAppId??(0,Tt.Z)(pt.hV,s)}})(t||{});super(e),this.initConfig=e;const n=(c=e,Object.assign(c,{useDualstackEndpoint:c.useDualstackEndpoint??!1,useFipsEndpoint:c.useFipsEndpoint??!1,defaultSigningName:"bedrock"}));var c;const y=(0,o.D)(n),A=(0,m.$z)(y),_=(0,h.T)(A),R=(0,i.OV)(_);var I;const P=((t,e)=>{const n=Object.assign((0,Ee.R)(t),(0,Ce.xA)(t),(0,_e.e)(t),(t=>{const e=t.httpAuthSchemes;let n=t.httpAuthSchemeProvider,i=t.credentials,s=t.token;return{setHttpAuthScheme(t){const n=e.findIndex(e=>e.schemeId===t.schemeId);-1===n?e.push(t):e.splice(n,1,t)},httpAuthSchemes:()=>e,setHttpAuthSchemeProvider(t){n=t},httpAuthSchemeProvider:()=>n,setCredentials(t){i=t},credentials:()=>i,setToken(t){s=t},token:()=>s}})(t));return e.forEach(t=>t.configure(n)),Object.assign(t,(0,Ee.$)(n),(0,Ce.uv)(n),(0,_e.j)(n),{httpAuthSchemes:(i=n).httpAuthSchemes(),httpAuthSchemeProvider:i.httpAuthSchemeProvider(),credentials:i.credentials(),token:i.token()});var i})((t=>{const{signer:e}=t;return Object.assign(t,{signer:async t=>{const n=await e(t);if((t=>!!t)(n))return new l({signer:n});throw new Error("Expected WebsocketSignatureV4 signer, please check the client constructor.")}})})(function(t){const e=t.signer,n=t.signer,i=Object.assign(t,{eventSigner:e,messageSigner:n}),s=i.eventStreamPayloadHandlerProvider(i);return Object.assign(i,{eventStreamPayloadHandler:s})}((t=>{const e=(0,w.K4)(t.token,w.OC,w.e),n=(0,b.h)(t);return Object.assign(n,{authSchemePreference:(0,x.t)(t.authSchemePreference??[]),token:e})})((I=(0,f.C)(R),Object.assign(I,{eventStreamMarshaller:I.eventStreamSerdeProvider(I)}))))),t?.extensions||[]);this.config=P,this.middlewareStack.use((0,a.sM)(this.config)),this.middlewareStack.use((0,v.ey)(this.config)),this.middlewareStack.use((0,g.vK)(this.config)),this.middlewareStack.use((0,i.TC)(this.config)),this.middlewareStack.use((0,s.Y7)(this.config)),this.middlewareStack.use((0,r.n)(this.config)),this.middlewareStack.use((0,d.w)(this.config,{httpAuthSchemeParametersProvider:S,identityProviderConfigProvider:async t=>new u.h({"aws.auth#sigv4":t.credentials,"smithy.api#httpBearerAuth":t.token})})),this.middlewareStack.use((0,p.l)(this.config))}destroy(){super.destroy()}}var ke,Re=n(6768),Ie=n(1698),Pe=n(4957),Me=n(2809),De=n(4384);class Oe extends De.T{constructor(t){super(t),Object.setPrototypeOf(this,Oe.prototype)}}class Le extends Oe{name="AccessDeniedException";$fault="client";constructor(t){super({name:"AccessDeniedException",$fault:"client",...t}),Object.setPrototypeOf(this,Le.prototype)}}!function(t){t.visit=(t,e)=>void 0!==t.s3OutputDataConfig?e.s3OutputDataConfig(t.s3OutputDataConfig):e._(t.$unknown[0],t.$unknown[1])}(ke||(ke={}));const Ne={COMPLETED:"Completed",FAILED:"Failed",IN_PROGRESS:"InProgress"};class Fe extends Oe{name="InternalServerException";$fault="server";constructor(t){super({name:"InternalServerException",$fault:"server",...t}),Object.setPrototypeOf(this,Fe.prototype)}}class Be extends Oe{name="ThrottlingException";$fault="client";constructor(t){super({name:"ThrottlingException",$fault:"client",...t}),Object.setPrototypeOf(this,Be.prototype)}}class Ue extends Oe{name="ValidationException";$fault="client";constructor(t){super({name:"ValidationException",$fault:"client",...t}),Object.setPrototypeOf(this,Ue.prototype)}}const $e={SUBMISSION_TIME:"SubmissionTime"},je={ASCENDING:"Ascending",DESCENDING:"Descending"};class ze extends Oe{name="ConflictException";$fault="client";constructor(t){super({name:"ConflictException",$fault:"client",...t}),Object.setPrototypeOf(this,ze.prototype)}}class He extends Oe{name="ResourceNotFoundException";$fault="client";constructor(t){super({name:"ResourceNotFoundException",$fault:"client",...t}),Object.setPrototypeOf(this,He.prototype)}}class Ge extends Oe{name="ServiceQuotaExceededException";$fault="client";constructor(t){super({name:"ServiceQuotaExceededException",$fault:"client",...t}),Object.setPrototypeOf(this,Ge.prototype)}}class Ve extends Oe{name="ServiceUnavailableException";$fault="server";constructor(t){super({name:"ServiceUnavailableException",$fault:"server",...t}),Object.setPrototypeOf(this,Ve.prototype)}}const We={JPEG:"jpeg",PNG:"png"};var qe;!function(t){t.visit=(t,e)=>void 0!==t.bytes?e.bytes(t.bytes):e._(t.$unknown[0],t.$unknown[1])}(qe||(qe={}));const Ke={GROUNDING_SOURCE:"grounding_source",GUARD_CONTENT:"guard_content",QUERY:"query"};var Ye;!function(t){t.visit=(t,e)=>void 0!==t.text?e.text(t.text):void 0!==t.image?e.image(t.image):e._(t.$unknown[0],t.$unknown[1])}(Ye||(Ye={}));const Xe={FULL:"FULL",INTERVENTIONS:"INTERVENTIONS"},Je={INPUT:"INPUT",OUTPUT:"OUTPUT"},Qe={GUARDRAIL_INTERVENED:"GUARDRAIL_INTERVENED",NONE:"NONE"},Ze={ALWAYS_FALSE:"ALWAYS_FALSE",ALWAYS_TRUE:"ALWAYS_TRUE"};var tn;!function(t){t.visit=(t,e)=>void 0!==t.valid?e.valid(t.valid):void 0!==t.invalid?e.invalid(t.invalid):void 0!==t.satisfiable?e.satisfiable(t.satisfiable):void 0!==t.impossible?e.impossible(t.impossible):void 0!==t.translationAmbiguous?e.translationAmbiguous(t.translationAmbiguous):void 0!==t.tooComplex?e.tooComplex(t.tooComplex):void 0!==t.noTranslations?e.noTranslations(t.noTranslations):e._(t.$unknown[0],t.$unknown[1])}(tn||(tn={}));const en={BLOCKED:"BLOCKED",NONE:"NONE"},nn={HIGH:"HIGH",LOW:"LOW",MEDIUM:"MEDIUM",NONE:"NONE"},sn={HIGH:"HIGH",LOW:"LOW",MEDIUM:"MEDIUM",NONE:"NONE"},rn={HATE:"HATE",INSULTS:"INSULTS",MISCONDUCT:"MISCONDUCT",PROMPT_ATTACK:"PROMPT_ATTACK",SEXUAL:"SEXUAL",VIOLENCE:"VIOLENCE"},on={BLOCKED:"BLOCKED",NONE:"NONE"},an={GROUNDING:"GROUNDING",RELEVANCE:"RELEVANCE"},cn={ANONYMIZED:"ANONYMIZED",BLOCKED:"BLOCKED",NONE:"NONE"},ln={ADDRESS:"ADDRESS",AGE:"AGE",AWS_ACCESS_KEY:"AWS_ACCESS_KEY",AWS_SECRET_KEY:"AWS_SECRET_KEY",CA_HEALTH_NUMBER:"CA_HEALTH_NUMBER",CA_SOCIAL_INSURANCE_NUMBER:"CA_SOCIAL_INSURANCE_NUMBER",CREDIT_DEBIT_CARD_CVV:"CREDIT_DEBIT_CARD_CVV",CREDIT_DEBIT_CARD_EXPIRY:"CREDIT_DEBIT_CARD_EXPIRY",CREDIT_DEBIT_CARD_NUMBER:"CREDIT_DEBIT_CARD_NUMBER",DRIVER_ID:"DRIVER_ID",EMAIL:"EMAIL",INTERNATIONAL_BANK_ACCOUNT_NUMBER:"INTERNATIONAL_BANK_ACCOUNT_NUMBER",IP_ADDRESS:"IP_ADDRESS",LICENSE_PLATE:"LICENSE_PLATE",MAC_ADDRESS:"MAC_ADDRESS",NAME:"NAME",PASSWORD:"PASSWORD",PHONE:"PHONE",PIN:"PIN",SWIFT_CODE:"SWIFT_CODE",UK_NATIONAL_HEALTH_SERVICE_NUMBER:"UK_NATIONAL_HEALTH_SERVICE_NUMBER",UK_NATIONAL_INSURANCE_NUMBER:"UK_NATIONAL_INSURANCE_NUMBER",UK_UNIQUE_TAXPAYER_REFERENCE_NUMBER:"UK_UNIQUE_TAXPAYER_REFERENCE_NUMBER",URL:"URL",USERNAME:"USERNAME",US_BANK_ACCOUNT_NUMBER:"US_BANK_ACCOUNT_NUMBER",US_BANK_ROUTING_NUMBER:"US_BANK_ROUTING_NUMBER",US_INDIVIDUAL_TAX_IDENTIFICATION_NUMBER:"US_INDIVIDUAL_TAX_IDENTIFICATION_NUMBER",US_PASSPORT_NUMBER:"US_PASSPORT_NUMBER",US_SOCIAL_SECURITY_NUMBER:"US_SOCIAL_SECURITY_NUMBER",VEHICLE_IDENTIFICATION_NUMBER:"VEHICLE_IDENTIFICATION_NUMBER"},hn={BLOCKED:"BLOCKED",NONE:"NONE"},dn={DENY:"DENY"},un={BLOCKED:"BLOCKED",NONE:"NONE"},pn={PROFANITY:"PROFANITY"},gn={DISABLED:"disabled",ENABLED:"enabled",ENABLED_FULL:"enabled_full"},fn={DEFAULT:"default"};var mn,vn,yn;!function(t){t.visit=(t,e)=>void 0!==t.web?e.web(t.web):void 0!==t.documentChar?e.documentChar(t.documentChar):void 0!==t.documentPage?e.documentPage(t.documentPage):void 0!==t.documentChunk?e.documentChunk(t.documentChunk):e._(t.$unknown[0],t.$unknown[1])}(mn||(mn={})),function(t){t.visit=(t,e)=>void 0!==t.text?e.text(t.text):e._(t.$unknown[0],t.$unknown[1])}(vn||(vn={})),function(t){t.visit=(t,e)=>void 0!==t.text?e.text(t.text):e._(t.$unknown[0],t.$unknown[1])}(yn||(yn={}));const bn={CSV:"csv",DOC:"doc",DOCX:"docx",HTML:"html",MD:"md",PDF:"pdf",TXT:"txt",XLS:"xls",XLSX:"xlsx"};var wn,An;!function(t){t.visit=(t,e)=>void 0!==t.text?e.text(t.text):e._(t.$unknown[0],t.$unknown[1])}(wn||(wn={})),function(t){t.visit=(t,e)=>void 0!==t.bytes?e.bytes(t.bytes):void 0!==t.s3Location?e.s3Location(t.s3Location):void 0!==t.text?e.text(t.text):void 0!==t.content?e.content(t.content):e._(t.$unknown[0],t.$unknown[1])}(An||(An={}));const xn={JPEG:"jpeg",PNG:"png"};var Sn;!function(t){t.visit=(t,e)=>void 0!==t.bytes?e.bytes(t.bytes):e._(t.$unknown[0],t.$unknown[1])}(Sn||(Sn={}));const En={GROUNDING_SOURCE:"grounding_source",GUARD_CONTENT:"guard_content",QUERY:"query"};var _n;!function(t){t.visit=(t,e)=>void 0!==t.text?e.text(t.text):void 0!==t.image?e.image(t.image):e._(t.$unknown[0],t.$unknown[1])}(_n||(_n={}));const Cn={GIF:"gif",JPEG:"jpeg",PNG:"png",WEBP:"webp"};var Tn,kn;!function(t){t.visit=(t,e)=>void 0!==t.bytes?e.bytes(t.bytes):void 0!==t.s3Location?e.s3Location(t.s3Location):e._(t.$unknown[0],t.$unknown[1])}(Tn||(Tn={})),function(t){t.visit=(t,e)=>void 0!==t.reasoningText?e.reasoningText(t.reasoningText):void 0!==t.redactedContent?e.redactedContent(t.redactedContent):e._(t.$unknown[0],t.$unknown[1])}(kn||(kn={}));const Rn={FLV:"flv",MKV:"mkv",MOV:"mov",MP4:"mp4",MPEG:"mpeg",MPG:"mpg",THREE_GP:"three_gp",WEBM:"webm",WMV:"wmv"};var In,Pn;!function(t){t.visit=(t,e)=>void 0!==t.bytes?e.bytes(t.bytes):void 0!==t.s3Location?e.s3Location(t.s3Location):e._(t.$unknown[0],t.$unknown[1])}(In||(In={})),function(t){t.visit=(t,e)=>void 0!==t.json?e.json(t.json):void 0!==t.text?e.text(t.text):void 0!==t.image?e.image(t.image):void 0!==t.document?e.document(t.document):void 0!==t.video?e.video(t.video):e._(t.$unknown[0],t.$unknown[1])}(Pn||(Pn={}));const Mn={ERROR:"error",SUCCESS:"success"},Dn={SERVER_TOOL_USE:"server_tool_use"};var On;!function(t){t.visit=(t,e)=>void 0!==t.text?e.text(t.text):void 0!==t.image?e.image(t.image):void 0!==t.document?e.document(t.document):void 0!==t.video?e.video(t.video):void 0!==t.toolUse?e.toolUse(t.toolUse):void 0!==t.toolResult?e.toolResult(t.toolResult):void 0!==t.guardContent?e.guardContent(t.guardContent):void 0!==t.cachePoint?e.cachePoint(t.cachePoint):void 0!==t.reasoningContent?e.reasoningContent(t.reasoningContent):void 0!==t.citationsContent?e.citationsContent(t.citationsContent):e._(t.$unknown[0],t.$unknown[1])}(On||(On={}));const Ln={ASSISTANT:"assistant",USER:"user"},Nn={OPTIMIZED:"optimized",STANDARD:"standard"};var Fn,Bn,Un,$n,jn,zn;!function(t){t.visit=(t,e)=>void 0!==t.text?e.text(t.text):e._(t.$unknown[0],t.$unknown[1])}(Fn||(Fn={})),function(t){t.visit=(t,e)=>void 0!==t.text?e.text(t.text):void 0!==t.guardContent?e.guardContent(t.guardContent):void 0!==t.cachePoint?e.cachePoint(t.cachePoint):e._(t.$unknown[0],t.$unknown[1])}(Bn||(Bn={})),function(t){t.visit=(t,e)=>void 0!==t.auto?e.auto(t.auto):void 0!==t.any?e.any(t.any):void 0!==t.tool?e.tool(t.tool):e._(t.$unknown[0],t.$unknown[1])}(Un||(Un={})),function(t){t.visit=(t,e)=>void 0!==t.json?e.json(t.json):e._(t.$unknown[0],t.$unknown[1])}($n||($n={})),function(t){t.visit=(t,e)=>void 0!==t.toolSpec?e.toolSpec(t.toolSpec):void 0!==t.systemTool?e.systemTool(t.systemTool):void 0!==t.cachePoint?e.cachePoint(t.cachePoint):e._(t.$unknown[0],t.$unknown[1])}(jn||(jn={})),function(t){t.visit=(t,e)=>void 0!==t.message?e.message(t.message):e._(t.$unknown[0],t.$unknown[1])}(zn||(zn={}));const Hn={CONTENT_FILTERED:"content_filtered",END_TURN:"end_turn",GUARDRAIL_INTERVENED:"guardrail_intervened",MAX_TOKENS:"max_tokens",MODEL_CONTEXT_WINDOW_EXCEEDED:"model_context_window_exceeded",STOP_SEQUENCE:"stop_sequence",TOOL_USE:"tool_use"};class Gn extends Oe{name="ModelErrorException";$fault="client";originalStatusCode;resourceName;constructor(t){super({name:"ModelErrorException",$fault:"client",...t}),Object.setPrototypeOf(this,Gn.prototype),this.originalStatusCode=t.originalStatusCode,this.resourceName=t.resourceName}}class Vn extends Oe{name="ModelNotReadyException";$fault="client";$retryable={};constructor(t){super({name:"ModelNotReadyException",$fault:"client",...t}),Object.setPrototypeOf(this,Vn.prototype)}}class Wn extends Oe{name="ModelTimeoutException";$fault="client";constructor(t){super({name:"ModelTimeoutException",$fault:"client",...t}),Object.setPrototypeOf(this,Wn.prototype)}}const qn={ASYNC:"async",SYNC:"sync"};var Kn,Yn,Xn,Jn,Qn;!function(t){t.visit=(t,e)=>void 0!==t.text?e.text(t.text):void 0!==t.redactedContent?e.redactedContent(t.redactedContent):void 0!==t.signature?e.signature(t.signature):e._(t.$unknown[0],t.$unknown[1])}(Kn||(Kn={})),function(t){t.visit=(t,e)=>void 0!==t.text?e.text(t.text):e._(t.$unknown[0],t.$unknown[1])}(Yn||(Yn={})),function(t){t.visit=(t,e)=>void 0!==t.text?e.text(t.text):void 0!==t.toolUse?e.toolUse(t.toolUse):void 0!==t.toolResult?e.toolResult(t.toolResult):void 0!==t.reasoningContent?e.reasoningContent(t.reasoningContent):void 0!==t.citation?e.citation(t.citation):e._(t.$unknown[0],t.$unknown[1])}(Xn||(Xn={})),function(t){t.visit=(t,e)=>void 0!==t.toolUse?e.toolUse(t.toolUse):void 0!==t.toolResult?e.toolResult(t.toolResult):e._(t.$unknown[0],t.$unknown[1])}(Jn||(Jn={}));class Zn extends Oe{name="ModelStreamErrorException";$fault="client";originalStatusCode;originalMessage;constructor(t){super({name:"ModelStreamErrorException",$fault:"client",...t}),Object.setPrototypeOf(this,Zn.prototype),this.originalStatusCode=t.originalStatusCode,this.originalMessage=t.originalMessage}}!function(t){t.visit=(t,e)=>void 0!==t.messageStart?e.messageStart(t.messageStart):void 0!==t.contentBlockStart?e.contentBlockStart(t.contentBlockStart):void 0!==t.contentBlockDelta?e.contentBlockDelta(t.contentBlockDelta):void 0!==t.contentBlockStop?e.contentBlockStop(t.contentBlockStop):void 0!==t.messageStop?e.messageStop(t.messageStop):void 0!==t.metadata?e.metadata(t.metadata):void 0!==t.internalServerException?e.internalServerException(t.internalServerException):void 0!==t.modelStreamErrorException?e.modelStreamErrorException(t.modelStreamErrorException):void 0!==t.validationException?e.validationException(t.validationException):void 0!==t.throttlingException?e.throttlingException(t.throttlingException):void 0!==t.serviceUnavailableException?e.serviceUnavailableException(t.serviceUnavailableException):e._(t.$unknown[0],t.$unknown[1])}(Qn||(Qn={}));const ti={DISABLED:"DISABLED",ENABLED:"ENABLED",ENABLED_FULL:"ENABLED_FULL"};var ei,ni,ii,si;!function(t){t.visit=(t,e)=>void 0!==t.chunk?e.chunk(t.chunk):e._(t.$unknown[0],t.$unknown[1])}(ei||(ei={})),function(t){t.visit=(t,e)=>void 0!==t.chunk?e.chunk(t.chunk):void 0!==t.internalServerException?e.internalServerException(t.internalServerException):void 0!==t.modelStreamErrorException?e.modelStreamErrorException(t.modelStreamErrorException):void 0!==t.validationException?e.validationException(t.validationException):void 0!==t.throttlingException?e.throttlingException(t.throttlingException):void 0!==t.modelTimeoutException?e.modelTimeoutException(t.modelTimeoutException):void 0!==t.serviceUnavailableException?e.serviceUnavailableException(t.serviceUnavailableException):e._(t.$unknown[0],t.$unknown[1])}(ni||(ni={})),function(t){t.visit=(t,e)=>void 0!==t.chunk?e.chunk(t.chunk):void 0!==t.internalServerException?e.internalServerException(t.internalServerException):void 0!==t.modelStreamErrorException?e.modelStreamErrorException(t.modelStreamErrorException):void 0!==t.validationException?e.validationException(t.validationException):void 0!==t.throttlingException?e.throttlingException(t.throttlingException):void 0!==t.modelTimeoutException?e.modelTimeoutException(t.modelTimeoutException):void 0!==t.serviceUnavailableException?e.serviceUnavailableException(t.serviceUnavailableException):e._(t.$unknown[0],t.$unknown[1])}(ii||(ii={})),function(t){t.visit=(t,e)=>void 0!==t.invokeModel?e.invokeModel(t.invokeModel):void 0!==t.converse?e.converse(t.converse):e._(t.$unknown[0],t.$unknown[1])}(si||(si={}));const ri=t=>({...t,...t.failureMessage&&{failureMessage:Me.$},...t.outputDataConfig&&{outputDataConfig:t.outputDataConfig}}),oi=t=>({...t,...t.failureMessage&&{failureMessage:Me.$},...t.outputDataConfig&&{outputDataConfig:t.outputDataConfig}}),ai=t=>({...t,...t.asyncInvokeSummaries&&{asyncInvokeSummaries:t.asyncInvokeSummaries.map(t=>oi(t))}}),ci=t=>({...t,...t.modelInput&&{modelInput:Me.$},...t.outputDataConfig&&{outputDataConfig:t.outputDataConfig}}),li=t=>void 0!==t.bytes?{bytes:t.bytes}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,hi=t=>({...t,...t.source&&{source:Me.$}}),di=t=>void 0!==t.text?{text:t.text}:void 0!==t.image?{image:Me.$}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,ui=t=>({...t,...t.content&&{content:t.content.map(t=>di(t))}}),pi=t=>({...t,...t.logic&&{logic:Me.$},...t.naturalLanguage&&{naturalLanguage:Me.$}}),gi=t=>({...t,...t.premises&&{premises:t.premises.map(t=>pi(t))},...t.claims&&{claims:t.claims.map(t=>pi(t))}}),fi=t=>({...t,...t.text&&{text:Me.$}}),mi=t=>({...t,...t.premises&&{premises:t.premises.map(t=>pi(t))},...t.claims&&{claims:t.claims.map(t=>pi(t))},...t.untranslatedPremises&&{untranslatedPremises:t.untranslatedPremises.map(t=>fi(t))},...t.untranslatedClaims&&{untranslatedClaims:t.untranslatedClaims.map(t=>fi(t))}}),vi=t=>({...t,...t.translation&&{translation:mi(t.translation)},...t.logicWarning&&{logicWarning:gi(t.logicWarning)}}),yi=t=>({...t,...t.translation&&{translation:mi(t.translation)},...t.logicWarning&&{logicWarning:gi(t.logicWarning)}}),bi=t=>({...t,...t.statements&&{statements:t.statements.map(t=>pi(t))}}),wi=t=>({...t,...t.translation&&{translation:mi(t.translation)},...t.claimsTrueScenario&&{claimsTrueScenario:bi(t.claimsTrueScenario)},...t.claimsFalseScenario&&{claimsFalseScenario:bi(t.claimsFalseScenario)},...t.logicWarning&&{logicWarning:gi(t.logicWarning)}}),Ai=t=>({...t}),xi=t=>({...t}),Si=t=>({...t,...t.translation&&{translation:mi(t.translation)},...t.claimsTrueScenario&&{claimsTrueScenario:bi(t.claimsTrueScenario)},...t.logicWarning&&{logicWarning:gi(t.logicWarning)}}),Ei=t=>void 0!==t.valid?{valid:Si(t.valid)}:void 0!==t.invalid?{invalid:yi(t.invalid)}:void 0!==t.satisfiable?{satisfiable:wi(t.satisfiable)}:void 0!==t.impossible?{impossible:vi(t.impossible)}:void 0!==t.translationAmbiguous?{translationAmbiguous:xi(t.translationAmbiguous)}:void 0!==t.tooComplex?{tooComplex:t.tooComplex}:void 0!==t.noTranslations?{noTranslations:t.noTranslations}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,_i=t=>({...t,...t.findings&&{findings:t.findings.map(t=>Ei(t))}}),Ci=t=>({...t,...t.automatedReasoningPolicy&&{automatedReasoningPolicy:_i(t.automatedReasoningPolicy)}}),Ti=t=>({...t,...t.assessments&&{assessments:t.assessments.map(t=>Ci(t))}}),ki=t=>void 0!==t.bytes?{bytes:t.bytes}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,Ri=t=>({...t,...t.source&&{source:Me.$}}),Ii=t=>void 0!==t.text?{text:t.text}:void 0!==t.image?{image:Me.$}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,Pi=t=>({...t}),Mi=t=>void 0!==t.reasoningText?{reasoningText:Me.$}:void 0!==t.redactedContent?{redactedContent:t.redactedContent}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,Di=t=>void 0!==t.text?{text:t.text}:void 0!==t.image?{image:t.image}:void 0!==t.document?{document:t.document}:void 0!==t.video?{video:t.video}:void 0!==t.toolUse?{toolUse:t.toolUse}:void 0!==t.toolResult?{toolResult:t.toolResult}:void 0!==t.guardContent?{guardContent:Ii(t.guardContent)}:void 0!==t.cachePoint?{cachePoint:t.cachePoint}:void 0!==t.reasoningContent?{reasoningContent:Me.$}:void 0!==t.citationsContent?{citationsContent:t.citationsContent}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,Oi=t=>({...t,...t.content&&{content:t.content.map(t=>Di(t))}}),Li=t=>void 0!==t.text?{text:t.text}:void 0!==t.guardContent?{guardContent:Ii(t.guardContent)}:void 0!==t.cachePoint?{cachePoint:t.cachePoint}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,Ni=t=>({...t,...t.messages&&{messages:t.messages.map(t=>Oi(t))},...t.system&&{system:t.system.map(t=>Li(t))},...t.toolConfig&&{toolConfig:t.toolConfig},...t.promptVariables&&{promptVariables:Me.$},...t.requestMetadata&&{requestMetadata:Me.$}}),Fi=t=>void 0!==t.message?{message:Oi(t.message)}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,Bi=t=>({...t,...t.inputAssessment&&{inputAssessment:Object.entries(t.inputAssessment).reduce((t,[e,n])=>(t[e]=Ci(n),t),{})},...t.outputAssessments&&{outputAssessments:Object.entries(t.outputAssessments).reduce((t,[e,n])=>(t[e]=n.map(t=>Ci(t)),t),{})}}),Ui=t=>({...t,...t.guardrail&&{guardrail:Bi(t.guardrail)}}),$i=t=>({...t,...t.output&&{output:Fi(t.output)},...t.trace&&{trace:Ui(t.trace)}}),ji=t=>({...t,...t.messages&&{messages:t.messages.map(t=>Oi(t))},...t.system&&{system:t.system.map(t=>Li(t))},...t.toolConfig&&{toolConfig:t.toolConfig},...t.promptVariables&&{promptVariables:Me.$},...t.requestMetadata&&{requestMetadata:Me.$}}),zi=t=>void 0!==t.text?{text:t.text}:void 0!==t.redactedContent?{redactedContent:t.redactedContent}:void 0!==t.signature?{signature:t.signature}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,Hi=t=>void 0!==t.text?{text:t.text}:void 0!==t.toolUse?{toolUse:t.toolUse}:void 0!==t.toolResult?{toolResult:t.toolResult.map(t=>t)}:void 0!==t.reasoningContent?{reasoningContent:Me.$}:void 0!==t.citation?{citation:t.citation}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,Gi=t=>({...t,...t.delta&&{delta:Hi(t.delta)}}),Vi=t=>({...t,...t.guardrail&&{guardrail:Bi(t.guardrail)}}),Wi=t=>({...t,...t.trace&&{trace:Vi(t.trace)}}),qi=t=>void 0!==t.messageStart?{messageStart:t.messageStart}:void 0!==t.contentBlockStart?{contentBlockStart:t.contentBlockStart}:void 0!==t.contentBlockDelta?{contentBlockDelta:Gi(t.contentBlockDelta)}:void 0!==t.contentBlockStop?{contentBlockStop:t.contentBlockStop}:void 0!==t.messageStop?{messageStop:t.messageStop}:void 0!==t.metadata?{metadata:Wi(t.metadata)}:void 0!==t.internalServerException?{internalServerException:t.internalServerException}:void 0!==t.modelStreamErrorException?{modelStreamErrorException:t.modelStreamErrorException}:void 0!==t.validationException?{validationException:t.validationException}:void 0!==t.throttlingException?{throttlingException:t.throttlingException}:void 0!==t.serviceUnavailableException?{serviceUnavailableException:t.serviceUnavailableException}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,Ki=t=>({...t,...t.stream&&{stream:"STREAMING_CONTENT"}}),Yi=t=>({...t,...t.body&&{body:Me.$}}),Xi=t=>({...t,...t.body&&{body:Me.$}}),Ji=t=>({...t,...t.bytes&&{bytes:Me.$}}),Qi=t=>void 0!==t.chunk?{chunk:Me.$}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,Zi=t=>({...t,...t.body&&{body:"STREAMING_CONTENT"}}),ts=t=>({...t,...t.bytes&&{bytes:Me.$}}),es=t=>void 0!==t.chunk?{chunk:Me.$}:void 0!==t.internalServerException?{internalServerException:t.internalServerException}:void 0!==t.modelStreamErrorException?{modelStreamErrorException:t.modelStreamErrorException}:void 0!==t.validationException?{validationException:t.validationException}:void 0!==t.throttlingException?{throttlingException:t.throttlingException}:void 0!==t.modelTimeoutException?{modelTimeoutException:t.modelTimeoutException}:void 0!==t.serviceUnavailableException?{serviceUnavailableException:t.serviceUnavailableException}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,ns=t=>({...t,...t.body&&{body:"STREAMING_CONTENT"}}),is=t=>({...t,...t.body&&{body:Me.$}}),ss=t=>({...t,...t.bytes&&{bytes:Me.$}}),rs=t=>void 0!==t.chunk?{chunk:Me.$}:void 0!==t.internalServerException?{internalServerException:t.internalServerException}:void 0!==t.modelStreamErrorException?{modelStreamErrorException:t.modelStreamErrorException}:void 0!==t.validationException?{validationException:t.validationException}:void 0!==t.throttlingException?{throttlingException:t.throttlingException}:void 0!==t.modelTimeoutException?{modelTimeoutException:t.modelTimeoutException}:void 0!==t.serviceUnavailableException?{serviceUnavailableException:t.serviceUnavailableException}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,os=t=>({...t,...t.body&&{body:"STREAMING_CONTENT"}}),as=t=>({...t,...t.messages&&{messages:t.messages.map(t=>Oi(t))},...t.system&&{system:t.system.map(t=>Li(t))}}),cs=t=>({...t,...t.body&&{body:Me.$}}),ls=t=>void 0!==t.invokeModel?{invokeModel:cs(t.invokeModel)}:void 0!==t.converse?{converse:as(t.converse)}:void 0!==t.$unknown?{[t.$unknown[0]]:"UNKNOWN"}:void 0,hs=t=>({...t,...t.input&&{input:ls(t.input)}});var ds=n(1919),us=n(6460);const ps=t=>{if(null!=t)return"object"==typeof t&&"__type"in t&&delete t.__type,(0,us.tN)(t)};var gs=n(9212),fs=n(1226),ms=n(7268),vs=n(212);const ys=t=>{if(t!=t)return"NaN";switch(t){case 1/0:return"Infinity";case-1/0:return"-Infinity";default:return t}},bs=t=>t.toISOString().replace(".000Z","Z");var ws=n(1871),As=n(7308),xs=n(2967),Ss=n(6851);const Es=async(t,e)=>{const n=(0,gs.l)(t,e);let i;return n.bp("/guardrail/{guardrailIdentifier}/version/{guardrailVersion}/apply"),n.p("guardrailIdentifier",()=>t.guardrailIdentifier,"{guardrailIdentifier}",!1),n.p("guardrailVersion",()=>t.guardrailVersion,"{guardrailVersion}",!1),i=JSON.stringify((0,fs.s)(t,{content:t=>kr(t,e),outputScope:[],source:[]})),n.m("POST").h({"content-type":"application/json"}).b(i),n.build()},_s=async(t,e)=>{const n=(0,gs.l)(t,e);let i;return n.bp("/model/{modelId}/converse"),n.p("modelId",()=>t.modelId,"{modelId}",!1),i=JSON.stringify((0,fs.s)(t,{additionalModelRequestFields:t=>Xr(t,e),additionalModelResponseFieldPaths:t=>(0,ms.S)(t),guardrailConfig:t=>(0,ms.S)(t),inferenceConfig:t=>Nr(t,e),messages:t=>Br(t,e),performanceConfig:t=>(0,ms.S)(t),promptVariables:t=>(0,ms.S)(t),requestMetadata:t=>(0,ms.S)(t),system:t=>jr(t,e),toolConfig:t=>zr(t,e)})),n.m("POST").h({"content-type":"application/json"}).b(i),n.build()},Cs=async(t,e)=>{const n=(0,gs.l)(t,e);let i;return n.bp("/model/{modelId}/converse-stream"),n.p("modelId",()=>t.modelId,"{modelId}",!1),i=JSON.stringify((0,fs.s)(t,{additionalModelRequestFields:t=>Xr(t,e),additionalModelResponseFieldPaths:t=>(0,ms.S)(t),guardrailConfig:t=>(0,ms.S)(t),inferenceConfig:t=>Nr(t,e),messages:t=>Br(t,e),performanceConfig:t=>(0,ms.S)(t),promptVariables:t=>(0,ms.S)(t),requestMetadata:t=>(0,ms.S)(t),system:t=>jr(t,e),toolConfig:t=>zr(t,e)})),n.m("POST").h({"content-type":"application/json"}).b(i),n.build()},Ts=async(t,e)=>{const n=(0,gs.l)(t,e);let i;return n.bp("/model/{modelId}/count-tokens"),n.p("modelId",()=>t.modelId,"{modelId}",!1),i=JSON.stringify((0,fs.s)(t,{input:t=>_r(t,e)})),n.m("POST").h({"content-type":"application/json"}).b(i),n.build()},ks=async(t,e)=>{const n=(0,gs.l)(t,e);return n.bp("/async-invoke/{invocationArn}"),n.p("invocationArn",()=>t.invocationArn,"{invocationArn}",!1),n.m("GET").h({}).b(void 0),n.build()},Rs=async(t,e)=>{const n=(0,gs.l)(t,e),i=(0,fs.Tj)({},vs.e,{[Uo]:t[Bo]||"application/octet-stream",[Fo]:t[Fo],[na]:t[Xo],[Zo]:t[$o],[ta]:t[jo],[ea]:t[Go]});let s;return n.bp("/model/{modelId}/invoke"),n.p("modelId",()=>t.modelId,"{modelId}",!1),void 0!==t.body&&(s=t.body),n.m("POST").h(i).b(s),n.build()},Is=async(t,e)=>{const n=(0,gs.l)(t,e);let i;return n.bp("/model/{modelId}/invoke-with-bidirectional-stream"),n.p("modelId",()=>t.modelId,"{modelId}",!1),void 0!==t.body&&(i=sr(t.body,e)),n.m("POST").h({"content-type":"application/json"}).b(i),n.build()},Ps=async(t,e)=>{const n=(0,gs.l)(t,e),i=(0,fs.Tj)({},vs.e,{[Uo]:t[Bo]||"application/octet-stream",[Jo]:t[Fo],[na]:t[Xo],[Zo]:t[$o],[ta]:t[jo],[ea]:t[Go]});let s;return n.bp("/model/{modelId}/invoke-with-response-stream"),n.p("modelId",()=>t.modelId,"{modelId}",!1),void 0!==t.body&&(s=t.body),n.m("POST").h(i).b(s),n.build()},Ms=async(t,e)=>{const n=(0,gs.l)(t,e);n.bp("/async-invoke");const i=(0,fs.Tj)({[Ko]:[()=>void 0!==t.submitTimeAfter,()=>bs(t[Ko]).toString()],[Yo]:[()=>void 0!==t.submitTimeBefore,()=>bs(t[Yo]).toString()],[Wo]:[,t[Wo]],[zo]:[()=>void 0!==t.maxResults,()=>t[zo].toString()],[Ho]:[,t[Ho]],[Vo]:[,t[Vo]],[qo]:[,t[qo]]});return n.m("GET").h({}).q(i).b(void 0),n.build()},Ds=async(t,e)=>{const n=(0,gs.l)(t,e);let i;return n.bp("/async-invoke"),i=JSON.stringify((0,fs.s)(t,{clientRequestToken:[!0,t=>t??(0,Ss.v4)()],modelId:[],modelInput:t=>Ur(t,e),outputDataConfig:t=>(0,ms.S)(t),tags:t=>(0,ms.S)(t)})),n.m("POST").h({"content-type":"application/json"}).b(i),n.build()},Os=async(t,e)=>{if(200!==t.statusCode&&t.statusCode>=300)return Gs(t,e);const n=(0,fs.Tj)({$metadata:No(t)}),i=(0,us.Y0)((0,us.Xk)(await(0,ds.Y2)(t.body,e)),"body"),s=(0,fs.s)(i,{action:us.lK,actionReason:us.lK,assessments:t=>co(t,e),guardrailCoverage:ms.S,outputs:ms.S,usage:ms.S});return Object.assign(n,s),n},Ls=async(t,e)=>{if(200!==t.statusCode&&t.statusCode>=300)return Gs(t,e);const n=(0,fs.Tj)({$metadata:No(t)}),i=(0,us.Y0)((0,us.Xk)(await(0,ds.Y2)(t.body,e)),"body"),s=(0,fs.s)(i,{additionalModelResponseFields:t=>Lo(t,e),metrics:ms.S,output:t=>eo(ps(t),e),performanceConfig:ms.S,stopReason:us.lK,trace:t=>so(t,e),usage:ms.S});return Object.assign(n,s),n},Ns=async(t,e)=>{if(200!==t.statusCode&&t.statusCode>=300)return Gs(t,e);const n=(0,fs.Tj)({$metadata:No(t)}),i=t.body;return n.stream=or(i,e),n},Fs=async(t,e)=>{if(200!==t.statusCode&&t.statusCode>=300)return Gs(t,e);const n=(0,fs.Tj)({$metadata:No(t)}),i=(0,us.Y0)((0,us.Xk)(await(0,ds.Y2)(t.body,e)),"body"),s=(0,fs.s)(i,{inputTokens:us.ET});return Object.assign(n,s),n},Bs=async(t,e)=>{if(200!==t.statusCode&&t.statusCode>=300)return Gs(t,e);const n=(0,fs.Tj)({$metadata:No(t)}),i=(0,us.Y0)((0,us.Xk)(await(0,ds.Y2)(t.body,e)),"body"),s=(0,fs.s)(i,{clientRequestToken:us.lK,endTime:t=>(0,us.Y0)((0,ws.t_)(t)),failureMessage:us.lK,invocationArn:us.lK,lastModifiedTime:t=>(0,us.Y0)((0,ws.t_)(t)),modelArn:us.lK,outputDataConfig:t=>(0,ms.S)(ps(t)),status:us.lK,submitTime:t=>(0,us.Y0)((0,ws.t_)(t))});return Object.assign(n,s),n},Us=async(t,e)=>{if(200!==t.statusCode&&t.statusCode>=300)return Gs(t,e);const n=(0,fs.Tj)({$metadata:No(t),[Bo]:[,t.headers[Uo]],[Go]:[,t.headers[ea]]}),i=await(0,As.P)(t.body,e);return n.body=i,n},$s=async(t,e)=>{if(200!==t.statusCode&&t.statusCode>=300)return Gs(t,e);const n=(0,fs.Tj)({$metadata:No(t)}),i=t.body;return n.body=ar(i,e),n},js=async(t,e)=>{if(200!==t.statusCode&&t.statusCode>=300)return Gs(t,e);const n=(0,fs.Tj)({$metadata:No(t),[Bo]:[,t.headers[Qo]],[Go]:[,t.headers[ea]]}),i=t.body;return n.body=cr(i,e),n},zs=async(t,e)=>{if(200!==t.statusCode&&t.statusCode>=300)return Gs(t,e);const n=(0,fs.Tj)({$metadata:No(t)}),i=(0,us.Y0)((0,us.Xk)(await(0,ds.Y2)(t.body,e)),"body"),s=(0,fs.s)(i,{asyncInvokeSummaries:t=>Jr(t,e),nextToken:us.lK});return Object.assign(n,s),n},Hs=async(t,e)=>{if(200!==t.statusCode&&t.statusCode>=300)return Gs(t,e);const n=(0,fs.Tj)({$metadata:No(t)}),i=(0,us.Y0)((0,us.Xk)(await(0,ds.Y2)(t.body,e)),"body"),s=(0,fs.s)(i,{invocationArn:us.lK});return Object.assign(n,s),n},Gs=async(t,e)=>{const n={...t,body:await(0,ds.CG)(t.body,e)},i=(0,ds.cJ)(t,n.body);switch(i){case"AccessDeniedException":case"com.amazonaws.bedrockruntime#AccessDeniedException":throw await Ws(n,e);case"InternalServerException":case"com.amazonaws.bedrockruntime#InternalServerException":throw await Ks(n,e);case"ResourceNotFoundException":case"com.amazonaws.bedrockruntime#ResourceNotFoundException":throw await Zs(n,e);case"ServiceQuotaExceededException":case"com.amazonaws.bedrockruntime#ServiceQuotaExceededException":throw await tr(n,e);case"ServiceUnavailableException":case"com.amazonaws.bedrockruntime#ServiceUnavailableException":throw await er(n,e);case"ThrottlingException":case"com.amazonaws.bedrockruntime#ThrottlingException":throw await nr(n,e);case"ValidationException":case"com.amazonaws.bedrockruntime#ValidationException":throw await ir(n,e);case"ModelErrorException":case"com.amazonaws.bedrockruntime#ModelErrorException":throw await Ys(n,e);case"ModelNotReadyException":case"com.amazonaws.bedrockruntime#ModelNotReadyException":throw await Xs(n,e);case"ModelTimeoutException":case"com.amazonaws.bedrockruntime#ModelTimeoutException":throw await Qs(n,e);case"ModelStreamErrorException":case"com.amazonaws.bedrockruntime#ModelStreamErrorException":throw await Js(n,e);case"ConflictException":case"com.amazonaws.bedrockruntime#ConflictException":throw await qs(n,e);default:const s=n.body;return Vs({output:t,parsedBody:s,errorCode:i})}},Vs=(0,xs.j)(Oe),Ws=async(t,e)=>{const n=(0,fs.Tj)({}),i=t.body,s=(0,fs.s)(i,{message:us.lK});Object.assign(n,s);const r=new Le({$metadata:No(t),...n});return(0,De.M)(r,t.body)},qs=async(t,e)=>{const n=(0,fs.Tj)({}),i=t.body,s=(0,fs.s)(i,{message:us.lK});Object.assign(n,s);const r=new ze({$metadata:No(t),...n});return(0,De.M)(r,t.body)},Ks=async(t,e)=>{const n=(0,fs.Tj)({}),i=t.body,s=(0,fs.s)(i,{message:us.lK});Object.assign(n,s);const r=new Fe({$metadata:No(t),...n});return(0,De.M)(r,t.body)},Ys=async(t,e)=>{const n=(0,fs.Tj)({}),i=t.body,s=(0,fs.s)(i,{message:us.lK,originalStatusCode:us.ET,resourceName:us.lK});Object.assign(n,s);const r=new Gn({$metadata:No(t),...n});return(0,De.M)(r,t.body)},Xs=async(t,e)=>{const n=(0,fs.Tj)({}),i=t.body,s=(0,fs.s)(i,{message:us.lK});Object.assign(n,s);const r=new Vn({$metadata:No(t),...n});return(0,De.M)(r,t.body)},Js=async(t,e)=>{const n=(0,fs.Tj)({}),i=t.body,s=(0,fs.s)(i,{message:us.lK,originalMessage:us.lK,originalStatusCode:us.ET});Object.assign(n,s);const r=new Zn({$metadata:No(t),...n});return(0,De.M)(r,t.body)},Qs=async(t,e)=>{const n=(0,fs.Tj)({}),i=t.body,s=(0,fs.s)(i,{message:us.lK});Object.assign(n,s);const r=new Wn({$metadata:No(t),...n});return(0,De.M)(r,t.body)},Zs=async(t,e)=>{const n=(0,fs.Tj)({}),i=t.body,s=(0,fs.s)(i,{message:us.lK});Object.assign(n,s);const r=new He({$metadata:No(t),...n});return(0,De.M)(r,t.body)},tr=async(t,e)=>{const n=(0,fs.Tj)({}),i=t.body,s=(0,fs.s)(i,{message:us.lK});Object.assign(n,s);const r=new Ge({$metadata:No(t),...n});return(0,De.M)(r,t.body)},er=async(t,e)=>{const n=(0,fs.Tj)({}),i=t.body,s=(0,fs.s)(i,{message:us.lK});Object.assign(n,s);const r=new Ve({$metadata:No(t),...n});return(0,De.M)(r,t.body)},nr=async(t,e)=>{const n=(0,fs.Tj)({}),i=t.body,s=(0,fs.s)(i,{message:us.lK});Object.assign(n,s);const r=new Be({$metadata:No(t),...n});return(0,De.M)(r,t.body)},ir=async(t,e)=>{const n=(0,fs.Tj)({}),i=t.body,s=(0,fs.s)(i,{message:us.lK});Object.assign(n,s);const r=new Ue({$metadata:No(t),...n});return(0,De.M)(r,t.body)},sr=(t,e)=>e.eventStreamMarshaller.serialize(t,t=>ei.visit(t,{chunk:t=>rr(t,e),_:t=>t})),rr=(t,e)=>{let n=new Uint8Array;return n=Sr(t,e),n=e.utf8Decoder(JSON.stringify(n)),{headers:{":event-type":{type:"string",value:"chunk"},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:"application/json"}},body:n}},or=(t,e)=>e.eventStreamMarshaller.deserialize(t,async t=>null!=t.messageStart?{messageStart:await fr(t.messageStart,e)}:null!=t.contentBlockStart?{contentBlockStart:await dr(t.contentBlockStart,e)}:null!=t.contentBlockDelta?{contentBlockDelta:await hr(t.contentBlockDelta,e)}:null!=t.contentBlockStop?{contentBlockStop:await ur(t.contentBlockStop,e)}:null!=t.messageStop?{messageStop:await mr(t.messageStop,e)}:null!=t.metadata?{metadata:await pr(t.metadata,e)}:null!=t.internalServerException?{internalServerException:await gr(t.internalServerException,e)}:null!=t.modelStreamErrorException?{modelStreamErrorException:await vr(t.modelStreamErrorException,e)}:null!=t.validationException?{validationException:await xr(t.validationException,e)}:null!=t.throttlingException?{throttlingException:await Ar(t.throttlingException,e)}:null!=t.serviceUnavailableException?{serviceUnavailableException:await wr(t.serviceUnavailableException,e)}:{$unknown:t}),ar=(t,e)=>e.eventStreamMarshaller.deserialize(t,async t=>null!=t.chunk?{chunk:await lr(t.chunk,e)}:null!=t.internalServerException?{internalServerException:await gr(t.internalServerException,e)}:null!=t.modelStreamErrorException?{modelStreamErrorException:await vr(t.modelStreamErrorException,e)}:null!=t.validationException?{validationException:await xr(t.validationException,e)}:null!=t.throttlingException?{throttlingException:await Ar(t.throttlingException,e)}:null!=t.modelTimeoutException?{modelTimeoutException:await yr(t.modelTimeoutException,e)}:null!=t.serviceUnavailableException?{serviceUnavailableException:await wr(t.serviceUnavailableException,e)}:{$unknown:t}),cr=(t,e)=>e.eventStreamMarshaller.deserialize(t,async t=>null!=t.chunk?{chunk:await br(t.chunk,e)}:null!=t.internalServerException?{internalServerException:await gr(t.internalServerException,e)}:null!=t.modelStreamErrorException?{modelStreamErrorException:await vr(t.modelStreamErrorException,e)}:null!=t.validationException?{validationException:await xr(t.validationException,e)}:null!=t.throttlingException?{throttlingException:await Ar(t.throttlingException,e)}:null!=t.modelTimeoutException?{modelTimeoutException:await yr(t.modelTimeoutException,e)}:null!=t.serviceUnavailableException?{serviceUnavailableException:await wr(t.serviceUnavailableException,e)}:{$unknown:t}),lr=async(t,e)=>{const n={},i=await(0,ds.Y2)(t.body,e);return Object.assign(n,Zr(i,e)),n},hr=async(t,e)=>{const n={},i=await(0,ds.Y2)(t.body,e);return Object.assign(n,to(i,e)),n},dr=async(t,e)=>{const n={},i=await(0,ds.Y2)(t.body,e);return Object.assign(n,(0,ms.S)(i)),n},ur=async(t,e)=>{const n={},i=await(0,ds.Y2)(t.body,e);return Object.assign(n,(0,ms.S)(i)),n},pr=async(t,e)=>{const n={},i=await(0,ds.Y2)(t.body,e);return Object.assign(n,no(i,e)),n},gr=async(t,e)=>{const n={...t,body:await(0,ds.Y2)(t.body,e)};return Ks(n,e)},fr=async(t,e)=>{const n={},i=await(0,ds.Y2)(t.body,e);return Object.assign(n,(0,ms.S)(i)),n},mr=async(t,e)=>{const n={},i=await(0,ds.Y2)(t.body,e);return Object.assign(n,Co(i,e)),n},vr=async(t,e)=>{const n={...t,body:await(0,ds.Y2)(t.body,e)};return Js(n,e)},yr=async(t,e)=>{const n={...t,body:await(0,ds.Y2)(t.body,e)};return Qs(n,e)},br=async(t,e)=>{const n={},i=await(0,ds.Y2)(t.body,e);return Object.assign(n,To(i,e)),n},wr=async(t,e)=>{const n={...t,body:await(0,ds.Y2)(t.body,e)};return er(n,e)},Ar=async(t,e)=>{const n={...t,body:await(0,ds.Y2)(t.body,e)};return nr(n,e)},xr=async(t,e)=>{const n={...t,body:await(0,ds.Y2)(t.body,e)};return ir(n,e)},Sr=(t,e)=>(0,fs.s)(t,{bytes:e.base64Encoder}),Er=(t,e)=>(0,fs.s)(t,{messages:t=>Br(t,e),system:t=>jr(t,e)}),_r=(t,e)=>si.visit(t,{converse:t=>({converse:Er(t,e)}),invokeModel:t=>({invokeModel:Fr(t,e)}),_:(t,e)=>({[t]:e})}),Cr=(t,e)=>(0,fs.s)(t,{citations:ms.S,context:[],format:[],name:[],source:t=>Tr(t,e)}),Tr=(t,e)=>An.visit(t,{bytes:t=>({bytes:e.base64Encoder(t)}),content:t=>({content:(0,ms.S)(t)}),s3Location:t=>({s3Location:(0,ms.S)(t)}),text:t=>({text:t}),_:(t,e)=>({[t]:e})}),kr=(t,e)=>t.filter(t=>null!=t).map(t=>((t,e)=>Ye.visit(t,{image:t=>({image:Mr(t,e)}),text:t=>({text:(0,ms.S)(t)}),_:(t,e)=>({[t]:e})}))(t,e)),Rr=(t,e)=>_n.visit(t,{image:t=>({image:Ir(t,e)}),text:t=>({text:(0,ms.S)(t)}),_:(t,e)=>({[t]:e})}),Ir=(t,e)=>(0,fs.s)(t,{format:[],source:t=>Pr(t,e)}),Pr=(t,e)=>Sn.visit(t,{bytes:t=>({bytes:e.base64Encoder(t)}),_:(t,e)=>({[t]:e})}),Mr=(t,e)=>(0,fs.s)(t,{format:[],source:t=>Dr(t,e)}),Dr=(t,e)=>qe.visit(t,{bytes:t=>({bytes:e.base64Encoder(t)}),_:(t,e)=>({[t]:e})}),Or=(t,e)=>(0,fs.s)(t,{format:[],source:t=>Lr(t,e)}),Lr=(t,e)=>Tn.visit(t,{bytes:t=>({bytes:e.base64Encoder(t)}),s3Location:t=>({s3Location:(0,ms.S)(t)}),_:(t,e)=>({[t]:e})}),Nr=(t,e)=>(0,fs.s)(t,{maxTokens:[],stopSequences:ms.S,temperature:ys,topP:ys}),Fr=(t,e)=>(0,fs.s)(t,{body:e.base64Encoder}),Br=(t,e)=>t.filter(t=>null!=t).map(t=>((t,e)=>(0,fs.s)(t,{content:t=>((t,e)=>t.filter(t=>null!=t).map(t=>((t,e)=>On.visit(t,{cachePoint:t=>({cachePoint:(0,ms.S)(t)}),citationsContent:t=>({citationsContent:(0,ms.S)(t)}),document:t=>({document:Cr(t,e)}),guardContent:t=>({guardContent:Rr(t,e)}),image:t=>({image:Or(t,e)}),reasoningContent:t=>({reasoningContent:$r(t,e)}),text:t=>({text:t}),toolResult:t=>({toolResult:Hr(t,e)}),toolUse:t=>({toolUse:qr(t,e)}),video:t=>({video:Kr(t,e)}),_:(t,e)=>({[t]:e})}))(t,e)))(t,e),role:[]}))(t,e)),Ur=(t,e)=>t,$r=(t,e)=>kn.visit(t,{reasoningText:t=>({reasoningText:(0,ms.S)(t)}),redactedContent:t=>({redactedContent:e.base64Encoder(t)}),_:(t,e)=>({[t]:e})}),jr=(t,e)=>t.filter(t=>null!=t).map(t=>((t,e)=>Bn.visit(t,{cachePoint:t=>({cachePoint:(0,ms.S)(t)}),guardContent:t=>({guardContent:Rr(t,e)}),text:t=>({text:t}),_:(t,e)=>({[t]:e})}))(t,e)),zr=(t,e)=>(0,fs.s)(t,{toolChoice:ms.S,tools:t=>Vr(t,e)}),Hr=(t,e)=>(0,fs.s)(t,{content:t=>Gr(t,e),status:[],toolUseId:[],type:[]}),Gr=(t,e)=>t.filter(t=>null!=t).map(t=>((t,e)=>Pn.visit(t,{document:t=>({document:Cr(t,e)}),image:t=>({image:Or(t,e)}),json:t=>({json:Xr(t,e)}),text:t=>({text:t}),video:t=>({video:Kr(t,e)}),_:(t,e)=>({[t]:e})}))(t,e)),Vr=(t,e)=>t.filter(t=>null!=t).map(t=>((t,e)=>jn.visit(t,{cachePoint:t=>({cachePoint:(0,ms.S)(t)}),systemTool:t=>({systemTool:(0,ms.S)(t)}),toolSpec:t=>({toolSpec:Wr(t,e)}),_:(t,e)=>({[t]:e})}))(t,e)),Wr=(t,e)=>(0,fs.s)(t,{description:[],inputSchema:t=>((t,e)=>$n.visit(t,{json:t=>({json:Xr(t,e)}),_:(t,e)=>({[t]:e})}))(t,e),name:[]}),qr=(t,e)=>(0,fs.s)(t,{input:t=>Xr(t,e),name:[],toolUseId:[],type:[]}),Kr=(t,e)=>(0,fs.s)(t,{format:[],source:t=>Yr(t,e)}),Yr=(t,e)=>In.visit(t,{bytes:t=>({bytes:e.base64Encoder(t)}),s3Location:t=>({s3Location:(0,ms.S)(t)}),_:(t,e)=>({[t]:e})}),Xr=(t,e)=>t,Jr=(t,e)=>{const n=(t||[]).filter(t=>null!=t).map(t=>Qr(t,e));return n},Qr=(t,e)=>(0,fs.s)(t,{clientRequestToken:us.lK,endTime:t=>(0,us.Y0)((0,ws.t_)(t)),failureMessage:us.lK,invocationArn:us.lK,lastModifiedTime:t=>(0,us.Y0)((0,ws.t_)(t)),modelArn:us.lK,outputDataConfig:t=>(0,ms.S)(ps(t)),status:us.lK,submitTime:t=>(0,us.Y0)((0,ws.t_)(t))}),Zr=(t,e)=>(0,fs.s)(t,{bytes:e.base64Decoder}),to=(t,e)=>(0,fs.s)(t,{contentBlockIndex:us.ET,delta:t=>((t,e)=>null!=t.citation?{citation:(0,ms.S)(t.citation)}:null!=t.reasoningContent?{reasoningContent:Ro(ps(t.reasoningContent),e)}:void 0!==(0,us.lK)(t.text)?{text:(0,us.lK)(t.text)}:null!=t.toolResult?{toolResult:(0,ms.S)(t.toolResult)}:null!=t.toolUse?{toolUse:(0,ms.S)(t.toolUse)}:{$unknown:Object.entries(t)[0]})(ps(t),e)}),eo=(t,e)=>null!=t.message?{message:_o(t.message,e)}:{$unknown:Object.entries(t)[0]},no=(t,e)=>(0,fs.s)(t,{metrics:ms.S,performanceConfig:ms.S,trace:t=>io(t,e),usage:ms.S}),io=(t,e)=>(0,fs.s)(t,{guardrail:t=>xo(t,e),promptRouter:ms.S}),so=(t,e)=>(0,fs.s)(t,{guardrail:t=>xo(t,e),promptRouter:ms.S}),ro=(t,e)=>(0,fs.s)(t,{citations:ms.S,context:us.lK,format:us.lK,name:us.lK,source:t=>oo(ps(t),e)}),oo=(t,e)=>null!=t.bytes?{bytes:e.base64Decoder(t.bytes)}:null!=t.content?{content:(0,ms.S)(t.content)}:null!=t.s3Location?{s3Location:(0,ms.S)(t.s3Location)}:void 0!==(0,us.lK)(t.text)?{text:(0,us.lK)(t.text)}:{$unknown:Object.entries(t)[0]},ao=(t,e)=>(0,fs.s)(t,{automatedReasoningPolicy:t=>uo(t,e),contentPolicy:ms.S,contextualGroundingPolicy:t=>yo(t,e),invocationMetrics:ms.S,sensitiveInformationPolicy:ms.S,topicPolicy:ms.S,wordPolicy:ms.S}),co=(t,e)=>{const n=(t||[]).filter(t=>null!=t).map(t=>ao(t,e));return n},lo=(t,e)=>(0,fs.s)(t,{contradictingRules:ms.S,logicWarning:ms.S,translation:t=>go(t,e)}),ho=(t,e)=>(0,fs.s)(t,{contradictingRules:ms.S,logicWarning:ms.S,translation:t=>go(t,e)}),uo=(t,e)=>(0,fs.s)(t,{findings:t=>((t,e)=>{const n=(t||[]).filter(t=>null!=t).map(t=>((t,e)=>null!=t.impossible?{impossible:lo(t.impossible,e)}:null!=t.invalid?{invalid:ho(t.invalid,e)}:null!=t.noTranslations?{noTranslations:(0,ms.S)(t.noTranslations)}:null!=t.satisfiable?{satisfiable:po(t.satisfiable,e)}:null!=t.tooComplex?{tooComplex:(0,ms.S)(t.tooComplex)}:null!=t.translationAmbiguous?{translationAmbiguous:fo(t.translationAmbiguous,e)}:null!=t.valid?{valid:vo(t.valid,e)}:{$unknown:Object.entries(t)[0]})(ps(t),e));return n})(t,e)}),po=(t,e)=>(0,fs.s)(t,{claimsFalseScenario:ms.S,claimsTrueScenario:ms.S,logicWarning:ms.S,translation:t=>go(t,e)}),go=(t,e)=>(0,fs.s)(t,{claims:ms.S,confidence:us.JW,premises:ms.S,untranslatedClaims:ms.S,untranslatedPremises:ms.S}),fo=(t,e)=>(0,fs.s)(t,{differenceScenarios:ms.S,options:t=>mo(t,e)}),mo=(t,e)=>{const n=(t||[]).filter(t=>null!=t).map(t=>((t,e)=>(0,fs.s)(t,{translations:t=>((t,e)=>{const n=(t||[]).filter(t=>null!=t).map(t=>go(t,e));return n})(t,e)}))(t,e));return n},vo=(t,e)=>(0,fs.s)(t,{claimsTrueScenario:ms.S,logicWarning:ms.S,supportingRules:ms.S,translation:t=>go(t,e)}),yo=(t,e)=>(0,fs.s)(t,{filters:t=>(t=>{const e=(t||[]).filter(t=>null!=t).map(t=>(t=>(0,fs.s)(t,{action:us.lK,detected:us.ak,score:us.JW,threshold:us.JW,type:us.lK}))(t));return e})(t)}),bo=(t,e)=>null!=t.image?{image:wo(t.image,e)}:null!=t.text?{text:(0,ms.S)(t.text)}:{$unknown:Object.entries(t)[0]},wo=(t,e)=>(0,fs.s)(t,{format:us.lK,source:t=>Ao(ps(t),e)}),Ao=(t,e)=>null!=t.bytes?{bytes:e.base64Decoder(t.bytes)}:{$unknown:Object.entries(t)[0]},xo=(t,e)=>(0,fs.s)(t,{actionReason:us.lK,inputAssessment:t=>((t,e)=>Object.entries(t).reduce((t,[n,i])=>(null===i||(t[n]=ao(i,e)),t),{}))(t,e),modelOutput:ms.S,outputAssessments:t=>((t,e)=>Object.entries(t).reduce((t,[n,i])=>(null===i||(t[n]=co(i,e)),t),{}))(t,e)}),So=(t,e)=>(0,fs.s)(t,{format:us.lK,source:t=>Eo(ps(t),e)}),Eo=(t,e)=>null!=t.bytes?{bytes:e.base64Decoder(t.bytes)}:null!=t.s3Location?{s3Location:(0,ms.S)(t.s3Location)}:{$unknown:Object.entries(t)[0]},_o=(t,e)=>(0,fs.s)(t,{content:t=>((t,e)=>{const n=(t||[]).filter(t=>null!=t).map(t=>((t,e)=>null!=t.cachePoint?{cachePoint:(0,ms.S)(t.cachePoint)}:null!=t.citationsContent?{citationsContent:(0,ms.S)(t.citationsContent)}:null!=t.document?{document:ro(t.document,e)}:null!=t.guardContent?{guardContent:bo(ps(t.guardContent),e)}:null!=t.image?{image:So(t.image,e)}:null!=t.reasoningContent?{reasoningContent:ko(ps(t.reasoningContent),e)}:void 0!==(0,us.lK)(t.text)?{text:(0,us.lK)(t.text)}:null!=t.toolResult?{toolResult:Io(t.toolResult,e)}:null!=t.toolUse?{toolUse:Mo(t.toolUse,e)}:null!=t.video?{video:Do(t.video,e)}:{$unknown:Object.entries(t)[0]})(ps(t),e));return n})(t,e),role:us.lK}),Co=(t,e)=>(0,fs.s)(t,{additionalModelResponseFields:t=>Lo(t,e),stopReason:us.lK}),To=(t,e)=>(0,fs.s)(t,{bytes:e.base64Decoder}),ko=(t,e)=>null!=t.reasoningText?{reasoningText:(0,ms.S)(t.reasoningText)}:null!=t.redactedContent?{redactedContent:e.base64Decoder(t.redactedContent)}:{$unknown:Object.entries(t)[0]},Ro=(t,e)=>null!=t.redactedContent?{redactedContent:e.base64Decoder(t.redactedContent)}:void 0!==(0,us.lK)(t.signature)?{signature:(0,us.lK)(t.signature)}:void 0!==(0,us.lK)(t.text)?{text:(0,us.lK)(t.text)}:{$unknown:Object.entries(t)[0]},Io=(t,e)=>(0,fs.s)(t,{content:t=>Po(t,e),status:us.lK,toolUseId:us.lK,type:us.lK}),Po=(t,e)=>{const n=(t||[]).filter(t=>null!=t).map(t=>((t,e)=>null!=t.document?{document:ro(t.document,e)}:null!=t.image?{image:So(t.image,e)}:null!=t.json?{json:Lo(t.json,e)}:void 0!==(0,us.lK)(t.text)?{text:(0,us.lK)(t.text)}:null!=t.video?{video:Do(t.video,e)}:{$unknown:Object.entries(t)[0]})(ps(t),e));return n},Mo=(t,e)=>(0,fs.s)(t,{input:t=>Lo(t,e),name:us.lK,toolUseId:us.lK,type:us.lK}),Do=(t,e)=>(0,fs.s)(t,{format:us.lK,source:t=>Oo(ps(t),e)}),Oo=(t,e)=>null!=t.bytes?{bytes:e.base64Decoder(t.bytes)}:null!=t.s3Location?{s3Location:(0,ms.S)(t.s3Location)}:{$unknown:Object.entries(t)[0]},Lo=(t,e)=>t,No=t=>({httpStatusCode:t.statusCode,requestId:t.headers["x-amzn-requestid"]??t.headers["x-amzn-request-id"]??t.headers["x-amz-request-id"],extendedRequestId:t.headers["x-amz-id-2"],cfId:t.headers["x-amz-cf-id"]}),Fo="accept",Bo="contentType",Uo="content-type",$o="guardrailIdentifier",jo="guardrailVersion",zo="maxResults",Ho="nextToken",Go="performanceConfigLatency",Vo="sortBy",Wo="statusEquals",qo="sortOrder",Ko="submitTimeAfter",Yo="submitTimeBefore",Xo="trace",Jo="x-amzn-bedrock-accept",Qo="x-amzn-bedrock-content-type",Zo="x-amzn-bedrock-guardrailidentifier",ta="x-amzn-bedrock-guardrailversion",ea="x-amzn-bedrock-performanceconfig-latency",na="x-amzn-bedrock-trace";class ia extends(Pe.u.classBuilder().ep(_).m(function(t,e,n,i){return[(0,Ie.TM)(n,this.serialize,this.deserialize),(0,Re.r)(n,t.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","ApplyGuardrail",{}).n("BedrockRuntimeClient","ApplyGuardrailCommand").f(ui,Ti).ser(Es).de(Os).build()){}class sa extends(Pe.u.classBuilder().ep(_).m(function(t,e,n,i){return[(0,Ie.TM)(n,this.serialize,this.deserialize),(0,Re.r)(n,t.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","Converse",{}).n("BedrockRuntimeClient","ConverseCommand").f(Ni,$i).ser(_s).de(Ls).build()){}class ra extends(Pe.u.classBuilder().ep(_).m(function(t,e,n,i){return[(0,Ie.TM)(n,this.serialize,this.deserialize),(0,Re.r)(n,t.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","ConverseStream",{eventStream:{output:!0}}).n("BedrockRuntimeClient","ConverseStreamCommand").f(ji,Ki).ser(Cs).de(Ns).build()){}class oa extends(Pe.u.classBuilder().ep(_).m(function(t,e,n,i){return[(0,Ie.TM)(n,this.serialize,this.deserialize),(0,Re.r)(n,t.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","CountTokens",{}).n("BedrockRuntimeClient","CountTokensCommand").f(hs,void 0).ser(Ts).de(Fs).build()){}class aa extends(Pe.u.classBuilder().ep(_).m(function(t,e,n,i){return[(0,Ie.TM)(n,this.serialize,this.deserialize),(0,Re.r)(n,t.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","GetAsyncInvoke",{}).n("BedrockRuntimeClient","GetAsyncInvokeCommand").f(void 0,ri).ser(ks).de(Bs).build()){}class ca extends(Pe.u.classBuilder().ep(_).m(function(t,e,n,i){return[(0,Ie.TM)(n,this.serialize,this.deserialize),(0,Re.r)(n,t.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","InvokeModel",{}).n("BedrockRuntimeClient","InvokeModelCommand").f(Yi,Xi).ser(Rs).de(Us).build()){}const la={tags:["EVENT_STREAM","SIGNATURE","HANDLE"],name:"eventStreamHandlingMiddleware",relation:"after",toMiddleware:"awsAuthMiddleware",override:!0},ha=t=>async e=>{const{request:n}=e;return c.K.isInstance(n)?(n.headers={...n.headers,"content-type":"application/vnd.amazon.eventstream","x-amz-content-sha256":"STREAMING-AWS4-HMAC-SHA256-EVENTS"},t({...e,request:n})):t(e)},da={step:"build",tags:["EVENT_STREAM","HEADER","CONTENT_TYPE","CONTENT_SHA256"],name:"eventStreamHeaderMiddleware",override:!0},ua={step:"initialize",name:"injectSessionIdMiddleware",tags:["WEBSOCKET","EVENT_STREAM"],override:!0},pa={name:"websocketEndpointMiddleware",tags:["WEBSOCKET","EVENT_STREAM"],relation:"after",toMiddleware:"eventStreamHeaderMiddleware",override:!0},ga=(t,e)=>({applyToStack:n=>{n.addRelativeTo(((t,e)=>n=>i=>{const{request:s}=i;if(c.K.isInstance(s)&&t.requestHandler.metadata?.handlerProtocol?.toLowerCase().includes("websocket")){s.protocol="wss:",s.method="GET",s.path=`${s.path}-websocket`;const{headers:t}=s;delete t["content-type"],delete t["x-amz-content-sha256"];for(const n of Object.keys(t))if(0===n.indexOf(e.headerPrefix)){const i=n.replace(e.headerPrefix,"");s.query[i]=t[n]}t["x-amz-user-agent"]&&(s.query["user-agent"]=t["x-amz-user-agent"]),s.headers={host:t.host??s.hostname}}return n(i)})(t,e),pa),n.add(t=>async e=>{const n={...e.input},i=await t(e),s=i.output;return n.SessionId&&null==s.SessionId&&(s.SessionId=n.SessionId),i},ua)}});class fa extends(Pe.u.classBuilder().ep(_).m(function(t,e,n,i){return[(0,Ie.TM)(n,this.serialize,this.deserialize),(0,Re.r)(n,t.getEndpointParameterInstructions()),(s=n,{applyToStack:t=>{t.addRelativeTo((t=>(e,n)=>async i=>{const{request:s}=i;return c.K.isInstance(s)?t.eventStreamPayloadHandler.handle(e,i,n):e(i)})(s),la),t.add(ha,da)}}),ga(n,{headerPrefix:"x-amz-bedrock-"})];var s}).s("AmazonBedrockFrontendService","InvokeModelWithBidirectionalStream",{eventStream:{input:!0,output:!0}}).n("BedrockRuntimeClient","InvokeModelWithBidirectionalStreamCommand").f(Zi,ns).ser(Is).de($s).build()){}class ma extends(Pe.u.classBuilder().ep(_).m(function(t,e,n,i){return[(0,Ie.TM)(n,this.serialize,this.deserialize),(0,Re.r)(n,t.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","InvokeModelWithResponseStream",{eventStream:{output:!0}}).n("BedrockRuntimeClient","InvokeModelWithResponseStreamCommand").f(is,os).ser(Ps).de(js).build()){}class va extends(Pe.u.classBuilder().ep(_).m(function(t,e,n,i){return[(0,Ie.TM)(n,this.serialize,this.deserialize),(0,Re.r)(n,t.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","ListAsyncInvokes",{}).n("BedrockRuntimeClient","ListAsyncInvokesCommand").f(void 0,ai).ser(Ms).de(zs).build()){}class ya extends(Pe.u.classBuilder().ep(_).m(function(t,e,n,i){return[(0,Ie.TM)(n,this.serialize,this.deserialize),(0,Re.r)(n,t.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","StartAsyncInvoke",{}).n("BedrockRuntimeClient","StartAsyncInvokeCommand").f(ci,void 0).ser(Ds).de(Hs).build()){}const ba={ApplyGuardrailCommand:ia,ConverseCommand:sa,ConverseStreamCommand:ra,CountTokensCommand:oa,GetAsyncInvokeCommand:aa,InvokeModelCommand:ca,InvokeModelWithBidirectionalStreamCommand:fa,InvokeModelWithResponseStreamCommand:ma,ListAsyncInvokesCommand:va,StartAsyncInvokeCommand:ya};class wa extends Te{}((t,e)=>{for(const n of Object.keys(t)){const i=t[n],s=async function(t,e,n){const s=new i(t);if("function"==typeof e)this.send(s,e);else{if("function"!=typeof n)return this.send(s,e);if("object"!=typeof e)throw new Error("Expected http options but got "+typeof e);this.send(s,e||{},n)}},r=(n[0].toLowerCase()+n.slice(1)).replace(/Command$/,"");e.prototype[r]=s}})(ba,wa);const Aa=async(t,e,n,i=t=>t,...s)=>{let r=new t(n);return r=i(r)??r,await e.send(r,...s)},xa=(t,e)=>{let n=t;const i=e.split(".");for(const t of i){if(!n||"object"!=typeof n)return;n=n[t]}return n},Sa=(Ea=Te,_a=va,Ca="nextToken",Ta="maxResults",async function*(t,e,...n){const i=e;let s,r=t.startingToken??i[Ca],o=!0;for(;o;){if(i[Ca]=r,Ta&&(i[Ta]=i[Ta]??t.pageSize),!(t.client instanceof Ea))throw new Error(`Invalid client, expected instance of ${Ea.name}`);s=await Aa(_a,t.client,e,t.withCommand,...n),yield s;const a=r;r=xa(s,"nextToken"),o=!(!r||t.stopOnSameToken&&r===a)}});var Ea,_a,Ca,Ta},3466:(t,e,n)=>{"use strict";var i;n.d(e,{c:()=>i}),function(t){t.ENV="env",t.CONFIG="shared config entry"}(i||(i={}))},3579:(t,e,n)=>{"use strict";n.d(e,{q:()=>h});var i=n(2432),s=n(5578),r=n(9094);const o=t=>Object.entries(t).filter(([t])=>t.startsWith(s.I.SSO_SESSION+r.Q)).reduce((t,[e,n])=>({...t,[e.substring(e.indexOf(r.Q)+1)]:n}),{});var a=n(1476),c=n(8845);const l=()=>({}),h=async(t={})=>(0,c.TA)(t.configFilepath??(0,i.g)()).then(a.A).then(o).catch(l)},3695:(t,e,n)=>{"use strict";n.d(e,{m:()=>i});const i=t=>"function"==typeof ArrayBuffer&&t instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(t)},3783:(t,e,n)=>{"use strict";n.d(e,{B:()=>i});const i=(t,e,n)=>{let i,s,r,o=!1;const a=async()=>{s||(s=t());try{i=await s,r=!0,o=!1}finally{s=void 0}return i};return void 0===e?async t=>(r&&!t?.forceRefresh||(i=await a()),i):async t=>(r&&!t?.forceRefresh||(i=await a()),o?i:n&&!n(i)?(o=!0,i):e(i)?(await a(),i):i)}},4013:(t,e,n)=>{"use strict";n.d(e,{Z:()=>l});var i=n(3783),s=n(8062),r=n(3052);function o(t){try{const e=new Set(Array.from(t.match(/([A-Z_]){3,}/g)??[]));return e.delete("CONFIG"),e.delete("CONFIG_PREFIX_SEPARATOR"),e.delete("ENV"),[...e].join(", ")}catch(e){return t}}var a=n(6437),c=n(5546);const l=({environmentVariableSelector:t,configFileSelector:e,default:n},l={})=>{const{signingName:h,logger:d}=l,u={signingName:h,logger:d};return(0,i.B)((0,s.c)((p=t,g=u,async()=>{try{const t=p(process.env,g);if(void 0===t)throw new Error;return t}catch(t){throw new r.C(t.message||`Not found in ENV: ${o(p.toString())}`,{logger:g?.logger})}}),((t,{preferredFile:e="config",...n}={})=>async()=>{const i=(0,a.Bz)(n),{configFile:s,credentialsFile:l}=await(0,c.p)(n),h=l[i]||{},d=s[i]||{},u="config"===e?{...h,...d}:{...d,...h};try{const n=t(u,"config"===e?s:l);if(void 0===n)throw new Error;return n}catch(e){throw new r.C(e.message||`Not found in config files w/ profile [${i}]: ${o(t.toString())}`,{logger:n.logger})}})(e,l),(t=>{return"function"==typeof t?async()=>await t():(e=t,()=>Promise.resolve(e));var e})(n)));var p,g}},4014:(t,e,n)=>{"use strict";n.d(e,{T:()=>o});var i=n(8883);const s=new Set,r=t=>"string"==typeof t&&(t.startsWith("fips-")||t.endsWith("-fips")),o=t=>{const{region:e,useFipsEndpoint:n}=t;if(!e)throw new Error("Region is missing");return Object.assign(t,{region:async()=>{const t=(t=>r(t)?["fips-aws-global","aws-fips"].includes(t)?"us-east-1":t.replace(/fips-(dkr-|prod-)?|-fips/,""):t)("function"==typeof e?await e():e);return((t,e=i.X)=>{if(s.has(t)||e(t))s.add(t);else{if("*"!==t)throw new Error(`Region not accepted: region="${t}" is not a valid hostname component.`);console.warn('@smithy/config-resolver WARN - Please use the caller region instead of "*". See "sigv4a" in https://github.com/aws/aws-sdk-js-v3/blob/main/supplemental-docs/CLIENTS.md.')}})(t),t},useFipsEndpoint:async()=>{const t="string"==typeof e?e:await e();return!!r(t)||("function"!=typeof n?Promise.resolve(!!n):n())}})}},4094:(t,e,n)=>{"use strict";n.d(e,{c:()=>i});class i{statusCode;reason;headers;body;constructor(t){this.statusCode=t.statusCode,this.reason=t.reason,this.headers=t.headers||{},this.body=t.body}static isInstance(t){if(!t)return!1;const e=t;return"number"==typeof e.statusCode&&"object"==typeof e.headers}}},4098:(t,e,n)=>{"use strict";n.d(e,{N:()=>i});class i{trace(){}debug(){}info(){}warn(){}error(){}}},4163:(t,e,n)=>{"use strict";n.d(e,{$:()=>s,R:()=>i});const i=t=>({setRegion(e){t.region=e},region:()=>t.region}),s=t=>({region:t.region()})},4265:function(t,e,n){"use strict";var i,s=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(e,n);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,s)}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||(i=function(t){return i=Object.getOwnPropertyNames||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[e.length]=n);return e},i(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n=i(t),o=0;o<n.length;o++)"default"!==n[o]&&s(e,t,n[o]);return r(e,t),e});Object.defineProperty(e,"__esModule",{value:!0}),e.activate=function(t){console.log("WriteDot is now active"),d=a.window.createStatusBarItem(a.StatusBarAlignment.Right,100),d.command="writedot.modifySelection",d.text="$(sparkle) AI Edit",d.tooltip="Modify selection with AI",t.subscriptions.push(d),t.subscriptions.push(a.window.onDidChangeActiveTextEditor(u)),u();const e=a.commands.registerCommand("writedot.modifySelection",async()=>{const e=a.window.activeTextEditor;if(!e)return;let n=e.document.getText(e.selection);if(!n)return void a.window.showErrorMessage("No text selected");const i=e;for(e.document,e.document.getText();;){const e=await h.PromptPanel.getPrompt(t.extensionUri,n);if(!e)break;const{prompt:s,includeContext:r}=e,o=i.document.getText(i.selection);if(!o){a.window.showErrorMessage("No text selected");continue}const d=a.workspace.getConfiguration("writedot").get("defaultContextBehavior","ask");let u="";("always"===d||r)&&(u=await(0,l.gatherFolderContext)(i.document.uri.fsPath));const p=i.document.getText();try{let t=await a.window.withProgress({location:a.ProgressLocation.Notification,title:"Modifying with Claude..."},async()=>await(0,c.modifyTextWithClaude)(o,s,p,u));t=t.trim(),await i.edit(e=>{e.replace(i.selection,t)}),a.window.showInformationMessage(" Text modified"),h.PromptPanel.currentPanel?.clearPrompt(),n=i.document.getText(i.selection)}catch(t){const e=t instanceof Error?t.message:String(t);a.window.showErrorMessage("Error: "+e)}}});t.subscriptions.push(e)},e.deactivate=function(){d&&d.dispose()};const a=o(n(1398)),c=n(6001),l=n(3127),h=n(4732);let d;function u(){const t=a.window.activeTextEditor;t&&t.selection&&!t.selection.isEmpty?d.show():d.hide()}},4367:(t,e,n)=>{"use strict";n.d(e,{t:()=>i});const i=t=>{if("function"==typeof t)return t;const e=Promise.resolve(t);return()=>e}},4384:(t,e,n)=>{"use strict";n.d(e,{M:()=>s,T:()=>i});class i extends Error{$fault;$response;$retryable;$metadata;constructor(t){super(t.message),Object.setPrototypeOf(this,Object.getPrototypeOf(this).constructor.prototype),this.name=t.name,this.$fault=t.$fault,this.$metadata=t.$metadata}static isInstance(t){if(!t)return!1;const e=t;return i.prototype.isPrototypeOf(e)||Boolean(e.$fault)&&Boolean(e.$metadata)&&("client"===e.$fault||"server"===e.$fault)}static[Symbol.hasInstance](t){if(!t)return!1;const e=t;return this===i?i.isInstance(t):!!i.isInstance(t)&&(e.name&&this.name?this.prototype.isPrototypeOf(t)||e.name===this.name:this.prototype.isPrototypeOf(t))}}const s=(t,e={})=>{Object.entries(e).filter(([,t])=>void 0!==t).forEach(([e,n])=>{null!=t[e]&&""!==t[e]||(t[e]=n)});const n=t.message||t.Message||"UnknownError";return t.message=n,delete t.Message,t}},4424:(t,e,n)=>{"use strict";n.d(e,{F:()=>s});var i=n(7459);const s=t=>"string"==typeof t?(0,i.a)(t):ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(t)},4542:(t,e,n)=>{"use strict";n.d(e,{GQ:()=>h,Qb:()=>c,bV:()=>l});const i=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],s=["TimeoutError","RequestTimeout","RequestTimeoutException"],r=[500,502,503,504],o=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],a=["EHOSTUNREACH","ENETUNREACH","ENOTFOUND"],c=t=>429===t.$metadata?.httpStatusCode||i.includes(t.name)||1==t.$retryable?.throttling,l=(t,e=0)=>(t=>void 0!==t?.$retryable)(t)||(t=>t.$metadata?.clockSkewCorrected)(t)||s.includes(t.name)||o.includes(t?.code||"")||a.includes(t?.code||"")||r.includes(t.$metadata?.httpStatusCode||0)||(t=>{const e=new Set(["Failed to fetch","NetworkError when attempting to fetch resource","The Internet connection appears to be offline","Load failed","Network request failed"]);return!!(t&&t instanceof TypeError)&&e.has(t.message)})(t)||void 0!==t.cause&&e<=10&&l(t.cause,e+1),h=t=>{if(void 0!==t.$metadata?.httpStatusCode){const e=t.$metadata.httpStatusCode;return 500<=e&&e<=599&&!l(t)}return!1}},4559:t=>{function e(t){return Promise.resolve().then(()=>{var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}e.keys=()=>[],e.resolve=e,e.id=4559,t.exports=e},4570:(t,e,n)=>{"use strict";n.d(e,{Ko:()=>r});var i=n(5938),s=n(3466);const r={environmentVariableSelector:t=>(0,i.Q)(t,"AWS_USE_FIPS_ENDPOINT",s.c.ENV),configFileSelector:t=>(0,i.Q)(t,"use_fips_endpoint",s.c.CONFIG),default:!1}},4653:(t,e,n)=>{"use strict";n.d(e,{$:()=>a});const i=t=>"string"==typeof t&&t.length>0?t.split(",").map(t=>t.trim()):[];var s=n(1544);const r="AWS_AUTH_SCHEME_PREFERENCE",o="auth_scheme_preference",a={environmentVariableSelector:(t,e)=>e?.signingName&&(0,s.R)(e.signingName)in t?["httpBearerAuth"]:r in t?i(t[r]):void 0,configFileSelector:t=>{if(o in t)return i(t[o])},default:[]}},4732:function(t,e,n){"use strict";var i,s=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(e,n);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,s)}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||(i=function(t){return i=Object.getOwnPropertyNames||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[e.length]=n);return e},i(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n=i(t),o=0;o<n.length;o++)"default"!==n[o]&&s(e,t,n[o]);return r(e,t),e});Object.defineProperty(e,"__esModule",{value:!0}),e.PromptPanel=void 0;const a=o(n(1398));class c{constructor(t,e,n){this._disposables=[],this._currentSelection="",this._panel=t,this._currentSelection=n,this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.html=this._getHtmlContent(n),this._disposables.push(a.window.onDidChangeTextEditorSelection(t=>{const e=t.textEditor.document.getText(t.selections[0]);e&&e!==this._currentSelection&&(this._currentSelection=e,this._panel.webview.postMessage({command:"updateSelection",selection:this._truncateSelection(e)}))})),this._panel.webview.onDidReceiveMessage(t=>{switch(t.command){case"submit":return void(this._resolvePrompt&&(this._resolvePrompt({prompt:t.text,includeContext:t.includeContext}),this._resolvePrompt=void 0));case"cancel":return this._resolvePrompt&&(this._resolvePrompt(void 0),this._resolvePrompt=void 0),void this._panel.dispose()}},null,this._disposables)}static async getPrompt(t,e){if(c.currentPanel)c.currentPanel._currentSelection=e,c.currentPanel._panel.webview.postMessage({command:"updateSelection",selection:c.currentPanel._truncateSelection(e)}),c.currentPanel._panel.reveal();else{const n=a.window.createWebviewPanel("aiPromptInput","WriteDot AI",a.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});c.currentPanel=new c(n,t,e)}return new Promise(t=>{c.currentPanel._resolvePrompt=t})}getCurrentSelection(){return this._currentSelection}clearPrompt(){this._panel.webview.postMessage({command:"clearPrompt"})}_truncateSelection(t){return t.length<=100?t:t.substring(0,100)+"..."}dispose(){for(c.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const t=this._disposables.pop();t&&t.dispose()}}_getHtmlContent(t){return`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>AI Prompt</title>\n    <style>\n        body {\n            padding: 20px;\n            padding-right: 30px;\n            font-family: var(--vscode-font-family);\n            color: var(--vscode-foreground);\n            box-sizing: border-box;\n        }\n        h2 {\n            margin-top: 0;\n            margin-bottom: 10px;\n            color: var(--vscode-foreground);\n        }\n        .selection-preview {\n            background: var(--vscode-textBlockQuote-background);\n            border-left: 3px solid var(--vscode-textBlockQuote-border);\n            padding: 10px 12px;\n            margin-bottom: 15px;\n            font-family: var(--vscode-editor-font-family);\n            font-size: 12px;\n            color: var(--vscode-foreground);\n            border-radius: 2px;\n            white-space: pre-wrap;\n            word-wrap: break-word;\n        }\n        .selection-label {\n            font-size: 11px;\n            color: var(--vscode-descriptionForeground);\n            margin-bottom: 5px;\n            font-weight: 500;\n        }\n        textarea {\n            width: 100%;\n            min-height: 150px;\n            padding: 10px;\n            font-family: var(--vscode-editor-font-family);\n            font-size: var(--vscode-editor-font-size);\n            background: var(--vscode-input-background);\n            color: var(--vscode-input-foreground);\n            border: 1px solid var(--vscode-input-border);\n            border-radius: 2px;\n            resize: vertical;\n            box-sizing: border-box;\n        }\n        textarea:focus {\n            outline: 1px solid var(--vscode-focusBorder);\n        }\n        .checkbox-container {\n            margin-top: 15px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n        .checkbox-container input[type="checkbox"] {\n            cursor: pointer;\n        }\n        .checkbox-container label {\n            cursor: pointer;\n            font-size: 13px;\n        }\n        .button-group {\n            margin-top: 15px;\n            display: flex;\n            gap: 10px;\n        }\n        button {\n            padding: 8px 16px;\n            background: var(--vscode-button-background);\n            color: var(--vscode-button-foreground);\n            border: none;\n            border-radius: 2px;\n            cursor: pointer;\n            font-size: 13px;\n        }\n        button:hover {\n            background: var(--vscode-button-hoverBackground);\n        }\n        button.secondary {\n            background: var(--vscode-button-secondaryBackground);\n            color: var(--vscode-button-secondaryForeground);\n        }\n        button.secondary:hover {\n            background: var(--vscode-button-secondaryHoverBackground);\n        }\n        .examples {\n            margin-top: 10px;\n            font-size: 12px;\n            color: var(--vscode-descriptionForeground);\n        }\n        .examples strong {\n            color: var(--vscode-foreground);\n        }\n    </style>\n</head>\n<body>\n    <h2>How should I modify this text?</h2>\n    <div class="selection-label">Selected text:</div>\n    <div class="selection-preview" id="selectionPreview">${this._truncateSelection(t)}</div>\n    <textarea id="promptInput" placeholder="Enter your modification instructions...\nExamples:\n- make it more concise\n- fix grammar and spelling\n- translate to Spanish\n- rewrite in a professional tone"></textarea>\n    <div class="examples">\n        <strong>Tip:</strong> You can use multi-line prompts for complex instructions\n    </div>\n    <div class="checkbox-container">\n        <input type="checkbox" id="includeContextCheckbox" />\n        <label for="includeContextCheckbox">Include context from folder files</label>\n    </div>\n    <div class="button-group">\n        <button id="submitBtn">Modify with AI</button>\n        <button id="cancelBtn" class="secondary">Cancel</button>\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        const textarea = document.getElementById('promptInput');\n        const submitBtn = document.getElementById('submitBtn');\n        const cancelBtn = document.getElementById('cancelBtn');\n        const includeContextCheckbox = document.getElementById('includeContextCheckbox');\n        const selectionPreview = document.getElementById('selectionPreview');\n\n        // Listen for messages from the extension\n        window.addEventListener('message', event => {\n            const message = event.data;\n            if (message.command === 'updateSelection') {\n                selectionPreview.textContent = message.selection;\n            } else if (message.command === 'clearPrompt') {\n                textarea.value = '';\n                textarea.focus();\n            }\n        });\n\n        // Focus the textarea\n        textarea.focus();\n\n        // Submit on button click\n        submitBtn.addEventListener('click', () => {\n            const text = textarea.value.trim();\n            if (text) {\n                vscode.postMessage({\n                    command: 'submit',\n                    text: text,\n                    includeContext: includeContextCheckbox.checked\n                });\n            }\n        });\n\n        // Cancel button\n        cancelBtn.addEventListener('click', () => {\n            vscode.postMessage({ command: 'cancel' });\n        });\n\n        // Submit on Ctrl/Cmd + Enter\n        textarea.addEventListener('keydown', (e) => {\n            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {\n                e.preventDefault();\n                const text = textarea.value.trim();\n                if (text) {\n                    vscode.postMessage({\n                        command: 'submit',\n                        text: text,\n                        includeContext: includeContextCheckbox.checked\n                    });\n                }\n            }\n        });\n    <\/script>\n</body>\n</html>`}}e.PromptPanel=c},4757:(t,e,n)=>{"use strict";n.d(e,{a:()=>r,v:()=>o});var i=n(1943),s=n(2594);const r={},o=async t=>{if(r[t])return r[t];const e=(0,s.C)(t),n=await(0,i.readFile)(e,"utf8");return JSON.parse(n)}},4836:(t,e,n)=>{"use strict";n.d(e,{GG:()=>i,zH:()=>s});const i={environmentVariableSelector:t=>t.AWS_REGION,configFileSelector:t=>t.region,default:()=>{throw new Error("Region is missing")}},s={preferredFile:"credentials"}},4957:(t,e,n)=>{"use strict";n.d(e,{u:()=>p});var i=n(1671),s=n(7267);const r=t=>"function"==typeof t?t():t;function o(t){if("object"==typeof t)return t;t|=0;const e={};let n=0;for(const i of["httpLabel","idempotent","idempotencyToken","sensitive","httpPayload","httpResponseCode","httpQueryParams"])1==(t>>n++&1)&&(e[i]=1);return e}class a{ref;memberName;static symbol=Symbol.for("@smithy/nor");symbol=a.symbol;name;schema;_isMemberSchema;traits;memberTraits;normalizedTraits;constructor(t,e){this.ref=t,this.memberName=e;const n=[];let i=t,s=t;for(this._isMemberSchema=!1;l(i);)n.push(i[1]),i=i[0],s=r(i),this._isMemberSchema=!0;if(n.length>0){this.memberTraits={};for(let t=n.length-1;t>=0;--t){const e=n[t];Object.assign(this.memberTraits,o(e))}}else this.memberTraits=0;if(s instanceof a){const t=this.memberTraits;return Object.assign(this,s),this.memberTraits=Object.assign({},t,s.getMemberTraits(),this.getMemberTraits()),this.normalizedTraits=void 0,void(this.memberName=e??s.memberName)}if(this.schema=r(s),h(this.schema)?(this.name=`${this.schema[1]}#${this.schema[2]}`,this.traits=this.schema[3]):(this.name=this.memberName??String(s),this.traits=0),this._isMemberSchema&&!e)throw new Error(`@smithy/core/schema - NormalizedSchema member init ${this.getName(!0)} missing member name.`)}static[Symbol.hasInstance](t){const e=this.prototype.isPrototypeOf(t);return e||"object"!=typeof t||null===t?e:t.symbol===this.symbol}static of(t){const e=r(t);if(e instanceof a)return e;if(l(e)){const[n,i]=e;if(n instanceof a)return Object.assign(n.getMergedTraits(),o(i)),n;throw new Error(`@smithy/core/schema - may not init unwrapped member schema=${JSON.stringify(t,null,2)}.`)}return new a(e)}getSchema(){const t=this.schema;return 0===t[0]?t[4]:t}getName(t=!1){const{name:e}=this;return!t&&e&&e.includes("#")?e.split("#")[1]:e||void 0}getMemberName(){return this.memberName}isMemberSchema(){return this._isMemberSchema}isListSchema(){const t=this.getSchema();return"number"==typeof t?t>=64&&t<128:1===t[0]}isMapSchema(){const t=this.getSchema();return"number"==typeof t?t>=128&&t<=255:2===t[0]}isStructSchema(){const t=this.getSchema();return 3===t[0]||-3===t[0]}isBlobSchema(){const t=this.getSchema();return 21===t||42===t}isTimestampSchema(){const t=this.getSchema();return"number"==typeof t&&t>=4&&t<=7}isUnitSchema(){return"unit"===this.getSchema()}isDocumentSchema(){return 15===this.getSchema()}isStringSchema(){return 0===this.getSchema()}isBooleanSchema(){return 2===this.getSchema()}isNumericSchema(){return 1===this.getSchema()}isBigIntegerSchema(){return 17===this.getSchema()}isBigDecimalSchema(){return 19===this.getSchema()}isStreaming(){const{streaming:t}=this.getMergedTraits();return!!t||42===this.getSchema()}isIdempotencyToken(){const t=t=>!(4&~t&&!t?.idempotencyToken),{normalizedTraits:e,traits:n,memberTraits:i}=this;return t(e)||t(n)||t(i)}getMergedTraits(){return this.normalizedTraits??(this.normalizedTraits={...this.getOwnTraits(),...this.getMemberTraits()})}getMemberTraits(){return o(this.memberTraits)}getOwnTraits(){return o(this.traits)}getKeySchema(){const[t,e]=[this.isDocumentSchema(),this.isMapSchema()];if(!t&&!e)throw new Error(`@smithy/core/schema - cannot get key for non-map: ${this.getName(!0)}`);const n=this.getSchema();return c([t?15:n[4]??0,0],"key")}getValueSchema(){const t=this.getSchema(),[e,n,i]=[this.isDocumentSchema(),this.isMapSchema(),this.isListSchema()],s="number"==typeof t?63&t:t&&"object"==typeof t&&(n||i)?t[3+t[0]]:e?15:void 0;if(null!=s)return c([s,0],n?"value":"member");throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no value member.`)}getMemberSchema(t){const e=this.getSchema();if(this.isStructSchema()&&e[4].includes(t)){const n=e[4].indexOf(t),i=e[5][n];return c(l(i)?i:[i,0],t)}if(this.isDocumentSchema())return c([15,0],t);throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no no member=${t}.`)}getMemberSchemas(){const t={};try{for(const[e,n]of this.structIterator())t[e]=n}catch(t){}return t}getEventStreamMember(){if(this.isStructSchema())for(const[t,e]of this.structIterator())if(e.isStreaming()&&e.isStructSchema())return t;return""}*structIterator(){if(this.isUnitSchema())return;if(!this.isStructSchema())throw new Error("@smithy/core/schema - cannot iterate non-struct schema.");const t=this.getSchema();for(let e=0;e<t[4].length;++e)yield[t[4][e],c([t[5][e],0],t[4][e])]}}function c(t,e){return t instanceof a?Object.assign(t,{memberName:e,_isMemberSchema:!0}):new a(t,e)}const l=t=>Array.isArray(t)&&2===t.length,h=t=>Array.isArray(t)&&t.length>=5,d="***SensitiveInformation***";function u(t,e){if(null==e)return e;const n=a.of(t);if(n.getMergedTraits().sensitive)return d;if(n.isListSchema()){if(n.getValueSchema().getMergedTraits().sensitive)return d}else if(n.isMapSchema()){if(n.getKeySchema().getMergedTraits().sensitive||n.getValueSchema().getMergedTraits().sensitive)return d}else if(n.isStructSchema()&&"object"==typeof e){const t=e,i={};for(const[e,s]of n.structIterator())null!=t[e]&&(i[e]=u(s,t[e]));return i}return e}class p{middlewareStack=(0,i.o)();schema;static classBuilder(){return new g}resolveMiddlewareWithContext(t,e,n,{middlewareFn:i,clientName:r,commandName:o,inputFilterSensitiveLog:a,outputFilterSensitiveLog:c,smithyContext:l,additionalContext:h,CommandCtor:d}){for(const s of i.bind(this)(d,t,e,n))this.middlewareStack.use(s);const u=t.concat(this.middlewareStack),{logger:p}=e,g={logger:p,clientName:r,commandName:o,inputFilterSensitiveLog:a,outputFilterSensitiveLog:c,[s.V]:{commandInstance:this,...l},...h},{requestHandler:f}=e;return u.resolve(t=>f.handle(t.request,n||{}),g)}}class g{_init=()=>{};_ep={};_middlewareFn=()=>[];_commandName="";_clientName="";_additionalContext={};_smithyContext={};_inputFilterSensitiveLog=void 0;_outputFilterSensitiveLog=void 0;_serializer=null;_deserializer=null;_operationSchema;init(t){this._init=t}ep(t){return this._ep=t,this}m(t){return this._middlewareFn=t,this}s(t,e,n={}){return this._smithyContext={service:t,operation:e,...n},this}c(t={}){return this._additionalContext=t,this}n(t,e){return this._clientName=t,this._commandName=e,this}f(t=t=>t,e=t=>t){return this._inputFilterSensitiveLog=t,this._outputFilterSensitiveLog=e,this}ser(t){return this._serializer=t,this}de(t){return this._deserializer=t,this}sc(t){return this._operationSchema=t,this._smithyContext.operationSchema=t,this}build(){const t=this;let e;return e=class extends p{input;static getEndpointParameterInstructions(){return t._ep}constructor(...[e]){super(),this.input=e??{},t._init(this),this.schema=t._operationSchema}resolveMiddleware(n,i,s){const r=t._operationSchema,o=r?.[4]??r?.input,a=r?.[5]??r?.output;return this.resolveMiddlewareWithContext(n,i,s,{CommandCtor:e,middlewareFn:t._middlewareFn,clientName:t._clientName,commandName:t._commandName,inputFilterSensitiveLog:t._inputFilterSensitiveLog??(r?u.bind(null,o):t=>t),outputFilterSensitiveLog:t._outputFilterSensitiveLog??(r?u.bind(null,a):t=>t),smithyContext:t._smithyContext,additionalContext:t._additionalContext})}serialize=t._serializer;deserialize=t._deserializer}}}},5122:(t,e,n)=>{"use strict";n.d(e,{I:()=>s});const i={warningEmitted:!1},s=t=>{t&&!i.warningEmitted&&parseInt(t.substring(1,t.indexOf(".")))<18&&(i.warningEmitted=!0,process.emitWarning("NodeDeprecationWarning: The AWS SDK for JavaScript (v3) will\nno longer support Node.js 16.x on January 6, 2025.\n\nTo continue receiving updates to AWS services, bug fixes, and security\nupdates please upgrade to a supported Node.js LTS version.\n\nMore information can be found at: https://a.co/74kJMmI"))}},5172:(t,e,n)=>{"use strict";n.d(e,{l:()=>c});var i=n(7324),s=n(6116);const r=t=>t=>{throw t},o=(t,e)=>{},a={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},c=t=>({applyToStack:t=>{t.addRelativeTo((t,e)=>async n=>{if(!i.K.isInstance(n.request))return t(n);const a=(0,s.u)(e).selectedHttpAuthScheme;if(!a)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:c={}},identity:l,signer:h}=a,d=await t({...n,request:await h.sign(n.request,l,c)}).catch((h.errorHandler||r)(c));return(h.successHandler||o)(d.response,c),d},a)}})},5178:(t,e,n)=>{"use strict";n.d(e,{k:()=>r});var i=n(2203);class s extends i.Writable{bufferedBytes=[];_write(t,e,n){this.bufferedBytes.push(t),n()}}const r=t=>o(t)?async function(t){const e=[],n=t.getReader();let i=!1,s=0;for(;!i;){const{done:t,value:r}=await n.read();r&&(e.push(r),s+=r.length),i=t}const r=new Uint8Array(s);let o=0;for(const t of e)r.set(t,o),o+=t.length;return r}(t):new Promise((e,n)=>{const i=new s;t.pipe(i),t.on("error",t=>{i.end(),n(t)}),i.on("error",n),i.on("finish",function(){const t=new Uint8Array(Buffer.concat(this.bufferedBytes));e(t)})}),o=t=>"function"==typeof ReadableStream&&t instanceof ReadableStream},5317:t=>{"use strict";t.exports=require("child_process")},5546:(t,e,n)=>{"use strict";n.d(e,{p:()=>p});var i=n(6928),s=n(5578),r=n(9094);const o=t=>Object.entries(t).filter(([t])=>{const e=t.indexOf(r.Q);return-1!==e&&Object.values(s.I).includes(t.substring(0,e))}).reduce((t,[e,n])=>{const i=e.indexOf(r.Q);return t[e.substring(0,i)===s.I.PROFILE?e.substring(i+1):e]=n,t},{...t.default&&{default:t.default}});var a=n(2432),c=n(7029);const l=()=>process.env.AWS_SHARED_CREDENTIALS_FILE||(0,i.join)((0,c.R)(),".aws","credentials");var h=n(1476),d=n(8845);const u=()=>({}),p=async(t={})=>{const{filepath:e=l(),configFilepath:n=(0,a.g)()}=t,s=(0,c.R)();let r=e;e.startsWith("~/")&&(r=(0,i.join)(s,e.slice(2)));let p=n;n.startsWith("~/")&&(p=(0,i.join)(s,n.slice(2)));const g=await Promise.all([(0,d.TA)(p,{ignoreCache:t.ignoreCache}).then(h.A).then(o).catch(u),(0,d.TA)(r,{ignoreCache:t.ignoreCache}).then(h.A).catch(u)]);return{configFile:g[0],credentialsFile:g[1]}}},5578:(t,e,n)=>{"use strict";var i;n.d(e,{I:()=>i}),function(t){t.PROFILE="profile",t.SSO_SESSION="sso-session",t.SERVICES="services"}(i||(i={}))},5692:t=>{"use strict";t.exports=require("https")},5901:(t,e,n)=>{"use strict";n.d(e,{G:()=>s});var i=n(2531);function s(t){const e=[];for(let n of Object.keys(t).sort()){const s=t[n];if(n=(0,i.o)(n),Array.isArray(s))for(let t=0,r=s.length;t<r;t++)e.push(`${n}=${(0,i.o)(s[t])}`);else{let t=n;(s||"string"==typeof s)&&(t+=`=${(0,i.o)(s)}`),e.push(t)}}return e.join("&")}},5938:(t,e,n)=>{"use strict";n.d(e,{Q:()=>i});const i=(t,e,n)=>{if(e in t){if("true"===t[e])return!0;if("false"===t[e])return!1;throw new Error(`Cannot load ${n} "${e}". Expected "true" or "false", got ${t[e]}.`)}}},5963:(t,e,n)=>{"use strict";n.d(e,{qs:()=>p,kN:()=>f,$z:()=>g});var i=n(8947),s=n(7355),r=n(4542);class o{static setTimeoutFn=setTimeout;beta;minCapacity;minFillRate;scaleConstant;smooth;currentCapacity=0;enabled=!1;lastMaxRate=0;measuredTxRate=0;requestCount=0;fillRate;lastThrottleTime;lastTimestamp=0;lastTxRateBucket;maxCapacity;timeWindow=0;constructor(t){this.beta=t?.beta??.7,this.minCapacity=t?.minCapacity??1,this.minFillRate=t?.minFillRate??.5,this.scaleConstant=t?.scaleConstant??.4,this.smooth=t?.smooth??.8;const e=this.getCurrentTimeInSeconds();this.lastThrottleTime=e,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(t){if(this.enabled){if(this.refillTokenBucket(),t>this.currentCapacity){const e=(t-this.currentCapacity)/this.fillRate*1e3;await new Promise(t=>o.setTimeoutFn(t,e))}this.currentCapacity=this.currentCapacity-t}}refillTokenBucket(){const t=this.getCurrentTimeInSeconds();if(!this.lastTimestamp)return void(this.lastTimestamp=t);const e=(t-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+e),this.lastTimestamp=t}updateClientSendingRate(t){let e;if(this.updateMeasuredRate(),(0,r.Qb)(t)){const t=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=t,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),e=this.cubicThrottle(t),this.enableTokenBucket()}else this.calculateTimeWindow(),e=this.cubicSuccess(this.getCurrentTimeInSeconds());const n=Math.min(e,2*this.measuredTxRate);this.updateTokenBucketRate(n)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(t){return this.getPrecise(t*this.beta)}cubicSuccess(t){return this.getPrecise(this.scaleConstant*Math.pow(t-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(t){this.refillTokenBucket(),this.fillRate=Math.max(t,this.minFillRate),this.maxCapacity=Math.max(t,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){const t=this.getCurrentTimeInSeconds(),e=Math.floor(2*t)/2;if(this.requestCount++,e>this.lastTxRateBucket){const t=this.requestCount/(e-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(t*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=e}}getPrecise(t){return parseFloat(t.toFixed(8))}}var a=n(7072);const c=({retryDelay:t,retryCount:e,retryCost:n})=>({getRetryCount:()=>e,getRetryDelay:()=>Math.min(a.G8,t),getRetryCost:()=>n});class l{maxAttempts;mode=s.cm.STANDARD;capacity=a.Df;retryBackoffStrategy=(()=>{let t=a.bp;return{computeNextBackoffDelay:e=>Math.floor(Math.min(a.G8,Math.random()*2**e*t)),setDelayBase:e=>{t=e}}})();maxAttemptsProvider;constructor(t){this.maxAttempts=t,this.maxAttemptsProvider="function"==typeof t?t:async()=>t}async acquireInitialRetryToken(t){return c({retryDelay:a.bp,retryCount:0})}async refreshRetryTokenForRetry(t,e){const n=await this.getMaxAttempts();if(this.shouldRetry(t,e,n)){const n=e.errorType;this.retryBackoffStrategy.setDelayBase("THROTTLING"===n?a.jh:a.bp);const i=this.retryBackoffStrategy.computeNextBackoffDelay(t.getRetryCount()),s=e.retryAfterHint?Math.max(e.retryAfterHint.getTime()-Date.now()||0,i):i,r=this.getCapacityCost(n);return this.capacity-=r,c({retryDelay:s,retryCount:t.getRetryCount()+1,retryCost:r})}throw new Error("No retry token available")}recordSuccess(t){this.capacity=Math.max(a.Df,this.capacity+(t.getRetryCost()??a.XP))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch(t){return console.warn(`Max attempts provider could not resolve. Using default of ${s.Gz}`),s.Gz}}shouldRetry(t,e,n){return t.getRetryCount()+1<n&&this.capacity>=this.getCapacityCost(e.errorType)&&this.isRetryableError(e.errorType)}getCapacityCost(t){return"TRANSIENT"===t?a.Rn:a.XS}isRetryableError(t){return"THROTTLING"===t||"TRANSIENT"===t}}class h{maxAttemptsProvider;rateLimiter;standardRetryStrategy;mode=s.cm.ADAPTIVE;constructor(t,e){this.maxAttemptsProvider=t;const{rateLimiter:n}=e??{};this.rateLimiter=n??new o,this.standardRetryStrategy=new l(t)}async acquireInitialRetryToken(t){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(t)}async refreshRetryTokenForRetry(t,e){return this.rateLimiter.updateClientSendingRate(e),this.standardRetryStrategy.refreshRetryTokenForRetry(t,e)}recordSuccess(t){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(t)}}const d="AWS_MAX_ATTEMPTS",u="max_attempts",p={environmentVariableSelector:t=>{const e=t[d];if(!e)return;const n=parseInt(e);if(Number.isNaN(n))throw new Error(`Environment variable ${d} mast be a number, got "${e}"`);return n},configFileSelector:t=>{const e=t[u];if(!e)return;const n=parseInt(e);if(Number.isNaN(n))throw new Error(`Shared config file entry ${u} mast be a number, got "${e}"`);return n},default:s.Gz},g=t=>{const{retryStrategy:e,retryMode:n,maxAttempts:r}=t,o=(0,i.t)(r??s.Gz);return Object.assign(t,{maxAttempts:o,retryStrategy:async()=>e||(await(0,i.t)(n)()===s.cm.ADAPTIVE?new h(o):new l(o))})},f={environmentVariableSelector:t=>t.AWS_RETRY_MODE,configFileSelector:t=>t.retry_mode,default:s.L0}},6001:function(t,e,n){"use strict";var i,s=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(e,n);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,s)}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||(i=function(t){return i=Object.getOwnPropertyNames||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[e.length]=n);return e},i(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n=i(t),o=0;o<n.length;o++)"default"!==n[o]&&s(e,t,n[o]);return r(e,t),e});Object.defineProperty(e,"__esModule",{value:!0}),e.modifyTextWithClaude=async function(t,e,n,i=""){const s=c.workspace.getConfiguration("writedot"),r=s.get("awsRegion","us-west-2"),o=s.get("modelId","global.anthropic.claude-sonnet-4-5-20250929-v1:0"),l=s.get("maxTokens",4096);try{const s=new a.BedrockRuntimeClient({region:r}),c="You are a text editing assistant. Modify ONLY the selected text according to instructions. Return ONLY the modified selected text with no additional content, explanations, or formatting markers.",h=i?`\n\n## Additional Files in Folder:\n${i}`:"",d=JSON.stringify({anthropic_version:"bedrock-2023-05-31",max_tokens:l,system:c,messages:[{role:"user",content:`## Full Document Content:\n${n}\n\n## Selected Text to Modify:\n${t}\n\n## Modification Instructions:\n${e}${h}\n\nReturn ONLY the modified version of the selected text above, with no explanations or additional content:`}]}),u=new a.InvokeModelCommand({modelId:o,body:d}),p=await s.send(u);return JSON.parse((new TextDecoder).decode(p.body)).content[0].text}catch(t){if(t instanceof Error)throw new Error(`AWS Bedrock error: ${t.message}. Please check your AWS credentials in ~/.aws/credentials`);throw t}};const a=n(3368),c=o(n(1398))},6014:(t,e,n)=>{"use strict";n.d(e,{m:()=>i});class i extends Error{name="ProviderError";tryNextLink;constructor(t,e=!0){let n,s=!0;"boolean"==typeof e?(n=void 0,s=e):null!=e&&"object"==typeof e&&(n=e.logger,s=e.tryNextLink??!0),super(t),this.tryNextLink=s,Object.setPrototypeOf(this,i.prototype),n?.debug?.(`@smithy/property-provider ${s?"->":"(!)"} ${t}`)}static from(t,e=!0){return Object.assign(new this(t.message,e),t)}}},6035:(t,e,n)=>{"use strict";n.d(e,{u:()=>i});const i=t=>{const e={};for(const n of Object.keys(t)){const i=t[n];e[n]=Array.isArray(i)?i.join(","):i}return e}},6116:(t,e,n)=>{"use strict";n.d(e,{u:()=>s});var i=n(7267);const s=t=>t[i.V]||(t[i.V]={})},6228:(t,e,n)=>{"use strict";n.d(e,{f2:()=>l});var i=n(7324);const s=t=>new Date(Date.now()+t);var r=n(4094);const o=t=>r.c.isInstance(t)?t.headers?.date??t.headers?.Date:void 0,a=(t,e)=>{const n=Date.parse(t);return((t,e)=>Math.abs(s(e).getTime()-t)>=3e5)(n,e)?n-Date.now():e},c=(t,e)=>{if(!e)throw new Error(`Property \`${t}\` is not resolved for AWS SDK SigV4Auth`);return e};class l{async sign(t,e,n){if(!i.K.isInstance(t))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const r=await(async t=>{const e=c("context",t.context),n=c("config",t.config),i=e.endpointV2?.properties?.authSchemes?.[0],s=c("signer",n.signer),r=await s(i),o=t?.signingRegion,a=t?.signingRegionSet,l=t?.signingName;return{config:n,signer:r,signingRegion:o,signingRegionSet:a,signingName:l}})(n),{config:o,signer:a}=r;let{signingRegion:l,signingName:h}=r;const d=n.context;if(d?.authSchemes?.length){const[t,e]=d.authSchemes;"sigv4a"===t?.name&&"sigv4"===e?.name&&(l=e?.signingRegion??l,h=e?.signingName??h)}return await a.sign(t,{signingDate:s(o.systemClockOffset),signingRegion:l,signingService:h})}errorHandler(t){return e=>{const n=e.ServerTime??o(e.$response);if(n){const i=c("config",t.config),s=i.systemClockOffset;i.systemClockOffset=a(n,i.systemClockOffset),i.systemClockOffset!==s&&e.$metadata&&(e.$metadata.clockSkewCorrected=!0)}throw e}}successHandler(t,e){const n=o(t);if(n){const t=c("config",e.config);t.systemClockOffset=a(n,t.systemClockOffset)}}}},6437:(t,e,n)=>{"use strict";n.d(e,{Bz:()=>s,Ch:()=>i});const i="AWS_PROFILE",s=t=>t.profile||process.env[i]||"default"},6460:(t,e,n)=>{"use strict";n.d(e,{ET:()=>o,JW:()=>m,UO:()=>p,Xk:()=>h,Y0:()=>l,ak:()=>i,lK:()=>d,tN:()=>u,tW:()=>w,xW:()=>y,zi:()=>b});const i=t=>{if(null!=t){if("number"==typeof t){if(0!==t&&1!==t||x.warn(A(`Expected boolean, got ${typeof t}: ${t}`)),0===t)return!1;if(1===t)return!0}if("string"==typeof t){const e=t.toLowerCase();if("false"!==e&&"true"!==e||x.warn(A(`Expected boolean, got ${typeof t}: ${t}`)),"false"===e)return!1;if("true"===e)return!0}if("boolean"==typeof t)return t;throw new TypeError(`Expected boolean, got ${typeof t}: ${t}`)}},s=t=>{if(null!=t){if("string"==typeof t){const e=parseFloat(t);if(!Number.isNaN(e))return String(e)!==String(t)&&x.warn(A(`Expected number but observed string: ${t}`)),e}if("number"==typeof t)return t;throw new TypeError(`Expected number, got ${typeof t}: ${t}`)}},r=Math.ceil(2**127*(2-2**-23)),o=t=>a(t,32),a=(t,e)=>{const n=(t=>{if(null!=t){if(Number.isInteger(t)&&!Number.isNaN(t))return t;throw new TypeError(`Expected integer, got ${typeof t}: ${t}`)}})(t);if(void 0!==n&&c(n,e)!==n)throw new TypeError(`Expected ${e}-bit integer, got ${t}`);return n},c=(t,e)=>{switch(e){case 32:return Int32Array.of(t)[0];case 16:return Int16Array.of(t)[0];case 8:return Int8Array.of(t)[0]}},l=(t,e)=>{if(null==t){if(e)throw new TypeError(`Expected a non-null value for ${e}`);throw new TypeError("Expected a non-null value")}return t},h=t=>{if(null==t)return;if("object"==typeof t&&!Array.isArray(t))return t;const e=Array.isArray(t)?"array":typeof t;throw new TypeError(`Expected object, got ${e}: ${t}`)},d=t=>{if(null!=t){if("string"==typeof t)return t;if(["boolean","number","bigint"].includes(typeof t))return x.warn(A(`Expected string, got ${typeof t}: ${t}`)),String(t);throw new TypeError(`Expected string, got ${typeof t}: ${t}`)}},u=t=>{if(null==t)return;const e=h(t),n=Object.entries(e).filter(([,t])=>null!=t).map(([t])=>t);if(0===n.length)throw new TypeError("Unions must have exactly one non-null member. None were found.");if(n.length>1)throw new TypeError(`Unions must have exactly one non-null member. Keys ${n} were not null.`);return e},p=t=>(t=>{const e=s(t);if(void 0!==e&&!Number.isNaN(e)&&e!==1/0&&e!==-1/0&&Math.abs(e)>r)throw new TypeError(`Expected 32-bit float, got ${t}`);return e})("string"==typeof t?f(t):t),g=/(-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|(-?Infinity)|(NaN)/g,f=t=>{const e=t.match(g);if(null===e||e[0].length!==t.length)throw new TypeError("Expected real number, got implicit NaN");return parseFloat(t)},m=t=>"string"==typeof t?v(t):s(t),v=t=>{switch(t){case"NaN":return NaN;case"Infinity":return 1/0;case"-Infinity":return-1/0;default:throw new Error(`Unable to parse float value: ${t}`)}},y=t=>o("string"==typeof t?f(t):t),b=t=>(t=>a(t,16))("string"==typeof t?f(t):t),w=t=>(t=>a(t,8))("string"==typeof t?f(t):t),A=t=>String(new TypeError(t).stack||t).split("\n").slice(0,5).filter(t=>!t.includes("stackTraceWarning")).join("\n"),x={warn:console.warn}},6768:(t,e,n)=>{"use strict";n.d(e,{r:()=>p});var i=n(1698),s=n(6116);const r=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,o=/(\d+\.){3}\d+/,a=/\.\./,c=(t,e,n)=>{const i=async()=>{const i=n[t]??n[e];return"function"==typeof i?i():i};return"credentialScope"===t||"CredentialScope"===e?async()=>{const t="function"==typeof n.credentials?await n.credentials():n.credentials;return t?.credentialScope??t?.CredentialScope}:"accountId"===t||"AccountId"===e?async()=>{const t="function"==typeof n.credentials?await n.credentials():n.credentials;return t?.accountId??t?.AccountId}:"endpoint"===t||"endpoint"===e?async()=>{if(!1===n.isCustomEndpoint)return;const t=await i();if(t&&"object"==typeof t){if("url"in t)return t.url.href;if("hostname"in t){const{protocol:e,hostname:n,port:i,path:s}=t;return`${e}//${n}${i?":"+i:""}${s}`}}return t}:i};var l=n(8829),h=n(8462);const d=async(t,e,n)=>{const i={},s=e?.getEndpointParameterInstructions?.()||{};for(const[e,r]of Object.entries(s))switch(r.type){case"staticContextParams":i[e]=r.value;break;case"contextParams":i[e]=t[r.name];break;case"clientContextParams":case"builtInParams":i[e]=await c(r.name,e,n)();break;case"operationContextParams":i[e]=r.get(t);break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(r))}return 0===Object.keys(s).length&&Object.assign(i,n),"s3"===String(n.serviceId).toLowerCase()&&await(async t=>{const e=t?.Bucket||"";if("string"==typeof t.Bucket&&(t.Bucket=e.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),(t=>{const[e,n,i,,,s]=t.split(":"),r="arn"===e&&t.split(":").length>=6,o=Boolean(r&&n&&i&&s);if(r&&!o)throw new Error(`Invalid ARN: ${t} was an invalid ARN.`);return o})(e)){if(!0===t.ForcePathStyle)throw new Error("Path-style addressing cannot be used with ARN buckets")}else n=e,(!r.test(n)||o.test(n)||a.test(n)||-1!==e.indexOf(".")&&!String(t.Endpoint).startsWith("http:")||e.toLowerCase()!==e||e.length<3)&&(t.ForcePathStyle=!0);var n;return t.DisableMultiRegionAccessPoints&&(t.disableMultiRegionAccessPoints=!0,t.DisableMRAP=!0),t})(i),i},u={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:i.Ou.name},p=(t,e)=>({applyToStack:n=>{n.addRelativeTo((({config:t,instructions:e})=>(n,i)=>async r=>{t.isCustomEndpoint&&function(t){t.__smithy_context?t.__smithy_context.features||(t.__smithy_context.features={}):t.__smithy_context={features:{}},t.__smithy_context.features.ENDPOINT_OVERRIDE="N"}(i);const o=await(async(t,e,n,i)=>{if(!n.isCustomEndpoint){let t;t=n.serviceConfiguredEndpoint?await n.serviceConfiguredEndpoint():await(0,l.k)(n.serviceId),t&&(n.endpoint=()=>Promise.resolve((0,h.a)(t)),n.isCustomEndpoint=!0)}const s=await d(t,e,n);if("function"!=typeof n.endpointProvider)throw new Error("config.endpointProvider is not set.");return n.endpointProvider(s,i)})(r.input,{getEndpointParameterInstructions:()=>e},{...t},i);i.endpointV2=o,i.authSchemes=o.properties?.authSchemes;const a=i.authSchemes?.[0];if(a){i.signing_region=a.signingRegion,i.signing_service=a.signingName;const t=(0,s.u)(i),e=t?.selectedHttpAuthScheme?.httpAuthOption;e&&(e.signingProperties=Object.assign(e.signingProperties||{},{signing_region:a.signingRegion,signingRegion:a.signingRegion,signing_service:a.signingName,signingName:a.signingName,signingRegionSet:a.signingRegionSet},a.properties))}return n({...r})})({config:t,instructions:e}),u)}})},6851:(t,e,n)=>{"use strict";n.d(e,{v4:()=>a});var i=n(6982),s=n.n(i);const r=s().randomUUID.bind(s()),o=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0")),a=()=>{if(r)return r();const t=new Uint8Array(16);return crypto.getRandomValues(t),t[6]=15&t[6]|64,t[8]=63&t[8]|128,o[t[0]]+o[t[1]]+o[t[2]]+o[t[3]]+"-"+o[t[4]]+o[t[5]]+"-"+o[t[6]]+o[t[7]]+"-"+o[t[8]]+o[t[9]]+"-"+o[t[10]]+o[t[11]]+o[t[12]]+o[t[13]]+o[t[14]]+o[t[15]]}},6928:t=>{"use strict";t.exports=require("path")},6982:t=>{"use strict";t.exports=require("crypto")},7016:t=>{"use strict";t.exports=require("url")},7029:(t,e,n)=>{"use strict";n.d(e,{R:()=>o});var i=n(857),s=n(6928);const r={},o=()=>{const{HOME:t,USERPROFILE:e,HOMEPATH:n,HOMEDRIVE:o=`C:${s.sep}`}=process.env;if(t)return t;if(e)return e;if(n)return`${o}${n}`;const a=process&&process.geteuid?`${process.geteuid()}`:"DEFAULT";return r[a]||(r[a]=(0,i.homedir)()),r[a]}},7072:(t,e,n)=>{"use strict";n.d(e,{Df:()=>o,G8:()=>s,Rn:()=>c,XP:()=>l,XS:()=>a,bp:()=>i,jh:()=>r,l5:()=>h,ok:()=>d});const i=100,s=2e4,r=500,o=500,a=5,c=10,l=1,h="amz-sdk-invocation-id",d="amz-sdk-request"},7260:(t,e,n)=>{"use strict";n.d(e,{N:()=>i});const i={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t)}},7267:(t,e,n)=>{"use strict";n.d(e,{V:()=>i});const i="__smithy_context"},7268:(t,e,n)=>{"use strict";n.d(e,{S:()=>i});const i=t=>{if(null==t)return{};if(Array.isArray(t))return t.filter(t=>null!=t).map(i);if("object"==typeof t){const e={};for(const n of Object.keys(t))null!=t[n]&&(e[n]=i(t[n]));return e}return t}},7287:(t,e,n)=>{"use strict";n.d(e,{D:()=>r,b:()=>s});var i=n(4367);const s=void 0;function r(t){const e=(0,i.t)(t.userAgentAppId??s),{customUserAgent:n}=t;return Object.assign(t,{customUserAgent:"string"==typeof n?[[n]]:n,userAgentAppId:async()=>{const n=await e();if(!function(t){return void 0===t||"string"==typeof t&&t.length<=50}(n)){const e="NoOpLogger"!==t.logger?.constructor?.name&&t.logger?t.logger:console;"string"!=typeof n?e?.warn("userAgentAppId must be a string or undefined."):n.length>50&&e?.warn("The provided userAgentAppId exceeds the maximum length of 50 characters.")}return n}})}},7308:(t,e,n)=>{"use strict";n.d(e,{P:()=>c});var i=n(1395),s=n(9718),r=n(7459),o=n(7638);class a extends Uint8Array{static fromString(t,e="utf-8"){if("string"==typeof t)return"base64"===e?a.mutate((0,i.E)(t)):a.mutate((0,r.a)(t));throw new Error(`Unsupported conversion from ${typeof t} to Uint8ArrayBlobAdapter.`)}static mutate(t){return Object.setPrototypeOf(t,a.prototype),t}transformToString(t="utf-8"){return"base64"===t?(0,s.n)(this):(0,o.P)(this)}}const c=async(t=new Uint8Array,e)=>{if(t instanceof Uint8Array)return a.mutate(t);if(!t)return a.mutate(new Uint8Array);const n=e.streamCollector(t);return a.mutate(await n)}},7324:(t,e,n)=>{"use strict";n.d(e,{K:()=>i});class i{method;protocol;hostname;port;path;query;headers;username;password;fragment;body;constructor(t){this.method=t.method||"GET",this.hostname=t.hostname||"localhost",this.port=t.port,this.query=t.query||{},this.headers=t.headers||{},this.body=t.body,this.protocol=t.protocol?":"!==t.protocol.slice(-1)?`${t.protocol}:`:t.protocol:"https:",this.path=t.path?"/"!==t.path.charAt(0)?`/${t.path}`:t.path:"/",this.username=t.username,this.password=t.password,this.fragment=t.fragment}static clone(t){const e=new i({...t,headers:{...t.headers}});var n;return e.query&&(e.query=(n=e.query,Object.keys(n).reduce((t,e)=>{const i=n[e];return{...t,[e]:Array.isArray(i)?[...i]:i}},{}))),e}static isInstance(t){if(!t)return!1;const e=t;return"method"in e&&"protocol"in e&&"hostname"in e&&"path"in e&&"object"==typeof e.query&&"object"==typeof e.headers}clone(){return i.clone(this)}}},7355:(t,e,n)=>{"use strict";var i;n.d(e,{Gz:()=>s,L0:()=>r,cm:()=>i}),function(t){t.STANDARD="standard",t.ADAPTIVE="adaptive"}(i||(i={}));const s=3,r=i.STANDARD},7389:(t,e,n)=>{"use strict";n.d(e,{h:()=>z});var i=n(244),s=n(4367),r=n(1431),o=n(8004),a=n(4424);const c="X-Amz-Date",l="X-Amz-Signature",h="X-Amz-Security-Token",d="authorization",u=c.toLowerCase(),p=[d,u,"date"],g=l.toLowerCase(),f="x-amz-content-sha256",m=h.toLowerCase(),v={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},y=/^proxy-/,b=/^sec-/,w="AWS4-HMAC-SHA256",A="AWS4-HMAC-SHA256-PAYLOAD",x="aws4_request",S={},E=[],_=(t,e,n)=>`${t}/${e}/${n}/${x}`,C=(t,e,n)=>{const i=new t(e);return i.update((0,a.F)(n)),i.digest()},T=({headers:t},e,n)=>{const i={};for(const s of Object.keys(t).sort()){if(null==t[s])continue;const r=s.toLowerCase();(r in v||e?.has(r)||y.test(r)||b.test(r))&&(!n||n&&!n.has(r))||(i[r]=t[s].trim().replace(/\s+/g," "))}return i};var k=n(3695);const R=async({headers:t,body:e},n)=>{for(const e of Object.keys(t))if(e.toLowerCase()===f)return t[e];if(null==e)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if("string"==typeof e||ArrayBuffer.isView(e)||(0,k.m)(e)){const t=new n;return t.update((0,a.F)(e)),(0,o.n)(await t.digest())}return"UNSIGNED-PAYLOAD"};var I,P=n(7459);class M{format(t){const e=[];for(const n of Object.keys(t)){const i=(0,P.a)(n);e.push(Uint8Array.from([i.byteLength]),i,this.formatHeaderValue(t[n]))}const n=new Uint8Array(e.reduce((t,e)=>t+e.byteLength,0));let i=0;for(const t of e)n.set(t,i),i+=t.byteLength;return n}formatHeaderValue(t){switch(t.type){case"boolean":return Uint8Array.from([t.value?0:1]);case"byte":return Uint8Array.from([2,t.value]);case"short":const e=new DataView(new ArrayBuffer(3));return e.setUint8(0,3),e.setInt16(1,t.value,!1),new Uint8Array(e.buffer);case"integer":const n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,t.value,!1),new Uint8Array(n.buffer);case"long":const i=new Uint8Array(9);return i[0]=5,i.set(t.value.bytes,1),i;case"binary":const s=new DataView(new ArrayBuffer(3+t.value.byteLength));s.setUint8(0,6),s.setUint16(1,t.value.byteLength,!1);const r=new Uint8Array(s.buffer);return r.set(t.value,3),r;case"string":const a=(0,P.a)(t.value),c=new DataView(new ArrayBuffer(3+a.byteLength));c.setUint8(0,7),c.setUint16(1,a.byteLength,!1);const l=new Uint8Array(c.buffer);return l.set(a,3),l;case"timestamp":const h=new Uint8Array(9);return h[0]=8,h.set(O.fromNumber(t.value.valueOf()).bytes,1),h;case"uuid":if(!D.test(t.value))throw new Error(`Invalid UUID received: ${t.value}`);const d=new Uint8Array(17);return d[0]=9,d.set((0,o.a)(t.value.replace(/\-/g,"")),1),d}}}!function(t){t[t.boolTrue=0]="boolTrue",t[t.boolFalse=1]="boolFalse",t[t.byte=2]="byte",t[t.short=3]="short",t[t.integer=4]="integer",t[t.long=5]="long",t[t.byteArray=6]="byteArray",t[t.string=7]="string",t[t.timestamp=8]="timestamp",t[t.uuid=9]="uuid"}(I||(I={}));const D=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;class O{bytes;constructor(t){if(this.bytes=t,8!==t.byteLength)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(t){if(t>0x8000000000000000||t<-0x8000000000000000)throw new Error(`${t} is too large (or, if negative, too small) to represent as an Int64`);const e=new Uint8Array(8);for(let n=7,i=Math.abs(Math.round(t));n>-1&&i>0;n--,i/=256)e[n]=i;return t<0&&L(e),new O(e)}valueOf(){const t=this.bytes.slice(0),e=128&t[0];return e&&L(t),parseInt((0,o.n)(t),16)*(e?-1:1)}toString(){return String(this.valueOf())}}function L(t){for(let e=0;e<8;e++)t[e]^=255;for(let e=7;e>-1&&(t[e]++,0===t[e]);e--);}var N=n(7324);const F=t=>{t=N.K.clone(t);for(const e of Object.keys(t.headers))p.indexOf(e.toLowerCase())>-1&&delete t.headers[e];return t};var B=n(8947),U=n(2531);class ${service;regionProvider;credentialProvider;sha256;uriEscapePath;applyChecksum;constructor({applyChecksum:t,credentials:e,region:n,service:i,sha256:s,uriEscapePath:r=!0}){this.service=i,this.sha256=s,this.uriEscapePath=r,this.applyChecksum="boolean"!=typeof t||t,this.regionProvider=(0,B.t)(n),this.credentialProvider=(0,B.t)(e)}createCanonicalRequest(t,e,n){const i=Object.keys(e).sort();return`${t.method}\n${this.getCanonicalPath(t)}\n${(({query:t={}})=>{const e=[],n={};for(const i of Object.keys(t)){if(i.toLowerCase()===g)continue;const s=(0,U.o)(i);e.push(s);const r=t[i];"string"==typeof r?n[s]=`${s}=${(0,U.o)(r)}`:Array.isArray(r)&&(n[s]=r.slice(0).reduce((t,e)=>t.concat([`${s}=${(0,U.o)(e)}`]),[]).sort().join("&"))}return e.sort().map(t=>n[t]).filter(t=>t).join("&")})(t)}\n${i.map(t=>`${t}:${e[t]}`).join("\n")}\n\n${i.join(";")}\n${n}`}async createStringToSign(t,e,n,i){const s=new this.sha256;s.update((0,a.F)(n));const r=await s.digest();return`${i}\n${t}\n${e}\n${(0,o.n)(r)}`}getCanonicalPath({path:t}){if(this.uriEscapePath){const e=[];for(const n of t.split("/"))0!==n?.length&&"."!==n&&(".."===n?e.pop():e.push(n));const n=`${t?.startsWith("/")?"/":""}${e.join("/")}${e.length>0&&t?.endsWith("/")?"/":""}`;return(0,U.o)(n).replace(/%2F/g,"/")}return t}validateResolvedCredentials(t){if("object"!=typeof t||"string"!=typeof t.accessKeyId||"string"!=typeof t.secretAccessKey)throw new Error("Resolved credential object is not valid")}formatDate(t){const e=(n=t,(t=>"number"==typeof t?new Date(1e3*t):"string"==typeof t?Number(t)?new Date(1e3*Number(t)):new Date(t):t)(n).toISOString().replace(/\.\d{3}Z$/,"Z")).replace(/[\-:]/g,"");var n;return{longDate:e,shortDate:e.slice(0,8)}}getCanonicalHeaderList(t){return Object.keys(t).sort().join(";")}}class j extends ${headerFormatter=new M;constructor({applyChecksum:t,credentials:e,region:n,service:i,sha256:s,uriEscapePath:r=!0}){super({applyChecksum:t,credentials:e,region:n,service:i,sha256:s,uriEscapePath:r})}async presign(t,e={}){const{signingDate:n=new Date,expiresIn:i=3600,unsignableHeaders:s,unhoistableHeaders:r,signableHeaders:o,hoistableHeaders:a,signingRegion:d,signingService:u}=e,p=await this.credentialProvider();this.validateResolvedCredentials(p);const g=d??await this.regionProvider(),{longDate:f,shortDate:m}=this.formatDate(n);if(i>604800)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");const v=_(m,g,u??this.service),y=((t,e={})=>{const{headers:n,query:i={}}=N.K.clone(t);for(const t of Object.keys(n)){const s=t.toLowerCase();("x-amz-"===s.slice(0,6)&&!e.unhoistableHeaders?.has(s)||e.hoistableHeaders?.has(s))&&(i[t]=n[t],delete n[t])}return{...t,headers:n,query:i}})(F(t),{unhoistableHeaders:r,hoistableHeaders:a});p.sessionToken&&(y.query[h]=p.sessionToken),y.query["X-Amz-Algorithm"]=w,y.query["X-Amz-Credential"]=`${p.accessKeyId}/${v}`,y.query[c]=f,y.query["X-Amz-Expires"]=i.toString(10);const b=T(y,s,o);return y.query["X-Amz-SignedHeaders"]=this.getCanonicalHeaderList(b),y.query[l]=await this.getSignature(f,v,this.getSigningKey(p,g,m,u),this.createCanonicalRequest(y,b,await R(t,this.sha256))),y}async sign(t,e){return"string"==typeof t?this.signString(t,e):t.headers&&t.payload?this.signEvent(t,e):t.message?this.signMessage(t,e):this.signRequest(t,e)}async signEvent({headers:t,payload:e},{signingDate:n=new Date,priorSignature:i,signingRegion:s,signingService:r}){const a=s??await this.regionProvider(),{shortDate:c,longDate:l}=this.formatDate(n),h=_(c,a,r??this.service),d=await R({headers:{},body:e},this.sha256),u=new this.sha256;u.update(t);const p=(0,o.n)(await u.digest()),g=[A,l,h,i,p,d].join("\n");return this.signString(g,{signingDate:n,signingRegion:a,signingService:r})}async signMessage(t,{signingDate:e=new Date,signingRegion:n,signingService:i}){return this.signEvent({headers:this.headerFormatter.format(t.message.headers),payload:t.message.body},{signingDate:e,signingRegion:n,signingService:i,priorSignature:t.priorSignature}).then(e=>({message:t.message,signature:e}))}async signString(t,{signingDate:e=new Date,signingRegion:n,signingService:i}={}){const s=await this.credentialProvider();this.validateResolvedCredentials(s);const r=n??await this.regionProvider(),{shortDate:c}=this.formatDate(e),l=new this.sha256(await this.getSigningKey(s,r,c,i));return l.update((0,a.F)(t)),(0,o.n)(await l.digest())}async signRequest(t,{signingDate:e=new Date,signableHeaders:n,unsignableHeaders:i,signingRegion:s,signingService:r}={}){const o=await this.credentialProvider();this.validateResolvedCredentials(o);const a=s??await this.regionProvider(),c=F(t),{longDate:l,shortDate:h}=this.formatDate(e),p=_(h,a,r??this.service);c.headers[u]=l,o.sessionToken&&(c.headers[m]=o.sessionToken);const g=await R(c,this.sha256);!((t,e)=>{t=t.toLowerCase();for(const n of Object.keys(e))if(t===n.toLowerCase())return!0;return!1})(f,c.headers)&&this.applyChecksum&&(c.headers[f]=g);const v=T(c,i,n),y=await this.getSignature(l,p,this.getSigningKey(o,a,h,r),this.createCanonicalRequest(c,v,g));return c.headers[d]=`${w} Credential=${o.accessKeyId}/${p}, SignedHeaders=${this.getCanonicalHeaderList(v)}, Signature=${y}`,c}async getSignature(t,e,n,i){const s=await this.createStringToSign(t,e,i,w),r=new this.sha256(await n);return r.update((0,a.F)(s)),(0,o.n)(await r.digest())}getSigningKey(t,e,n,i){return(async(t,e,n,i,s)=>{const r=await C(t,e.secretAccessKey,e.accessKeyId),a=`${n}:${i}:${s}:${(0,o.n)(r)}:${e.sessionToken}`;if(a in S)return S[a];for(E.push(a);E.length>50;)delete S[E.shift()];let c=`AWS4${e.secretAccessKey}`;for(const e of[n,i,s,x])c=await C(t,c,e);return S[a]=c})(this.sha256,t,n,e,i||this.service)}}const z=t=>{let e,n=t.credentials,o=!!t.credentials;Object.defineProperty(t,"credentials",{set(a){a&&a!==n&&a!==e&&(o=!0),n=a;const c=function(t,{credentials:e,credentialDefaultProvider:n}){let i;return i=e?e?.memoized?e:(0,r.K4)(e,r.OC,r.e):n?(0,s.t)(n(Object.assign({},t,{parentClientConfig:t}))):async()=>{throw new Error("@aws-sdk/core::resolveAwsSdkSigV4Config - `credentials` not provided and no credentialDefaultProvider was configured.")},i.memoized=!0,i}(t,{credentials:n,credentialDefaultProvider:t.credentialDefaultProvider}),l=function(t,e){if(e.configBound)return e;const n=async n=>e({...n,callerClientConfig:t});return n.memoized=e.memoized,n.configBound=!0,n}(t,c);o&&!l.attributed?(e=async t=>l(t).then(t=>(0,i.g)(t,"CREDENTIALS_CODE","e")),e.memoized=l.memoized,e.configBound=l.configBound,e.attributed=!0):e=l},get:()=>e,enumerable:!0,configurable:!0}),t.credentials=n;const{signingEscapePath:a=!0,systemClockOffset:c=t.systemClockOffset||0,sha256:l}=t;let h;return h=t.signer?(0,s.t)(t.signer):t.regionInfoProvider?()=>(0,s.t)(t.region)().then(async e=>[await t.regionInfoProvider(e,{useFipsEndpoint:await t.useFipsEndpoint(),useDualstackEndpoint:await t.useDualstackEndpoint()})||{},e]).then(([e,n])=>{const{signingRegion:i,signingService:s}=e;t.signingRegion=t.signingRegion||i||n,t.signingName=t.signingName||s||t.serviceId;const r={...t,credentials:t.credentials,region:t.signingRegion,service:t.signingName,sha256:l,uriEscapePath:a};return new(t.signerConstructor||j)(r)}):async e=>{const n=(e=Object.assign({},{name:"sigv4",signingName:t.signingName||t.defaultSigningName,signingRegion:await(0,s.t)(t.region)(),properties:{}},e)).signingRegion,i=e.signingName;t.signingRegion=t.signingRegion||n,t.signingName=t.signingName||i||t.serviceId;const r={...t,credentials:t.credentials,region:t.signingRegion,service:t.signingName,sha256:l,uriEscapePath:a};return new(t.signerConstructor||j)(r)},Object.assign(t,{systemClockOffset:c,signingEscapePath:a,signer:h})}},7459:(t,e,n)=>{"use strict";n.d(e,{a:()=>s});var i=n(9290);const s=t=>{const e=(0,i.s)(t,"utf8");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT)}},7461:(t,e,n)=>{"use strict";n.d(e,{k:()=>i});class i{capacity;data=new Map;parameters=[];constructor({size:t,params:e}){this.capacity=t??50,e&&(this.parameters=e)}get(t,e){const n=this.hash(t);if(!1===n)return e();if(!this.data.has(n)){if(this.data.size>this.capacity+10){const t=this.data.keys();let e=0;for(;;){const{value:n,done:i}=t.next();if(this.data.delete(n),i||++e>10)break}}this.data.set(n,e())}return this.data.get(n)}size(){return this.data.size}hash(t){let e="";const{parameters:n}=this;if(0===n.length)return!1;for(const i of n){const n=String(t[i]??"");if(n.includes("|;"))return!1;e+=n+"|;"}return e}}},7513:(t,e,n)=>{"use strict";n.d(e,{J:()=>s});var i=n(6014);class s extends i.m{name="TokenProviderError";constructor(t,e=!0){super(t,e),Object.setPrototypeOf(this,s.prototype)}}},7638:(t,e,n)=>{"use strict";n.d(e,{P:()=>s});var i=n(9290);const s=t=>{if("string"==typeof t)return t;if("object"!=typeof t||"number"!=typeof t.byteOffset||"number"!=typeof t.byteLength)throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return(0,i.Q)(t.buffer,t.byteOffset,t.byteLength).toString("utf8")}},7813:(t,e,n)=>{"use strict";n.d(e,{Y7:()=>s});const i={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},s=t=>({applyToStack:t=>{t.add((t,e)=>async n=>{try{const i=await t(n),{clientName:s,commandName:r,logger:o,dynamoDbDocumentClientOptions:a={}}=e,{overrideInputFilterSensitiveLog:c,overrideOutputFilterSensitiveLog:l}=a,h=c??e.inputFilterSensitiveLog,d=l??e.outputFilterSensitiveLog,{$metadata:u,...p}=i.output;return o?.info?.({clientName:s,commandName:r,input:h(n.input),output:d(p),metadata:u}),i}catch(t){const{clientName:i,commandName:s,logger:r,dynamoDbDocumentClientOptions:o={}}=e,{overrideInputFilterSensitiveLog:a}=o,c=a??e.inputFilterSensitiveLog;throw r?.error?.({clientName:i,commandName:s,input:c(n.input),error:t,metadata:t.$metadata}),t}},i)}})},7821:(t,e,n)=>{"use strict";n.d(e,{K:()=>s});var i=n(1671);class s{config;middlewareStack=(0,i.o)();initConfig;handlers;constructor(t){this.config=t}send(t,e,n){const i="function"!=typeof e?e:void 0,s="function"==typeof e?e:n;let r;if(void 0===i&&!0===this.config.cacheMiddleware){this.handlers||(this.handlers=new WeakMap);const e=this.handlers;e.has(t.constructor)?r=e.get(t.constructor):(r=t.resolveMiddleware(this.middlewareStack,this.config,i),e.set(t.constructor,r))}else delete this.handlers,r=t.resolveMiddleware(this.middlewareStack,this.config,i);if(!s)return r(t).then(t=>t.output);r(t).then(t=>s(null,t.output),t=>s(t)).catch(()=>{})}destroy(){this.config?.requestHandler?.destroy?.(),delete this.handlers}}},7916:(t,e,n)=>{"use strict";function i(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}n.d(e,{$:()=>i})},8004:(t,e,n)=>{"use strict";n.d(e,{a:()=>r,n:()=>o});const i={},s={};for(let t=0;t<256;t++){let e=t.toString(16).toLowerCase();1===e.length&&(e=`0${e}`),i[t]=e,s[e]=t}function r(t){if(t.length%2!=0)throw new Error("Hex encoded strings must have an even number length");const e=new Uint8Array(t.length/2);for(let n=0;n<t.length;n+=2){const i=t.slice(n,n+2).toLowerCase();if(!(i in s))throw new Error(`Cannot decode unrecognized sequence ${i} as hexadecimal`);e[n/2]=s[i]}return e}function o(t){let e="";for(let n=0;n<t.byteLength;n++)e+=i[t[n]];return e}},8059:(t,e,n)=>{"use strict";n.d(e,{sM:()=>p});var i=n(643),s=n(7324);function r(t,e,n){t.__aws_sdk_context?t.__aws_sdk_context.features||(t.__aws_sdk_context.features={}):t.__aws_sdk_context={features:{}},t.__aws_sdk_context.features[e]=n}const o=/\d{12}\.ddb/,a="user-agent",c="x-amz-user-agent",l=/[^!$%&'*+\-.^_`|~\w]/g,h=/[^!$%&'*+\-.^_`|~\w#]/g,d=t=>{const e=t[0].split("/").map(t=>t.replace(l,"-")).join("/"),n=t[1]?.replace(h,"-"),i=e.indexOf("/"),s=e.substring(0,i);let r=e.substring(i+1);return"api"===s&&(r=r.toLowerCase()),[s,r,n].filter(t=>t&&t.length>0).reduce((t,e,n)=>{switch(n){case 0:return e;case 1:return`${t}/${e}`;default:return`${t}#${e}`}},"")},u={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},p=t=>({applyToStack:e=>{var n;e.add((n=t,(t,e)=>async l=>{const{request:h}=l;if(!s.K.isInstance(h))return t(l);const{headers:u}=h,p=e?.userAgent?.map(d)||[],g=(await n.defaultUserAgentProvider()).map(d);await async function(t,e,n){const i=n.request;if("rpc-v2-cbor"===i?.headers?.["smithy-protocol"]&&r(t,"PROTOCOL_RPC_V2_CBOR","M"),"function"==typeof e.retryStrategy){const n=await e.retryStrategy();"function"==typeof n.acquireInitialRetryToken?n.constructor?.name?.includes("Adaptive")?r(t,"RETRY_MODE_ADAPTIVE","F"):r(t,"RETRY_MODE_STANDARD","E"):r(t,"RETRY_MODE_LEGACY","D")}if("function"==typeof e.accountIdEndpointMode){const n=t.endpointV2;switch(String(n?.url?.hostname).match(o)&&r(t,"ACCOUNT_ID_ENDPOINT","O"),await(e.accountIdEndpointMode?.())){case"disabled":r(t,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":r(t,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":r(t,"ACCOUNT_ID_MODE_REQUIRED","R")}}const s=t.__smithy_context?.selectedHttpAuthScheme?.identity;if(s?.$source){const e=s;e.accountId&&r(t,"RESOLVED_ACCOUNT_ID","T");for(const[n,i]of Object.entries(e.$source??{}))r(t,n,i)}}(e,n,l);const f=e;g.push(`m/${function(t){let e="";for(const n in t){const i=t[n];if(!(e.length+i.length+1<=1024))break;e.length?e+=","+i:e+=i}return e}(Object.assign({},e.__smithy_context?.features,f.__aws_sdk_context?.features))}`);const m=n?.customUserAgent?.map(d)||[],v=await n.userAgentAppId();v&&g.push(d(["app",`${v}`]));const y=(0,i.vL)(),b=(y?[y]:[]).concat([...g,...p,...m]).join(" "),w=[...g.filter(t=>t.startsWith("aws-sdk-")),...m].join(" ");return"browser"!==n.runtime?(w&&(u[c]=u[c]?`${u[a]} ${w}`:w),u[a]=b):u[c]=b,t({...l,request:h})}),u)}})},8062:(t,e,n)=>{"use strict";n.d(e,{c:()=>s});var i=n(6014);const s=(...t)=>async()=>{if(0===t.length)throw new i.m("No providers in chain");let e;for(const n of t)try{return await n()}catch(t){if(e=t,t?.tryNextLink)continue;throw t}throw e}},8218:(t,e,n)=>{"use strict";n.d(e,{w:()=>r});var i=n(7308),s=n(7638);const r=(t,e)=>(0,i.P)(t,e).then(t=>(e?.utf8Encoder??s.P)(t))},8246:(t,e,n)=>{"use strict";n.d(e,{pf:()=>r});var i=n(857);const s=require("process"),r=({serviceId:t,clientVersion:e})=>async n=>{const r=[["aws-sdk-js",e],["ua","2.1"],[`os/${(0,i.platform)()}`,(0,i.release)()],["lang/js"],["md/nodejs",`${s.versions.node}`]];t&&r.push([`api/${t}`,e]),s.env.AWS_EXECUTION_ENV&&r.push([`exec-env/${s.env.AWS_EXECUTION_ENV}`]);const o=await(n?.userAgentAppId?.());return o?[...r,[`app/${o}`]]:[...r]}},8462:(t,e,n)=>{"use strict";n.d(e,{a:()=>s});var i=n(2641);const s=t=>"object"==typeof t?"url"in t?(0,i.D)(t.url):t:(0,i.D)(t)},8611:t=>{"use strict";t.exports=require("http")},8829:(t,e,n)=>{"use strict";n.d(e,{k:()=>a});var i=n(4013),s=n(9094);const r="AWS_ENDPOINT_URL",o="endpoint_url",a=async t=>(0,i.Z)((t=>({environmentVariableSelector:e=>{const n=t.split(" ").map(t=>t.toUpperCase()),i=e[[r,...n].join("_")];return i||(e[r]||void 0)},configFileSelector:(e,n)=>{if(n&&e.services){const i=n[["services",e.services].join(s.Q)];if(i){const e=i[[t.split(" ").map(t=>t.toLowerCase()).join("_"),o].join(s.Q)];if(e)return e}}const i=e[o];if(i)return i},default:void 0}))(t??""))()},8845:(t,e,n)=>{"use strict";n.d(e,{Jj:()=>r,TA:()=>o});const i=require("node:fs/promises"),s={},r={},o=(t,e)=>void 0!==r[t]?r[t]:(s[t]&&!e?.ignoreCache||(s[t]=(0,i.readFile)(t,"utf8")),s[t])},8879:(t,e,n)=>{"use strict";n.d(e,{n:()=>u});const i={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},s=require("async_hooks"),r="1"===process.env.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA||"true"===process.env.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA;r||(globalThis.awslambda=globalThis.awslambda||{});const o={REQUEST_ID:Symbol("_AWS_LAMBDA_REQUEST_ID"),X_RAY_TRACE_ID:Symbol("_AWS_LAMBDA_X_RAY_TRACE_ID"),TENANT_ID:Symbol("_AWS_LAMBDA_TENANT_ID")};class a{static storage=new s.AsyncLocalStorage;static PROTECTED_KEYS=o;static run(t,e){return this.storage.run({...t},e)}static getContext(){return this.storage.getStore()}static get(t){const e=this.storage.getStore();return e?.[t]}static set(t,e){if(this.isProtectedKey(t))throw new Error("Cannot modify protected Lambda context field");const n=this.storage.getStore();n&&(n[t]=e)}static getRequestId(){return this.get(this.PROTECTED_KEYS.REQUEST_ID)??"-"}static getXRayTraceId(){return this.get(this.PROTECTED_KEYS.X_RAY_TRACE_ID)}static getTenantId(){return this.get(this.PROTECTED_KEYS.TENANT_ID)}static hasContext(){return void 0!==this.storage.getStore()}static isProtectedKey(t){return t===this.PROTECTED_KEYS.REQUEST_ID||t===this.PROTECTED_KEYS.X_RAY_TRACE_ID}}let c;!r&&globalThis.awslambda?.InvokeStore?c=globalThis.awslambda.InvokeStore:(c=a,!r&&globalThis.awslambda&&(globalThis.awslambda.InvokeStore=c));const l=c;var h=n(7324);const d="X-Amzn-Trace-Id",u=t=>({applyToStack:t=>{t.add(t=>async e=>{const{request:n}=e;if(!h.K.isInstance(n))return t(e);const i=Object.keys(n.headers??{}).find(t=>t.toLowerCase()===d.toLowerCase())??d;if(n.headers.hasOwnProperty(i))return t(e);const s=process.env.AWS_LAMBDA_FUNCTION_NAME,r=process.env._X_AMZN_TRACE_ID,o=l.getXRayTraceId()??r,a=t=>"string"==typeof t&&t.length>0;return a(s)&&a(o)&&(n.headers[d]=o),t({...e,request:n})},i)}})},8883:(t,e,n)=>{"use strict";n.d(e,{X:()=>s});const i=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),s=(t,e=!1)=>{if(!e)return i.test(t);const n=t.split(".");for(const t of n)if(!s(t))return!1;return!0}},8947:(t,e,n)=>{"use strict";n.d(e,{t:()=>i});const i=t=>{if("function"==typeof t)return t;const e=Promise.resolve(t);return()=>e}},9023:t=>{"use strict";t.exports=require("util")},9094:(t,e,n)=>{"use strict";n.d(e,{Q:()=>i});const i="."},9212:(t,e,n)=>{"use strict";n.d(e,{l:()=>r});var i=n(7324),s=n(7916);function r(t,e){return new o(t,e)}class o{input;context;query={};method="";headers={};path="";body=null;hostname="";resolvePathStack=[];constructor(t,e){this.input=t,this.context=e}async build(){const{hostname:t,protocol:e="https",port:n,path:s}=await this.context.endpoint();this.path=s;for(const t of this.resolvePathStack)t(this.path);return new i.K({protocol:e,hostname:this.hostname||t,port:n,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(t){return this.hostname=t,this}bp(t){return this.resolvePathStack.push(e=>{this.path=`${e?.endsWith("/")?e.slice(0,-1):e||""}`+t}),this}p(t,e,n,i){return this.resolvePathStack.push(r=>{this.path=((t,e,n,i,r,o)=>{if(null==e||void 0===e[n])throw new Error("No value provided for input HTTP label: "+n+".");{const e=i();if(e.length<=0)throw new Error("Empty value provided for input HTTP label: "+n+".");t=t.replace(r,o?e.split("/").map(t=>(0,s.$)(t)).join("/"):(0,s.$)(e))}return t})(r,this.input,t,e,n,i)}),this}h(t){return this.headers=t,this}q(t){return this.query=t,this}b(t){return this.body=t,this}m(t){return this.method=t,this}}},9290:(t,e,n)=>{"use strict";n.d(e,{Q:()=>r,s:()=>o});var i=n(3695),s=n(181);const r=(t,e=0,n=t.byteLength-e)=>{if(!(0,i.m)(t))throw new TypeError(`The "input" argument must be ArrayBuffer. Received type ${typeof t} (${t})`);return s.Buffer.from(t,e,n)},o=(t,e)=>{if("string"!=typeof t)throw new TypeError(`The "input" argument must be of type string. Received type ${typeof t} (${t})`);return e?s.Buffer.from(t,e):s.Buffer.from(t)}},9317:(t,e,n)=>{"use strict";var i,s,r,o,a,c,l,h,d,u,p,g,f,m,v=t=>{throw TypeError(t)},y=(t,e,n)=>e.has(t)||v("Cannot "+n),b=(t,e,n)=>(y(t,e,"read from private field"),n?n.call(t):e.get(t)),w=(t,e,n)=>e.has(t)?v("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),A=(t,e,n,i)=>(y(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n),x=(t,e,n)=>(y(t,e,"access private method"),n);Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});var S="undefined"!=typeof document?document.currentScript:null,E={34:(t,e,n)=>{var i=n(4901);t.exports=function(t){return"object"==typeof t?null!==t:i(t)}},81:(t,e,n)=>{var i=n(9565),s=n(9306),r=n(8551),o=n(6823),a=n(851),c=TypeError;t.exports=function(t,e){var n=arguments.length<2?a(t):e;if(s(n))return r(i(n,t));throw new c(o(t)+" is not iterable")}},116:(t,e,n)=>{var i=n(6518),s=n(9565),r=n(2652),o=n(9306),a=n(8551),c=n(1767),l=n(9539),h=n(4549)("find",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:h},{find:function(t){a(this);try{o(t)}catch(t){l(this,"throw",t)}if(h)return s(h,this,t);var e=c(this),n=0;return r(e,function(e,i){if(t(e,n++))return i(e)},{IS_RECORD:!0,INTERRUPTED:!0}).result}})},283:(t,e,n)=>{var i=n(9504),s=n(9039),r=n(4901),o=n(9297),a=n(3724),c=n(350).CONFIGURABLE,l=n(3706),h=n(1181),d=h.enforce,u=h.get,p=String,g=Object.defineProperty,f=i("".slice),m=i("".replace),v=i([].join),y=a&&!s(function(){return 8!==g(function(){},"length",{value:8}).length}),b=String(String).split("String"),w=t.exports=function(t,e,n){"Symbol("===f(p(e),0,7)&&(e="["+m(p(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!o(t,"name")||c&&t.name!==e)&&(a?g(t,"name",{value:e,configurable:!0}):t.name=e),y&&n&&o(n,"arity")&&t.length!==n.arity&&g(t,"length",{value:n.arity});try{n&&o(n,"constructor")&&n.constructor?a&&g(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var i=d(t);return o(i,"source")||(i.source=v(b,"string"==typeof e?e:"")),t};Function.prototype.toString=w(function(){return r(this)&&u(this).source||l(this)},"toString")},350:(t,e,n)=>{var i=n(3724),s=n(9297),r=Function.prototype,o=i&&Object.getOwnPropertyDescriptor,a=s(r,"name"),c=a&&"something"===function(){}.name,l=a&&(!i||i&&o(r,"name").configurable);t.exports={EXISTS:a,PROPER:c,CONFIGURABLE:l}},397:(t,e,n)=>{var i=n(7751);t.exports=i("document","documentElement")},421:t=>{t.exports={}},456:(t,e,n)=>{var i=n(6518),s=n(4576),r=n(9504),o=n(4154),a=n(5169),c=r(1.1.toString),l=s.Uint8Array,h=!l||!l.prototype.toHex||!function(){try{return"ffffffffffffffff"===new l([255,255,255,255,255,255,255,255]).toHex()}catch(t){return!1}}();l&&i({target:"Uint8Array",proto:!0,forced:h},{toHex:function(){o(this),a(this.buffer);for(var t="",e=0,n=this.length;e<n;e++){var i=c(this[e],16);t+=1===i.length?"0"+i:i}return t}})},507:(t,e,n)=>{var i=n(9565);t.exports=function(t,e,n){for(var s,r,o=n?t:t.iterator,a=t.next;!(s=i(a,o)).done;)if(void 0!==(r=e(s.value)))return r}},531:(t,e,n)=>{var i=n(6518),s=n(9565),r=n(9306),o=n(8551),a=n(1767),c=n(8646),l=n(9462),h=n(9539),d=n(6395),u=n(684),p=n(4549),g=!d&&!u("flatMap",function(){}),f=!d&&!g&&p("flatMap",TypeError),m=d||g||f,v=l(function(){for(var t,e,n=this.iterator,i=this.mapper;;){if(e=this.inner)try{if(!(t=o(s(e.next,e.iterator))).done)return t.value;this.inner=null}catch(t){h(n,"throw",t)}if(t=o(s(this.next,n)),this.done=!!t.done)return;try{this.inner=c(i(t.value,this.counter++),!1)}catch(t){h(n,"throw",t)}}});i({target:"Iterator",proto:!0,real:!0,forced:m},{flatMap:function(t){o(this);try{r(t)}catch(t){h(this,"throw",t)}return f?s(f,this,t):new v(a(this),{mapper:t,inner:null})}})},616:(t,e,n)=>{var i=n(9039);t.exports=!i(function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})},655:(t,e,n)=>{var i=n(6955),s=String;t.exports=function(t){if("Symbol"===i(t))throw new TypeError("Cannot convert a Symbol value to a string");return s(t)}},679:(t,e,n)=>{var i=n(1625),s=TypeError;t.exports=function(t,e){if(i(e,t))return t;throw new s("Incorrect invocation")}},684:t=>{t.exports=function(t,e){var n="function"==typeof Iterator&&Iterator.prototype[t];if(n)try{n.call({next:null},e).next()}catch(t){return!0}}},741:t=>{var e=Math.ceil,n=Math.floor;t.exports=Math.trunc||function(t){var i=+t;return(i>0?n:e)(i)}},757:(t,e,n)=>{var i=n(7751),s=n(4901),r=n(1625),o=n(7040),a=Object;t.exports=o?function(t){return"symbol"==typeof t}:function(t){var e=i("Symbol");return s(e)&&r(e.prototype,a(t))}},851:(t,e,n)=>{var i=n(6955),s=n(5966),r=n(4117),o=n(6269),a=n(8227)("iterator");t.exports=function(t){if(!r(t))return s(t,a)||s(t,"@@iterator")||o[i(t)]}},944:t=>{var e=TypeError;t.exports=function(t){var n=t&&t.alphabet;if(void 0===n||"base64"===n||"base64url"===n)return n||"base64";throw new e("Incorrect `alphabet` option")}},1072:(t,e,n)=>{var i=n(1828),s=n(8727);t.exports=Object.keys||function(t){return i(t,s)}},1103:t=>{t.exports=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}},1108:(t,e,n)=>{var i=n(6955);t.exports=function(t){var e=i(t);return"BigInt64Array"===e||"BigUint64Array"===e}},1148:(t,e,n)=>{var i=n(6518),s=n(9565),r=n(2652),o=n(9306),a=n(8551),c=n(1767),l=n(9539),h=n(4549)("every",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:h},{every:function(t){a(this);try{o(t)}catch(t){l(this,"throw",t)}if(h)return s(h,this,t);var e=c(this),n=0;return!r(e,function(e,i){if(!t(e,n++))return i()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},1181:(t,e,n)=>{var i,s,r,o=n(8622),a=n(4576),c=n(34),l=n(6699),h=n(9297),d=n(7629),u=n(6119),p=n(421),g="Object already initialized",f=a.TypeError,m=a.WeakMap;if(o||d.state){var v=d.state||(d.state=new m);v.get=v.get,v.has=v.has,v.set=v.set,i=function(t,e){if(v.has(t))throw new f(g);return e.facade=t,v.set(t,e),e},s=function(t){return v.get(t)||{}},r=function(t){return v.has(t)}}else{var y=u("state");p[y]=!0,i=function(t,e){if(h(t,y))throw new f(g);return e.facade=t,l(t,y,e),e},s=function(t){return h(t,y)?t[y]:{}},r=function(t){return h(t,y)}}t.exports={set:i,get:s,has:r,enforce:function(t){return r(t)?s(t):i(t,{})},getterFor:function(t){return function(e){var n;if(!c(e)||(n=s(e)).type!==t)throw new f("Incompatible receiver, "+t+" required");return n}}}},1291:(t,e,n)=>{var i=n(741);t.exports=function(t){var e=+t;return e!=e||0===e?0:i(e)}},1385:(t,e,n)=>{var i=n(9539);t.exports=function(t,e,n){for(var s=t.length-1;s>=0;s--)if(void 0!==t[s])try{n=i(t[s].iterator,e,n)}catch(t){e="throw",n=t}if("throw"===e)throw n;return n}},1548:(t,e,n)=>{var i=n(4576),s=n(9039),r=n(9519),o=n(4215),a=i.structuredClone;t.exports=!!a&&!s(function(){if("DENO"===o&&r>92||"NODE"===o&&r>94||"BROWSER"===o&&r>97)return!1;var t=new ArrayBuffer(8),e=a(t,{transfer:[t]});return 0!==t.byteLength||8!==e.byteLength})},1549:(t,e,n)=>{n(6632)},1625:(t,e,n)=>{var i=n(9504);t.exports=i({}.isPrototypeOf)},1689:(t,e,n)=>{var i=n(6518),s=n(4576),r=n(8745),o=n(7680),a=n(6043),c=n(9306),l=n(1103),h=s.Promise,d=!1;i({target:"Promise",stat:!0,forced:!h||!h.try||l(function(){h.try(function(t){d=8===t},8)}).error||!d},{try:function(t){var e=arguments.length>1?o(arguments,1):[],n=a.f(this),i=l(function(){return r(c(t),void 0,e)});return(i.error?n.reject:n.resolve)(i.value),n.promise}})},1698:(t,e,n)=>{var i=n(6518),s=n(4204),r=n(9835);i({target:"Set",proto:!0,real:!0,forced:!n(4916)("union")||!r("union")},{union:s})},1701:(t,e,n)=>{var i=n(6518),s=n(9565),r=n(9306),o=n(8551),a=n(1767),c=n(9462),l=n(6319),h=n(9539),d=n(684),u=n(4549),p=n(6395),g=!p&&!d("map",function(){}),f=!p&&!g&&u("map",TypeError),m=p||g||f,v=c(function(){var t=this.iterator,e=o(s(this.next,t));if(!(this.done=!!e.done))return l(t,this.mapper,[e.value,this.counter++],!0)});i({target:"Iterator",proto:!0,real:!0,forced:m},{map:function(t){o(this);try{r(t)}catch(t){h(this,"throw",t)}return f?s(f,this,t):new v(a(this),{mapper:t})}})},1767:t=>{t.exports=function(t){return{iterator:t,next:t.next,done:!1}}},1828:(t,e,n)=>{var i=n(9504),s=n(9297),r=n(5397),o=n(9617).indexOf,a=n(421),c=i([].push);t.exports=function(t,e){var n,i=r(t),l=0,h=[];for(n in i)!s(a,n)&&s(i,n)&&c(h,n);for(;e.length>l;)s(i,n=e[l++])&&(~o(h,n)||c(h,n));return h}},2106:(t,e,n)=>{var i=n(283),s=n(4913);t.exports=function(t,e,n){return n.get&&i(n.get,e,{getter:!0}),n.set&&i(n.set,e,{setter:!0}),s.f(t,e,n)}},2140:(t,e,n)=>{var i={};i[n(8227)("toStringTag")]="z",t.exports="[object z]"===String(i)},2195:(t,e,n)=>{var i=n(9504),s=i({}.toString),r=i("".slice);t.exports=function(t){return r(s(t),8,-1)}},2211:(t,e,n)=>{var i=n(9039);t.exports=!i(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})},2303:(t,e,n)=>{var i=n(4576),s=n(9504),r=i.Uint8Array,o=i.SyntaxError,a=i.parseInt,c=Math.min,l=/[^\da-f]/i,h=s(l.exec),d=s("".slice);t.exports=function(t,e){var n=t.length;if(n%2!=0)throw new o("String should be an even number of characters");for(var i=e?c(e.length,n/2):n/2,s=e||new r(i),u=0,p=0;p<i;){var g=d(t,u,u+=2);if(h(l,g))throw new o("String should only contain hex characters");s[p++]=a(g,16)}return{bytes:s,read:u}}},2360:(t,e,n)=>{var i,s=n(8551),r=n(6801),o=n(8727),a=n(421),c=n(397),l=n(4055),h=n(6119),d="prototype",u="script",p=h("IE_PROTO"),g=function(){},f=function(t){return"<"+u+">"+t+"</"+u+">"},m=function(t){t.write(f("")),t.close();var e=t.parentWindow.Object;return t=null,e},v=function(){try{i=new ActiveXObject("htmlfile")}catch(t){}var t,e,n;v="undefined"!=typeof document?document.domain&&i?m(i):(e=l("iframe"),n="java"+u+":",e.style.display="none",c.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(f("document.F=Object")),t.close(),t.F):m(i);for(var s=o.length;s--;)delete v[d][o[s]];return v()};a[p]=!0,t.exports=Object.create||function(t,e){var n;return null!==t?(g[d]=s(t),n=new g,g[d]=null,n[p]=t):n=v(),void 0===e?n:r.f(n,e)}},2475:(t,e,n)=>{var i=n(6518),s=n(8527);i({target:"Set",proto:!0,real:!0,forced:!n(4916)("isSupersetOf",function(t){return!t})},{isSupersetOf:s})},2489:(t,e,n)=>{var i=n(6518),s=n(9565),r=n(9306),o=n(8551),a=n(1767),c=n(9462),l=n(6319),h=n(6395),d=n(9539),u=n(684),p=n(4549),g=!h&&!u("filter",function(){}),f=!h&&!g&&p("filter",TypeError),m=h||g||f,v=c(function(){for(var t,e,n=this.iterator,i=this.predicate,r=this.next;;){if(t=o(s(r,n)),this.done=!!t.done)return;if(e=t.value,l(n,i,[e,this.counter++],!0))return e}});i({target:"Iterator",proto:!0,real:!0,forced:m},{filter:function(t){o(this);try{r(t)}catch(t){d(this,"throw",t)}return f?s(f,this,t):new v(a(this),{predicate:t})}})},2529:t=>{t.exports=function(t,e){return{value:t,done:e}}},2603:(t,e,n)=>{var i=n(655);t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:i(t)}},2652:(t,e,n)=>{var i=n(6080),s=n(9565),r=n(8551),o=n(6823),a=n(4209),c=n(6198),l=n(1625),h=n(81),d=n(851),u=n(9539),p=TypeError,g=function(t,e){this.stopped=t,this.result=e},f=g.prototype;t.exports=function(t,e,n){var m,v,y,b,w,A,x,S=n&&n.that,E=!(!n||!n.AS_ENTRIES),_=!(!n||!n.IS_RECORD),C=!(!n||!n.IS_ITERATOR),T=!(!n||!n.INTERRUPTED),k=i(e,S),R=function(t){return m&&u(m,"normal"),new g(!0,t)},I=function(t){return E?(r(t),T?k(t[0],t[1],R):k(t[0],t[1])):T?k(t,R):k(t)};if(_)m=t.iterator;else if(C)m=t;else{if(!(v=d(t)))throw new p(o(t)+" is not iterable");if(a(v)){for(y=0,b=c(t);b>y;y++)if((w=I(t[y]))&&l(f,w))return w;return new g(!1)}m=h(t,v)}for(A=_?t.next:m.next;!(x=s(A,m)).done;){try{w=I(x.value)}catch(t){u(m,"throw",t)}if("object"==typeof w&&w&&l(f,w))return w}return new g(!1)}},2777:(t,e,n)=>{var i=n(9565),s=n(34),r=n(757),o=n(5966),a=n(4270),c=n(8227),l=TypeError,h=c("toPrimitive");t.exports=function(t,e){if(!s(t)||r(t))return t;var n,c=o(t,h);if(c){if(void 0===e&&(e="default"),n=i(c,t,e),!s(n)||r(n))return n;throw new l("Can't convert object to primitive value")}return void 0===e&&(e="number"),a(t,e)}},2787:(t,e,n)=>{var i=n(9297),s=n(4901),r=n(8981),o=n(6119),a=n(2211),c=o("IE_PROTO"),l=Object,h=l.prototype;t.exports=a?l.getPrototypeOf:function(t){var e=r(t);if(i(e,c))return e[c];var n=e.constructor;return s(n)&&e instanceof n?n.prototype:e instanceof l?h:null}},2796:(t,e,n)=>{var i=n(9039),s=n(4901),r=/#|\.prototype\./,o=function(t,e){var n=c[a(t)];return n===h||n!==l&&(s(e)?i(e):!!e)},a=o.normalize=function(t){return String(t).replace(r,".").toLowerCase()},c=o.data={},l=o.NATIVE="N",h=o.POLYFILL="P";t.exports=o},2804:t=>{var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=e+"+/",i=e+"-_",s=function(t){for(var e={},n=0;n<64;n++)e[t.charAt(n)]=n;return e};t.exports={i2c:n,c2i:s(n),i2cUrl:i,c2iUrl:s(i)}},2812:t=>{var e=TypeError;t.exports=function(t,n){if(t<n)throw new e("Not enough arguments");return t}},2839:(t,e,n)=>{var i=n(4576).navigator,s=i&&i.userAgent;t.exports=s?String(s):""},2967:(t,e,n)=>{var i=n(6706),s=n(34),r=n(7750),o=n(3506);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=i(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch(t){}return function(n,i){return r(n),o(i),s(n)?(e?t(n,i):n.__proto__=i,n):n}}():void 0)},3068:(t,e,n)=>{var i=n(6518),s=n(9504),r=n(2652),o=RangeError,a=TypeError,c=1/0,l=Math.abs,h=Math.pow,d=s([].push),u=h(2,1023),p=h(2,53)-1,g=Number.MAX_VALUE,f=h(2,971),m={},v={},y={},b={},w={},A=function(t,e){var n=t+e;return{hi:n,lo:e-(n-t)}};i({target:"Math",stat:!0},{sumPrecise:function(t){var e=[],n=0,i=b;switch(r(t,function(t){if(++n>=p)throw new o("Maximum allowed index exceeded");if("number"!=typeof t)throw new a("Value is not a number");i!==m&&(t!=t?i=m:t===c?i=i===v?m:y:t===-1/0?i=i===y?m:v:0===t&&1/t!==c||i!==b&&i!==w||(i=w,d(e,t)))}),i){case m:return NaN;case v:return-1/0;case y:return c;case b:return-0}for(var s,h,x,S,E,_,C=[],T=0,k=0;k<e.length;k++){s=e[k];for(var R=0,I=0;I<C.length;I++){if(h=C[I],l(s)<l(h)&&(_=s,s=h,h=_),S=(x=A(s,h)).hi,E=x.lo,l(S)===c){var P=S===c?1:-1;T+=P,l(s=s-P*u-P*u)<l(h)&&(_=s,s=h,h=_),S=(x=A(s,h)).hi,E=x.lo}0!==E&&(C[R++]=E),s=S}C.length=R,0!==s&&d(C,s)}var M=C.length-1;if(S=0,E=0,0!==T){var D=M>=0?C[M]:0;if(M--,l(T)>1||T>0&&D>0||T<0&&D<0)return T>0?c:-1/0;if(S=(x=A(T*u,D/2)).hi,E=x.lo,E*=2,l(2*S)===c)return S>0?S===u&&E===-f/2&&M>=0&&C[M]<0?g:c:S===-u&&E===f/2&&M>=0&&C[M]>0?-g:-1/0;0!==E&&(C[++M]=E,E=0),S*=2}for(;M>=0&&(S=(x=A(S,C[M--])).hi,0===(E=x.lo)););return M>=0&&(E<0&&C[M]<0||E>0&&C[M]>0)&&(h=2*E)===(s=S+h)-S&&(S=s),S}})},3167:(t,e,n)=>{var i=n(4901),s=n(34),r=n(2967);t.exports=function(t,e,n){var o,a;return r&&i(o=e.constructor)&&o!==n&&s(a=o.prototype)&&a!==n.prototype&&r(t,a),t}},3238:(t,e,n)=>{var i=n(4576),s=n(7811),r=n(7394),o=i.DataView;t.exports=function(t){if(!s||0!==r(t))return!1;try{return new o(t),!1}catch(t){return!0}}},3392:(t,e,n)=>{var i=n(9504),s=0,r=Math.random(),o=i(1.1.toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+o(++s+r,36)}},3440:(t,e,n)=>{var i=n(7080),s=n(4402),r=n(9286),o=n(5170),a=n(3789),c=n(8469),l=n(507),h=s.has,d=s.remove;t.exports=function(t){var e=i(this),n=a(t),s=r(e);return o(e)<=n.size?c(e,function(t){n.includes(t)&&d(s,t)}):l(n.getIterator(),function(t){h(s,t)&&d(s,t)}),s}},3463:t=>{var e=TypeError;t.exports=function(t){if("string"==typeof t)return t;throw new e("Argument is not a string")}},3506:(t,e,n)=>{var i=n(3925),s=String,r=TypeError;t.exports=function(t){if(i(t))return t;throw new r("Can't set "+s(t)+" as a prototype")}},3579:(t,e,n)=>{var i=n(6518),s=n(9565),r=n(2652),o=n(9306),a=n(8551),c=n(1767),l=n(9539),h=n(4549)("some",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:h},{some:function(t){a(this);try{o(t)}catch(t){l(this,"throw",t)}if(h)return s(h,this,t);var e=c(this),n=0;return r(e,function(e,i){if(t(e,n++))return i()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},3650:(t,e,n)=>{var i=n(7080),s=n(4402),r=n(9286),o=n(3789),a=n(507),c=s.add,l=s.has,h=s.remove;t.exports=function(t){var e=i(this),n=o(t).getIterator(),s=r(e);return a(n,function(t){l(e,t)?h(s,t):c(s,t)}),s}},3706:(t,e,n)=>{var i=n(9504),s=n(4901),r=n(7629),o=i(Function.toString);s(r.inspectSource)||(r.inspectSource=function(t){return o(t)}),t.exports=r.inspectSource},3717:(t,e)=>{e.f=Object.getOwnPropertySymbols},3724:(t,e,n)=>{var i=n(9039);t.exports=!i(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},3789:(t,e,n)=>{var i=n(9306),s=n(8551),r=n(9565),o=n(1291),a=n(1767),c="Invalid size",l=RangeError,h=TypeError,d=Math.max,u=function(t,e){this.set=t,this.size=d(e,0),this.has=i(t.has),this.keys=i(t.keys)};u.prototype={getIterator:function(){return a(s(r(this.keys,this.set)))},includes:function(t){return r(this.has,this.set,t)}},t.exports=function(t){s(t);var e=+t.size;if(e!=e)throw new h(c);var n=o(e);if(n<0)throw new l(c);return new u(t,n)}},3838:(t,e,n)=>{var i=n(7080),s=n(5170),r=n(8469),o=n(3789);t.exports=function(t){var e=i(this),n=o(t);return!(s(e)>n.size)&&!1!==r(e,function(t){if(!n.includes(t))return!1},!0)}},3853:(t,e,n)=>{var i=n(6518),s=n(4449);i({target:"Set",proto:!0,real:!0,forced:!n(4916)("isDisjointFrom",function(t){return!t})},{isDisjointFrom:s})},3925:(t,e,n)=>{var i=n(34);t.exports=function(t){return i(t)||null===t}},3972:(t,e,n)=>{var i=n(34),s=String,r=TypeError;t.exports=function(t){if(void 0===t||i(t))return t;throw new r(s(t)+" is not an object or undefined")}},4055:(t,e,n)=>{var i=n(4576),s=n(34),r=i.document,o=s(r)&&s(r.createElement);t.exports=function(t){return o?r.createElement(t):{}}},4114:(t,e,n)=>{var i=n(6518),s=n(8981),r=n(6198),o=n(4527),a=n(6837);i({target:"Array",proto:!0,arity:1,forced:n(9039)(function(){return 4294967297!==[].push.call({length:4294967296},1)})||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(t){return t instanceof TypeError}}()},{push:function(t){var e=s(this),n=r(e),i=arguments.length;a(n+i);for(var c=0;c<i;c++)e[n]=arguments[c],n++;return o(e,n),n}})},4117:t=>{t.exports=function(t){return null==t}},4149:t=>{var e=RangeError;t.exports=function(t){if(t==t)return t;throw new e("NaN is not allowed")}},4154:(t,e,n)=>{var i=n(6955),s=TypeError;t.exports=function(t){if("Uint8Array"===i(t))return t;throw new s("Argument is not an Uint8Array")}},4204:(t,e,n)=>{var i=n(7080),s=n(4402).add,r=n(9286),o=n(3789),a=n(507);t.exports=function(t){var e=i(this),n=o(t).getIterator(),c=r(e);return a(n,function(t){s(c,t)}),c}},4209:(t,e,n)=>{var i=n(8227),s=n(6269),r=i("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(s.Array===t||o[r]===t)}},4215:(t,e,n)=>{var i=n(4576),s=n(2839),r=n(2195),o=function(t){return s.slice(0,t.length)===t};t.exports=o("Bun/")?"BUN":o("Cloudflare-Workers")?"CLOUDFLARE":o("Deno/")?"DENO":o("Node.js/")?"NODE":i.Bun&&"string"==typeof Bun.version?"BUN":i.Deno&&"object"==typeof Deno.version?"DENO":"process"===r(i.process)?"NODE":i.window&&i.document?"BROWSER":"REST"},4226:(t,e,n)=>{var i=n(6518),s=n(4576),r=n(3463),o=n(4154),a=n(5169),c=n(2303);s.Uint8Array&&i({target:"Uint8Array",proto:!0},{setFromHex:function(t){o(this),r(t),a(this.buffer);var e=c(t,this).read;return{read:e,written:e/2}}})},4235:(t,e,n)=>{n(3068)},4270:(t,e,n)=>{var i=n(9565),s=n(4901),r=n(34),o=TypeError;t.exports=function(t,e){var n,a;if("string"===e&&s(n=t.toString)&&!r(a=i(n,t)))return a;if(s(n=t.valueOf)&&!r(a=i(n,t)))return a;if("string"!==e&&s(n=t.toString)&&!r(a=i(n,t)))return a;throw new o("Can't convert object to primitive value")}},4376:(t,e,n)=>{var i=n(2195);t.exports=Array.isArray||function(t){return"Array"===i(t)}},4402:(t,e,n)=>{var i=n(9504),s=Set.prototype;t.exports={Set,add:i(s.add),has:i(s.has),remove:i(s.delete),proto:s}},4449:(t,e,n)=>{var i=n(7080),s=n(4402).has,r=n(5170),o=n(3789),a=n(8469),c=n(507),l=n(9539);t.exports=function(t){var e=i(this),n=o(t);if(r(e)<=n.size)return!1!==a(e,function(t){if(n.includes(t))return!1},!0);var h=n.getIterator();return!1!==c(h,function(t){if(s(e,t))return l(h,"normal",!1)})}},4483:(t,e,n)=>{var i,s,r,o,a=n(4576),c=n(9429),l=n(1548),h=a.structuredClone,d=a.ArrayBuffer,u=a.MessageChannel,p=!1;if(l)p=function(t){h(t,{transfer:[t]})};else if(d)try{u||(i=c("worker_threads"))&&(u=i.MessageChannel),u&&(s=new u,r=new d(2),o=function(t){s.port1.postMessage(null,[t])},2===r.byteLength&&(o(r),0===r.byteLength&&(p=o)))}catch(t){}t.exports=p},4495:(t,e,n)=>{var i=n(9519),s=n(9039),r=n(4576).String;t.exports=!!Object.getOwnPropertySymbols&&!s(function(){var t=Symbol("symbol detection");return!r(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&i&&i<41})},4527:(t,e,n)=>{var i=n(3724),s=n(4376),r=TypeError,o=Object.getOwnPropertyDescriptor,a=i&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=a?function(t,e){if(s(t)&&!o(t,"length").writable)throw new r("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e}},4549:(t,e,n)=>{var i=n(4576);t.exports=function(t,e){var n=i.Iterator,s=n&&n.prototype,r=s&&s[t],o=!1;if(r)try{r.call({next:function(){return{done:!0}},return:function(){o=!0}},-1)}catch(t){t instanceof e||(o=!1)}if(!o)return r}},4576:function(t){var e=function(t){return t&&t.Math===Math&&t};t.exports=e("object"==typeof globalThis&&globalThis)||e("object"==typeof window&&window)||e("object"==typeof self&&self)||e("object"==typeof global&&global)||e("object"==typeof this&&this)||function(){return this}()||Function("return this")()},4603:(t,e,n)=>{var i=n(6840),s=n(9504),r=n(655),o=n(2812),a=URLSearchParams,c=a.prototype,l=s(c.append),h=s(c.delete),d=s(c.forEach),u=s([].push),p=new a("a=1&a=2&b=3");p.delete("a",1),p.delete("b",void 0),p+""!="a=2"&&i(c,"delete",function(t){var e=arguments.length,n=e<2?void 0:arguments[1];if(e&&void 0===n)return h(this,t);var i=[];d(this,function(t,e){u(i,{key:e,value:t})}),o(e,1);for(var s,a=r(t),c=r(n),p=0,g=0,f=!1,m=i.length;p<m;)s=i[p++],f||s.key===a?(f=!0,h(this,s.key)):g++;for(;g<m;)(s=i[g++]).key===a&&s.value===c||l(this,s.key,s.value)},{enumerable:!0,unsafe:!0})},4628:(t,e,n)=>{var i=n(6518),s=n(6043);i({target:"Promise",stat:!0},{withResolvers:function(){var t=s.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}})},4644:(t,e,n)=>{var i,s,r,o=n(7811),a=n(3724),c=n(4576),l=n(4901),h=n(34),d=n(9297),u=n(6955),p=n(6823),g=n(6699),f=n(6840),m=n(2106),v=n(1625),y=n(2787),b=n(2967),w=n(8227),A=n(3392),x=n(1181),S=x.enforce,E=x.get,_=c.Int8Array,C=_&&_.prototype,T=c.Uint8ClampedArray,k=T&&T.prototype,R=_&&y(_),I=C&&y(C),P=Object.prototype,M=c.TypeError,D=w("toStringTag"),O=A("TYPED_ARRAY_TAG"),L="TypedArrayConstructor",N=o&&!!b&&"Opera"!==u(c.opera),F=!1,B={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},U={BigInt64Array:8,BigUint64Array:8},$=function(t){var e=y(t);if(h(e)){var n=E(e);return n&&d(n,L)?n[L]:$(e)}},j=function(t){if(!h(t))return!1;var e=u(t);return d(B,e)||d(U,e)};for(i in B)(r=(s=c[i])&&s.prototype)?S(r)[L]=s:N=!1;for(i in U)(r=(s=c[i])&&s.prototype)&&(S(r)[L]=s);if((!N||!l(R)||R===Function.prototype)&&(R=function(){throw new M("Incorrect invocation")},N))for(i in B)c[i]&&b(c[i],R);if((!N||!I||I===P)&&(I=R.prototype,N))for(i in B)c[i]&&b(c[i].prototype,I);if(N&&y(k)!==I&&b(k,I),a&&!d(I,D))for(i in F=!0,m(I,D,{configurable:!0,get:function(){return h(this)?this[O]:void 0}}),B)c[i]&&g(c[i],O,i);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:N,TYPED_ARRAY_TAG:F&&O,aTypedArray:function(t){if(j(t))return t;throw new M("Target is not a typed array")},aTypedArrayConstructor:function(t){if(l(t)&&(!b||v(R,t)))return t;throw new M(p(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,n,i){if(a){if(n)for(var s in B){var r=c[s];if(r&&d(r.prototype,t))try{delete r.prototype[t]}catch(n){try{r.prototype[t]=e}catch(t){}}}I[t]&&!n||f(I,t,n?e:N&&C[t]||e,i)}},exportTypedArrayStaticMethod:function(t,e,n){var i,s;if(a){if(b){if(n)for(i in B)if((s=c[i])&&d(s,t))try{delete s[t]}catch(t){}if(R[t]&&!n)return;try{return f(R,t,n?e:N&&R[t]||e)}catch(t){}}for(i in B)!(s=c[i])||s[t]&&!n||f(s,t,e)}},getTypedArrayConstructor:$,isView:function(t){if(!h(t))return!1;var e=u(t);return"DataView"===e||d(B,e)||d(U,e)},isTypedArray:j,TypedArray:R,TypedArrayPrototype:I}},4659:(t,e,n)=>{var i=n(3724),s=n(4913),r=n(6980);t.exports=function(t,e,n){i?s.f(t,e,r(0,n)):t[e]=n}},4901:t=>{var e="object"==typeof document&&document.all;t.exports=void 0===e&&void 0!==e?function(t){return"function"==typeof t||t===e}:function(t){return"function"==typeof t}},4913:(t,e,n)=>{var i=n(3724),s=n(5917),r=n(8686),o=n(8551),a=n(6969),c=TypeError,l=Object.defineProperty,h=Object.getOwnPropertyDescriptor,d="enumerable",u="configurable",p="writable";e.f=i?r?function(t,e,n){if(o(t),e=a(e),o(n),"function"==typeof t&&"prototype"===e&&"value"in n&&p in n&&!n[p]){var i=h(t,e);i&&i[p]&&(t[e]=n.value,n={configurable:u in n?n[u]:i[u],enumerable:d in n?n[d]:i[d],writable:!1})}return l(t,e,n)}:l:function(t,e,n){if(o(t),e=a(e),o(n),s)try{return l(t,e,n)}catch(t){}if("get"in n||"set"in n)throw new c("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},4916:(t,e,n)=>{var i=n(7751),s=function(t){return{size:t,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},r=function(t){return{size:t,has:function(){return!0},keys:function(){throw new Error("e")}}};t.exports=function(t,e){var n=i("Set");try{(new n)[t](s(0));try{return(new n)[t](s(-1)),!1}catch(i){if(!e)return!0;try{return(new n)[t](r(-1/0)),!1}catch(i){var o=new n;return o.add(1),o.add(2),e(o[t](r(1/0)))}}}catch(t){return!1}}},4972:(t,e,n)=>{var i=n(6518),s=n(9565),r=n(8551),o=n(1767),a=n(4149),c=n(9590),l=n(9462),h=n(9539),d=n(4549),u=n(6395),p=!u&&d("take",RangeError),g=l(function(){var t=this.iterator;if(!this.remaining--)return this.done=!0,h(t,"normal",void 0);var e=r(s(this.next,t));return(this.done=!!e.done)?void 0:e.value});i({target:"Iterator",proto:!0,real:!0,forced:u||p},{take:function(t){var e;r(this);try{e=c(a(+t))}catch(t){h(this,"throw",t)}return p?s(p,this,e):new g(o(this),{remaining:e})}})},4979:(t,e,n)=>{var i=n(6518),s=n(4576),r=n(7751),o=n(6980),a=n(4913).f,c=n(9297),l=n(679),h=n(3167),d=n(2603),u=n(5002),p=n(8574),g=n(3724),f=n(6395),m="DOMException",v=r("Error"),y=r(m),b=function(){l(this,w);var t=arguments.length,e=d(t<1?void 0:arguments[0]),n=d(t<2?void 0:arguments[1],"Error"),i=new y(e,n),s=new v(e);return s.name=m,a(i,"stack",o(1,p(s.stack,1))),h(i,this,b),i},w=b.prototype=y.prototype,A="stack"in new v(m),x="stack"in new y(1,2),S=y&&g&&Object.getOwnPropertyDescriptor(s,m),E=!(!S||S.writable&&S.configurable),_=A&&!E&&!x;i({global:!0,constructor:!0,forced:f||_},{DOMException:_?b:y});var C=r(m),T=C.prototype;if(T.constructor!==C)for(var k in f||a(T,"constructor",o(1,C)),u)if(c(u,k)){var R=u[k],I=R.s;c(C,I)||a(C,I,o(6,R.c))}},5002:t=>{t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},5024:(t,e,n)=>{var i=n(6518),s=n(3650),r=n(9835);i({target:"Set",proto:!0,real:!0,forced:!n(4916)("symmetricDifference")||!r("symmetricDifference")},{symmetricDifference:s})},5031:(t,e,n)=>{var i=n(7751),s=n(9504),r=n(8480),o=n(3717),a=n(8551),c=s([].concat);t.exports=i("Reflect","ownKeys")||function(t){var e=r.f(a(t)),n=o.f;return n?c(e,n(t)):e}},5169:(t,e,n)=>{var i=n(3238),s=TypeError;t.exports=function(t){if(i(t))throw new s("ArrayBuffer is detached");return t}},5170:(t,e,n)=>{var i=n(6706),s=n(4402);t.exports=i(s.proto,"size","get")||function(t){return t.size}},5213:(t,e,n)=>{var i=n(6518),s=n(4576),r=n(5370),o=n(9143),a=s.Uint8Array,c=!a||!a.fromBase64||!function(){try{return void a.fromBase64("a")}catch(t){}try{a.fromBase64("",null)}catch(t){return!0}}();a&&i({target:"Uint8Array",stat:!0,forced:c},{fromBase64:function(t){var e=o(t,arguments.length>1?arguments[1]:void 0,null,9007199254740991);return r(a,e.bytes)}})},5370:(t,e,n)=>{var i=n(6198);t.exports=function(t,e,n){for(var s=0,r=arguments.length>2?n:i(e),o=new t(r);r>s;)o[s]=e[s++];return o}},5397:(t,e,n)=>{var i=n(7055),s=n(7750);t.exports=function(t){return i(s(t))}},5610:(t,e,n)=>{var i=n(1291),s=Math.max,r=Math.min;t.exports=function(t,e){var n=i(t);return n<0?s(n+e,0):r(n,e)}},5623:(t,e,n)=>{n(456)},5636:(t,e,n)=>{var i=n(4576),s=n(9504),r=n(6706),o=n(7696),a=n(5169),c=n(7394),l=n(4483),h=n(1548),d=i.structuredClone,u=i.ArrayBuffer,p=i.DataView,g=Math.min,f=u.prototype,m=p.prototype,v=s(f.slice),y=r(f,"resizable","get"),b=r(f,"maxByteLength","get"),w=s(m.getInt8),A=s(m.setInt8);t.exports=(h||l)&&function(t,e,n){var i,s=c(t),r=void 0===e?s:o(e),f=!y||!y(t);if(a(t),h&&(t=d(t,{transfer:[t]}),s===r&&(n||f)))return t;if(s>=r&&(!n||f))i=v(t,0,r);else{var m=n&&!f&&b?{maxByteLength:b(t)}:void 0;i=new u(r,m);for(var x=new p(t),S=new p(i),E=g(r,s),_=0;_<E;_++)A(S,_,w(x,_))}return h||l(t),i}},5745:(t,e,n)=>{var i=n(7629);t.exports=function(t,e){return i[t]||(i[t]=e||{})}},5781:(t,e,n)=>{var i=n(6518),s=n(7751),r=n(2812),o=n(655),a=n(7416),c=s("URL");i({target:"URL",stat:!0,forced:!a},{parse:function(t){var e=r(arguments.length,1),n=o(t),i=e<2||void 0===arguments[1]?void 0:o(arguments[1]);try{return new c(n,i)}catch(t){return null}}})},5854:(t,e,n)=>{var i=n(2777),s=TypeError;t.exports=function(t){var e=i(t,"number");if("number"==typeof e)throw new s("Can't convert number to bigint");return BigInt(e)}},5876:(t,e,n)=>{var i=n(6518),s=n(3838);i({target:"Set",proto:!0,real:!0,forced:!n(4916)("isSubsetOf",function(t){return t})},{isSubsetOf:s})},5917:(t,e,n)=>{var i=n(3724),s=n(9039),r=n(4055);t.exports=!i&&!s(function(){return 7!==Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a})},5966:(t,e,n)=>{var i=n(9306),s=n(4117);t.exports=function(t,e){var n=t[e];return s(n)?void 0:i(n)}},6043:(t,e,n)=>{var i=n(9306),s=TypeError,r=function(t){var e,n;this.promise=new t(function(t,i){if(void 0!==e||void 0!==n)throw new s("Bad Promise constructor");e=t,n=i}),this.resolve=i(e),this.reject=i(n)};t.exports.f=function(t){return new r(t)}},6080:(t,e,n)=>{var i=n(7476),s=n(9306),r=n(616),o=i(i.bind);t.exports=function(t,e){return s(t),void 0===e?t:r?o(t,e):function(){return t.apply(e,arguments)}}},6119:(t,e,n)=>{var i=n(5745),s=n(3392),r=i("keys");t.exports=function(t){return r[t]||(r[t]=s(t))}},6193:(t,e,n)=>{var i=n(4215);t.exports="NODE"===i},6198:(t,e,n)=>{var i=n(8014);t.exports=function(t){return i(t.length)}},6269:t=>{t.exports={}},6279:(t,e,n)=>{var i=n(6840);t.exports=function(t,e,n){for(var s in e)i(t,s,e[s],n);return t}},6319:(t,e,n)=>{var i=n(8551),s=n(9539);t.exports=function(t,e,n,r){try{return r?e(i(n)[0],n[1]):e(n)}catch(e){s(t,"throw",e)}}},6395:t=>{t.exports=!1},6518:(t,e,n)=>{var i=n(4576),s=n(7347).f,r=n(6699),o=n(6840),a=n(9433),c=n(7740),l=n(2796);t.exports=function(t,e){var n,h,d,u,p,g=t.target,f=t.global,m=t.stat;if(n=f?i:m?i[g]||a(g,{}):i[g]&&i[g].prototype)for(h in e){if(u=e[h],d=t.dontCallGetSet?(p=s(n,h))&&p.value:n[h],!l(f?h:g+(m?".":"#")+h,t.forced)&&void 0!==d){if(typeof u==typeof d)continue;c(u,d)}(t.sham||d&&d.sham)&&r(u,"sham",!0),o(n,h,u,t)}}},6573:(t,e,n)=>{var i=n(3724),s=n(2106),r=n(3238),o=ArrayBuffer.prototype;i&&!("detached"in o)&&s(o,"detached",{configurable:!0,get:function(){return r(this)}})},6632:(t,e,n)=>{var i=n(6518),s=n(4576),r=n(9143),o=n(4154),a=s.Uint8Array,c=!a||!a.prototype.setFromBase64||!function(){var t=new a([255,255,255,255,255]);try{return void t.setFromBase64("",null)}catch(t){}try{return void t.setFromBase64("a")}catch(t){}try{t.setFromBase64("MjYyZg===")}catch(e){return 50===t[0]&&54===t[1]&&50===t[2]&&255===t[3]&&255===t[4]}}();a&&i({target:"Uint8Array",proto:!0,forced:c},{setFromBase64:function(t){o(this);var e=r(t,arguments.length>1?arguments[1]:void 0,this,this.length);return{read:e.read,written:e.written}}})},6699:(t,e,n)=>{var i=n(3724),s=n(4913),r=n(6980);t.exports=i?function(t,e,n){return s.f(t,e,r(1,n))}:function(t,e,n){return t[e]=n,t}},6706:(t,e,n)=>{var i=n(9504),s=n(9306);t.exports=function(t,e,n){try{return i(s(Object.getOwnPropertyDescriptor(t,e)[n]))}catch(t){}}},6801:(t,e,n)=>{var i=n(3724),s=n(8686),r=n(4913),o=n(8551),a=n(5397),c=n(1072);e.f=i&&!s?Object.defineProperties:function(t,e){o(t);for(var n,i=a(e),s=c(e),l=s.length,h=0;l>h;)r.f(t,n=s[h++],i[n]);return t}},6823:t=>{var e=String;t.exports=function(t){try{return e(t)}catch(t){return"Object"}}},6837:t=>{var e=TypeError;t.exports=function(t){if(t>9007199254740991)throw e("Maximum allowed index exceeded");return t}},6840:(t,e,n)=>{var i=n(4901),s=n(4913),r=n(283),o=n(9433);t.exports=function(t,e,n,a){a||(a={});var c=a.enumerable,l=void 0!==a.name?a.name:e;if(i(n)&&r(n,l,a),a.global)c?t[e]=n:o(e,n);else{try{a.unsafe?t[e]&&(c=!0):delete t[e]}catch(t){}c?t[e]=n:s.f(t,e,{value:n,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return t}},6955:(t,e,n)=>{var i=n(2140),s=n(4901),r=n(2195),o=n(8227)("toStringTag"),a=Object,c="Arguments"===r(function(){return arguments}());t.exports=i?r:function(t){var e,n,i;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=a(t),o))?n:c?r(e):"Object"===(i=r(e))&&s(e.callee)?"Arguments":i}},6969:(t,e,n)=>{var i=n(2777),s=n(757);t.exports=function(t){var e=i(t,"string");return s(e)?e:e+""}},6980:t=>{t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},7040:(t,e,n)=>{var i=n(4495);t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},7055:(t,e,n)=>{var i=n(9504),s=n(9039),r=n(2195),o=Object,a=i("".split);t.exports=s(function(){return!o("z").propertyIsEnumerable(0)})?function(t){return"String"===r(t)?a(t,""):o(t)}:o},7080:(t,e,n)=>{var i=n(4402).has;t.exports=function(t){return i(t),t}},7347:(t,e,n)=>{var i=n(3724),s=n(9565),r=n(8773),o=n(6980),a=n(5397),c=n(6969),l=n(9297),h=n(5917),d=Object.getOwnPropertyDescriptor;e.f=i?d:function(t,e){if(t=a(t),e=c(e),h)try{return d(t,e)}catch(t){}if(l(t,e))return o(!s(r.f,t,e),t[e])}},7394:(t,e,n)=>{var i=n(4576),s=n(6706),r=n(2195),o=i.ArrayBuffer,a=i.TypeError;t.exports=o&&s(o.prototype,"byteLength","get")||function(t){if("ArrayBuffer"!==r(t))throw new a("ArrayBuffer expected");return t.byteLength}},7416:(t,e,n)=>{var i=n(9039),s=n(8227),r=n(3724),o=n(6395),a=s("iterator");t.exports=!i(function(){var t=new URL("b?a=1&b=2&c=3","https://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return t.pathname="c%20d",e.forEach(function(t,n){e.delete("b"),i+=n+t}),n.delete("a",2),n.delete("b",void 0),o&&(!t.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b"))||!e.size&&(o||!r)||!e.sort||"https://a/c%20d?a=1&c=3"!==t.href||"3"!==e.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!e[a]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://").host||"#%D0%B1"!==new URL("https://a#").hash||"a1c3"!==i||"x"!==new URL("https://x",void 0).host})},7476:(t,e,n)=>{var i=n(2195),s=n(9504);t.exports=function(t){if("Function"===i(t))return s(t)}},7566:(t,e,n)=>{var i=n(6840),s=n(9504),r=n(655),o=n(2812),a=URLSearchParams,c=a.prototype,l=s(c.getAll),h=s(c.has),d=new a("a=1");!d.has("a",2)&&d.has("a",void 0)||i(c,"has",function(t){var e=arguments.length,n=e<2?void 0:arguments[1];if(e&&void 0===n)return h(this,t);var i=l(this,t);o(e,1);for(var s=r(n),a=0;a<i.length;)if(i[a++]===s)return!0;return!1},{enumerable:!0,unsafe:!0})},7588:(t,e,n)=>{var i=n(6518),s=n(9565),r=n(2652),o=n(9306),a=n(8551),c=n(1767),l=n(9539),h=n(4549)("forEach",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:h},{forEach:function(t){a(this);try{o(t)}catch(t){l(this,"throw",t)}if(h)return s(h,this,t);var e=c(this),n=0;r(e,function(e){t(e,n++)},{IS_RECORD:!0})}})},7629:(t,e,n)=>{var i=n(6395),s=n(4576),r=n(9433),o="__core-js_shared__",a=t.exports=s[o]||r(o,{});(a.versions||(a.versions=[])).push({version:"3.45.1",mode:i?"pure":"global",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.45.1/LICENSE",source:"https://github.com/zloirock/core-js"})},7642:(t,e,n)=>{var i=n(6518),s=n(3440),r=n(9039);i({target:"Set",proto:!0,real:!0,forced:!n(4916)("difference",function(t){return 0===t.size})||r(function(){var t={size:1,has:function(){return!0},keys:function(){var t=0;return{next:function(){var n=t++>1;return e.has(1)&&e.clear(),{done:n,value:2}}}}},e=new Set([1,2,3,4]);return 3!==e.difference(t).size})},{difference:s})},7657:(t,e,n)=>{var i,s,r,o=n(9039),a=n(4901),c=n(34),l=n(2360),h=n(2787),d=n(6840),u=n(8227),p=n(6395),g=u("iterator"),f=!1;[].keys&&("next"in(r=[].keys())?(s=h(h(r)))!==Object.prototype&&(i=s):f=!0),!c(i)||o(function(){var t={};return i[g].call(t)!==t})?i={}:p&&(i=l(i)),a(i[g])||d(i,g,function(){return this}),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:f}},7680:(t,e,n)=>{var i=n(9504);t.exports=i([].slice)},7696:(t,e,n)=>{var i=n(1291),s=n(8014),r=RangeError;t.exports=function(t){if(void 0===t)return 0;var e=i(t),n=s(e);if(e!==n)throw new r("Wrong length or index");return n}},7740:(t,e,n)=>{var i=n(9297),s=n(5031),r=n(7347),o=n(4913);t.exports=function(t,e,n){for(var a=s(e),c=o.f,l=r.f,h=0;h<a.length;h++){var d=a[h];i(t,d)||n&&i(n,d)||c(t,d,l(e,d))}}},7750:(t,e,n)=>{var i=n(4117),s=TypeError;t.exports=function(t){if(i(t))throw new s("Can't call method on "+t);return t}},7751:(t,e,n)=>{var i=n(4576),s=n(4901);t.exports=function(t,e){return arguments.length<2?(n=i[t],s(n)?n:void 0):i[t]&&i[t][e];var n}},7811:t=>{t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7936:(t,e,n)=>{var i=n(6518),s=n(5636);s&&i({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return s(this,arguments.length?arguments[0]:void 0,!1)}})},8004:(t,e,n)=>{var i=n(6518),s=n(9039),r=n(8750);i({target:"Set",proto:!0,real:!0,forced:!n(4916)("intersection",function(t){return 2===t.size&&t.has(1)&&t.has(2)})||s(function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))})},{intersection:r})},8014:(t,e,n)=>{var i=n(1291),s=Math.min;t.exports=function(t){var e=i(t);return e>0?s(e,9007199254740991):0}},8100:(t,e,n)=>{var i=n(6518),s=n(5636);s&&i({target:"ArrayBuffer",proto:!0},{transfer:function(){return s(this,arguments.length?arguments[0]:void 0,!0)}})},8111:(t,e,n)=>{var i=n(6518),s=n(4576),r=n(679),o=n(8551),a=n(4901),c=n(2787),l=n(2106),h=n(4659),d=n(9039),u=n(9297),p=n(8227),g=n(7657).IteratorPrototype,f=n(3724),m=n(6395),v="constructor",y="Iterator",b=p("toStringTag"),w=TypeError,A=s[y],x=m||!a(A)||A.prototype!==g||!d(function(){A({})}),S=function(){if(r(this,g),c(this)===g)throw new w("Abstract class Iterator not directly constructable")},E=function(t,e){f?l(g,t,{configurable:!0,get:function(){return e},set:function(e){if(o(this),this===g)throw new w("You can't redefine this property");u(this,t)?this[t]=e:h(this,t,e)}}):g[t]=e};u(g,b)||E(b,y),!x&&u(g,v)&&g[v]!==Object||E(v,S),S.prototype=g,i({global:!0,constructor:!0,forced:x},{Iterator:S})},8227:(t,e,n)=>{var i=n(4576),s=n(5745),r=n(9297),o=n(3392),a=n(4495),c=n(7040),l=i.Symbol,h=s("wks"),d=c?l.for||l:l&&l.withoutSetter||o;t.exports=function(t){return r(h,t)||(h[t]=a&&r(l,t)?l[t]:d("Symbol."+t)),h[t]}},8235:(t,e,n)=>{var i=n(9504),s=n(9297),r=SyntaxError,o=parseInt,a=String.fromCharCode,c=i("".charAt),l=i("".slice),h=i(/./.exec),d={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":"\n","\\r":"\r","\\t":"\t"},u=/^[\da-f]{4}$/i,p=/^[\u0000-\u001F]$/;t.exports=function(t,e){for(var n=!0,i="";e<t.length;){var g=c(t,e);if("\\"===g){var f=l(t,e,e+2);if(s(d,f))i+=d[f],e+=2;else{if("\\u"!==f)throw new r('Unknown escape sequence: "'+f+'"');var m=l(t,e+=2,e+4);if(!h(u,m))throw new r("Bad Unicode escape at: "+e);i+=a(o(m,16)),e+=4}}else{if('"'===g){n=!1,e++;break}if(h(p,g))throw new r("Bad control character in string literal at: "+e);i+=g,e++}}if(n)throw new r("Unterminated string at: "+e);return{value:i,end:e}}},8237:(t,e,n)=>{var i=n(6518),s=n(2652),r=n(9306),o=n(8551),a=n(1767),c=n(9539),l=n(4549),h=n(8745),d=n(9039),u=TypeError,p=d(function(){[].keys().reduce(function(){},void 0)}),g=!p&&l("reduce",u);i({target:"Iterator",proto:!0,real:!0,forced:p||g},{reduce:function(t){o(this);try{r(t)}catch(t){c(this,"throw",t)}var e=arguments.length<2,n=e?void 0:arguments[1];if(g)return h(g,this,e?[t]:[t,n]);var i=a(this),l=0;if(s(i,function(i){e?(e=!1,n=i):n=t(n,i,l),l++},{IS_RECORD:!0}),e)throw new u("Reduce of empty iterator with no initial value");return n}})},8335:(t,e,n)=>{var i=n(6518),s=n(3724),r=n(4576),o=n(7751),a=n(9504),c=n(9565),l=n(4901),h=n(34),d=n(4376),u=n(9297),p=n(655),g=n(6198),f=n(4659),m=n(9039),v=n(8235),y=n(4495),b=r.JSON,w=r.Number,A=r.SyntaxError,x=b&&b.parse,S=o("Object","keys"),E=Object.getOwnPropertyDescriptor,_=a("".charAt),C=a("".slice),T=a(/./.exec),k=a([].push),R=/^\d$/,I=/^[1-9]$/,P=/^[\d-]$/,M=/^[\t\n\r ]$/,D=function(t,e,n,i){var s,r,o,a,l,p=t[e],f=i&&p===i.value,m=f&&"string"==typeof i.source?{source:i.source}:{};if(h(p)){var v=d(p),y=f?i.nodes:v?[]:{};if(v)for(s=y.length,o=g(p),a=0;a<o;a++)O(p,a,D(p,""+a,n,a<s?y[a]:void 0));else for(r=S(p),o=g(r),a=0;a<o;a++)l=r[a],O(p,l,D(p,l,n,u(y,l)?y[l]:void 0))}return c(n,t,e,p,m)},O=function(t,e,n){if(s){var i=E(t,e);if(i&&!i.configurable)return}void 0===n?delete t[e]:f(t,e,n)},L=function(t,e,n,i){this.value=t,this.end=e,this.source=n,this.nodes=i},N=function(t,e){this.source=t,this.index=e};N.prototype={fork:function(t){return new N(this.source,t)},parse:function(){var t=this.source,e=this.skip(M,this.index),n=this.fork(e),i=_(t,e);if(T(P,i))return n.number();switch(i){case"{":return n.object();case"[":return n.array();case'"':return n.string();case"t":return n.keyword(!0);case"f":return n.keyword(!1);case"n":return n.keyword(null)}throw new A('Unexpected character: "'+i+'" at: '+e)},node:function(t,e,n,i,s){return new L(e,i,t?null:C(this.source,n,i),s)},object:function(){for(var t=this.source,e=this.index+1,n=!1,i={},s={};e<t.length;){if(e=this.until(['"',"}"],e),"}"===_(t,e)&&!n){e++;break}var r=this.fork(e).string(),o=r.value;e=r.end,e=this.until([":"],e)+1,e=this.skip(M,e),r=this.fork(e).parse(),f(s,o,r),f(i,o,r.value),e=this.until([",","}"],r.end);var a=_(t,e);if(","===a)n=!0,e++;else if("}"===a){e++;break}}return this.node(1,i,this.index,e,s)},array:function(){for(var t=this.source,e=this.index+1,n=!1,i=[],s=[];e<t.length;){if(e=this.skip(M,e),"]"===_(t,e)&&!n){e++;break}var r=this.fork(e).parse();if(k(s,r),k(i,r.value),e=this.until([",","]"],r.end),","===_(t,e))n=!0,e++;else if("]"===_(t,e)){e++;break}}return this.node(1,i,this.index,e,s)},string:function(){var t=this.index,e=v(this.source,this.index+1);return this.node(0,e.value,t,e.end)},number:function(){var t=this.source,e=this.index,n=e;if("-"===_(t,n)&&n++,"0"===_(t,n))n++;else{if(!T(I,_(t,n)))throw new A("Failed to parse number at: "+n);n=this.skip(R,n+1)}if("."===_(t,n)&&(n=this.skip(R,n+1)),("e"===_(t,n)||"E"===_(t,n))&&(n++,"+"!==_(t,n)&&"-"!==_(t,n)||n++,n===(n=this.skip(R,n))))throw new A("Failed to parse number's exponent value at: "+n);return this.node(0,w(C(t,e,n)),e,n)},keyword:function(t){var e=""+t,n=this.index,i=n+e.length;if(C(this.source,n,i)!==e)throw new A("Failed to parse value at: "+n);return this.node(0,t,n,i)},skip:function(t,e){for(var n=this.source;e<n.length&&T(t,_(n,e));e++);return e},until:function(t,e){e=this.skip(M,e);for(var n=_(this.source,e),i=0;i<t.length;i++)if(t[i]===n)return e;throw new A('Unexpected character: "'+n+'" at: '+e)}};var F=m(function(){var t,e="9007199254740993";return x(e,function(e,n,i){t=i.source}),t!==e}),B=y&&!m(function(){return 1/x("-0 \t")!=-1/0});i({target:"JSON",stat:!0,forced:F},{parse:function(t,e){return B&&!l(e)?x(t):function(t,e){t=p(t);var n=new N(t,0),i=n.parse(),s=i.value,r=n.skip(M,i.end);if(r<t.length)throw new A('Unexpected extra character: "'+_(t,r)+'" after the parsed data at: '+r);return l(e)?D({"":s},"",e,i):s}(t,e)}})},8469:(t,e,n)=>{var i=n(9504),s=n(507),r=n(4402),o=r.Set,a=r.proto,c=i(a.forEach),l=i(a.keys),h=l(new o).next;t.exports=function(t,e,n){return n?s({iterator:l(t),next:h},e):c(t,e)}},8480:(t,e,n)=>{var i=n(1828),s=n(8727).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return i(t,s)}},8527:(t,e,n)=>{var i=n(7080),s=n(4402).has,r=n(5170),o=n(3789),a=n(507),c=n(9539);t.exports=function(t){var e=i(this),n=o(t);if(r(e)<n.size)return!1;var l=n.getIterator();return!1!==a(l,function(t){if(!s(e,t))return c(l,"normal",!1)})}},8551:(t,e,n)=>{var i=n(34),s=String,r=TypeError;t.exports=function(t){if(i(t))return t;throw new r(s(t)+" is not an object")}},8574:(t,e,n)=>{var i=n(9504),s=Error,r=i("".replace),o=String(new s("zxcasd").stack),a=/\n\s*at [^:]*:[^\n]*/,c=a.test(o);t.exports=function(t,e){if(c&&"string"==typeof t&&!s.prepareStackTrace)for(;e--;)t=r(t,a,"");return t}},8622:(t,e,n)=>{var i=n(4576),s=n(4901),r=i.WeakMap;t.exports=s(r)&&/native code/.test(String(r))},8646:(t,e,n)=>{var i=n(9565),s=n(8551),r=n(1767),o=n(851);t.exports=function(t,e){e&&"string"==typeof t||s(t);var n=o(t);return r(s(void 0!==n?i(n,t):t))}},8686:(t,e,n)=>{var i=n(3724),s=n(9039);t.exports=i&&s(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},8721:(t,e,n)=>{var i=n(3724),s=n(9504),r=n(2106),o=URLSearchParams.prototype,a=s(o.forEach);i&&!("size"in o)&&r(o,"size",{get:function(){var t=0;return a(this,function(){t++}),t},configurable:!0,enumerable:!0})},8727:t=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},8745:(t,e,n)=>{var i=n(616),s=Function.prototype,r=s.apply,o=s.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?o.bind(r):function(){return o.apply(r,arguments)})},8750:(t,e,n)=>{var i=n(7080),s=n(4402),r=n(5170),o=n(3789),a=n(8469),c=n(507),l=s.Set,h=s.add,d=s.has;t.exports=function(t){var e=i(this),n=o(t),s=new l;return r(e)>n.size?c(n.getIterator(),function(t){d(e,t)&&h(s,t)}):a(e,function(t){n.includes(t)&&h(s,t)}),s}},8773:(t,e)=>{var n={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,s=i&&!n.call({1:2},1);e.f=s?function(t){var e=i(this,t);return!!e&&e.enumerable}:n},8981:(t,e,n)=>{var i=n(7750),s=Object;t.exports=function(t){return s(i(t))}},9039:t=>{t.exports=function(t){try{return!!t()}catch(t){return!0}}},9143:(t,e,n)=>{var i=n(4576),s=n(9504),r=n(3972),o=n(3463),a=n(9297),c=n(2804),l=n(944),h=n(5169),d=c.c2i,u=c.c2iUrl,p=i.SyntaxError,g=i.TypeError,f=s("".charAt),m=function(t,e){for(var n=t.length;e<n;e++){var i=f(t,e);if(" "!==i&&"\t"!==i&&"\n"!==i&&"\f"!==i&&"\r"!==i)break}return e},v=function(t,e,n){var i=t.length;i<4&&(t+=2===i?"AA":"A");var s=(e[f(t,0)]<<18)+(e[f(t,1)]<<12)+(e[f(t,2)]<<6)+e[f(t,3)],r=[s>>16&255,s>>8&255,255&s];if(2===i){if(n&&0!==r[1])throw new p("Extra bits");return[r[0]]}if(3===i){if(n&&0!==r[2])throw new p("Extra bits");return[r[0],r[1]]}return r},y=function(t,e,n){for(var i=e.length,s=0;s<i;s++)t[n+s]=e[s];return n+i};t.exports=function(t,e,n,i){o(t),r(e);var s="base64"===l(e)?d:u,c=e?e.lastChunkHandling:void 0;if(void 0===c&&(c="loose"),"loose"!==c&&"strict"!==c&&"stop-before-partial"!==c)throw new g("Incorrect `lastChunkHandling` option");n&&h(n.buffer);var b=t.length,w=n||[],A=0,x=0,S="",E=0;if(i)for(;;){if((E=m(t,E))===b){if(S.length>0){if("stop-before-partial"===c)break;if("loose"!==c)throw new p("Missing padding");if(1===S.length)throw new p("Malformed padding: exactly one additional character");A=y(w,v(S,s,!1),A)}x=b;break}var _=f(t,E);if(++E,"="===_){if(S.length<2)throw new p("Padding is too early");if(E=m(t,E),2===S.length){if(E===b){if("stop-before-partial"===c)break;throw new p("Malformed padding: only one =")}"="===f(t,E)&&(++E,E=m(t,E))}if(E<b)throw new p("Unexpected character after padding");A=y(w,v(S,s,"strict"===c),A),x=b;break}if(!a(s,_))throw new p("Unexpected character");var C=i-A;if(1===C&&2===S.length||2===C&&3===S.length)break;if(4===(S+=_).length&&(A=y(w,v(S,s,!1),A),S="",x=E,A===i))break}return{bytes:w,read:x,written:A}}},9286:(t,e,n)=>{var i=n(4402),s=n(8469),r=i.Set,o=i.add;t.exports=function(t){var e=new r;return s(t,function(t){o(e,t)}),e}},9297:(t,e,n)=>{var i=n(9504),s=n(8981),r=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return r(s(t),e)}},9306:(t,e,n)=>{var i=n(4901),s=n(6823),r=TypeError;t.exports=function(t){if(i(t))return t;throw new r(s(t)+" is not a function")}},9314:(t,e,n)=>{var i=n(6518),s=n(9565),r=n(8551),o=n(1767),a=n(4149),c=n(9590),l=n(9539),h=n(9462),d=n(684),u=n(4549),p=n(6395),g=!p&&!d("drop",0),f=!p&&!g&&u("drop",RangeError),m=p||g||f,v=h(function(){for(var t,e=this.iterator,n=this.next;this.remaining;)if(this.remaining--,t=r(s(n,e)),this.done=!!t.done)return;if(t=r(s(n,e)),!(this.done=!!t.done))return t.value});i({target:"Iterator",proto:!0,real:!0,forced:m},{drop:function(t){var e;r(this);try{e=c(a(+t))}catch(t){l(this,"throw",t)}return f?s(f,this,e):new v(o(this),{remaining:e})}})},9429:(t,e,n)=>{var i=n(4576),s=n(6193);t.exports=function(t){if(s){try{return i.process.getBuiltinModule(t)}catch(t){}try{return Function('return require("'+t+'")')()}catch(t){}}}},9432:(t,e,n)=>{n(5213)},9433:(t,e,n)=>{var i=n(4576),s=Object.defineProperty;t.exports=function(t,e){try{s(i,t,{value:e,configurable:!0,writable:!0})}catch(n){i[t]=e}return e}},9462:(t,e,n)=>{var i=n(9565),s=n(2360),r=n(6699),o=n(6279),a=n(8227),c=n(1181),l=n(5966),h=n(7657).IteratorPrototype,d=n(2529),u=n(9539),p=n(1385),g=a("toStringTag"),f="IteratorHelper",m="WrapForValidIterator",v="normal",y="throw",b=c.set,w=function(t){var e=c.getterFor(t?m:f);return o(s(h),{next:function(){var n=e(this);if(t)return n.nextHandler();if(n.done)return d(void 0,!0);try{var i=n.nextHandler();return n.returnHandlerResult?i:d(i,n.done)}catch(t){throw n.done=!0,t}},return:function(){var n=e(this),s=n.iterator;if(n.done=!0,t){var r=l(s,"return");return r?i(r,s):d(void 0,!0)}if(n.inner)try{u(n.inner.iterator,v)}catch(t){return u(s,y,t)}if(n.openIters)try{p(n.openIters,v)}catch(t){return u(s,y,t)}return s&&u(s,v),d(void 0,!0)}})},A=w(!0),x=w(!1);r(x,g,"Iterator Helper"),t.exports=function(t,e,n){var i=function(i,s){s?(s.iterator=i.iterator,s.next=i.next):s=i,s.type=e?m:f,s.returnHandlerResult=!!n,s.nextHandler=t,s.counter=0,s.done=!1,b(this,s)};return i.prototype=e?A:x,i}},9486:(t,e,n)=>{var i=n(6518),s=n(4576),r=n(9504),o=n(3972),a=n(4154),c=n(5169),l=n(2804),h=n(944),d=l.i2c,u=l.i2cUrl,p=r("".charAt),g=s.Uint8Array,f=!g||!g.prototype.toBase64||!function(){try{(new g).toBase64(null)}catch(t){return!0}}();g&&i({target:"Uint8Array",proto:!0,forced:f},{toBase64:function(){var t=a(this),e=arguments.length?o(arguments[0]):void 0,n="base64"===h(e)?d:u,i=!!e&&!!e.omitPadding;c(this.buffer);for(var s,r="",l=0,g=t.length,f=function(t){return p(n,s>>6*t&63)};l+2<g;l+=3)s=(t[l]<<16)+(t[l+1]<<8)+t[l+2],r+=f(3)+f(2)+f(1)+f(0);return l+2===g?(s=(t[l]<<16)+(t[l+1]<<8),r+=f(3)+f(2)+f(1)+(i?"":"=")):l+1===g&&(s=t[l]<<16,r+=f(3)+f(2)+(i?"":"==")),r}})},9504:(t,e,n)=>{var i=n(616),s=Function.prototype,r=s.call,o=i&&s.bind.bind(r,r);t.exports=i?o:function(t){return function(){return r.apply(t,arguments)}}},9519:(t,e,n)=>{var i,s,r=n(4576),o=n(2839),a=r.process,c=r.Deno,l=a&&a.versions||c&&c.version,h=l&&l.v8;h&&(s=(i=h.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!s&&o&&(!(i=o.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=o.match(/Chrome\/(\d+)/))&&(s=+i[1]),t.exports=s},9539:(t,e,n)=>{var i=n(9565),s=n(8551),r=n(5966);t.exports=function(t,e,n){var o,a;s(t);try{if(!(o=r(t,"return"))){if("throw"===e)throw n;return n}o=i(o,t)}catch(t){a=!0,o=t}if("throw"===e)throw n;if(a)throw o;return s(o),n}},9565:(t,e,n)=>{var i=n(616),s=Function.prototype.call;t.exports=i?s.bind(s):function(){return s.apply(s,arguments)}},9577:(t,e,n)=>{var i=n(9928),s=n(4644),r=n(1108),o=n(1291),a=n(5854),c=s.aTypedArray,l=s.getTypedArrayConstructor,h=s.exportTypedArrayMethod,d=function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(t){return 8===t}}(),u=d&&function(){try{new Int8Array(1).with(-.5,1)}catch(t){return!0}}();h("with",{with:function(t,e){var n=c(this),s=o(t),h=r(n)?a(e):+e;return i(n,l(n),s,h)}}.with,!d||u)},9590:(t,e,n)=>{var i=n(1291),s=RangeError;t.exports=function(t){var e=i(t);if(e<0)throw new s("The argument can't be less than 0");return e}},9617:(t,e,n)=>{var i=n(5397),s=n(5610),r=n(6198),o=function(t){return function(e,n,o){var a=i(e),c=r(a);if(0===c)return!t&&-1;var l,h=s(o,c);if(t&&n!=n){for(;c>h;)if((l=a[h++])!=l)return!0}else for(;c>h;h++)if((t||h in a)&&a[h]===n)return t||h||0;return!t&&-1}};t.exports={includes:o(!0),indexOf:o(!1)}},9631:(t,e,n)=>{n(9486)},9797:(t,e,n)=>{n(4226)},9835:t=>{t.exports=function(t){try{var e=new Set,n={size:0,has:function(){return!0},keys:function(){return Object.defineProperty({},"next",{get:function(){return e.clear(),e.add(4),function(){return{done:!0}}}})}},i=e[t](n);return 1===i.size&&4===i.values().next().value}catch(t){return!1}}},9928:(t,e,n)=>{var i=n(6198),s=n(1291),r=RangeError;t.exports=function(t,e,n,o){var a=i(t),c=s(n),l=c<0?a+c:c;if(l>=a||l<0)throw new r("Incorrect index");for(var h=new e(a),d=0;d<a;d++)h[d]=d===l?o:t[d];return h}}},_={};function C(t){var e=_[t];if(void 0!==e)return e.exports;var n=_[t]={exports:{}};return E[t].call(n.exports,n,n.exports,C),n.exports}C.d=(t,e)=>{for(var n in e)C.o(e,n)&&!C.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},C.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),C(4114),C(6573),C(8100),C(7936),C(8111),C(8237),C(1689),C(9577),C(4235),C(9432),C(1549),C(9797),C(9631),C(5623),C(4979),C(5781);const T=!("object"!=typeof process||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type),k=[.001,0,0,.001,0,0],R=1.35,I={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},P="pdfjs_internal_editor_",M={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},D={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},O={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},L={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},N={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},F={ERRORS:0,WARNINGS:1,INFOS:5},B={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},U={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let $=F.WARNINGS;function j(){return $}function z(t){$>=F.INFOS&&console.info(`Info: ${t}`)}function H(t){$>=F.WARNINGS&&console.warn(`Warning: ${t}`)}function G(t){throw new Error(t)}function V(t,e){t||G(e)}function W(t,e=null,n=null){if(!t)return null;if(n&&"string"==typeof t){if(n.addDefaultProtocol&&t.startsWith("www.")){const e=t.match(/\./g);e?.length>=2&&(t=`http://${t}`)}if(n.tryConvertEncoding)try{t=decodeURIComponent(escape(t))}catch{}}const i=e?URL.parse(t,e):URL.parse(t);return function(t){switch(t?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(i)?i:null}function q(t,e,n=!1){const i=URL.parse(t);return i?(i.hash=e,i.href):n&&W(t,"http://example.com")?t.split("#",1)[0]+""+(e?`#${e}`:""):""}function K(t,e,n,i=!1){return Object.defineProperty(t,e,{value:n,enumerable:!i,configurable:!0,writable:!1}),n}const Y=function(){function t(t,e){this.message=t,this.name=e}return t.prototype=new Error,t.constructor=t,t}();let X=class extends Y{constructor(t,e){super(t,"PasswordException"),this.code=e}},J=class extends Y{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}},Q=class extends Y{constructor(t){super(t,"InvalidPDFException")}},Z=class extends Y{constructor(t,e,n){super(t,"ResponseException"),this.status=e,this.missing=n}},tt=class extends Y{constructor(t){super(t,"FormatError")}},et=class extends Y{constructor(t){super(t,"AbortException")}};function nt(t){"object"==typeof t&&void 0!==t?.length||G("Invalid argument for bytesToString");const e=t.length,n=8192;if(e<n)return String.fromCharCode.apply(null,t);const i=[];for(let s=0;s<e;s+=n){const r=Math.min(s+n,e),o=t.subarray(s,r);i.push(String.fromCharCode.apply(null,o))}return i.join("")}function it(t){"string"!=typeof t&&G("Invalid argument for stringToBytes");const e=t.length,n=new Uint8Array(e);for(let i=0;i<e;++i)n[i]=255&t.charCodeAt(i);return n}class st{static get isLittleEndian(){return K(this,"isLittleEndian",function(){const t=new Uint8Array(4);return t[0]=1,1===new Uint32Array(t.buffer,0,1)[0]}())}static get isEvalSupported(){return K(this,"isEvalSupported",function(){try{return new Function(""),!0}catch{return!1}}())}static get isOffscreenCanvasSupported(){return K(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}static get isImageDecoderSupported(){return K(this,"isImageDecoderSupported","undefined"!=typeof ImageDecoder)}static get platform(){const{platform:t,userAgent:e}=navigator;return K(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return K(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const rt=Array.from(Array(256).keys(),t=>t.toString(16).padStart(2,"0"));class ot{static makeHexColor(t,e,n){return`#${rt[t]}${rt[e]}${rt[n]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let n;t[0]?(t[0]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[3],e[3]*=t[3]):(n=e[0],e[0]=e[1],e[1]=n,n=e[2],e[2]=e[3],e[3]=n,t[1]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,n=0){const i=t[n],s=t[n+1];t[n]=i*e[0]+s*e[2]+e[4],t[n+1]=i*e[1]+s*e[3]+e[5]}static applyTransformToBezier(t,e,n=0){const i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],c=e[5];for(let e=0;e<6;e+=2){const l=t[n+e],h=t[n+e+1];t[n+e]=l*i+h*r+a,t[n+e+1]=l*s+h*o+c}}static applyInverseTransform(t,e){const n=t[0],i=t[1],s=e[0]*e[3]-e[1]*e[2];t[0]=(n*e[3]-i*e[2]+e[2]*e[5]-e[4]*e[3])/s,t[1]=(-n*e[1]+i*e[0]+e[4]*e[1]-e[5]*e[0])/s}static axialAlignedBoundingBox(t,e,n){const i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],c=e[5],l=t[0],h=t[1],d=t[2],u=t[3];let p=i*l+a,g=p,f=i*d+a,m=f,v=o*h+c,y=v,b=o*u+c,w=b;if(0!==s||0!==r){const t=s*l,e=s*d,n=r*h,i=r*u;p+=n,m+=n,f+=i,g+=i,v+=t,w+=t,b+=e,y+=e}n[0]=Math.min(n[0],p,f,g,m),n[1]=Math.min(n[1],v,b,y,w),n[2]=Math.max(n[2],p,f,g,m),n[3]=Math.max(n[3],v,b,y,w)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const n=t[0],i=t[1],s=t[2],r=t[3],o=n**2+i**2,a=n*s+i*r,c=s**2+r**2,l=(o+c)/2,h=Math.sqrt(l**2-(o*c-a**2));e[0]=Math.sqrt(l+h||1),e[1]=Math.sqrt(l-h||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const n=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(n>i)return null;const s=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return s>r?null:[n,s,i,r]}static pointBoundingBox(t,e,n){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}static rectBoundingBox(t,e,n,i,s){s[0]=Math.min(s[0],t,n),s[1]=Math.min(s[1],e,i),s[2]=Math.max(s[2],t,n),s[3]=Math.max(s[3],e,i)}static#t(t,e,n,i,s,r,o,a,c,l){if(c<=0||c>=1)return;const h=1-c,d=c*c,u=d*c,p=h*(h*(h*t+3*c*e)+3*d*n)+u*i,g=h*(h*(h*s+3*c*r)+3*d*o)+u*a;l[0]=Math.min(l[0],p),l[1]=Math.min(l[1],g),l[2]=Math.max(l[2],p),l[3]=Math.max(l[3],g)}static#e(t,e,n,i,s,r,o,a,c,l,h,d){if(Math.abs(c)<1e-12)return void(Math.abs(l)>=1e-12&&this.#t(t,e,n,i,s,r,o,a,-h/l,d));const u=l**2-4*h*c;if(u<0)return;const p=Math.sqrt(u),g=2*c;this.#t(t,e,n,i,s,r,o,a,(-l+p)/g,d),this.#t(t,e,n,i,s,r,o,a,(-l-p)/g,d)}static bezierBoundingBox(t,e,n,i,s,r,o,a,c){c[0]=Math.min(c[0],t,o),c[1]=Math.min(c[1],e,a),c[2]=Math.max(c[2],t,o),c[3]=Math.max(c[3],e,a),this.#e(t,n,s,o,e,i,r,a,3*(3*(n-s)-t+o),6*(t-2*n+s),3*(n-t),c),this.#e(t,n,s,o,e,i,r,a,3*(3*(i-r)-e+a),6*(e-2*i+r),3*(i-e),c)}}let at=null,ct=null;function lt(t){return at||(at=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,ct=new Map([["","t"]])),t.replaceAll(at,(t,e,n)=>e?e.normalize("NFKC"):ct.get(n))}function ht(){if("function"==typeof crypto.randomUUID)return crypto.randomUUID();const t=new Uint8Array(32);return crypto.getRandomValues(t),nt(t)}const dt="pdfjs_internal_id_";function ut(t,e,n){return Math.min(Math.max(t,e),n)}function pt(t){return Uint8Array.prototype.toBase64?t.toBase64():btoa(nt(t))}"function"!=typeof Math.sumPrecise&&(Math.sumPrecise=function(t){return t.reduce((t,e)=>t+e,0)}),"function"!=typeof AbortSignal.any&&(AbortSignal.any=function(t){const e=new AbortController,{signal:n}=e;for(const i of t)if(i.aborted)return e.abort(i.reason),n;for(const i of t)i.addEventListener("abort",()=>{e.abort(i.reason)},{signal:n});return n}),C(1701),C(4603),C(7566),C(8721);class gt{static textContent(t){const e=[],n={items:e,styles:Object.create(null)};return function t(n){if(!n)return;let i=null;const s=n.name;if("#text"===s)i=n.value;else{if(!gt.shouldBuildText(s))return;n?.attributes?.textContent?i=n.attributes.textContent:n.value&&(i=n.value)}if(null!==i&&e.push({str:i}),n.children)for(const e of n.children)t(e)}(t),n}static shouldBuildText(t){return!("textarea"===t||"input"===t||"option"===t||"select"===t)}}class ft{static setupStorage(t,e,n,i,s){const r=i.getValue(e,{value:null});switch(n.name){case"textarea":if(null!==r.value&&(t.textContent=r.value),"print"===s)break;t.addEventListener("input",t=>{i.setValue(e,{value:t.target.value})});break;case"input":if("radio"===n.attributes.type||"checkbox"===n.attributes.type){if(r.value===n.attributes.xfaOn?t.setAttribute("checked",!0):r.value===n.attributes.xfaOff&&t.removeAttribute("checked"),"print"===s)break;t.addEventListener("change",t=>{i.setValue(e,{value:t.target.checked?t.target.getAttribute("xfaOn"):t.target.getAttribute("xfaOff")})})}else{if(null!==r.value&&t.setAttribute("value",r.value),"print"===s)break;t.addEventListener("input",t=>{i.setValue(e,{value:t.target.value})})}break;case"select":if(null!==r.value){t.setAttribute("value",r.value);for(const t of n.children)t.attributes.value===r.value?t.attributes.selected=!0:t.attributes.hasOwnProperty("selected")&&delete t.attributes.selected}t.addEventListener("input",t=>{const n=t.target.options,s=-1===n.selectedIndex?"":n[n.selectedIndex].value;i.setValue(e,{value:s})})}}static setAttributes({html:t,element:e,storage:n=null,intent:i,linkService:s}){const{attributes:r}=e,o=t instanceof HTMLAnchorElement;"radio"===r.type&&(r.name=`${r.name}-${i}`);for(const[e,n]of Object.entries(r))if(null!=n)switch(e){case"class":n.length&&t.setAttribute(e,n.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",n);break;case"style":Object.assign(t.style,n);break;case"textContent":t.textContent=n;break;default:(!o||"href"!==e&&"newWindow"!==e)&&t.setAttribute(e,n)}o&&s.addLinkAttributes(t,r.href,r.newWindow),n&&r.dataId&&this.setupStorage(t,r.dataId,e,n)}static render(t){const e=t.annotationStorage,n=t.linkService,i=t.xfaHtml,s=t.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:s,linkService:n});const o="richText"!==s,a=t.div;if(a.append(r),t.viewport){const e=`matrix(${t.viewport.transform.join(",")})`;a.style.transform=e}o&&a.setAttribute("class","xfaLayer xfaFont");const c=[];if(0===i.children.length){if(i.value){const t=document.createTextNode(i.value);r.append(t),o&&gt.shouldBuildText(i.name)&&c.push(t)}return{textDivs:c}}const l=[[i,-1,r]];for(;l.length>0;){const[t,i,r]=l.at(-1);if(i+1===t.children.length){l.pop();continue}const a=t.children[++l.at(-1)[1]];if(null===a)continue;const{name:h}=a;if("#text"===h){const t=document.createTextNode(a.value);c.push(t),r.append(t);continue}const d=a?.attributes?.xmlns?document.createElementNS(a.attributes.xmlns,h):document.createElement(h);if(r.append(d),a.attributes&&this.setAttributes({html:d,element:a,storage:e,intent:s,linkService:n}),a.children?.length>0)l.push([a,-1,d]);else if(a.value){const t=document.createTextNode(a.value);o&&gt.shouldBuildText(h)&&c.push(t),d.append(t)}}for(const t of a.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))t.setAttribute("readOnly",!0);return{textDivs:c}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const mt="http://www.w3.org/2000/svg";class vt{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function yt(t,e="text"){if(Ct(t,document.baseURI)){const n=await fetch(t);if(!n.ok)throw new Error(n.statusText);switch(e){case"arraybuffer":return n.arrayBuffer();case"blob":return n.blob();case"json":return n.json()}return n.text()}return new Promise((n,i)=>{const s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE)if(200!==s.status&&0!==s.status)i(new Error(s.statusText));else{switch(e){case"arraybuffer":case"blob":case"json":return void n(s.response)}n(s.responseText)}},s.send(null)})}class bt{constructor({viewBox:t,userUnit:e,scale:n,rotation:i,offsetX:s=0,offsetY:r=0,dontFlip:o=!1}){this.viewBox=t,this.userUnit=e,this.scale=n,this.rotation=i,this.offsetX=s,this.offsetY=r,n*=e;const a=(t[2]+t[0])/2,c=(t[3]+t[1])/2;let l,h,d,u,p,g,f,m;switch((i%=360)<0&&(i+=360),i){case 180:l=-1,h=0,d=0,u=1;break;case 90:l=0,h=1,d=1,u=0;break;case 270:l=0,h=-1,d=-1,u=0;break;case 0:l=1,h=0,d=0,u=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(d=-d,u=-u),0===l?(p=Math.abs(c-t[1])*n+s,g=Math.abs(a-t[0])*n+r,f=(t[3]-t[1])*n,m=(t[2]-t[0])*n):(p=Math.abs(a-t[0])*n+s,g=Math.abs(c-t[1])*n+r,f=(t[2]-t[0])*n,m=(t[3]-t[1])*n),this.transform=[l*n,h*n,d*n,u*n,p-l*n*a-d*n*c,g-h*n*a-u*n*c],this.width=f,this.height=m}get rawDims(){const t=this.viewBox;return K(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:n=this.offsetX,offsetY:i=this.offsetY,dontFlip:s=!1}={}){return new bt({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:i,dontFlip:s})}convertToViewportPoint(t,e){const n=[t,e];return ot.applyTransform(n,this.transform),n}convertToViewportRectangle(t){const e=[t[0],t[1]];ot.applyTransform(e,this.transform);const n=[t[2],t[3]];return ot.applyTransform(n,this.transform),[e[0],e[1],n[0],n[1]]}convertToPdfPoint(t,e){const n=[t,e];return ot.applyInverseTransform(n,this.transform),n}}class wt extends Y{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function At(t){const e=t.length;let n=0;for(;n<e&&""===t[n].trim();)n++;return"data:"===t.substring(n,n+5).toLowerCase()}function xt(t){return"string"==typeof t&&/\.pdf$/i.test(t)}function St(t){return[t]=t.split(/[#?]/,1),t.substring(t.lastIndexOf("/")+1)}function Et(t,e="document.pdf"){if("string"!=typeof t)return e;if(At(t))return H('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const n=(t=>{try{return new URL(t)}catch{try{return new URL(decodeURIComponent(t))}catch{try{return new URL(t,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(t),"https://foo.bar")}catch{return null}}}}})(t);if(!n)return e;const i=t=>{try{let e=decodeURIComponent(t);return e.includes("/")?(e=e.split("/").at(-1),e.test(/^\.pdf$/i)?e:t):e}catch{return t}},s=/\.pdf$/i,r=n.pathname.split("/").at(-1);if(s.test(r))return i(r);if(n.searchParams.size>0){const t=Array.from(n.searchParams.values()).reverse();for(const e of t)if(s.test(e))return i(e);const e=Array.from(n.searchParams.keys()).reverse();for(const t of e)if(s.test(t))return i(t)}if(n.hash){const t=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(t)return i(t[0])}return e}class _t{started=Object.create(null);times=[];time(t){t in this.started&&H(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||H(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:t}of this.times)e=Math.max(t.length,e);for(const{name:n,start:i,end:s}of this.times)t.push(`${n.padEnd(e)} ${s-i}ms\n`);return t.join("")}}function Ct(t,e){const n=e?URL.parse(t,e):URL.parse(t);return"http:"===n?.protocol||"https:"===n?.protocol}function Tt(t){t.preventDefault()}function kt(t){t.preventDefault(),t.stopPropagation()}class Rt{static#n;static toDateObject(t){if(t instanceof Date)return t;if(!t||"string"!=typeof t)return null;this.#n||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#n.exec(t);if(!e)return null;const n=parseInt(e[1],10);let i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;let s=parseInt(e[3],10);s=s>=1&&s<=31?s:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let o=parseInt(e[5],10);o=o>=0&&o<=59?o:0;let a=parseInt(e[6],10);a=a>=0&&a<=59?a:0;const c=e[7]||"Z";let l=parseInt(e[8],10);l=l>=0&&l<=23?l:0;let h=parseInt(e[9],10)||0;return h=h>=0&&h<=59?h:0,"-"===c?(r+=l,o+=h):"+"===c&&(r-=l,o-=h),new Date(Date.UTC(n,i,s,r,o,a))}}function It(t,{scale:e=1,rotation:n=0}){const{width:i,height:s}=t.attributes.style,r=[0,0,parseInt(i),parseInt(s)];return new bt({viewBox:r,userUnit:1,scale:e,rotation:n})}function Pt(t){if(t.startsWith("#")){const e=parseInt(t.slice(1),16);return[(16711680&e)>>16,(65280&e)>>8,255&e]}return t.startsWith("rgb(")?t.slice(4,-1).split(",").map(t=>parseInt(t)):t.startsWith("rgba(")?t.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(H(`Not a valid color format: "${t}"`),[0,0,0])}function Mt(t){const{a:e,b:n,c:i,d:s,e:r,f:o}=t.getTransform();return[e,n,i,s,r,o]}function Dt(t){const{a:e,b:n,c:i,d:s,e:r,f:o}=t.getTransform().invertSelf();return[e,n,i,s,r,o]}function Ot(t,e,n=!1,i=!0){if(e instanceof bt){const{pageWidth:i,pageHeight:s}=e.rawDims,{style:r}=t,o=st.isCSSRoundSupported,a=`var(--total-scale-factor) * ${i}px`,c=`var(--total-scale-factor) * ${s}px`,l=o?`round(down, ${a}, var(--scale-round-x))`:`calc(${a})`,h=o?`round(down, ${c}, var(--scale-round-y))`:`calc(${c})`;n&&e.rotation%180!=0?(r.width=h,r.height=l):(r.width=l,r.height=h)}i&&t.setAttribute("data-main-rotation",e.rotation)}class Lt{constructor(){const{pixelRatio:t}=Lt;this.sx=t,this.sy=t}get scaled(){return 1!==this.sx||1!==this.sy}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,n,i,s=-1){let r=1/0,o=1/0,a=1/0;(n=Lt.capPixels(n,s))>0&&(r=Math.sqrt(n/(t*e))),-1!==i&&(o=i/t,a=i/e);const c=Math.min(r,o,a);return(this.sx>c||this.sy>c)&&(this.sx=c,this.sy=c,!0)}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,n):n}return t}}const Nt=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class Ft{static get isDarkMode(){return K(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class Bt{static get commentForegroundColor(){const t=document.createElement("span");t.classList.add("comment","sidebar");const{style:e}=t;e.width=e.height="0",e.display="none",e.color="var(--comment-fg-color)",document.body.append(t);const{color:n}=window.getComputedStyle(t);return t.remove(),K(this,"commentForegroundColor",Pt(n))}}function Ut(t,e,n,i){const s=255*(1-(i=Math.min(Math.max(i??1,0),1)));return[t=Math.round(t*i+s),e=Math.round(e*i+s),n=Math.round(n*i+s)]}function $t(t,e){const n=t[0]/255,i=t[1]/255,s=t[2]/255,r=Math.max(n,i,s),o=Math.min(n,i,s),a=(r+o)/2;if(r===o)e[0]=e[1]=0;else{const t=r-o;switch(e[1]=a<.5?t/(r+o):t/(2-r-o),r){case n:e[0]=60*((i-s)/t+(i<s?6:0));break;case i:e[0]=60*((s-n)/t+2);break;case s:e[0]=60*((n-i)/t+4)}}e[2]=a}function jt(t,e){const n=t[0],i=t[1],s=t[2],r=(1-Math.abs(2*s-1))*i,o=r*(1-Math.abs(n/60%2-1)),a=s-r/2;switch(Math.floor(n/60)){case 0:e[0]=r+a,e[1]=o+a,e[2]=a;break;case 1:e[0]=o+a,e[1]=r+a,e[2]=a;break;case 2:e[0]=a,e[1]=r+a,e[2]=o+a;break;case 3:e[0]=a,e[1]=o+a,e[2]=r+a;break;case 4:e[0]=o+a,e[1]=a,e[2]=r+a;break;case 5:case 6:e[0]=r+a,e[1]=a,e[2]=o+a}}function zt(t){return t<=.03928?t/12.92:((t+.055)/1.055)**2.4}function Ht(t,e,n){jt(t,n),n.map(zt);const i=.2126*n[0]+.7152*n[1]+.0722*n[2];jt(e,n),n.map(zt);const s=.2126*n[0]+.7152*n[1]+.0722*n[2];return i>s?(i+.05)/(s+.05):(s+.05)/(i+.05)}const Gt=new Map;function Vt(t,e){const n=t[0]+256*t[1]+65536*t[2]+16777216*e[0]+4294967296*e[1]+1099511627776*e[2];let i=Gt.get(n);if(i)return i;const s=new Float32Array(9),r=s.subarray(0,3),o=s.subarray(3,6);$t(t,o);const a=s.subarray(6,9);$t(e,a);const c=a[2]<.5,l=c?12:4.5;if(o[2]=c?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),Ht(o,a,r)<l){let t,e;c?(t=o[2],e=1):(t=0,e=o[2]);const n=.005;for(;e-t>n;){const n=o[2]=(t+e)/2;c===Ht(o,a,r)<l?t=n:e=n}o[2]=c?e:t}return jt(o,r),i=ot.makeHexColor(Math.round(255*r[0]),Math.round(255*r[1]),Math.round(255*r[2])),Gt.set(n,i),i}function Wt({html:t,dir:e,className:n},i){const s=document.createDocumentFragment();if("string"==typeof t){const n=document.createElement("p");n.dir=e||"auto";const i=t.split(/(?:\r\n?|\n)/);for(let t=0,e=i.length;t<e;++t){const s=i[t];n.append(document.createTextNode(s)),t<e-1&&n.append(document.createElement("br"))}s.append(n)}else ft.render({xfaHtml:t,div:s,intent:"richText"});s.firstChild.classList.add("richText",n),i.append(s)}C(4972),C(4628),C(7642),C(8004),C(3853),C(5876),C(2475),C(5024),C(1698),C(9314),C(1148),C(3579),C(8335);class qt{#i=null;#s=null;#r;#o=null;#a=null;#c=null;#l=null;#h=null;static#d=null;constructor(t){this.#r=t,qt.#d||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#i=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#r._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",Tt,{signal:e}),t.addEventListener("pointerdown",qt.#u,{signal:e}));const n=this.#o=document.createElement("div");n.className="buttons",t.append(n);const i=this.#r.toolbarPosition;if(i){const{style:e}=t,n="ltr"===this.#r._uiManager.direction?1-i[0]:i[0];e.insetInlineEnd=100*n+"%",e.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#i}static#u(t){t.stopPropagation()}#p(t){this.#r._focusEventsAllowed=!1,kt(t)}#g(t){this.#r._focusEventsAllowed=!0,kt(t)}#f(t){const e=this.#r._uiManager._signal;return e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("focusin",this.#p.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#g.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",Tt,{signal:e}),!0)}hide(){this.#i.classList.add("hidden"),this.#s?.hideDropdown()}show(){this.#i.classList.remove("hidden"),this.#a?.shown(),this.#c?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#r,n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",qt.#d[t]),this.#f(n)&&n.addEventListener("click",t=>{e.delete()},{signal:e._signal}),this.#o.append(n)}get#m(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#f(e),this.#o.append(e,this.#m),this.#a=t}addComment(t,e=null){if(this.#c)return;const n=t.renderForToolbar();if(!n)return;this.#f(n);const i=this.#l=this.#m;e?(this.#o.insertBefore(n,e),this.#o.insertBefore(i,e)):this.#o.append(n,i),this.#c=t,t.toolbar=this}addColorPicker(t){if(this.#s)return;this.#s=t;const e=t.renderButton();this.#f(e),this.#o.append(e,this.#m)}async addEditSignatureButton(t){const e=this.#h=await t.renderEditButton(this.#r);this.#f(e),this.#o.append(e,this.#m)}removeButton(t){"comment"===t&&(this.#c?.removeToolbarCommentButton(),this.#c=null,this.#l?.remove(),this.#l=null)}async addButton(t,e){switch(t){case"colorPicker":this.addColorPicker(e);break;case"altText":await this.addAltText(e);break;case"editSignature":await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(e)}}async addButtonBefore(t,e,n){const i=this.#o.querySelector(n);i&&"comment"===t&&this.addComment(e,i)}updateEditSignatureButton(t){this.#h&&(this.#h.title=t)}remove(){this.#i.remove(),this.#s?.destroy(),this.#s=null}}class Kt{#o=null;#i=null;#v;constructor(t){this.#v=t}#y(){const t=this.#i=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#v._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",Tt,{signal:e});const n=this.#o=document.createElement("div");return n.className="buttons",t.append(n),this.#v.hasCommentManager()&&this.#b("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#v.commentSelection("floating_button")}),this.#b("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#v.highlightSelection("floating_button")}),t}#w(t,e){let n=0,i=0;for(const s of t){const t=s.y+s.height;if(t<n)continue;const r=s.x+(e?s.width:0);t>n?(i=r,n=t):e?r>i&&(i=r):r<i&&(i=r)}return[e?1-i:i,n]}show(t,e,n){const[i,s]=this.#w(e,n),{style:r}=this.#i||=this.#y();t.append(this.#i),r.insetInlineEnd=100*i+"%",r.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){this.#i.remove()}#b(t,e,n,i){const s=document.createElement("button");s.classList.add("basic",t),s.tabIndex=0,s.setAttribute("data-l10n-id",e);const r=document.createElement("span");s.append(r),r.className="visuallyHidden",r.setAttribute("data-l10n-id",n);const o=this.#v._signal;o instanceof AbortSignal&&!o.aborted&&(s.addEventListener("contextmenu",Tt,{signal:o}),s.addEventListener("click",i,{signal:o})),this.#o.append(s)}}function Yt(t,e,n){for(const i of n)e.addEventListener(i,t[i].bind(t))}class Xt{#A=0;get id(){return`${P}${this.#A++}`}}class Jt{#x=ht();#A=0;#S=null;static get _isSVGFittingCanvas(){const t=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',K(this,"_isSVGFittingCanvas",e.decode().then(()=>(t.drawImage(e,0,0,1,1,0,0,1,3),0===new Uint32Array(t.getImageData(0,0,1,1).data.buffer)[0])))}async#E(t,e){this.#S||=new Map;let n=this.#S.get(t);if(null===n)return null;if(n?.bitmap)return n.refCounter+=1,n;try{let t;if(n||={bitmap:null,id:`image_${this.#x}_${this.#A++}`,refCounter:0,isSvg:!1},"string"==typeof e?(n.url=e,t=await yt(e,"blob")):e instanceof File?t=n.file=e:e instanceof Blob&&(t=e),"image/svg+xml"===t.type){const e=Jt._isSVGFittingCanvas,i=new FileReader,s=new Image,r=new Promise((t,r)=>{s.onload=()=>{n.bitmap=s,n.isSvg=!0,t()},i.onload=async()=>{const t=n.svgUrl=i.result;s.src=await e?`${t}#svgView(preserveAspectRatio(none))`:t},s.onerror=i.onerror=r});i.readAsDataURL(t),await r}else n.bitmap=await createImageBitmap(t);n.refCounter=1}catch(t){H(t),n=null}return this.#S.set(t,n),n&&this.#S.set(n.id,n),n}async getFromFile(t){const{lastModified:e,name:n,size:i,type:s}=t;return this.#E(`${e}_${n}_${i}_${s}`,t)}async getFromUrl(t){return this.#E(t,t)}async getFromBlob(t,e){const n=await e;return this.#E(t,n)}async getFromId(t){this.#S||=new Map;const e=this.#S.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:t}=e;return delete e.blobPromise,this.getFromBlob(e.id,t)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#S||=new Map;let n=this.#S.get(t);if(n?.bitmap)return n.refCounter+=1,n;const i=new OffscreenCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),n={bitmap:i.transferToImageBitmap(),id:`image_${this.#x}_${this.#A++}`,refCounter:1,isSvg:!1},this.#S.set(t,n),this.#S.set(n.id,n),n}getSvgUrl(t){const e=this.#S.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#S||=new Map;const e=this.#S.get(t);if(!e)return;if(e.refCounter-=1,0!==e.refCounter)return;const{bitmap:n}=e;if(!e.url&&!e.file){const t=new OffscreenCanvas(n.width,n.height);t.getContext("bitmaprenderer").transferFromImageBitmap(n),e.blobPromise=t.convertToBlob()}n.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#x}_`)}}class Qt{#_=[];#C=!1;#T;#k=-1;constructor(t=128){this.#T=t}add({cmd:t,undo:e,post:n,mustExec:i,type:s=NaN,overwriteIfSameType:r=!1,keepUndo:o=!1}){if(i&&t(),this.#C)return;const a={cmd:t,undo:e,post:n,type:s};if(-1===this.#k)return this.#_.length>0&&(this.#_.length=0),this.#k=0,void this.#_.push(a);if(r&&this.#_[this.#k].type===s)return o&&(a.undo=this.#_[this.#k].undo),void(this.#_[this.#k]=a);const c=this.#k+1;c===this.#T?this.#_.splice(0,1):(this.#k=c,c<this.#_.length&&this.#_.splice(c)),this.#_.push(a)}undo(){if(-1===this.#k)return;this.#C=!0;const{undo:t,post:e}=this.#_[this.#k];t(),e?.(),this.#C=!1,this.#k-=1}redo(){if(this.#k<this.#_.length-1){this.#k+=1,this.#C=!0;const{cmd:t,post:e}=this.#_[this.#k];t(),e?.(),this.#C=!1}}hasSomethingToUndo(){return-1!==this.#k}hasSomethingToRedo(){return this.#k<this.#_.length-1}cleanType(t){if(-1!==this.#k){for(let e=this.#k;e>=0;e--)if(this.#_[e].type!==t)return this.#_.splice(e+1,this.#k-e),void(this.#k=e);this.#_.length=0,this.#k=-1}}destroy(){this.#_=null}}class Zt{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=st.platform;for(const[n,i,s={}]of t)for(const t of n){const n=t.startsWith("mac+");e&&n?(this.callbacks.set(t.slice(4),{callback:i,options:s}),this.allKeys.add(t.split("+").at(-1))):e||n||(this.callbacks.set(t,{callback:i,options:s}),this.allKeys.add(t.split("+").at(-1)))}}#R(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const n=this.callbacks.get(this.#R(e));if(!n)return;const{callback:i,options:{bubbles:s=!1,args:r=[],checker:o=null}}=n;o&&!o(t,e)||(i.bind(t,...r,e)(),s||kt(e))}}class te{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return function(t){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const n of t.keys()){e.style.color=n;const i=window.getComputedStyle(e).color;t.set(n,Pt(i))}e.remove()}(t),K(this,"_colors",t)}convert(t){const e=Pt(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[t,n]of this._colors)if(n.every((t,n)=>t===e[n]))return te._colorsMapping.get(t);return e}getHexCode(t){const e=this._colors.get(t);return e?ot.makeHexColor(...e):t}}class ee{#I=new AbortController;#P=null;#M=null;#D=new Map;#O=new Map;#L=null;#N=null;#F=null;#B=new Qt;#U=null;#$=null;#j=null;#z=0;#H=new Set;#G=null;#V=null;#W=new Set;_editorUndoBar=null;#q=!1;#K=!1;#Y=!1;#X=null;#J=null;#Q=null;#Z=null;#tt=!1;#et=null;#nt=new Xt;#it=!1;#st=!1;#rt=!1;#ot=null;#at=null;#ct=null;#lt=null;#ht=null;#dt=M.NONE;#ut=new Set;#pt=null;#gt=null;#ft=null;#mt=null;#vt=null;#yt={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#bt=[0,0];#wt=null;#At=null;#xt=null;#St=null;#Et=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=ee.prototype,e=t=>t.#At.contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&t.hasSomethingToControl(),n=(t,{target:e})=>{if(e instanceof HTMLInputElement){const{type:t}=e;return"text"!==t&&"number"!==t}return!0},i=this.TRANSLATE_SMALL,s=this.TRANSLATE_BIG;return K(this,"_keyboardManager",new Zt([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],t.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:n}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(t,{target:e})=>!(e instanceof HTMLButtonElement)&&t.#At.contains(e)&&!t.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(t,{target:e})=>!(e instanceof HTMLButtonElement)&&t.#At.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:e}]]))}constructor(t,e,n,i,s,r,o,a,c,l,h,d,u,p,g,f){const m=this._signal=this.#I.signal;this.#At=t,this.#xt=e,this.#St=n,this.#L=i,this.#U=s,this.#gt=r,this.#vt=a,this._eventBus=o,o._on("editingaction",this.onEditingAction.bind(this),{signal:m}),o._on("pagechanging",this.onPageChanging.bind(this),{signal:m}),o._on("scalechanging",this.onScaleChanging.bind(this),{signal:m}),o._on("rotationchanging",this.onRotationChanging.bind(this),{signal:m}),o._on("setpreference",this.onSetPreference.bind(this),{signal:m}),o._on("switchannotationeditorparams",t=>this.updateParams(t.type,t.value),{signal:m}),window.addEventListener("pointerdown",()=>{this.#st=!0},{capture:!0,signal:m}),window.addEventListener("pointerup",()=>{this.#st=!1},{capture:!0,signal:m}),this.#_t(),this.#Ct(),this.#Tt(),this.#N=a.annotationStorage,this.#X=a.filterFactory,this.#ft=c,this.#Z=l||null,this.#q=h,this.#K=d,this.#Y=u,this.#ht=p||null,this.viewParameters={realScale:vt.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=!1!==f,s?.setSidebarUiManager(this)}destroy(){this.#Et?.resolve(),this.#Et=null,this.#I?.abort(),this.#I=null,this._signal=null;for(const t of this.#O.values())t.destroy();this.#O.clear(),this.#D.clear(),this.#W.clear(),this.#lt?.clear(),this.#P=null,this.#ut.clear(),this.#B.destroy(),this.#L?.destroy(),this.#U?.destroy(),this.#gt?.destroy(),this.#et?.hide(),this.#et=null,this.#ct?.destroy(),this.#ct=null,this.#M=null,this.#J&&(clearTimeout(this.#J),this.#J=null),this.#wt&&(clearTimeout(this.#wt),this.#wt=null),this._editorUndoBar?.destroy(),this.#vt=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#ht}get useNewAltTextFlow(){return this.#K}get useNewAltTextWhenAddingImage(){return this.#Y}get hcmFilter(){return K(this,"hcmFilter",this.#ft?this.#X.addHCMFilter(this.#ft.foreground,this.#ft.background):"none")}get direction(){return K(this,"direction",getComputedStyle(this.#At).direction)}get _highlightColors(){return K(this,"_highlightColors",this.#Z?new Map(this.#Z.split(",").map(t=>((t=t.split("=").map(t=>t.trim()))[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return K(this,"highlightColors",null);const e=new Map,n=!!this.#ft;for(const[i,s]of t){const t=i.endsWith("_HCM");n&&t?e.set(i.replace("_HCM",""),s):n||t||e.set(i,s)}return K(this,"highlightColors",e)}get highlightColorNames(){return K(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#j=t}setMainHighlightColorPicker(t){this.#ct=t}editAltText(t,e=!1){this.#L?.editAltText(this,t,e)}hasCommentManager(){return!!this.#U}editComment(t,e,n,i){this.#U?.showDialog(this,t,e,n,i)}selectComment(t,e){const n=this.#O.get(t),i=n?.getEditorByUID(e);i?.toggleComment(!0,!0)}updateComment(t){this.#U?.updateComment(t.getData())}updatePopupColor(t){this.#U?.updatePopupColor(t)}removeComment(t){this.#U?.removeComments([t.uid])}toggleComment(t,e,n=void 0){this.#U?.toggleCommentPopup(t,e,n)}makeCommentColor(t,e){return t&&this.#U?.makeCommentColor(t,e)||null}getCommentDialogElement(){return this.#U?.dialogElement||null}async waitForEditorsRendered(t){if(this.#O.has(t-1))return;const{resolve:e,promise:n}=Promise.withResolvers(),i=n=>{n.pageNumber===t&&(this._eventBus._off("editorsrendered",i),e())};this._eventBus.on("editorsrendered",i),await n}getSignature(t){this.#gt?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#gt}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){"enableNewAltTextWhenAddingImage"===t&&(this.#Y=e)}onPageChanging({pageNumber:t}){this.#z=t-1}focusMainContainer(){this.#At.focus()}findParent(t,e){for(const n of this.#O.values()){const{x:i,y:s,width:r,height:o}=n.div.getBoundingClientRect();if(t>=i&&t<=i+r&&e>=s&&e<=s+o)return n}return null}disableUserSelect(t=!1){this.#xt.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#W.add(t)}removeShouldRescale(t){this.#W.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*vt.PDF_TO_CSS_UNITS;for(const t of this.#W)t.onScaleChanging();this.#j?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#kt({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#Rt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const e of this.#O.values())if(e.hasTextLayer(t))return e;return null}highlightSelection(t="",e=!1){const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:i,anchorOffset:s,focusNode:r,focusOffset:o}=n,a=n.toString(),c=this.#kt(n).closest(".textLayer"),l=this.getSelectionBoxes(c);if(!l)return;n.empty();const h=this.#Rt(c),d=this.#dt===M.NONE,u=()=>{const n=h?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:l,anchorNode:i,anchorOffset:s,focusNode:r,focusOffset:o,text:a});d&&this.showAllEditors("highlight",!0,!0),e&&n?.editComment()};d?this.switchToMode(M.HIGHLIGHT,u):u()}commentSelection(t=""){this.highlightSelection(t,!0)}#It(){const t=document.getSelection();if(!t||t.isCollapsed)return;const e=this.#kt(t).closest(".textLayer"),n=this.getSelectionBoxes(e);n&&(this.#et||=new Kt(this),this.#et.show(e,n,"ltr"===this.direction))}getAndRemoveDataFromAnnotationStorage(t){if(!this.#N)return null;const e=`${P}${t}`,n=this.#N.getRawValue(e);return n&&this.#N.remove(e),n}addToAnnotationStorage(t){t.isEmpty()||!this.#N||this.#N.has(t.id)||this.#N.setValue(t.id,t)}a11yAlert(t,e=null){const n=this.#St;n&&(n.setAttribute("data-l10n-id",t),e?n.setAttribute("data-l10n-args",JSON.stringify(e)):n.removeAttribute("data-l10n-args"))}#Pt(){const t=document.getSelection();if(!t||t.isCollapsed)return void(this.#pt&&(this.#et?.hide(),this.#pt=null,this.#Mt({hasSelectedText:!1})));const{anchorNode:e}=t;if(e===this.#pt)return;const n=this.#kt(t).closest(".textLayer");if(n){if(this.#et?.hide(),this.#pt=e,this.#Mt({hasSelectedText:!0}),(this.#dt===M.HIGHLIGHT||this.#dt===M.NONE)&&(this.#dt===M.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#tt=this.isShiftKeyDown,!this.isShiftKeyDown)){const t=this.#dt===M.HIGHLIGHT?this.#Rt(n):null;if(t?.toggleDrawing(),this.#st){const e=new AbortController,n=this.combinedSignal(e),i=n=>{"pointerup"===n.type&&0!==n.button||(e.abort(),t?.toggleDrawing(!0),"pointerup"===n.type&&this.#Dt("main_toolbar"))};window.addEventListener("pointerup",i,{signal:n}),window.addEventListener("blur",i,{signal:n})}else t?.toggleDrawing(!0),this.#Dt("main_toolbar")}}else this.#pt&&(this.#et?.hide(),this.#pt=null,this.#Mt({hasSelectedText:!1}))}#Dt(t=""){this.#dt===M.HIGHLIGHT?this.highlightSelection(t):this.#q&&this.#It()}#_t(){document.addEventListener("selectionchange",this.#Pt.bind(this),{signal:this._signal})}#Ot(){if(this.#Q)return;this.#Q=new AbortController;const t=this.combinedSignal(this.#Q);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#Lt(){this.#Q?.abort(),this.#Q=null}blur(){if(this.isShiftKeyDown=!1,this.#tt&&(this.#tt=!1,this.#Dt("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#ut)if(e.div.contains(t)){this.#at=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#at)return;const[t,e]=this.#at;this.#at=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#Tt(){if(this.#ot)return;this.#ot=new AbortController;const t=this.combinedSignal(this.#ot);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#Nt(){this.#ot?.abort(),this.#ot=null}#Ft(){if(this.#$)return;this.#$=new AbortController;const t=this.combinedSignal(this.#$);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#Bt(){this.#$?.abort(),this.#$=null}#Ct(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#Tt(),this.#Ft()}removeEditListeners(){this.#Nt(),this.#Bt()}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const n of this.#V)if(n.isHandlingMimeForPasting(e))return t.dataTransfer.dropEffect="copy",void t.preventDefault()}drop(t){for(const e of t.dataTransfer.items)for(const n of this.#V)if(n.isHandlingMimeForPasting(e.type))return n.paste(e,this.currentLayer),void t.preventDefault()}copy(t){if(t.preventDefault(),this.#P?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const t of this.#ut){const n=t.serialize(!0);n&&e.push(n)}0!==e.length&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const t of e.items)for(const e of this.#V)if(e.isHandlingMimeForPasting(t.type))return void e.paste(t,this.currentLayer);let n=e.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(t){return void H(`paste: "${t.message}".`)}if(!Array.isArray(n))return;this.unselectAll();const i=this.currentLayer;try{const t=[];for(const e of n){const n=await i.deserialize(e);if(!n)return;t.push(n)}const e=()=>{for(const e of t)this.#Ut(e);this.#$t(t)},s=()=>{for(const e of t)e.remove()};this.addCommands({cmd:e,undo:s,mustExec:!0})}catch(t){H(`paste: "${t.message}".`)}}keydown(t){this.isShiftKeyDown||"Shift"!==t.key||(this.isShiftKeyDown=!0),this.#dt===M.NONE||this.isEditorHandlingKeyboard||ee._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&"Shift"===t.key&&(this.isShiftKeyDown=!1,this.#tt&&(this.#tt=!1,this.#Dt("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu")}}#Mt(t){Object.entries(t).some(([t,e])=>this.#yt[t]!==e)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#yt,t)}),this.#dt===M.HIGHLIGHT&&!1===t.hasSelectedEditor&&this.#jt([[D.HIGHLIGHT_FREE,!0]]))}#jt(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#Ot(),this.#Ft(),this.#Mt({isEditing:this.#dt!==M.NONE,isEmpty:this.#zt(),hasSomethingToUndo:this.#B.hasSomethingToUndo(),hasSomethingToRedo:this.#B.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#Lt(),this.#Bt(),this.#Mt({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#V){this.#V=t;for(const t of this.#V)this.#jt(t.defaultPropertiesToUpdate)}}getId(){return this.#nt.id}get currentLayer(){return this.#O.get(this.#z)}getLayer(t){return this.#O.get(t)}get currentPageIndex(){return this.#z}addLayer(t){this.#O.set(t.pageIndex,t),this.#it?t.enable():t.disable()}removeLayer(t){this.#O.delete(t.pageIndex)}async updateMode(t,e=null,n=!1,i=!1,s=!1){if(this.#dt!==t&&(!this.#Et||(await this.#Et.promise,this.#Et))){if(this.#Et=Promise.withResolvers(),this.#j?.commitOrRemove(),this.#dt===M.POPUP&&this.#U?.hideSidebar(),this.#U?.destroyPopup(),this.#dt=t,t===M.NONE){this.setEditingState(!1),this.#Ht();for(const t of this.#D.values())t.hideStandaloneCommentButton();return this._editorUndoBar?.hide(),this.toggleComment(null),void this.#Et.resolve()}for(const t of this.#D.values())t.addStandaloneCommentButton();t===M.SIGNATURE&&await(this.#gt?.loadSignatures()),this.setEditingState(!0),await this.#Gt(),this.unselectAll();for(const e of this.#O.values())e.updateMode(t);if(t===M.POPUP){this.#M||=await this.#vt.getAnnotationsByType(new Set(this.#V.map(t=>t._editorType)));const t=new Set,e=[];for(const n of this.#D.values()){const{annotationElementId:i,hasComment:s,deleted:r}=n;i&&t.add(i),s&&!r&&e.push(n.getData())}for(const n of this.#M){const{id:i,popupRef:s,contentsObj:r}=n;s&&r?.str&&!t.has(i)&&!this.#H.has(i)&&e.push(n)}this.#U?.showSidebar(e)}if(!e)return n&&this.addNewEditorFromKeyboard(),void this.#Et.resolve();for(const t of this.#D.values())t.uid===e?(this.setSelected(t),s?t.editComment():i?t.enterInEditMode():t.focus()):t.unselect();this.#Et.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#dt&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#V){switch(t){case D.CREATE:return void this.currentLayer.addNewEditor(e);case D.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#mt||=new Map).set(t,e),this.showAllEditors("highlight",e)}if(this.hasSelection)for(const n of this.#ut)n.updateParams(t,e);else for(const n of this.#V)n.updateDefaultParams(t,e)}}showAllEditors(t,e,n=!1){for(const n of this.#D.values())n.editorType===t&&n.show(e);(this.#mt?.get(D.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#jt([[D.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#rt!==t){this.#rt=t;for(const e of this.#O.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#Gt(){if(!this.#it){this.#it=!0;const t=[];for(const e of this.#O.values())t.push(e.enable());await Promise.all(t);for(const t of this.#D.values())t.enable()}}#Ht(){if(this.unselectAll(),this.#it){this.#it=!1;for(const t of this.#O.values())t.disable();for(const t of this.#D.values())t.disable()}}*getEditors(t){for(const e of this.#D.values())e.pageIndex===t&&(yield e)}getEditor(t){return this.#D.get(t)}addEditor(t){this.#D.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#J&&clearTimeout(this.#J),this.#J=setTimeout(()=>{this.focusMainContainer(),this.#J=null},0)),this.#D.delete(t.id),t.annotationElementId&&this.#lt?.delete(t.annotationElementId),this.unselect(t),t.annotationElementId&&this.#H.has(t.annotationElementId)||this.#N?.remove(t.id)}addDeletedAnnotationElement(t){this.#H.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#H.has(t)}removeDeletedAnnotationElement(t){this.#H.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#Ut(t){const e=this.#O.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#P!==t&&(this.#P=t,t&&this.#jt(t.propertiesToUpdate))}get#Vt(){let t=null;for(t of this.#ut);return t}updateUI(t){this.#Vt===t&&this.#jt(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#jt(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#ut.has(t))return this.#ut.delete(t),t.unselect(),void this.#Mt({hasSelectedEditor:this.hasSelection});this.#ut.add(t),t.select(),this.#jt(t.propertiesToUpdate),this.#Mt({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.id}),this.#j?.commitOrRemove();for(const e of this.#ut)e!==t&&e.unselect();this.#ut.clear(),this.#ut.add(t),t.select(),this.#jt(t.propertiesToUpdate),this.#Mt({hasSelectedEditor:!0})}isSelected(t){return this.#ut.has(t)}get firstSelectedEditor(){return this.#ut.values().next().value}unselect(t){t.unselect(),this.#ut.delete(t),this.#Mt({hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==this.#ut.size}get isEnterHandled(){return 1===this.#ut.size&&this.firstSelectedEditor.isEnterHandled}undo(){this.#B.undo(),this.#Mt({hasSomethingToUndo:this.#B.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#zt()}),this._editorUndoBar?.hide()}redo(){this.#B.redo(),this.#Mt({hasSomethingToUndo:!0,hasSomethingToRedo:this.#B.hasSomethingToRedo(),isEmpty:this.#zt()})}addCommands(t){this.#B.add(t),this.#Mt({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#zt()})}cleanUndoStack(t){this.#B.cleanType(t)}#zt(){if(0===this.#D.size)return!0;if(1===this.#D.size)for(const t of this.#D.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#ut],n=()=>{for(const t of e)this.#Ut(t)};this.addCommands({cmd:()=>{this._editorUndoBar?.show(n,1===e.length?e[0].editorType:e.length);for(const t of e)t.remove()},undo:n,mustExec:!0})}commitOrRemove(){this.#P?.commitOrRemove()}hasSomethingToControl(){return this.#P||this.hasSelection}#$t(t){for(const t of this.#ut)t.unselect();this.#ut.clear();for(const e of t)e.isEmpty()||(this.#ut.add(e),e.select());this.#Mt({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#ut)t.commit();this.#$t(this.#D.values())}unselectAll(){if((!this.#P||(this.#P.commitOrRemove(),this.#dt===M.NONE))&&!this.#j?.commitOrRemove()&&this.hasSelection){for(const t of this.#ut)t.unselect();this.#ut.clear(),this.#Mt({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;this.#bt[0]+=t,this.#bt[1]+=e;const[i,s]=this.#bt,r=[...this.#ut];this.#wt&&clearTimeout(this.#wt),this.#wt=setTimeout(()=>{this.#wt=null,this.#bt[0]=this.#bt[1]=0,this.addCommands({cmd:()=>{for(const t of r)this.#D.has(t.id)&&(t.translateInPage(i,s),t.translationDone())},undo:()=>{for(const t of r)this.#D.has(t.id)&&(t.translateInPage(-i,-s),t.translationDone())},mustExec:!1})},1e3);for(const n of r)n.translateInPage(t,e),n.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#G=new Map;for(const t of this.#ut)this.#G.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#G)return!1;this.disableUserSelect(!1);const t=this.#G;this.#G=null;let e=!1;for(const[{x:n,y:i,pageIndex:s},r]of t)r.newX=n,r.newY=i,r.newPageIndex=s,e||=n!==r.savedX||i!==r.savedY||s!==r.savedPageIndex;if(!e)return!1;const n=(t,e,n,i)=>{if(this.#D.has(t.id)){const s=this.#O.get(i);s?t._setParentAndPosition(s,e,n):(t.pageIndex=i,t.x=e,t.y=n)}};return this.addCommands({cmd:()=>{for(const[e,{newX:i,newY:s,newPageIndex:r}]of t)n(e,i,s,r)},undo:()=>{for(const[e,{savedX:i,savedY:s,savedPageIndex:r}]of t)n(e,i,s,r)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#G)for(const n of this.#G.keys())n.drag(t,e)}rebuild(t){if(null===t.parent){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||1===this.#ut.size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#P===t}getActive(){return this.#P}getMode(){return this.#dt}isEditingMode(){return this.#dt!==M.NONE}get imageManager(){return K(this,"imageManager",new Jt)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let n=0,i=e.rangeCount;n<i;n++)if(!t.contains(e.getRangeAt(n).commonAncestorContainer))return null;const{x:n,y:i,width:s,height:r}=t.getBoundingClientRect();let o;switch(t.getAttribute("data-main-rotation")){case"90":o=(t,e,o,a)=>({x:(e-i)/r,y:1-(t+o-n)/s,width:a/r,height:o/s});break;case"180":o=(t,e,o,a)=>({x:1-(t+o-n)/s,y:1-(e+a-i)/r,width:o/s,height:a/r});break;case"270":o=(t,e,o,a)=>({x:1-(e+a-i)/r,y:(t-n)/s,width:a/r,height:o/s});break;default:o=(t,e,o,a)=>({x:(t-n)/s,y:(e-i)/r,width:o/s,height:a/r})}const a=[];for(let t=0,n=e.rangeCount;t<n;t++){const n=e.getRangeAt(t);if(!n.collapsed)for(const{x:t,y:e,width:i,height:s}of n.getClientRects())0!==i&&0!==s&&a.push(o(t,e,i,s))}return 0===a.length?null:a}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#F||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#F?.delete(t)}renderAnnotationElement(t){const e=this.#F?.get(t.data.id);if(!e)return;const n=this.#N.getRawValue(e);n&&(this.#dt!==M.NONE||n.hasBeenModified)&&n.renderAnnotationElement(t)}setMissingCanvas(t,e,n){const i=this.#lt?.get(t);i&&(i.setCanvas(e,n),this.#lt.delete(t))}addMissingCanvas(t,e){(this.#lt||=new Map).set(t,e)}}class ne{#a=null;#Wt=!1;#qt=null;#Kt=null;#Yt=null;#Xt=null;#Jt=!1;#Qt=null;#r=null;#Zt=null;#te=null;#ee=!1;static#ne=null;static _l10n=null;constructor(t){this.#r=t,this.#ee=t._uiManager.useNewAltTextFlow,ne.#ne||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){ne._l10n??=t}async render(){const t=this.#qt=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#Kt=document.createElement("span");t.append(e),this.#ee?(t.classList.add("new"),t.setAttribute("data-l10n-id",ne.#ne.missing),e.setAttribute("data-l10n-id",ne.#ne["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=this.#r._uiManager._signal;t.addEventListener("contextmenu",Tt,{signal:n}),t.addEventListener("pointerdown",t=>t.stopPropagation(),{signal:n});const i=t=>{t.preventDefault(),this.#r._uiManager.editAltText(this.#r),this.#ee&&this.#r._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#ie}})};return t.addEventListener("click",i,{capture:!0,signal:n}),t.addEventListener("keydown",e=>{e.target===t&&"Enter"===e.key&&(this.#Jt=!0,i(e))},{signal:n}),await this.#se(),t}get#ie(){return(this.#a?"added":null===this.#a&&this.guessedText&&"review")||"missing"}finish(){this.#qt&&(this.#qt.focus({focusVisible:this.#Jt}),this.#Jt=!1)}isEmpty(){return this.#ee?null===this.#a:!this.#a&&!this.#Wt}hasData(){return this.#ee?null!==this.#a||!!this.#Zt:this.isEmpty()}get guessedText(){return this.#Zt}async setGuessedText(t){null===this.#a&&(this.#Zt=t,this.#te=await ne._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#se())}toggleAltTextBadge(t=!1){if(!this.#ee||this.#a)return this.#Qt?.remove(),void(this.#Qt=null);if(!this.#Qt){const t=this.#Qt=document.createElement("div");t.className="noAltTextBadge",this.#r.div.append(t)}this.#Qt.classList.toggle("hidden",!t)}serialize(t){let e=this.#a;return t||this.#Zt!==e||(e=this.#te),{altText:e,decorative:this.#Wt,guessedText:this.#Zt,textWithDisclaimer:this.#te}}get data(){return{altText:this.#a,decorative:this.#Wt}}set data({altText:t,decorative:e,guessedText:n,textWithDisclaimer:i,cancel:s=!1}){n&&(this.#Zt=n,this.#te=i),this.#a===t&&this.#Wt===e||(s||(this.#a=t,this.#Wt=e),this.#se())}toggle(t=!1){this.#qt&&(!t&&this.#Xt&&(clearTimeout(this.#Xt),this.#Xt=null),this.#qt.disabled=!t)}shown(){this.#r._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#ie}})}destroy(){this.#qt?.remove(),this.#qt=null,this.#Kt=null,this.#Yt=null,this.#Qt?.remove(),this.#Qt=null}async#se(){const t=this.#qt;if(!t)return;if(this.#ee){if(t.classList.toggle("done",!!this.#a),t.setAttribute("data-l10n-id",ne.#ne[this.#ie]),this.#Kt?.setAttribute("data-l10n-id",ne.#ne[`${this.#ie}-label`]),!this.#a)return void this.#Yt?.remove()}else{if(!this.#a&&!this.#Wt)return t.classList.remove("done"),void this.#Yt?.remove();t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#Yt;if(!e){this.#Yt=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#r.id}`;const n=100,i=this.#r._uiManager._signal;i.addEventListener("abort",()=>{clearTimeout(this.#Xt),this.#Xt=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#Xt=setTimeout(()=>{this.#Xt=null,this.#Yt.classList.add("show"),this.#r._reportTelemetry({action:"alt_text_tooltip"})},n)},{signal:i}),t.addEventListener("mouseleave",()=>{this.#Xt&&(clearTimeout(this.#Xt),this.#Xt=null),this.#Yt?.classList.remove("show")},{signal:i})}this.#Wt?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#a),e.parentNode||t.append(e);const n=this.#r.getElementForAltText();n?.setAttribute("aria-describedby",e.id)}}class ie{#re=null;#oe=null;#ae=!1;#r=null;#ce=null;#le=null;#he=null;#de=null;#ue=!1;#pe=null;constructor(t){this.#r=t}renderForToolbar(){const t=this.#oe=document.createElement("button");return t.className="comment",this.#y(t,!1)}renderForStandalone(){const t=this.#re=document.createElement("button");t.className="annotationCommentButton";const e=this.#r.commentButtonPosition;if(e){const{style:n}=t;n.insetInlineEnd=`calc(${100*("ltr"===this.#r._uiManager.direction?1-e[0]:e[0])}% - var(--comment-button-dim))`,n.top=`calc(${100*e[1]}% - var(--comment-button-dim))`;const i=this.#r.commentButtonColor;i&&(n.backgroundColor=i)}return this.#y(t,!0)}focusButton(){setTimeout(()=>{(this.#re??this.#oe)?.focus()},0)}onUpdatedColor(){if(!this.#re)return;const t=this.#r.commentButtonColor;t&&(this.#re.style.backgroundColor=t),this.#r._uiManager.updatePopupColor(this.#r)}get commentButtonWidth(){return(this.#re?.getBoundingClientRect().width??0)/this.#r.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#pe)return this.#pe;if(!this.#re)return null;const{x:t,y:e,height:n}=this.#re.getBoundingClientRect(),{x:i,y:s,width:r,height:o}=this.#r.parent.boundingClientRect;return[(t-i)/r,(e+n-s)/o]}set commentPopupPositionInLayer(t){this.#pe=t}hasDefaultPopupPosition(){return null===this.#pe}removeStandaloneCommentButton(){this.#re?.remove(),this.#re=null}removeToolbarCommentButton(){this.#oe?.remove(),this.#oe=null}setCommentButtonStates({selected:t,hasPopup:e}){this.#re&&(this.#re.classList.toggle("selected",t),this.#re.ariaExpanded=e)}#y(t,e){if(!this.#r._uiManager.hasCommentManager())return null;t.tabIndex="0",t.ariaHasPopup="dialog",e?(t.ariaControls="commentPopup",t.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(t.ariaControlsElements=[this.#r._uiManager.getCommentDialogElement()],t.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button"));const n=this.#r._uiManager._signal;if(!(n instanceof AbortSignal)||n.aborted)return t;t.addEventListener("contextmenu",Tt,{signal:n}),e&&(t.addEventListener("focusin",t=>{this.#r._focusEventsAllowed=!1,kt(t)},{capture:!0,signal:n}),t.addEventListener("focusout",t=>{this.#r._focusEventsAllowed=!0,kt(t)},{capture:!0,signal:n})),t.addEventListener("pointerdown",t=>t.stopPropagation(),{signal:n});const i=e=>{e.preventDefault(),t===this.#oe?this.edit():this.#r.toggleComment(!0)};return t.addEventListener("click",i,{capture:!0,signal:n}),t.addEventListener("keydown",e=>{e.target===t&&"Enter"===e.key&&(this.#ae=!0,i(e))},{signal:n}),t.addEventListener("pointerenter",()=>{this.#r.toggleComment(!1,!0)},{signal:n}),t.addEventListener("pointerleave",()=>{this.#r.toggleComment(!1,!1)},{signal:n}),t}edit(t){const e=this.commentPopupPositionInLayer;let n,i;if(e)[n,i]=e;else{[n,i]=this.#r.commentButtonPosition;const{width:t,height:e,x:s,y:r}=this.#r;n=s+n*t,i=r+i*e}const s=this.#r.parent.boundingClientRect,{x:r,y:o,width:a,height:c}=s;this.#r._uiManager.editComment(this.#r,r+n*a,o+i*c,{...t,parentDimensions:s})}finish(){this.#oe&&(this.#oe.focus({focusVisible:this.#ae}),this.#ae=!1)}isDeleted(){return this.#ue||""===this.#he}isEmpty(){return null===this.#he}hasBeenEdited(){return this.isDeleted()||this.#he!==this.#ce}serialize(){return this.data}get data(){return{text:this.#he,richText:this.#le,date:this.#de,deleted:this.isDeleted()}}set data(t){if(t!==this.#he&&(this.#le=null),null===t)return this.#he="",void(this.#ue=!0);this.#he=t,this.#de=new Date,this.#ue=!1}setInitialText(t,e=null){this.#ce=t,this.data=t,this.#de=null,this.#le=e}shown(){}destroy(){this.#oe?.remove(),this.#oe=null,this.#re?.remove(),this.#re=null,this.#he="",this.#le=null,this.#de=null,this.#r=null,this.#ae=!1,this.#ue=!1}}class se{#At;#ge=!1;#fe=null;#me;#ve;#ye;#be;#we=null;#Ae;#xe=null;#Se;#Ee=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:n=null,onPinchStart:i=null,onPinching:s=null,onPinchEnd:r=null,signal:o}){this.#At=t,this.#fe=n,this.#me=e,this.#ve=i,this.#ye=s,this.#be=r,this.#Se=new AbortController,this.#Ae=AbortSignal.any([o,this.#Se.signal]),t.addEventListener("touchstart",this.#_e.bind(this),{passive:!1,signal:this.#Ae})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Lt.pixelRatio}#_e(t){if(this.#me?.())return;if(1===t.touches.length){if(this.#we)return;const t=this.#we=new AbortController,e=AbortSignal.any([this.#Ae,t.signal]),n=this.#At,i={capture:!0,signal:e,passive:!1},s=t=>{"touch"===t.pointerType&&(this.#we?.abort(),this.#we=null)};return n.addEventListener("pointerdown",t=>{"touch"===t.pointerType&&(kt(t),s(t))},i),n.addEventListener("pointerup",s,i),void n.addEventListener("pointercancel",s,i)}if(!this.#Ee){this.#Ee=new AbortController;const t=AbortSignal.any([this.#Ae,this.#Ee.signal]),e=this.#At,n={signal:t,capture:!1,passive:!1};e.addEventListener("touchmove",this.#Ce.bind(this),n);const i=this.#Te.bind(this);e.addEventListener("touchend",i,n),e.addEventListener("touchcancel",i,n),n.capture=!0,e.addEventListener("pointerdown",kt,n),e.addEventListener("pointermove",kt,n),e.addEventListener("pointercancel",kt,n),e.addEventListener("pointerup",kt,n),this.#ve?.()}if(kt(t),2!==t.touches.length||this.#fe?.())return void(this.#xe=null);let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]),this.#xe={touch0X:e.screenX,touch0Y:e.screenY,touch1X:n.screenX,touch1Y:n.screenY}}#Ce(t){if(!this.#xe||2!==t.touches.length)return;kt(t);let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]);const{screenX:i,screenY:s}=e,{screenX:r,screenY:o}=n,a=this.#xe,{touch0X:c,touch0Y:l,touch1X:h,touch1Y:d}=a,u=h-c,p=d-l,g=r-i,f=o-s,m=Math.hypot(g,f)||1,v=Math.hypot(u,p)||1;if(!this.#ge&&Math.abs(v-m)<=se.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(a.touch0X=i,a.touch0Y=s,a.touch1X=r,a.touch1Y=o,!this.#ge)return void(this.#ge=!0);const y=[(i+r)/2,(s+o)/2];this.#ye?.(y,v,m)}#Te(t){t.touches.length>=2||(this.#Ee&&(this.#Ee.abort(),this.#Ee=null,this.#be?.()),this.#xe&&(kt(t),this.#xe=null,this.#ge=!1))}destroy(){this.#Se?.abort(),this.#Se=null,this.#we?.abort(),this.#we=null}}class re{#ke=null;#Re=null;#a=null;#c=null;#re=null;#Ie=!1;#Pe=null;#Me="";#De=null;#Oe=null;#Le=null;#Ne=null;#Fe=null;#Be="";#Ue=!1;#$e=null;#je=!1;#ze=!1;#He=!1;#Ge=null;#Ve=0;#We=0;#qe=null;#Ke=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#Ye=!1;#Xe=re._zIndex++;static _borderLineWidth=-1;static _colorManager=new te;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=re.prototype._resizeWithKeyboard,e=ee.TRANSLATE_SMALL,n=ee.TRANSLATE_BIG;return K(this,"_resizerKeyboardManager",new Zt([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,n]}],[["Escape","mac+Escape"],re.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null,this.creationDate=t.creationDate||new Date,this.modificationDate=t.modificationDate||null;const{rotation:e,rawDims:{pageWidth:n,pageHeight:i,pageX:s,pageY:r}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,i],this.pageTranslation=[s,r];const[o,a]=this.parentDimensions;this.x=t.x/o,this.y=t.y/a,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return K(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new oe({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(re._l10n??=t,re._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),-1!==re._borderLineWidth)return;const n=getComputedStyle(document.documentElement);re._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){G("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#Ye}set _isDraggable(t){this.#Ye=t,this.div?.classList.toggle("draggable",t)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(2*t),this.y+=this.width*t/(2*e);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(2*t),this.y-=this.width*t/(2*e);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#Xe}setParent(t){null!==t?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):(this.#Je(),this.#Ne?.remove(),this.#Ne=null),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#Ue?this.#Ue=!1:this.parent.setSelected(this))}focusout(t){if(!this._focusEventsAllowed)return;if(!this.isAttachedToDOM)return;const e=t.relatedTarget;e?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,n,i){const[s,r]=this.parentDimensions;[n,i]=this.screenToPageTranslation(n,i),this.x=(t+n)/s,this.y=(e+i)/r,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[n,i]=this.parentDimensions;this.setAt(t*n,e*i,this.width*n,this.height*i),this._onTranslated()}#Qe([t,e],n,i){[n,i]=this.screenToPageTranslation(n,i),this.x+=n/t,this.y+=i/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#Qe(this.parentDimensions,t,e)}translateInPage(t,e){this.#$e||=[this.x,this.y,this.width,this.height],this.#Qe(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#$e||=[this.x,this.y,this.width,this.height];const{div:n,parentDimensions:[i,s]}=this;if(this.x+=t/i,this.y+=e/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:t,y:e}=this.div.getBoundingClientRect();this.parent.findNewParent(this,t,e)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:o}=this;const[a,c]=this.getBaseTranslation();r+=a,o+=c;const{style:l}=n;l.left=`${(100*r).toFixed(2)}%`,l.top=`${(100*o).toFixed(2)}%`,this._onTranslating(r,o),n.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#$e&&(this.#$e[0]!==this.x||this.#$e[1]!==this.y)}get _hasBeenResized(){return!!this.#$e&&(this.#$e[2]!==this.width||this.#$e[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:n}=re,i=n/t,s=n/e;switch(this.rotation){case 90:return[-i,s];case 180:return[i,s];case 270:return[i,-s];default:return[-i,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[n,i]}=this;let{x:s,y:r,width:o,height:a}=this;if(o*=n,a*=i,s*=n,r*=i,this._mustFixPosition)switch(t){case 0:s=ut(s,0,n-o),r=ut(r,0,i-a);break;case 90:s=ut(s,0,n-a),r=ut(r,o,i);break;case 180:s=ut(s,o,n),r=ut(r,a,i);break;case 270:s=ut(s,a,n),r=ut(r,0,i-o)}this.x=s/=n,this.y=r/=i;const[c,l]=this.getBaseTranslation();s+=c,r+=l,e.left=`${(100*s).toFixed(2)}%`,e.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}static#Ze(t,e,n){switch(n){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return re.#Ze(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return re.#Ze(t,e,360-this.parentRotation)}#tn(t){switch(t){case 90:{const[t,e]=this.pageDimensions;return[0,-t/e,e/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,e]=this.pageDimensions;return[0,t/e,-e/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,n]}=this;return[e*t,n*t]}setDims(){const{div:{style:t},width:e,height:n}=this;t.width=`${(100*e).toFixed(2)}%`,t.height=`${(100*n).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#en(){if(this.#De)return;this.#De=document.createElement("div"),this.#De.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const n of t){const t=document.createElement("div");this.#De.append(t),t.classList.add("resizer",n),t.setAttribute("data-resizer-name",n),t.addEventListener("pointerdown",this.#nn.bind(this,n),{signal:e}),t.addEventListener("contextmenu",Tt,{signal:e}),t.tabIndex=-1}this.div.prepend(this.#De)}#nn(t,e){e.preventDefault();const{isMac:n}=st.platform;if(0!==e.button||e.ctrlKey&&n)return;this.#a?.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,this.#Oe=[e.screenX,e.screenY];const s=new AbortController,r=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#in.bind(this,t),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",kt,{passive:!1,signal:r}),window.addEventListener("contextmenu",Tt,{signal:r}),this.#Le={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const o=this.parent.div.style.cursor,a=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const c=()=>{s.abort(),this.parent.togglePointerEvents(!0),this.#a?.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=o,this.div.style.cursor=a,this.#sn()};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})}#rn(t,e,n,i){this.width=n,this.height=i,this.x=t,this.y=e,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#sn(){if(!this.#Le)return;const{savedX:t,savedY:e,savedWidth:n,savedHeight:i}=this.#Le;this.#Le=null;const s=this.x,r=this.y,o=this.width,a=this.height;s===t&&r===e&&o===n&&a===i||this.addCommands({cmd:this.#rn.bind(this,s,r,o,a),undo:this.#rn.bind(this,t,e,n,i),mustExec:!0})}static _round(t){return Math.round(1e4*t)/1e4}#in(t,e){const[n,i]=this.parentDimensions,s=this.x,r=this.y,o=this.width,a=this.height,c=re.MIN_SIZE/n,l=re.MIN_SIZE/i,h=this.#tn(this.rotation),d=(t,e)=>[h[0]*t+h[2]*e,h[1]*t+h[3]*e],u=this.#tn(360-this.rotation);let p,g,f=!1,m=!1;switch(t){case"topLeft":f=!0,p=(t,e)=>[0,0],g=(t,e)=>[t,e];break;case"topMiddle":p=(t,e)=>[t/2,0],g=(t,e)=>[t/2,e];break;case"topRight":f=!0,p=(t,e)=>[t,0],g=(t,e)=>[0,e];break;case"middleRight":m=!0,p=(t,e)=>[t,e/2],g=(t,e)=>[0,e/2];break;case"bottomRight":f=!0,p=(t,e)=>[t,e],g=(t,e)=>[0,0];break;case"bottomMiddle":p=(t,e)=>[t/2,e],g=(t,e)=>[t/2,0];break;case"bottomLeft":f=!0,p=(t,e)=>[0,e],g=(t,e)=>[t,0];break;case"middleLeft":m=!0,p=(t,e)=>[0,e/2],g=(t,e)=>[t,e/2]}const v=p(o,a),y=g(o,a);let b=d(...y);const w=re._round(s+b[0]),A=re._round(r+b[1]);let x,S,E=1,_=1;if(e.fromKeyboard)({deltaX:x,deltaY:S}=e);else{const{screenX:t,screenY:n}=e,[i,s]=this.#Oe;[x,S]=this.screenToPageTranslation(t-i,n-s),this.#Oe[0]=t,this.#Oe[1]=n}var C,T;if([x,S]=(C=x/n,T=S/i,[u[0]*C+u[2]*T,u[1]*C+u[3]*T]),f){const t=Math.hypot(o,a);E=_=Math.max(Math.min(Math.hypot(y[0]-v[0]-x,y[1]-v[1]-S)/t,1/o,1/a),c/o,l/a)}else m?E=ut(Math.abs(y[0]-v[0]-x),c,1)/o:_=ut(Math.abs(y[1]-v[1]-S),l,1)/a;const k=re._round(o*E),R=re._round(a*_);b=d(...g(k,R));const I=w-b[0],P=A-b[1];this.#$e||=[this.x,this.y,this.width,this.height],this.width=k,this.height=R,this.x=I,this.y=P,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#a?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#ze)return this._editToolbar;this._editToolbar=new qt(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,n]of t)await this._editToolbar.addButton(e,n);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#a?.destroy()}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#a||(ne.initialize(re._l10n),this.#a=new ne(this),this.#ke&&(this.#a.data=this.#ke,this.#ke=null)),this.#a}get altTextData(){return this.#a?.data}set altTextData(t){this.#a&&(this.#a.data=t)}get guessedAltText(){return this.#a?.guessedText}async setGuessedAltText(t){await(this.#a?.setGuessedText(t))}serializeAltText(t){return this.#a?.serialize(t)}hasAltText(){return!!this.#a&&!this.#a.isEmpty()}hasAltTextData(){return this.#a?.hasData()??!1}focusCommentButton(){this.#c?.focusButton()}addCommentButton(){return this.#c||=new ie(this)}addStandaloneCommentButton(){this.#re?this._uiManager.isEditingMode()&&this.#re.classList.remove("hidden"):this.hasComment&&(this.#re=this.#c.renderForStandalone(),this.div.append(this.#re))}removeStandaloneCommentButton(){this.#c.removeStandaloneCommentButton(),this.#re=null}hideStandaloneCommentButton(){this.#re?.classList.add("hidden")}get comment(){const{data:{richText:t,text:e,date:n,deleted:i}}=this.#c;return{text:e,richText:t,date:n,deleted:i,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(t){this.#c||=new ie(this),this.#c.data=t,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:t,popupRef:e,richText:n}){if(!e)return;if(this.#c||=new ie(this),this.#c.setInitialText(t,n),!this.annotationElementId)return;const i=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);i&&this.updateFromAnnotationLayer(i)}get hasEditedComment(){return this.#c?.hasBeenEdited()}get hasDeletedComment(){return this.#c?.isDeleted()}get hasComment(){return!!this.#c&&!this.#c.isEmpty()&&!this.#c.isDeleted()}async editComment(t){this.#c||=new ie(this),this.#c.edit(t)}toggleComment(t,e=void 0){this.hasComment&&this._uiManager.toggleComment(this,t,e)}setSelectedCommentButton(t){this.#c.setSelectedButton(t)}addComment(t){if(this.hasEditedComment){const e=180,n=100,[,,,i]=t.rect,[s]=this.pageDimensions,[r]=this.pageTranslation,o=r+s+1,a=i-n,c=o+e;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[o,a,c,i]}}}updateFromAnnotationLayer({popup:{contents:t,deleted:e}}){this.#c.data=e?null:t}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#Ie?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#on();const[e,n]=this.parentDimensions;this.parentRotation%180!=0&&(t.style.maxWidth=`${(100*n/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/n).toFixed(2)}%`);const[i,s]=this.getInitialTranslation();return this.translate(i,s),Yt(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#Ke||=new se({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#an.bind(this),onPinching:this.#cn.bind(this),onPinchEnd:this.#ln.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),t}#an(){this.#Le={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#a?.toggle(!1),this.parent.togglePointerEvents(!1)}#cn(t,e,n){let i=n/e*.7+1-.7;if(1===i)return;const s=this.#tn(this.rotation),r=(t,e)=>[s[0]*t+s[2]*e,s[1]*t+s[3]*e],[o,a]=this.parentDimensions,c=this.x,l=this.y,h=this.width,d=this.height,u=re.MIN_SIZE/o,p=re.MIN_SIZE/a;i=Math.max(Math.min(i,1/h,1/d),u/h,p/d);const g=re._round(h*i),f=re._round(d*i);if(g===h&&f===d)return;this.#$e||=[c,l,h,d];const m=r(h/2,d/2),v=re._round(c+m[0]),y=re._round(l+m[1]),b=r(g/2,f/2);this.x=v-b[0],this.y=y-b[1],this.width=g,this.height=f,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#ln(){this.#a?.toggle(!0),this.parent.togglePointerEvents(!0),this.#sn()}pointerdown(t){const{isMac:e}=st.platform;0!==t.button||t.ctrlKey&&e?t.preventDefault():(this.#Ue=!0,this._isDraggable?this.#hn(t):this.#dn(t))}#dn(t){const{isMac:e}=st.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#hn(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let n=!1;const i=new AbortController,s=this._uiManager.combinedSignal(i),r={capture:!0,passive:!1,signal:s},o=t=>{i.abort(),this.#Pe=null,this.#Ue=!1,this._uiManager.endDragSession()||this.#dn(t),n&&this._onStopDragging()};e&&(this.#Ve=t.clientX,this.#We=t.clientY,this.#Pe=t.pointerId,this.#Me=t.pointerType,window.addEventListener("pointermove",t=>{n||(n=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:e,clientY:i,pointerId:s}=t;if(s!==this.#Pe)return void kt(t);const[r,o]=this.screenToPageTranslation(e-this.#Ve,i-this.#We);this.#Ve=e,this.#We=i,this._uiManager.dragSelectedEditors(r,o)},r),window.addEventListener("touchmove",kt,r),window.addEventListener("pointerdown",t=>{t.pointerType===this.#Me&&(this.#Ke||t.isPrimary)&&o(t),kt(t)},r));const a=t=>{this.#Pe&&this.#Pe!==t.pointerId?kt(t):o(t)};window.addEventListener("pointerup",a,{signal:s}),window.addEventListener("blur",a,{signal:s})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#Ge&&clearTimeout(this.#Ge),this.#Ge=setTimeout(()=>{this.#Ge=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,n){t.changeParent(this),this.x=e,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,n=this.rotation){const i=this.parentScale,[s,r]=this.pageDimensions,[o,a]=this.pageTranslation,c=t/i,l=e/i,h=this.x*s,d=this.y*r,u=this.width*s,p=this.height*r;switch(n){case 0:return[h+c+o,r-d-l-p+a,h+c+u+o,r-d-l+a];case 90:return[h+l+o,r-d+c+a,h+l+p+o,r-d+c+u+a];case 180:return[h-c-u+o,r-d+l+a,h-c+o,r-d+l+p+a];case 270:return[h-l-p+o,r-d-c-u+a,h-l+o,r-d-c+a];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[n,i,s,r]=t,o=s-n,a=r-i;switch(this.rotation){case 0:return[n,e-r,o,a];case 90:return[n,e-i,a,o];case 180:return[s,e-i,o,a];case 270:return[s,e-r,a,o];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&re._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#c?.onUpdatedColor()}getData(){const{comment:{text:t,color:e,date:n,opacity:i,deleted:s,richText:r},uid:o,pageIndex:a,creationDate:c,modificationDate:l}=this;return{id:o,pageIndex:a,rect:this.getPDFRect(),richText:r,contentsObj:{str:t},creationDate:c,modificationDate:n||l,popupRef:!s,color:e,opacity:i}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return!this.isInEditMode()&&(this.parent.setEditingState(!1),this.#ze=!0,!0)}disableEditMode(){return!!this.isInEditMode()&&(this.parent.setEditingState(!0),this.#ze=!1,!0)}isInEditMode(){return this.#ze}shouldGetKeyboardEvents(){return this.#He}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:n,right:i}=this.getClientDimensions(),{innerHeight:s,innerWidth:r}=window;return e<r&&i>0&&t<s&&n>0}#on(){if(this.#Fe||!this.div)return;this.#Fe=new AbortController;const t=this._uiManager.combinedSignal(this.#Fe);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#on()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(t,e,n){const i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:n,annotationElementId:t.annotationElementId,creationDate:t.creationDate,modificationDate:t.modificationDate});i.rotation=t.rotation,i.#ke=t.accessibilityData,i._isCopy=t.isCopy||!1;const[s,r]=i.pageDimensions,[o,a,c,l]=i.getRectInCurrentCoords(t.rect,r);return i.x=o/s,i.y=a/r,i.width=c/s,i.height=l/r,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}remove(){if(this.#Fe?.abort(),this.#Fe=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#Ge&&(clearTimeout(this.#Ge),this.#Ge=null),this.#Je(),this.removeEditToolbar(),this.#qe){for(const t of this.#qe.values())clearTimeout(t);this.#qe=null}this.parent=null,this.#Ke?.destroy(),this.#Ke=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#en(),this.#De.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return"ltr"===this._uiManager.direction?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[t,e]}=this,[n,i,s,r]=this.getPDFRect();return[re._round(n+(s-n)*t),re._round(i+(r-i)*(1-e))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#c.commentPopupPositionInLayer}set commentPopupPosition(t){this.#c.commentPopupPositionInLayer=t}hasDefaultPopupPosition(){return this.#c.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#c.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(t){this.#c.setCommentButtonStates(t)}keydown(t){if(!this.isResizable||t.target!==this.div||"Enter"!==t.key)return;this._uiManager.setSelected(this),this.#Le={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#De.children;if(!this.#Re){this.#Re=Array.from(e);const t=this.#un.bind(this),n=this.#pn.bind(this),i=this._uiManager._signal;for(const e of this.#Re){const s=e.getAttribute("data-resizer-name");e.setAttribute("role","spinbutton"),e.addEventListener("keydown",t,{signal:i}),e.addEventListener("blur",n,{signal:i}),e.addEventListener("focus",this.#gn.bind(this,s),{signal:i}),e.setAttribute("data-l10n-id",re._l10nResizer[s])}}const n=this.#Re[0];let i=0;for(const t of e){if(t===n)break;i++}const s=(360-this.rotation+this.parentRotation)%360/90*(this.#Re.length/4);if(s!==i){if(s<i)for(let t=0;t<i-s;t++)this.#De.append(this.#De.firstChild);else if(s>i)for(let t=0;t<s-i;t++)this.#De.firstChild.before(this.#De.lastChild);let t=0;for(const n of e){const e=this.#Re[t++].getAttribute("data-resizer-name");n.setAttribute("data-l10n-id",re._l10nResizer[e])}}this.#fn(0),this.#He=!0,this.#De.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#un(t){re._resizerKeyboardManager.exec(this,t)}#pn(t){this.#He&&t.relatedTarget?.parentNode!==this.#De&&this.#Je()}#gn(t){this.#Be=this.#He?t:""}#fn(t){if(this.#Re)for(const e of this.#Re)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#He&&this.#in(this.#Be,{deltaX:t,deltaY:e,fromKeyboard:!0})}#Je(){this.#He=!1,this.#fn(-1),this.#sn()}_stopResizingWithKeyboard(){this.#Je(),this.div.focus()}select(){this.isSelected&&this._editToolbar?this._editToolbar.show():(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),this._editToolbar?(this._editToolbar?.show(),this.#a?.toggleAltTextBadge(!1)):this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()}))}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#De?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#a?.toggleAltTextBadge(!0),this.hasComment&&this._uiManager.toggleComment(this,!1,!1))}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){"BUTTON"!==t.target.nodeName&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#je}set isEditing(t){this.#je=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#qe||=new Map;const{action:e}=t;let n=this.#qe.get(e);return n&&clearTimeout(n),n=setTimeout(()=>{this._reportTelemetry(t),this.#qe.delete(e),0===this.#qe.size&&(this.#qe=null)},re._telemetryTimeout),void this.#qe.set(e,n)}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#Ie=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#Ie=!0}updateFakeAnnotationElement(t){if(this.#Ne||this.deleted)return this.deleted?(this.#Ne.remove(),void(this.#Ne=null)):void((this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#Ne.updateEdited({rect:this.getPDFRect(),popup:this.comment}));this.#Ne=t.addFakeAnnotation(this)}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(e){if("CANVAS"===e.nodeName){const t=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.before(e)}}else e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);return e}resetAnnotationElement(t){const{firstChild:e}=t.container;"DIV"===e?.nodeName&&e.classList.contains("annotationContent")&&e.remove()}}class oe extends re{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const ae=3285377520,ce=4294901760,le=65535;class he{constructor(t){this.h1=t?4294967295&t:ae,this.h2=t?4294967295&t:ae}update(t){let e,n;if("string"==typeof t){e=new Uint8Array(2*t.length),n=0;for(let i=0,s=t.length;i<s;i++){const s=t.charCodeAt(i);s<=255?e[n++]=s:(e[n++]=s>>>8,e[n++]=255&s)}}else{if(!ArrayBuffer.isView(t))throw new Error("Invalid data format, must be a string or TypedArray.");e=t.slice(),n=e.byteLength}const i=n>>2,s=n-4*i,r=new Uint32Array(e.buffer,0,i);let o=0,a=0,c=this.h1,l=this.h2;const h=3432918353,d=461845907,u=11601,p=13715;for(let t=0;t<i;t++)1&t?(o=r[t],o=o*h&ce|o*u&le,o=o<<15|o>>>17,o=o*d&ce|o*p&le,c^=o,c=c<<13|c>>>19,c=5*c+3864292196):(a=r[t],a=a*h&ce|a*u&le,a=a<<15|a>>>17,a=a*d&ce|a*p&le,l^=a,l=l<<13|l>>>19,l=5*l+3864292196);switch(o=0,s){case 3:o^=e[4*i+2]<<16;case 2:o^=e[4*i+1]<<8;case 1:o^=e[4*i],o=o*h&ce|o*u&le,o=o<<15|o>>>17,o=o*d&ce|o*p&le,1&i?c^=o:l^=o}this.h1=c,this.h2=l}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=3981806797*t&ce|36045*t&le,e=4283543511*e&ce|(2950163797*(e<<16|t>>>16)&ce)>>>16,t^=e>>>1,t=444984403*t&ce|60499*t&le,e=3301882366*e&ce|(3120437893*(e<<16|t>>>16)&ce)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const de=Object.freeze({map:null,hash:"",transfer:void 0});class ue{#mn=!1;#vn=null;#yn=null;#bn=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const n=this.#bn.get(t);return void 0===n?e:Object.assign(e,n)}getRawValue(t){return this.#bn.get(t)}remove(t){const e=this.#bn.get(t);if(void 0!==e&&(e instanceof re&&this.#yn.delete(e.annotationElementId),this.#bn.delete(t),0===this.#bn.size&&this.resetModified(),"function"==typeof this.onAnnotationEditor)){for(const t of this.#bn.values())if(t instanceof re)return;this.onAnnotationEditor(null)}}setValue(t,e){const n=this.#bn.get(t);let i=!1;if(void 0!==n)for(const[t,s]of Object.entries(e))n[t]!==s&&(i=!0,n[t]=s);else i=!0,this.#bn.set(t,e);i&&this.#wn(),e instanceof re&&((this.#yn||=new Map).set(e.annotationElementId,e),"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(e.constructor._type))}has(t){return this.#bn.has(t)}get size(){return this.#bn.size}#wn(){this.#mn||(this.#mn=!0,"function"==typeof this.onSetModified&&this.onSetModified())}resetModified(){this.#mn&&(this.#mn=!1,"function"==typeof this.onResetModified&&this.onResetModified())}get print(){return new pe(this)}get serializable(){if(0===this.#bn.size)return de;const t=new Map,e=new he,n=[],i=Object.create(null);let s=!1;for(const[n,r]of this.#bn){const o=r instanceof re?r.serialize(!1,i):r;o&&(t.set(n,o),e.update(`${n}:${JSON.stringify(o)}`),s||=!!o.bitmap)}if(s)for(const e of t.values())e.bitmap&&n.push(e.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:n}:de}get editorStats(){let t=null;const e=new Map;let n=0,i=0;for(const s of this.#bn.values()){if(!(s instanceof re)){s.popup&&(s.popup.deleted?i+=1:n+=1);continue}s.isCommentDeleted?i+=1:s.hasEditedComment&&(n+=1);const r=s.telemetryFinalData;if(!r)continue;const{type:o}=r;e.has(o)||e.set(o,Object.getPrototypeOf(s).constructor),t||=Object.create(null);const a=t[o]||=new Map;for(const[t,e]of Object.entries(r)){if("type"===t)continue;let n=a.get(t);n||(n=new Map,a.set(t,n));const i=n.get(e)??0;n.set(e,i+1)}}if((i>0||n>0)&&(t||=Object.create(null),t.comments={deleted:i,edited:n}),!t)return null;for(const[n,i]of e)t[n]=i.computeTelemetryFinalData(t[n]);return t}resetModifiedIds(){this.#vn=null}updateEditor(t,e){const n=this.#yn?.get(t);return!!n&&(n.updateFromAnnotationLayer(e),!0)}getEditor(t){return this.#yn?.get(t)||null}get modifiedIds(){if(this.#vn)return this.#vn;const t=[];if(this.#yn)for(const e of this.#yn.values())e.serialize()&&t.push(e.annotationElementId);return this.#vn={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#bn.entries()}}class pe extends ue{#An;constructor(t){super();const{map:e,hash:n,transfer:i}=t.serializable,s=structuredClone(e,i?{transfer:i}:null);this.#An={map:s,hash:n,transfer:i}}get print(){G("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#An}get modifiedIds(){return K(this,"modifiedIds",{ids:new Set,hash:""})}}class ge{#xn=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#xn.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:n}){if(t&&!this.#xn.has(t.loadedName)){if(V(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:e,src:i,style:s}=t,r=new FontFace(e,i,s);this.addNativeFontFace(r);try{await r.load(),this.#xn.add(e),n?.(t)}catch{H(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(r)}return}G("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo)return void await this.loadSystemFont(t);if(this.isFontLoadingAPISupported){const e=t.createNativeFontFace();if(e){this.addNativeFontFace(e);try{await e.loaded}catch(n){throw H(`Failed to load font '${e.family}': '${n}'.`),t.disableFontFace=!0,n}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(e=>{const n=this._queueLoadingCallback(e);this._prepareFontLoadEvent(t,n)})}}get isFontLoadingAPISupported(){return K(this,"isFontLoadingAPISupported",!!this._document?.fonts)}get isSyncFontLoadingSupported(){return K(this,"isSyncFontLoadingSupported",T||st.platform.isFirefox)}_queueLoadingCallback(t){const{loadingRequests:e}=this,n={done:!1,complete:function(){for(V(!n.done,"completeRequest() cannot be called twice."),n.done=!0;e.length>0&&e[0].done;){const t=e.shift();setTimeout(t.callback,0)}},callback:t};return e.push(n),n}get _loadTestFont(){return K(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(t,e){function n(t,e){return t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|255&t.charCodeAt(e+3)}function i(t,e,n,i){return t.substring(0,e)+i+t.substring(e+n)}let s,r;const o=this._document.createElement("canvas");o.width=1,o.height=1;const a=o.getContext("2d");let c=0;const l=`lt${Date.now()}${this.loadTestFontId++}`;let h=this._loadTestFont;h=i(h,976,l.length,l);const d=1482184792;let u=n(h,16);for(s=0,r=l.length-3;s<r;s+=4)u=u-d+n(l,s)|0;var p;s<l.length&&(u=u-d+n(l+"XXX",s)|0),h=i(h,16,4,(p=u,String.fromCharCode(p>>24&255,p>>16&255,p>>8&255,255&p)));const g=`@font-face {font-family:"${l}";src:url(data:font/opentype;base64,${btoa(h)});}`;this.insertRule(g);const f=this._document.createElement("div");f.style.visibility="hidden",f.style.width=f.style.height="10px",f.style.position="absolute",f.style.top=f.style.left="0px";for(const e of[t.loadedName,l]){const t=this._document.createElement("span");t.textContent="Hi",t.style.fontFamily=e,f.append(t)}this._document.body.append(f),function t(e,n){if(++c>30)return H("Load test font never loaded."),void n();a.font="30px "+e,a.fillText(".",0,20),a.getImageData(0,0,1,1).data[3]>0?n():setTimeout(t.bind(null,e,n))}(l,()=>{f.remove(),e.complete()})}}class fe{#Sn;constructor(t,e=null,n,i){this.compiledGlyphs=Object.create(null),this.#Sn=t,this._inspectFont=e,n&&Object.assign(this,n),i&&(this.charProcOperatorList=i)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(this.cssFontInfo){const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}else t=new FontFace(this.loadedName,this.data,{});return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${pt(this.data)});`;let e;if(this.cssFontInfo){let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${t}}`}else e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(void 0!==this.compiledGlyphs[e])return this.compiledGlyphs[e];const n=this.loadedName+"_path_"+e;let i;try{i=t.get(n)}catch(t){H(`getPathGenerator - ignoring character: "${t}".`)}const s=new Path2D(i||"");return this.fontExtraProperties||t.delete(n),this.compiledGlyphs[e]=s}get black(){return this.#Sn.black}get bold(){return this.#Sn.bold}get disableFontFace(){return this.#Sn.disableFontFace??!1}get fontExtraProperties(){return this.#Sn.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#Sn.isInvalidPDFjsFont}get isType3Font(){return this.#Sn.isType3Font}get italic(){return this.#Sn.italic}get missingFile(){return this.#Sn.missingFile}get remeasure(){return this.#Sn.remeasure}get vertical(){return this.#Sn.vertical}get ascent(){return this.#Sn.ascent}get defaultWidth(){return this.#Sn.defaultWidth}get descent(){return this.#Sn.descent}get bbox(){return this.#Sn.bbox}get fontMatrix(){return this.#Sn.fontMatrix}get fallbackName(){return this.#Sn.fallbackName}get loadedName(){return this.#Sn.loadedName}get mimetype(){return this.#Sn.mimetype}get name(){return this.#Sn.name}get data(){return this.#Sn.data}clearData(){this.#Sn.clearData()}get cssFontInfo(){return this.#Sn.cssFontInfo}get systemFontInfo(){return this.#Sn.systemFontInfo}get defaultVMetrics(){return this.#Sn.defaultVMetrics}}function me(t){if("string"!=typeof t)return null;if(t.endsWith("/"))return t;throw new Error(`Invalid factory url: "${t}" must include trailing slash.`)}const ve=t=>"object"==typeof t&&Number.isInteger(t?.num)&&t.num>=0&&Number.isInteger(t?.gen)&&t.gen>=0,ye=function(t,e,n){if(!Array.isArray(n)||n.length<2)return!1;const[i,s,...r]=n;if(!t(i)&&!Number.isInteger(i))return!1;if(!e(s))return!1;const o=r.length;let a=!0;switch(s.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return 0===o;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(4!==o)return!1;a=!1;break;default:return!1}for(const t of r)if(!("number"==typeof t||a&&null===t))return!1;return!0}.bind(null,ve,t=>"object"==typeof t&&"string"==typeof t?.name);class be{#En=new Map;#_n=Promise.resolve();postMessage(t,e){const n={data:structuredClone(t,e?{transfer:e}:null)};this.#_n.then(()=>{for(const[t]of this.#En)t.call(this,n)})}addEventListener(t,e,n=null){let i=null;if(n?.signal instanceof AbortSignal){const{signal:s}=n;if(s.aborted)return void H("LoopbackPort - cannot use an `aborted` signal.");const r=()=>this.removeEventListener(t,e);i=()=>s.removeEventListener("abort",r),s.addEventListener("abort",r)}this.#En.set(e,i)}removeEventListener(t,e){const n=this.#En.get(e);n?.(),this.#En.delete(e)}terminate(){for(const[,t]of this.#En)t?.();this.#En.clear()}}function we(){}function Ae(t){if(t instanceof et||t instanceof Q||t instanceof X||t instanceof Z||t instanceof J)return t;switch(t instanceof Error||"object"==typeof t&&null!==t||G('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),t.name){case"AbortException":return new et(t.message);case"InvalidPDFException":return new Q(t.message);case"PasswordException":return new X(t.message,t.code);case"ResponseException":return new Z(t.message,t.status,t.missing);case"UnknownErrorException":return new J(t.message,t.details)}return new J(t.message,t.toString())}class xe{#Cn=new AbortController;constructor(t,e,n){this.sourceName=t,this.targetName=e,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",this.#Tn.bind(this),{signal:this.#Cn.signal})}#Tn({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream)return void this.#kn(t);if(t.callback){const e=t.callbackId,n=this.callbackCapabilities[e];if(!n)throw new Error(`Cannot resolve callback ${e}`);if(delete this.callbackCapabilities[e],1===t.callback)n.resolve(t.data);else{if(2!==t.callback)throw new Error("Unexpected callback case");n.reject(Ae(t.reason))}return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const n=this.sourceName,i=t.sourceName,s=this.comObj;return void Promise.try(e,t.data).then(function(e){s.postMessage({sourceName:n,targetName:i,callback:1,callbackId:t.callbackId,data:e})},function(e){s.postMessage({sourceName:n,targetName:i,callback:2,callbackId:t.callbackId,reason:Ae(e)})})}t.streamId?this.#Rn(t):e(t.data)}on(t,e){const n=this.actionHandler;if(n[t])throw new Error(`There is already an actionName called "${t}"`);n[t]=e}send(t,e,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},n)}sendWithPromise(t,e,n){const i=this.callbackId++,s=Promise.withResolvers();this.callbackCapabilities[i]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},n)}catch(t){s.reject(t)}return s.promise}sendWithStream(t,e,n,i){const s=this.streamId++,r=this.sourceName,o=this.targetName,a=this.comObj;return new ReadableStream({start:n=>{const c=Promise.withResolvers();return this.streamControllers[s]={controller:n,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},a.postMessage({sourceName:r,targetName:o,action:t,streamId:s,data:e,desiredSize:n.desiredSize},i),c.promise},pull:t=>{const e=Promise.withResolvers();return this.streamControllers[s].pullCall=e,a.postMessage({sourceName:r,targetName:o,stream:6,streamId:s,desiredSize:t.desiredSize}),e.promise},cancel:t=>{V(t instanceof Error,"cancel must have a valid reason");const e=Promise.withResolvers();return this.streamControllers[s].cancelCall=e,this.streamControllers[s].isClosed=!0,a.postMessage({sourceName:r,targetName:o,stream:1,streamId:s,reason:Ae(t)}),e.promise}},n)}#Rn(t){const e=t.streamId,n=this.sourceName,i=t.sourceName,s=this.comObj,r=this,o=this.actionHandler[t.action],a={enqueue(t,r=1,o){if(this.isCancelled)return;const a=this.desiredSize;this.desiredSize-=r,a>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),s.postMessage({sourceName:n,targetName:i,stream:4,streamId:e,chunk:t},o)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:n,targetName:i,stream:3,streamId:e}),delete r.streamSinks[e])},error(t){V(t instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:n,targetName:i,stream:5,streamId:e,reason:Ae(t)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};a.sinkCapability.resolve(),a.ready=a.sinkCapability.promise,this.streamSinks[e]=a,Promise.try(o,t.data,a).then(function(){s.postMessage({sourceName:n,targetName:i,stream:8,streamId:e,success:!0})},function(t){s.postMessage({sourceName:n,targetName:i,stream:8,streamId:e,reason:Ae(t)})})}#kn(t){const e=t.streamId,n=this.sourceName,i=t.sourceName,s=this.comObj,r=this.streamControllers[e],o=this.streamSinks[e];switch(t.stream){case 8:t.success?r.startCall.resolve():r.startCall.reject(Ae(t.reason));break;case 7:t.success?r.pullCall.resolve():r.pullCall.reject(Ae(t.reason));break;case 6:if(!o){s.postMessage({sourceName:n,targetName:i,stream:7,streamId:e,success:!0});break}o.desiredSize<=0&&t.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=t.desiredSize,Promise.try(o.onPull||we).then(function(){s.postMessage({sourceName:n,targetName:i,stream:7,streamId:e,success:!0})},function(t){s.postMessage({sourceName:n,targetName:i,stream:7,streamId:e,reason:Ae(t)})});break;case 4:if(V(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case 3:if(V(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),this.#In(r,e);break;case 5:V(r,"error should have stream controller"),r.controller.error(Ae(t.reason)),this.#In(r,e);break;case 2:t.success?r.cancelCall.resolve():r.cancelCall.reject(Ae(t.reason)),this.#In(r,e);break;case 1:if(!o)break;const a=Ae(t.reason);Promise.try(o.onCancel||we,a).then(function(){s.postMessage({sourceName:n,targetName:i,stream:2,streamId:e,success:!0})},function(t){s.postMessage({sourceName:n,targetName:i,stream:2,streamId:e,reason:Ae(t)})}),o.sinkCapability.reject(a),o.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#In(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#Cn?.abort(),this.#Cn=null}}class Se{#Pn=!1;constructor({enableHWA:t=!1}){this.#Pn=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(t,e);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!this.#Pn})}}reset(t,e,n){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||n<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=n}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){G("Abstract method `_createCanvas` called.")}}class Ee extends Se{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const n=this._document.createElement("canvas");return n.width=t,n.height=e,n}}class _e{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(t=>({cMapData:t,isCompressed:this.isCompressed})).catch(t=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){G("Abstract method `_fetch` called.")}}class Ce extends _e{async _fetch(t){const e=await yt(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):it(e)}}C(2489);class Te{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,n,i,s){return"none"}destroy(t=!1){}}class ke extends Te{#Mn;#Dn;#On;#Ln;#Nn;#Fn;#A=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#Ln=t,this.#Nn=e}get#S(){return this.#Dn||=new Map}get#Bn(){return this.#Fn||=new Map}get#Un(){if(!this.#On){const t=this.#Nn.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const n=this.#Nn.createElementNS(mt,"svg");n.setAttribute("width",0),n.setAttribute("height",0),this.#On=this.#Nn.createElementNS(mt,"defs"),t.append(n),n.append(this.#On),this.#Nn.body.append(t)}return this.#On}#$n(t){if(1===t.length){const e=t[0],n=new Array(256);for(let t=0;t<256;t++)n[t]=e[t]/255;const i=n.join(",");return[i,i,i]}const[e,n,i]=t,s=new Array(256),r=new Array(256),o=new Array(256);for(let t=0;t<256;t++)s[t]=e[t]/255,r[t]=n[t]/255,o[t]=i[t]/255;return[s.join(","),r.join(","),o.join(",")]}#jn(t){if(void 0===this.#Mn){this.#Mn="";const t=this.#Nn.URL;t!==this.#Nn.baseURI&&(At(t)?H('#createUrl: ignore "data:"-URL for performance reasons.'):this.#Mn=q(t,""))}return`url(${this.#Mn}#${t})`}addFilter(t){if(!t)return"none";let e=this.#S.get(t);if(e)return e;const[n,i,s]=this.#$n(t),r=1===t.length?n:`${n}${i}${s}`;if(e=this.#S.get(r),e)return this.#S.set(t,e),e;const o=`g_${this.#Ln}_transfer_map_${this.#A++}`,a=this.#jn(o);this.#S.set(t,a),this.#S.set(r,a);const c=this.#zn(o);return this.#Hn(n,i,s,c),a}addHCMFilter(t,e){const n=`${t}-${e}`,i="base";let s=this.#Bn.get(i);if(s?.key===n)return s.url;if(s?(s.filter?.remove(),s.key=n,s.url="none",s.filter=null):(s={key:n,url:"none",filter:null},this.#Bn.set(i,s)),!t||!e)return s.url;const r=this.#Gn(t);t=ot.makeHexColor(...r);const o=this.#Gn(e);if(e=ot.makeHexColor(...o),this.#Un.style.color="","#000000"===t&&"#ffffff"===e||t===e)return s.url;const a=new Array(256);for(let t=0;t<=255;t++){const e=t/255;a[t]=e<=.03928?e/12.92:((e+.055)/1.055)**2.4}const c=a.join(","),l=`g_${this.#Ln}_hcm_filter`,h=s.filter=this.#zn(l);this.#Hn(c,c,c,h),this.#Vn(h);const d=(t,e)=>{const n=r[t]/255,i=o[t]/255,s=new Array(e+1);for(let t=0;t<=e;t++)s[t]=n+t/e*(i-n);return s.join(",")};return this.#Hn(d(0,5),d(1,5),d(2,5),h),s.url=this.#jn(l),s.url}addAlphaFilter(t){let e=this.#S.get(t);if(e)return e;const[n]=this.#$n([t]),i=`alpha_${n}`;if(e=this.#S.get(i),e)return this.#S.set(t,e),e;const s=`g_${this.#Ln}_alpha_map_${this.#A++}`,r=this.#jn(s);this.#S.set(t,r),this.#S.set(i,r);const o=this.#zn(s);return this.#Wn(n,o),r}addLuminosityFilter(t){let e,n,i=this.#S.get(t||"luminosity");if(i)return i;if(t?([e]=this.#$n([t]),n=`luminosity_${e}`):n="luminosity",i=this.#S.get(n),i)return this.#S.set(t,i),i;const s=`g_${this.#Ln}_luminosity_map_${this.#A++}`,r=this.#jn(s);this.#S.set(t,r),this.#S.set(n,r);const o=this.#zn(s);return this.#qn(o),t&&this.#Wn(e,o),r}addHighlightHCMFilter(t,e,n,i,s){const r=`${e}-${n}-${i}-${s}`;let o=this.#Bn.get(t);if(o?.key===r)return o.url;if(o?(o.filter?.remove(),o.key=r,o.url="none",o.filter=null):(o={key:r,url:"none",filter:null},this.#Bn.set(t,o)),!e||!n)return o.url;const[a,c]=[e,n].map(this.#Gn.bind(this));let l=Math.round(.2126*a[0]+.7152*a[1]+.0722*a[2]),h=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[d,u]=[i,s].map(this.#Gn.bind(this));h<l&&([l,h,d,u]=[h,l,u,d]),this.#Un.style.color="";const p=(t,e,n)=>{const i=new Array(256),s=(h-l)/n,r=t/255,o=(e-t)/(255*n);let a=0;for(let t=0;t<=n;t++){const e=Math.round(l+t*s),n=r+t*o;for(let t=a;t<=e;t++)i[t]=n;a=e+1}for(let t=a;t<256;t++)i[t]=i[a-1];return i.join(",")},g=`g_${this.#Ln}_hcm_${t}_filter`,f=o.filter=this.#zn(g);return this.#Vn(f),this.#Hn(p(d[0],u[0],5),p(d[1],u[1],5),p(d[2],u[2],5),f),o.url=this.#jn(g),o.url}destroy(t=!1){t&&this.#Fn?.size||(this.#On?.parentNode.parentNode.remove(),this.#On=null,this.#Dn?.clear(),this.#Dn=null,this.#Fn?.clear(),this.#Fn=null,this.#A=0)}#qn(t){const e=this.#Nn.createElementNS(mt,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#Vn(t){const e=this.#Nn.createElementNS(mt,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#zn(t){const e=this.#Nn.createElementNS(mt,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#Un.append(e),e}#Kn(t,e,n){const i=this.#Nn.createElementNS(mt,e);i.setAttribute("type","discrete"),i.setAttribute("tableValues",n),t.append(i)}#Hn(t,e,n,i){const s=this.#Nn.createElementNS(mt,"feComponentTransfer");i.append(s),this.#Kn(s,"feFuncR",t),this.#Kn(s,"feFuncG",e),this.#Kn(s,"feFuncB",n)}#Wn(t,e){const n=this.#Nn.createElementNS(mt,"feComponentTransfer");e.append(n),this.#Kn(n,"feFuncA",t)}#Gn(t){return this.#Un.style.color=t,Pt(getComputedStyle(this.#Un).getPropertyValue("color"))}}class Re{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(t=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){G("Abstract method `_fetch` called.")}}class Ie extends Re{async _fetch(t){const e=await yt(t,"arraybuffer");return new Uint8Array(e)}}class Pe{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(t=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){G("Abstract method `_fetch` called.")}}class Me extends Pe{async _fetch(t){const e=await yt(t,"arraybuffer");return new Uint8Array(e)}}if(T){let t;try{const e=process.getBuiltinModule("module").createRequire("undefined"==typeof document?n(7016).pathToFileURL(__filename).href:S&&"SCRIPT"===S.tagName.toUpperCase()&&S.src||new URL("index.cjs",document.baseURI).href);try{t=e("@napi-rs/canvas")}catch(t){H(`Cannot load "@napi-rs/canvas" package: "${t}".`)}}catch(t){H(`Cannot access the \`require\` function: "${t}".`)}globalThis.DOMMatrix||(t?.DOMMatrix?globalThis.DOMMatrix=t.DOMMatrix:H("Cannot polyfill `DOMMatrix`, rendering may be broken.")),globalThis.ImageData||(t?.ImageData?globalThis.ImageData=t.ImageData:H("Cannot polyfill `ImageData`, rendering may be broken.")),globalThis.Path2D||(t?.Path2D?globalThis.Path2D=t.Path2D:H("Cannot polyfill `Path2D`, rendering may be broken.")),globalThis.navigator?.language||(globalThis.navigator={language:"en-US",platform:"",userAgent:""})}async function De(t){const e=process.getBuiltinModule("fs"),n=await e.promises.readFile(t);return new Uint8Array(n)}class Oe extends Te{}class Le extends Se{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire("undefined"==typeof document?n(7016).pathToFileURL(__filename).href:S&&"SCRIPT"===S.tagName.toUpperCase()&&S.src||new URL("index.cjs",document.baseURI).href)("@napi-rs/canvas").createCanvas(t,e)}}class Ne extends _e{async _fetch(t){return De(t)}}class Fe extends Re{async _fetch(t){return De(t)}}class Be extends Pe{async _fetch(t){return De(t)}}C(7588);const Ue="__forcedDependency",{floor:$e,ceil:je}=Math;function ze(t,e,n,i,s,r){t[4*e+0]=Math.min(t[4*e+0],n),t[4*e+1]=Math.min(t[4*e+1],i),t[4*e+2]=Math.max(t[4*e+2],s),t[4*e+3]=Math.max(t[4*e+3],r)}const He=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class Ge{#Yn;#Xn;constructor(t,e){this.#Yn=t,this.#Xn=e}get length(){return this.#Yn.length}isEmpty(t){return this.#Yn[t]===He}minX(t){return this.#Xn[4*t+0]/256}minY(t){return this.#Xn[4*t+1]/256}maxX(t){return(this.#Xn[4*t+2]+1)/256}maxY(t){return(this.#Xn[4*t+3]+1)/256}}const Ve=(t,e)=>{if(!t)return;let n=t.get(e);return n||(n={dependencies:new Set,isRenderingOperation:!1},t.set(e,n)),n};class We{#Jn={__proto__:null};#Qn={__proto__:null,transform:[],moveText:[],sameLineText:[],[Ue]:[]};#Zn=new Map;#ti=[];#ei=[];#ni=[[1,0,0,1,0,0]];#ii=[-1/0,-1/0,1/0,1/0];#si=new Float64Array([1/0,1/0,-1/0,-1/0]);#ri=-1;#oi=new Set;#ai=new Map;#ci=new Map;#li;#hi;#di;#Yn;#ui;constructor(t,e,n=!1){this.#li=t.width,this.#hi=t.height,this.#pi(e),n&&(this.#ui=new Map)}growOperationsCount(t){t>=this.#Yn.length&&this.#pi(t,this.#Yn)}#pi(t,e){const n=new ArrayBuffer(4*t);this.#di=new Uint8ClampedArray(n),this.#Yn=new Uint32Array(n),e&&e.length>0?(this.#Yn.set(e),this.#Yn.fill(He,e.length)):this.#Yn.fill(He)}save(t){return this.#Jn={__proto__:this.#Jn},this.#Qn={__proto__:this.#Qn,transform:{__proto__:this.#Qn.transform},moveText:{__proto__:this.#Qn.moveText},sameLineText:{__proto__:this.#Qn.sameLineText},[Ue]:{__proto__:this.#Qn[Ue]}},this.#ii={__proto__:this.#ii},this.#ti.push(t),this}restore(t){const e=Object.getPrototypeOf(this.#Jn);if(null===e)return this;this.#Jn=e,this.#Qn=Object.getPrototypeOf(this.#Qn),this.#ii=Object.getPrototypeOf(this.#ii);const n=this.#ti.pop();return void 0!==n&&(Ve(this.#ui,t)?.dependencies.add(n),this.#Yn[t]=this.#Yn[n]),this}recordOpenMarker(t){return this.#ti.push(t),this}getOpenMarker(){return 0===this.#ti.length?null:this.#ti.at(-1)}recordCloseMarker(t){const e=this.#ti.pop();return void 0!==e&&(Ve(this.#ui,t)?.dependencies.add(e),this.#Yn[t]=this.#Yn[e]),this}beginMarkedContent(t){return this.#ei.push(t),this}endMarkedContent(t){const e=this.#ei.pop();return void 0!==e&&(Ve(this.#ui,t)?.dependencies.add(e),this.#Yn[t]=this.#Yn[e]),this}pushBaseTransform(t){return this.#ni.push(ot.multiplyByDOMMatrix(this.#ni.at(-1),t.getTransform())),this}popBaseTransform(){return this.#ni.length>1&&this.#ni.pop(),this}recordSimpleData(t,e){return this.#Jn[t]=e,this}recordIncrementalData(t,e){return this.#Qn[t].push(e),this}resetIncrementalData(t,e){return this.#Qn[t].length=0,this}recordNamedData(t,e){return this.#Zn.set(t,e),this}recordSimpleDataFromNamed(t,e,n){this.#Jn[t]=this.#Zn.get(e)??n}recordFutureForcedDependency(t,e){return this.recordIncrementalData(Ue,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#Jn&&this.recordFutureForcedDependency(e,this.#Jn[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#oi)this.recordFutureForcedDependency(Ue,t);return this}resetBBox(t){return this.#ri!==t&&(this.#ri=t,this.#si[0]=1/0,this.#si[1]=1/0,this.#si[2]=-1/0,this.#si[3]=-1/0),this}recordClipBox(t,e,n,i,s,r){const o=ot.multiplyByDOMMatrix(this.#ni.at(-1),e.getTransform()),a=[1/0,1/0,-1/0,-1/0];ot.axialAlignedBoundingBox([n,s,i,r],o,a);const c=ot.intersect(this.#ii,a);return c?(this.#ii[0]=c[0],this.#ii[1]=c[1],this.#ii[2]=c[2],this.#ii[3]=c[3]):(this.#ii[0]=this.#ii[1]=1/0,this.#ii[2]=this.#ii[3]=-1/0),this}recordBBox(t,e,n,i,s,r){const o=this.#ii;if(o[0]===1/0)return this;const a=ot.multiplyByDOMMatrix(this.#ni.at(-1),e.getTransform());if(o[0]===-1/0)return ot.axialAlignedBoundingBox([n,s,i,r],a,this.#si),this;const c=[1/0,1/0,-1/0,-1/0];return ot.axialAlignedBoundingBox([n,s,i,r],a,c),this.#si[0]=Math.min(this.#si[0],Math.max(c[0],o[0])),this.#si[1]=Math.min(this.#si[1],Math.max(c[1],o[1])),this.#si[2]=Math.max(this.#si[2],Math.min(c[2],o[2])),this.#si[3]=Math.max(this.#si[3],Math.min(c[3],o[3])),this}recordCharacterBBox(t,e,n,i=1,s=0,r=0,o){const a=n.bbox;let c,l;if(a&&(c=a[2]!==a[0]&&a[3]!==a[1]&&this.#ci.get(n),!1!==c&&(l=[0,0,0,0],ot.axialAlignedBoundingBox(a,n.fontMatrix,l),1===i&&0===s&&0===r||ot.scaleMinMax([i,0,0,-i,s,r],l),c)))return this.recordBBox(t,e,l[0],l[2],l[1],l[3]);if(!o)return this.recordFullPageBBox(t);const h=o();return a&&l&&void 0===c&&(c=l[0]<=s-h.actualBoundingBoxLeft&&l[2]>=s+h.actualBoundingBoxRight&&l[1]<=r-h.actualBoundingBoxAscent&&l[3]>=r+h.actualBoundingBoxDescent,this.#ci.set(n,c),c)?this.recordBBox(t,e,l[0],l[2],l[1],l[3]):this.recordBBox(t,e,s-h.actualBoundingBoxLeft,s+h.actualBoundingBoxRight,r-h.actualBoundingBoxAscent,r+h.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#si[0]=Math.max(0,this.#ii[0]),this.#si[1]=Math.max(0,this.#ii[1]),this.#si[2]=Math.min(this.#li,this.#ii[2]),this.#si[3]=Math.min(this.#hi,this.#ii[3]),this}getSimpleIndex(t){return this.#Jn[t]}recordDependencies(t,e){const n=this.#oi,i=this.#Jn,s=this.#Qn;for(const t of e)t in this.#Jn?n.add(i[t]):t in s&&s[t].forEach(n.add,n);return this}recordNamedDependency(t,e){return this.#Zn.has(e)&&this.#oi.add(this.#Zn.get(e)),this}recordOperation(t,e=!1){if(this.recordDependencies(t,[Ue]),this.#ui){const e=Ve(this.#ui,t),{dependencies:n}=e;this.#oi.forEach(n.add,n),this.#ti.forEach(n.add,n),this.#ei.forEach(n.add,n),n.delete(t),e.isRenderingOperation=!0}if(this.#ri===t){const n=$e(256*this.#si[0]/this.#li),i=$e(256*this.#si[1]/this.#hi),s=je(256*this.#si[2]/this.#li),r=je(256*this.#si[3]/this.#hi);ze(this.#di,t,n,i,s,r);for(const e of this.#oi)e!==t&&ze(this.#di,e,n,i,s,r);for(const e of this.#ti)e!==t&&ze(this.#di,e,n,i,s,r);for(const e of this.#ei)e!==t&&ze(this.#di,e,n,i,s,r);e||(this.#oi.clear(),this.#ri=-1)}return this}recordShowTextOperation(t,e=!1){const n=Array.from(this.#oi);this.recordOperation(t,e),this.recordIncrementalData("sameLineText",t);for(const t of n)this.recordIncrementalData("sameLineText",t);return this}bboxToClipBoxDropOperation(t,e=!1){return this.#ri===t&&(this.#ri=-1,this.#ii[0]=Math.max(this.#ii[0],this.#si[0]),this.#ii[1]=Math.max(this.#ii[1],this.#si[1]),this.#ii[2]=Math.min(this.#ii[2],this.#si[2]),this.#ii[3]=Math.min(this.#ii[3],this.#si[3]),e||this.#oi.clear()),this}_takePendingDependencies(){const t=this.#oi;return this.#oi=new Set,t}_extractOperation(t){const e=this.#ai.get(t);return this.#ai.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#oi.add(e)}take(){return this.#ci.clear(),new Ge(this.#Yn,this.#di)}takeDebugMetadata(){return this.#ui}}class qe{#gi;#fi;#mi;#vi=0;#yi=0;constructor(t,e,n){if(t instanceof qe&&t.#mi===!!n)return t;this.#gi=t,this.#fi=e,this.#mi=!!n}growOperationsCount(){throw new Error("Unreachable")}save(t){return this.#yi++,this.#gi.save(this.#fi),this}restore(t){return this.#yi>0&&(this.#gi.restore(this.#fi),this.#yi--),this}recordOpenMarker(t){return this.#vi++,this}getOpenMarker(){return this.#vi>0?this.#fi:this.#gi.getOpenMarker()}recordCloseMarker(t){return this.#vi--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#gi.pushBaseTransform(t),this}popBaseTransform(){return this.#gi.popBaseTransform(),this}recordSimpleData(t,e){return this.#gi.recordSimpleData(t,this.#fi),this}recordIncrementalData(t,e){return this.#gi.recordIncrementalData(t,this.#fi),this}resetIncrementalData(t,e){return this.#gi.resetIncrementalData(t,this.#fi),this}recordNamedData(t,e){return this}recordSimpleDataFromNamed(t,e,n){return this.#gi.recordSimpleDataFromNamed(t,e,this.#fi),this}recordFutureForcedDependency(t,e){return this.#gi.recordFutureForcedDependency(t,this.#fi),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#gi.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#gi.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#mi||this.#gi.resetBBox(this.#fi),this}recordClipBox(t,e,n,i,s,r){return this.#mi||this.#gi.recordClipBox(this.#fi,e,n,i,s,r),this}recordBBox(t,e,n,i,s,r){return this.#mi||this.#gi.recordBBox(this.#fi,e,n,i,s,r),this}recordCharacterBBox(t,e,n,i,s,r,o){return this.#mi||this.#gi.recordCharacterBBox(this.#fi,e,n,i,s,r,o),this}recordFullPageBBox(t){return this.#mi||this.#gi.recordFullPageBBox(this.#fi),this}getSimpleIndex(t){return this.#gi.getSimpleIndex(t)}recordDependencies(t,e){return this.#gi.recordDependencies(this.#fi,e),this}recordNamedDependency(t,e){return this.#gi.recordNamedDependency(this.#fi,e),this}recordOperation(t){return this.#gi.recordOperation(this.#fi,!0),this}recordShowTextOperation(t){return this.#gi.recordShowTextOperation(this.#fi,!0),this}bboxToClipBoxDropOperation(t){return this.#mi||this.#gi.bboxToClipBoxDropOperation(this.#fi,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const Ke=["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],Ye=["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],Xe=["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],Je=["filter","fillColor","fillAlpha"],Qe=["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],Ze=["transform"],tn=["transform","fillColor"],en="Fill",nn="Stroke",sn="Shading";function rn(t,e){if(!e)return;const n=e[2]-e[0],i=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],n,i),t.clip(s)}class on{isModifyingCurrentTransform(){return!1}getPattern(){G("Abstract method `getPattern` called.")}}class an extends on{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;"axial"===this._type?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const t of this._colorStops)e.addColorStop(t[0],t[1]);return e}getPattern(t,e,n,i){let s;if(i===nn||i===en){const r=e.current.getClippedPathBoundingBox(i,Mt(t))||[0,0,0,0],o=Math.ceil(r[2]-r[0])||1,a=Math.ceil(r[3]-r[1])||1,c=e.cachedCanvases.getCanvas("pattern",o,a),l=c.context;l.clearRect(0,0,l.canvas.width,l.canvas.height),l.beginPath(),l.rect(0,0,l.canvas.width,l.canvas.height),l.translate(-r[0],-r[1]),n=ot.transform(n,[1,0,0,1,r[0],r[1]]),l.transform(...e.baseTransform),this.matrix&&l.transform(...this.matrix),rn(l,this._bbox),l.fillStyle=this._createGradient(l),l.fill(),s=t.createPattern(c.canvas,"no-repeat");const h=new DOMMatrix(n);s.setTransform(h)}else rn(t,this._bbox),s=this._createGradient(t);return s}}function cn(t,e,n,i,s,r,o,a){const c=e.coords,l=e.colors,h=t.data,d=4*t.width;let u;c[n+1]>c[i+1]&&(u=n,n=i,i=u,u=r,r=o,o=u),c[i+1]>c[s+1]&&(u=i,i=s,s=u,u=o,o=a,a=u),c[n+1]>c[i+1]&&(u=n,n=i,i=u,u=r,r=o,o=u);const p=(c[n]+e.offsetX)*e.scaleX,g=(c[n+1]+e.offsetY)*e.scaleY,f=(c[i]+e.offsetX)*e.scaleX,m=(c[i+1]+e.offsetY)*e.scaleY,v=(c[s]+e.offsetX)*e.scaleX,y=(c[s+1]+e.offsetY)*e.scaleY;if(g>=y)return;const b=l[r],w=l[r+1],A=l[r+2],x=l[o],S=l[o+1],E=l[o+2],_=l[a],C=l[a+1],T=l[a+2],k=Math.round(g),R=Math.round(y);let I,P,M,D,O,L,N,F;for(let t=k;t<=R;t++){if(t<m){const e=t<g?0:(g-t)/(g-m);I=p-(p-f)*e,P=b-(b-x)*e,M=w-(w-S)*e,D=A-(A-E)*e}else{let e;e=t>y?1:m===y?0:(m-t)/(m-y),I=f-(f-v)*e,P=x-(x-_)*e,M=S-(S-C)*e,D=E-(E-T)*e}let e;e=t<g?0:t>y?1:(g-t)/(g-y),O=p-(p-v)*e,L=b-(b-_)*e,N=w-(w-C)*e,F=A-(A-T)*e;const n=Math.round(Math.min(I,O)),i=Math.round(Math.max(I,O));let s=d*t+4*n;for(let t=n;t<=i;t++)e=(I-t)/(I-O),e<0?e=0:e>1&&(e=1),h[s++]=P-(P-L)*e|0,h[s++]=M-(M-N)*e|0,h[s++]=D-(D-F)*e|0,h[s++]=255}}function ln(t,e,n){const i=e.coords,s=e.colors;let r,o;switch(e.type){case"lattice":const a=e.verticesPerRow,c=Math.floor(i.length/a)-1,l=a-1;for(r=0;r<c;r++){let e=r*a;for(let r=0;r<l;r++,e++)cn(t,n,i[e],i[e+1],i[e+a],s[e],s[e+1],s[e+a]),cn(t,n,i[e+a+1],i[e+1],i[e+a],s[e+a+1],s[e+1],s[e+a])}break;case"triangles":for(r=0,o=i.length;r<o;r+=3)cn(t,n,i[r],i[r+1],i[r+2],s[r],s[r+1],s[r+2]);break;default:throw new Error("illegal figure")}}class hn extends on{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,n){const i=Math.floor(this._bounds[0]),s=Math.floor(this._bounds[1]),r=Math.ceil(this._bounds[2])-i,o=Math.ceil(this._bounds[3])-s,a=Math.min(Math.ceil(Math.abs(r*t[0]*1.1)),3e3),c=Math.min(Math.ceil(Math.abs(o*t[1]*1.1)),3e3),l=r/a,h=o/c,d={coords:this._coords,colors:this._colors,offsetX:-i,offsetY:-s,scaleX:1/l,scaleY:1/h},u=a+4,p=c+4,g=n.getCanvas("mesh",u,p),f=g.context,m=f.createImageData(a,c);if(e){const t=m.data;for(let n=0,i=t.length;n<i;n+=4)t[n]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=255}for(const t of this._figures)ln(m,t,d);return f.putImageData(m,2,2),{canvas:g.canvas,offsetX:i-2*l,offsetY:s-2*h,scaleX:l,scaleY:h}}isModifyingCurrentTransform(){return!0}getPattern(t,e,n,i){rn(t,this._bbox);const s=new Float32Array(2);if(i===sn)ot.singularValueDecompose2dScale(Mt(t),s);else if(this.matrix){ot.singularValueDecompose2dScale(this.matrix,s);const[t,n]=s;ot.singularValueDecompose2dScale(e.baseTransform,s),s[0]*=t,s[1]*=n}else ot.singularValueDecompose2dScale(e.baseTransform,s);const r=this._createMeshCanvas(s,i===sn?null:this._background,e.cachedCanvases);return i!==sn&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(r.offsetX,r.offsetY),t.scale(r.scaleX,r.scaleY),t.createPattern(r.canvas,"no-repeat")}}class dn extends on{getPattern(){return"hotpink"}}class un{static MAX_PATTERN_SIZE=3e3;constructor(t,e,n,i){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=n,this.baseTransform=i}createPatternCanvas(t,e){const{bbox:n,operatorList:i,paintType:s,tilingType:r,color:o,canvasGraphicsFactory:a}=this;let{xstep:c,ystep:l}=this;c=Math.abs(c),l=Math.abs(l),z("TilingType: "+r);const h=n[0],d=n[1],u=n[2],p=n[3],g=u-h,f=p-d,m=new Float32Array(2);ot.singularValueDecompose2dScale(this.matrix,m);const[v,y]=m;ot.singularValueDecompose2dScale(this.baseTransform,m);const b=v*m[0],w=y*m[1];let A=g,x=f,S=!1,E=!1;const _=Math.ceil(c*b),C=Math.ceil(l*w);_>=Math.ceil(g*b)?A=c:S=!0,C>=Math.ceil(f*w)?x=l:E=!0;const T=this.getSizeAndScale(A,this.ctx.canvas.width,b),k=this.getSizeAndScale(x,this.ctx.canvas.height,w),R=t.cachedCanvases.getCanvas("pattern",T.size,k.size),I=R.context,P=a.createCanvasGraphics(I,e);if(P.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(P,s,o),I.translate(-T.scale*h,-k.scale*d),P.transform(0,T.scale,0,0,k.scale,0,0),I.save(),P.dependencyTracker?.save(),this.clipBbox(P,h,d,u,p),P.baseTransform=Mt(P.ctx),P.executeOperatorList(i),P.endDrawing(),P.dependencyTracker?.restore(),I.restore(),S||E){const e=R.canvas;S&&(A=c),E&&(x=l);const n=this.getSizeAndScale(A,this.ctx.canvas.width,b),i=this.getSizeAndScale(x,this.ctx.canvas.height,w),s=n.size,r=i.size,o=t.cachedCanvases.getCanvas("pattern-workaround",s,r),a=o.context,u=S?Math.floor(g/c):0,p=E?Math.floor(f/l):0;for(let t=0;t<=u;t++)for(let n=0;n<=p;n++)a.drawImage(e,s*t,r*n,s,r,0,0,s,r);return{canvas:o.canvas,scaleX:n.scale,scaleY:i.scale,offsetX:h,offsetY:d}}return{canvas:R.canvas,scaleX:T.scale,scaleY:k.scale,offsetX:h,offsetY:d}}getSizeAndScale(t,e,n){const i=Math.max(un.MAX_PATTERN_SIZE,e);let s=Math.ceil(t*n);return s>=i?s=i:n=s/t,{scale:n,size:s}}clipBbox(t,e,n,i,s){const r=i-e,o=s-n;t.ctx.rect(e,n,r,o),ot.axialAlignedBoundingBox([e,n,i,s],Mt(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,n){const i=t.ctx,s=t.current;switch(e){case 1:const{fillStyle:t,strokeStyle:r}=this.ctx;i.fillStyle=s.fillColor=t,i.strokeStyle=s.strokeColor=r;break;case 2:i.fillStyle=i.strokeStyle=n,s.fillColor=s.strokeColor=n;break;default:throw new tt(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,n,i,s){let r=n;i!==sn&&(r=ot.transform(r,e.baseTransform),this.matrix&&(r=ot.transform(r,this.matrix)));const o=this.createPatternCanvas(e,s);let a=new DOMMatrix(r);a=a.translate(o.offsetX,o.offsetY),a=a.scale(1/o.scaleX,1/o.scaleY);const c=t.createPattern(o.canvas,"repeat");return c.setTransform(a),c}}function pn({src:t,srcPos:e=0,dest:n,width:i,height:s,nonBlackColor:r=4294967295,inverseDecode:o=!1}){const a=st.isLittleEndian?4278190080:255,[c,l]=o?[r,a]:[a,r],h=i>>3,d=7&i,u=t.length;n=new Uint32Array(n.buffer);let p=0;for(let i=0;i<s;i++){for(const i=e+h;e<i;e++){const i=e<u?t[e]:255;n[p++]=128&i?l:c,n[p++]=64&i?l:c,n[p++]=32&i?l:c,n[p++]=16&i?l:c,n[p++]=8&i?l:c,n[p++]=4&i?l:c,n[p++]=2&i?l:c,n[p++]=1&i?l:c}if(0===d)continue;const i=e<u?t[e++]:255;for(let t=0;t<d;t++)n[p++]=i&1<<7-t?l:c}return{srcPos:e,destPos:p}}const gn=16,fn=new DOMMatrix,mn=new Float32Array(2),vn=new Float32Array([1/0,1/0,-1/0,-1/0]);class yn{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,n){let i;return void 0!==this.cache[t]?(i=this.cache[t],this.canvasFactory.reset(i,e,n)):(i=this.canvasFactory.create(e,n),this.cache[t]=i),i}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function bn(t,e,n,i,s,r,o,a,c,l){const[h,d,u,p,g,f]=Mt(t);if(0===d&&0===u){const m=o*h+g,v=Math.round(m),y=a*p+f,b=Math.round(y),w=(o+c)*h+g,A=Math.abs(Math.round(w)-v)||1,x=(a+l)*p+f,S=Math.abs(Math.round(x)-b)||1;return t.setTransform(Math.sign(h),0,0,Math.sign(p),v,b),t.drawImage(e,n,i,s,r,0,0,A,S),t.setTransform(h,d,u,p,g,f),[A,S]}if(0===h&&0===p){const m=a*u+g,v=Math.round(m),y=o*d+f,b=Math.round(y),w=(a+l)*u+g,A=Math.abs(Math.round(w)-v)||1,x=(o+c)*d+f,S=Math.abs(Math.round(x)-b)||1;return t.setTransform(0,Math.sign(d),Math.sign(u),0,v,b),t.drawImage(e,n,i,s,r,0,0,S,A),t.setTransform(h,d,u,p,g,f),[S,A]}return t.drawImage(e,n,i,s,r,o,a,c,l),[Math.hypot(h,d)*c,Math.hypot(u,p)*l]}class wn{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=k;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=0;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,n){n?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=vn.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=en,e=null){const n=this.minMax.slice();if(t===nn){e||G("Stroke bounding box must include transform."),ot.singularValueDecompose2dScale(e,mn);const t=mn[0]*this.lineWidth/2,i=mn[1]*this.lineWidth/2;n[0]-=t,n[1]-=i,n[2]+=t,n[3]+=i}return n}updateClipFromPath(){const t=ot.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(vn,0)}getClippedPathBoundingBox(t=en,e=null){return ot.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function An(t,e){if(e instanceof ImageData)return void t.putImageData(e,0,0);const n=e.height,i=e.width,s=n%gn,r=(n-s)/gn,o=0===s?r:r+1,a=t.createImageData(i,gn);let c,l=0;const h=e.data,d=a.data;let u,p,g,f;if(e.kind===L.GRAYSCALE_1BPP){const e=h.byteLength,n=new Uint32Array(d.buffer,0,d.byteLength>>2),f=n.length,m=i+7>>3,v=4294967295,y=st.isLittleEndian?4278190080:255;for(u=0;u<o;u++){for(g=u<r?gn:s,c=0,p=0;p<g;p++){const t=e-l;let s=0;const r=t>m?i:8*t-7,o=-8&r;let a=0,d=0;for(;s<o;s+=8)d=h[l++],n[c++]=128&d?v:y,n[c++]=64&d?v:y,n[c++]=32&d?v:y,n[c++]=16&d?v:y,n[c++]=8&d?v:y,n[c++]=4&d?v:y,n[c++]=2&d?v:y,n[c++]=1&d?v:y;for(;s<r;s++)0===a&&(d=h[l++],a=128),n[c++]=d&a?v:y,a>>=1}for(;c<f;)n[c++]=0;t.putImageData(a,0,u*gn)}}else if(e.kind===L.RGBA_32BPP){for(p=0,f=i*gn*4,u=0;u<r;u++)d.set(h.subarray(l,l+f)),l+=f,t.putImageData(a,0,p),p+=gn;u<o&&(f=i*s*4,d.set(h.subarray(l,l+f)),t.putImageData(a,0,p))}else{if(e.kind!==L.RGB_24BPP)throw new Error(`bad image kind: ${e.kind}`);for(g=gn,f=i*g,u=0;u<o;u++){for(u>=r&&(g=s,f=i*g),c=0,p=f;p--;)d[c++]=h[l++],d[c++]=h[l++],d[c++]=h[l++],d[c++]=255;t.putImageData(a,0,u*gn)}}}function xn(t,e){if(e.bitmap)return void t.drawImage(e.bitmap,0,0);const n=e.height,i=e.width,s=n%gn,r=(n-s)/gn,o=0===s?r:r+1,a=t.createImageData(i,gn);let c=0;const l=e.data,h=a.data;for(let e=0;e<o;e++){const n=e<r?gn:s;({srcPos:c}=pn({src:l,srcPos:c,dest:h,width:i,height:n,nonBlackColor:0})),t.putImageData(a,0,e*gn)}}function Sn(t,e){const n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of n)void 0!==t[i]&&(e[i]=t[i]);void 0!==t.setLineDash&&(e.setLineDash(t.getLineDash()),e.lineDashOffset=t.lineDashOffset)}function En(t){t.strokeStyle=t.fillStyle="#000000",t.fillRule="nonzero",t.globalAlpha=1,t.lineWidth=1,t.lineCap="butt",t.lineJoin="miter",t.miterLimit=10,t.globalCompositeOperation="source-over",t.font="10px sans-serif",void 0!==t.setLineDash&&(t.setLineDash([]),t.lineDashOffset=0);const{filter:e}=t;"none"!==e&&""!==e&&(t.filter="none")}function _n(t,e){if(e)return!0;ot.singularValueDecompose2dScale(t,mn);const n=Math.fround(Lt.pixelRatio*vt.PDF_TO_CSS_UNITS);return mn[0]<=n&&mn[1]<=n}const Cn=["butt","round","square"],Tn=["miter","round","bevel"],kn={},Rn={};class In{constructor(t,e,n,i,s,{optionalContentConfig:r,markedContentStack:o=null},a,c,l){this.ctx=t,this.current=new wn(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=n,this.canvasFactory=i,this.filterFactory=s,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=r,this.cachedCanvases=new yn(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=a,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=l??null}getObject(t,e,n=null){return"string"==typeof e?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):n}beginDrawing({transform:t,viewport:e,transparency:n=!1,background:i=null}){const s=this.ctx.canvas.width,r=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,s,r),this.ctx.fillStyle=o,n){const t=this.cachedCanvases.getCanvas("transparent",s,r);this.compositeCtx=this.ctx,this.transparentCanvas=t.canvas,this.ctx=t.context,this.ctx.save(),this.ctx.transform(...Mt(this.compositeCtx))}this.ctx.save(),En(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Mt(this.ctx)}executeOperatorList(t,e,n,i,s){const r=t.argsArray,o=t.fnArray;let a=e||0;const c=r.length;if(c===a)return a;const l=c-a>10&&"function"==typeof n,h=l?Date.now()+15:0;let d=0;const u=this.commonObjs,p=this.objs;let g,f;for(;;){if(void 0!==i&&a===i.nextBreakPoint)return i.breakIt(a,n),a;if(!s||s(a))if(g=o[a],f=r[a]??null,g!==B.dependency)null===f?this[g](a):this[g](a,...f);else for(const t of f){this.dependencyTracker?.recordNamedData(t,a);const e=t.startsWith("g_")?u:p;if(!e.has(t))return e.get(t,n),a}if(a++,a===c)return a;if(l&&++d>10){if(Date.now()>h)return n(),a;d=0}}}#bi(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#bi(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#wi()}#wi(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==t){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const n=t.width??t.displayWidth,i=t.height??t.displayHeight;let s,r,o=Math.max(Math.hypot(e[0],e[1]),1),a=Math.max(Math.hypot(e[2],e[3]),1),c=n,l=i,h="prescale1";for(;o>2&&c>1||a>2&&l>1;){let e=c,n=l;o>2&&c>1&&(e=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c/2),o/=c/e),a>2&&l>1&&(n=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/n),s=this.cachedCanvases.getCanvas(h,e,n),r=s.context,r.clearRect(0,0,e,n),r.drawImage(t,0,0,c,l,0,0,e,n),t=s.canvas,c=e,l=n,h="prescale1"===h?"prescale2":"prescale1"}return{img:t,paintWidth:c,paintHeight:l}}_createMaskCanvas(t,e){const n=this.ctx,{width:i,height:s}=e,r=this.current.fillColor,o=this.current.patternFill,a=Mt(n);let c,l,h,d;if((e.bitmap||e.data)&&e.count>1){const n=e.bitmap||e.data.buffer;l=JSON.stringify(o?a:[a.slice(0,4),r]),c=this._cachedBitmapsMap.get(n),c||(c=new Map,this._cachedBitmapsMap.set(n,c));const i=c.get(l);if(i&&!o){const e=Math.round(Math.min(a[0],a[2])+a[4]),n=Math.round(Math.min(a[1],a[3])+a[5]);return this.dependencyTracker?.recordDependencies(t,tn),{canvas:i,offsetX:e,offsetY:n}}h=i}h||(d=this.cachedCanvases.getCanvas("maskCanvas",i,s),xn(d.context,e));let u=ot.transform(a,[1/i,0,0,-1/s,0,0]);u=ot.transform(u,[1,0,0,1,0,-s]);const p=vn.slice();ot.axialAlignedBoundingBox([0,0,i,s],u,p);const[g,f,m,v]=p,y=Math.round(m-g)||1,b=Math.round(v-f)||1,w=this.cachedCanvases.getCanvas("fillCanvas",y,b),A=w.context,x=g,S=f;A.translate(-x,-S),A.transform(...u),h||(h=this._scaleImage(d.canvas,Dt(A)),h=h.img,c&&o&&c.set(l,h)),A.imageSmoothingEnabled=_n(Mt(A),e.interpolate),bn(A,h,0,0,h.width,h.height,0,0,i,s),A.globalCompositeOperation="source-in";const E=ot.transform(Dt(A),[1,0,0,1,-x,-S]);return A.fillStyle=o?r.getPattern(n,this,E,en,t):r,A.fillRect(0,0,i,s),c&&!o&&(this.cachedCanvases.delete("fillCanvas"),c.set(l,w.canvas)),this.dependencyTracker?.recordDependencies(t,tn),{canvas:w.canvas,offsetX:Math.round(x),offsetY:Math.round(S)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=Cn[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=Tn[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,n){this.dependencyTracker?.recordSimpleData("dash",t);const i=this.ctx;void 0!==i.setLineDash&&(i.setLineDash(e),i.lineDashOffset=n)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[n,i]of e)switch(n){case"LW":this.setLineWidth(t,i);break;case"LC":this.setLineCap(t,i);break;case"LJ":this.setLineJoin(t,i);break;case"ML":this.setMiterLimit(t,i);break;case"D":this.setDash(t,i[0],i[1]);break;case"RI":this.setRenderingIntent(t,i);break;case"FL":this.setFlatness(t,i);break;case"Font":this.setFont(t,i[0],i[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=i;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=i;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=i;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,n=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(i,e,n);this.suspendedCtx=this.ctx;const r=this.ctx=s.context;r.setTransform(this.suspendedCtx.getTransform()),Sn(this.suspendedCtx,r),function(t,e){if(t._removeMirroring)throw new Error("Context is already forwarding operations.");t.__originalSave=t.save,t.__originalRestore=t.restore,t.__originalRotate=t.rotate,t.__originalScale=t.scale,t.__originalTranslate=t.translate,t.__originalTransform=t.transform,t.__originalSetTransform=t.setTransform,t.__originalResetTransform=t.resetTransform,t.__originalClip=t.clip,t.__originalMoveTo=t.moveTo,t.__originalLineTo=t.lineTo,t.__originalBezierCurveTo=t.bezierCurveTo,t.__originalRect=t.rect,t.__originalClosePath=t.closePath,t.__originalBeginPath=t.beginPath,t._removeMirroring=()=>{t.save=t.__originalSave,t.restore=t.__originalRestore,t.rotate=t.__originalRotate,t.scale=t.__originalScale,t.translate=t.__originalTranslate,t.transform=t.__originalTransform,t.setTransform=t.__originalSetTransform,t.resetTransform=t.__originalResetTransform,t.clip=t.__originalClip,t.moveTo=t.__originalMoveTo,t.lineTo=t.__originalLineTo,t.bezierCurveTo=t.__originalBezierCurveTo,t.rect=t.__originalRect,t.closePath=t.__originalClosePath,t.beginPath=t.__originalBeginPath,delete t._removeMirroring},t.save=function(){e.save(),this.__originalSave()},t.restore=function(){e.restore(),this.__originalRestore()},t.translate=function(t,n){e.translate(t,n),this.__originalTranslate(t,n)},t.scale=function(t,n){e.scale(t,n),this.__originalScale(t,n)},t.transform=function(t,n,i,s,r,o){e.transform(t,n,i,s,r,o),this.__originalTransform(t,n,i,s,r,o)},t.setTransform=function(t,n,i,s,r,o){e.setTransform(t,n,i,s,r,o),this.__originalSetTransform(t,n,i,s,r,o)},t.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},t.rotate=function(t){e.rotate(t),this.__originalRotate(t)},t.clip=function(t){e.clip(t),this.__originalClip(t)},t.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},t.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},t.bezierCurveTo=function(t,n,i,s,r,o){e.bezierCurveTo(t,n,i,s,r,o),this.__originalBezierCurveTo(t,n,i,s,r,o)},t.rect=function(t,n,i,s){e.rect(t,n,i,s),this.__originalRect(t,n,i,s)},t.closePath=function(){e.closePath(),this.__originalClosePath()},t.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}(r,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Sn(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,n,i){const s=i[0],r=i[1],o=i[2]-s,a=i[3]-r;0!==o&&0!==a&&(this.genericComposeSMask(e.context,n,o,a,e.subtype,e.backdrop,e.transferMap,s,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(n.canvas,0,0),t.restore())}genericComposeSMask(t,e,n,i,s,r,o,a,c,l,h){let d=t.canvas,u=a-l,p=c-h;if(r)if(u<0||p<0||u+n>d.width||p+i>d.height){const t=this.cachedCanvases.getCanvas("maskExtension",n,i),e=t.context;e.drawImage(d,-u,-p),e.globalCompositeOperation="destination-atop",e.fillStyle=r,e.fillRect(0,0,n,i),e.globalCompositeOperation="source-over",d=t.canvas,u=p=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const e=new Path2D;e.rect(u,p,n,i),t.clip(e),t.globalCompositeOperation="destination-atop",t.fillStyle=r,t.fillRect(u,p,n,i),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),"Alpha"===s&&o?e.filter=this.filterFactory.addAlphaFilter(o):"Luminosity"===s&&(e.filter=this.filterFactory.addLuminosityFilter(o));const g=new Path2D;g.rect(a,c,n,i),e.clip(g),e.globalCompositeOperation="destination-in",e.drawImage(d,u,p,n,i,a,c,n,i),e.restore()}save(t){this.inSMaskMode&&Sn(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){this.dependencyTracker?.restore(t),0!==this.stateStack.length?(this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Sn(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null):this.inSMaskMode&&this.endSMaskMode()}transform(t,e,n,i,s,r,o){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,n,i,s,r,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,n,i){let[s]=n;if(!i)return s||=n[0]=new Path2D,void this[e](t,s);if(null!==this.dependencyTracker){const n=e===B.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,i[0]-n,i[2]+n,i[1]-n,i[3]+n).recordDependencies(t,["transform"])}if(!(s instanceof Path2D)){const t=n[0]=new Path2D;for(let e=0,n=s.length;e<n;)switch(s[e++]){case 0:t.moveTo(s[e++],s[e++]);break;case 1:t.lineTo(s[e++],s[e++]);break;case 2:t.bezierCurveTo(s[e++],s[e++],s[e++],s[e++],s[e++],s[e++]);break;case 3:t.closePath();break;default:H(`Unrecognized drawing path operator: ${s[e-1]}`)}s=t}ot.axialAlignedBoundingBox(i,Mt(this.ctx),this.current.minMax),this[e](t,s),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,n=!0){const i=this.ctx,s=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if("object"==typeof s&&s?.getPattern){const n=s.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=s.getPattern(i,this,Dt(i),nn,t),n){const t=new Path2D;t.addPath(e,i.getTransform().invertSelf().multiplySelf(n)),e=t}this.rescaleAndStroke(e,!1),i.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,Ke),n&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(nn,Mt(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,n=!0){const i=this.ctx,s=this.current.fillColor;let r=!1;if(this.current.patternFill){const n=s.isModifyingCurrentTransform()?i.getTransform():null;if(this.dependencyTracker?.save(t),i.save(),i.fillStyle=s.getPattern(i,this,Dt(i),en,t),n){const t=new Path2D;t.addPath(e,i.getTransform().invertSelf().multiplySelf(n)),e=t}r=!0}const o=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==o&&(this.pendingEOFill?(i.fill(e,"evenodd"),this.pendingEOFill=!1):i.fill(e)),this.dependencyTracker?.recordDependencies(t,Ye),r&&(i.restore(),this.dependencyTracker?.restore(t)),n&&this.consumePath(t,e,o)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,Je).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=kn}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=Rn}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:n}=this;void 0!==e&&n.recordFutureForcedDependency("textClip",n.getOpenMarker()).recordFutureForcedDependency("textClip",t),n.recordCloseMarker(t)}if(void 0!==e){const t=new Path2D,i=n.getTransform().invertSelf();for(const{transform:n,x:s,y:r,fontSize:o,path:a}of e)a&&t.addPath(a,new DOMMatrix(n).preMultiplySelf(i).translate(s,r).scale(o,-o));n.clip(t)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,n){this.dependencyTracker?.recordSimpleData("font",t).recordSimpleDataFromNamed("fontObj",e,t);const i=this.commonObjs.get(e),s=this.current;if(!i)throw new Error(`Can't find font for ${e}`);if(s.fontMatrix=i.fontMatrix||k,0!==s.fontMatrix[0]&&0!==s.fontMatrix[3]||H("Invalid font matrix for font "+e),n<0?(n=-n,s.fontDirection=-1):s.fontDirection=1,this.current.font=i,this.current.fontSize=n,i.isType3Font)return;const r=i.loadedName||"sans-serif",o=i.systemFontInfo?.css||`"${r}", ${i.fallbackName}`;let a="normal";i.black?a="900":i.bold&&(a="bold");const c=i.italic?"italic":"normal";let l=n;n<16?l=16:n>100&&(l=100),this.current.fontSizeScale=n/l,this.ctx.font=`${c} ${a} ${l}px ${o}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,n){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=n}setLeadingMoveText(t,e,n){this.setLeading(t,-n),this.moveText(t,e,n)}setTextMatrix(t,e){this.dependencyTracker?.recordSimpleData("textMatrix",t);const{current:n}=this;n.textMatrix=e,n.textMatrixScale=Math.hypot(e[0],e[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#Ai(t,e,n){const i=new Path2D;return i.addPath(t,new DOMMatrix(n).invertSelf().multiplySelf(e)),i}paintChar(t,e,n,i,s,r){const o=this.ctx,a=this.current,c=a.font,l=a.textRenderingMode,h=a.fontSize/a.fontSizeScale,d=3&l,u=!!(4&l),p=a.patternFill&&!c.missingFile,g=a.patternStroke&&!c.missingFile;let f;if((c.disableFontFace||u||p||g)&&!c.missingFile&&(f=c.getPathGenerator(this.commonObjs,e)),f&&(c.disableFontFace||p||g)){let e;if(o.save(),o.translate(n,i),o.scale(h,-h),this.dependencyTracker?.recordCharacterBBox(t,o,c),0===d||2===d)if(s){e=o.getTransform(),o.setTransform(...s);const t=this.#Ai(f,e,s);o.fill(t)}else o.fill(f);if(1===d||2===d)if(r){e||=o.getTransform(),o.setTransform(...r);const{a:t,b:n,c:i,d:s}=e,a=ot.inverseTransform(r),c=ot.transform([t,n,i,s,0,0],a);ot.singularValueDecompose2dScale(c,mn),o.lineWidth*=Math.max(mn[0],mn[1])/h,o.stroke(this.#Ai(f,e,r))}else o.lineWidth/=h,o.stroke(f);o.restore()}else 0!==d&&2!==d||(o.fillText(e,n,i),this.dependencyTracker?.recordCharacterBBox(t,o,c,h,n,i,()=>o.measureText(e))),1!==d&&2!==d||(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,o,c,h,n,i,()=>o.measureText(e)).recordDependencies(t,Ke),o.strokeText(e,n,i));u&&((this.pendingTextPaths||=[]).push({transform:Mt(o),x:n,y:i,fontSize:h,path:f}),this.dependencyTracker?.recordCharacterBBox(t,o,c,h,n,i))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let n=!1;for(let t=3;t<e.length;t+=4)if(e[t]>0&&e[t]<255){n=!0;break}return K(this,"isFontSubpixelAAEnabled",n)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,Qe).resetBBox(t),4&this.current.textRenderingMode&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,i=n.font;if(i.isType3Font)return this.showType3Text(t,e),void this.dependencyTracker?.recordShowTextOperation(t);const s=n.fontSize;if(0===s)return void this.dependencyTracker?.recordOperation(t);const r=this.ctx,o=n.fontSizeScale,a=n.charSpacing,c=n.wordSpacing,l=n.fontDirection,h=n.textHScale*l,d=e.length,u=i.vertical,p=u?1:-1,g=i.defaultVMetrics,f=s*n.fontMatrix[0],m=0===n.textRenderingMode&&!i.disableFontFace&&!n.patternFill;let v,y;if(r.save(),n.textMatrix&&r.transform(...n.textMatrix),r.translate(n.x,n.y+n.textRise),l>0?r.scale(h,-1):r.scale(h,1),n.patternFill){r.save();const e=n.fillColor.getPattern(r,this,Dt(r),en,t);v=Mt(r),r.restore(),r.fillStyle=e}if(n.patternStroke){r.save();const e=n.strokeColor.getPattern(r,this,Dt(r),nn,t);y=Mt(r),r.restore(),r.strokeStyle=e}let b=n.lineWidth;const w=n.textMatrixScale;if(0===w||0===b){const t=3&n.textRenderingMode;1!==t&&2!==t||(b=this.getSinglePixelWidth())}else b/=w;if(1!==o&&(r.scale(o,o),b/=o),r.lineWidth=b,i.isInvalidPDFjsFont){const i=[];let s=0;for(const t of e)i.push(t.unicode),s+=t.width;const o=i.join("");if(r.fillText(o,0,0),null!==this.dependencyTracker){const e=r.measureText(o);this.dependencyTracker.recordBBox(t,this.ctx,-e.actualBoundingBoxLeft,e.actualBoundingBoxRight,-e.actualBoundingBoxAscent,e.actualBoundingBoxDescent).recordShowTextOperation(t)}return n.x+=s*f*h,r.restore(),void this.compose()}let A,x=0;for(A=0;A<d;++A){const n=e[A];if("number"==typeof n){x+=p*n*s/1e3;continue}let h=!1;const d=(n.isSpace?c:0)+a,b=n.fontChar,w=n.accent;let S,E,_,C=n.width;if(u){const t=n.vmetric||g,e=-(n.vmetric?t[1]:.5*C)*f,i=t[2]*f;C=t?-t[0]:C,S=e/o,E=(x+i)/o}else S=x/o,E=0;if(i.remeasure&&C>0){_=r.measureText(b);const t=1e3*_.width/s*o;if(C<t&&this.isFontSubpixelAAEnabled){const e=C/t;h=!0,r.save(),r.scale(e,1),S/=e}else C!==t&&(S+=(C-t)/2e3*s/o)}if(this.contentVisible&&(n.isInFont||i.missingFile))if(m&&!w)r.fillText(b,S,E),this.dependencyTracker?.recordCharacterBBox(t,r,_?{bbox:null}:i,s/o,S,E,()=>_??r.measureText(b));else if(this.paintChar(t,b,S,E,v,y),w){const e=S+s*w.offset.x/o,n=E-s*w.offset.y/o;this.paintChar(t,w.fontChar,e,n,v,y)}x+=u?C*f-d*l:C*f+d*l,h&&r.restore()}u?n.y-=x:n.x+=x*h,r.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(t)}showType3Text(t,e){const n=this.ctx,i=this.current,s=i.font,r=i.fontSize,o=i.fontDirection,a=s.vertical?1:-1,c=i.charSpacing,l=i.wordSpacing,h=i.textHScale*o,d=i.fontMatrix||k,u=e.length;let p,g,f,m;if(3===i.textRenderingMode||0===r)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),i.textMatrix&&n.transform(...i.textMatrix),n.translate(i.x,i.y+i.textRise),n.scale(h,o);const v=this.dependencyTracker;for(this.dependencyTracker=v?new qe(v,t):null,p=0;p<u;++p){if(g=e[p],"number"==typeof g){m=a*g*r/1e3,this.ctx.translate(m,0),i.x+=m*h;continue}const t=(g.isSpace?l:0)+c,o=s.charProcOperatorList[g.operatorListId];o?this.contentVisible&&(this.save(),n.scale(r,r),n.transform(...d),this.executeOperatorList(o),this.restore()):H(`Type3 character "${g.operatorListId}" is not available.`);const u=[g.width,0];ot.applyTransform(u,d),f=u[0]*r+t,n.translate(f,0),i.x+=f*h}n.restore(),v&&(this.dependencyTracker=v)}setCharWidth(t,e,n){}setCharWidthAndBounds(t,e,n,i,s,r,o){const a=new Path2D;a.rect(i,s,r-i,o-s),this.ctx.clip(a),this.dependencyTracker?.recordBBox(t,this.ctx,i,r,s,o).recordClipBox(t,this.ctx,i,r,s,o),this.endPath(t)}getColorN_Pattern(t,e){let n;if("TilingPattern"===e[0]){const t=this.baseTransform||Mt(this.ctx),i={createCanvasGraphics:(t,e)=>new In(t,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new qe(this.dependencyTracker,e,!0):null)};n=new un(e,this.ctx,i,t)}else n=this._getPattern(t,e[1],e[2]);return n}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,n=null){let i;return this.cachedPatterns.has(e)?i=this.cachedPatterns.get(e):(i=function(t){switch(t[0]){case"RadialAxial":return new an(t);case"Mesh":return new hn(t);case"Dummy":return new dn}throw new Error(`Unknown IR type: ${t[0]}`)}(this.getObject(t,e)),this.cachedPatterns.set(e,i)),n&&(i.matrix=n),i}shadingFill(t,e){if(!this.contentVisible)return;const n=this.ctx;this.save(t);const i=this._getPattern(t,e);n.fillStyle=i.getPattern(n,this,Dt(n),sn,t);const s=Dt(n);if(s){const{width:t,height:e}=n.canvas,i=vn.slice();ot.axialAlignedBoundingBox([0,0,t,e],s,i);const[r,o,a,c]=i;this.ctx.fillRect(r,o,a-r,c-o)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,Ze).recordDependencies(t,Ye).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){G("Should not call beginInlineImage")}beginImageData(){G("Should not call beginImageData")}paintFormXObjectBegin(t,e,n){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=Mt(this.ctx),n)){ot.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[e,i,s,r]=n,o=new Path2D;o.rect(e,i,s-e,r-i),this.ctx.clip(o),this.dependencyTracker?.recordClipBox(t,this.ctx,e,s,i,r),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;e.isolated||z("TODO: Support non-isolated groups."),e.knockout&&H("Knockout groups not supported.");const i=Mt(n);if(e.matrix&&n.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=vn.slice();ot.axialAlignedBoundingBox(e.bbox,Mt(n),s);const r=[0,0,n.canvas.width,n.canvas.height];s=ot.intersect(s,r)||[0,0,0,0];const o=Math.floor(s[0]),a=Math.floor(s[1]),c=Math.max(Math.ceil(s[2])-o,1),l=Math.max(Math.ceil(s[3])-a,1);this.current.startNewPathAndClipBox([0,0,c,l]);let h="groupAt"+this.groupLevel;e.smask&&(h+="_smask_"+this.smaskCounter++%2);const d=this.cachedCanvases.getCanvas(h,c,l),u=d.context;u.translate(-o,-a),u.transform(...i);let p=new Path2D;const[g,f,m,v]=e.bbox;if(p.rect(g,f,m-g,v-f),e.matrix){const t=new Path2D;t.addPath(p,new DOMMatrix(e.matrix)),p=t}u.clip(p),e.smask&&this.smaskStack.push({canvas:d.canvas,context:u,offsetX:o,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),e.smask&&!this.dependencyTracker||(n.setTransform(1,0,0,1,0,0),n.translate(o,a),n.save()),Sn(n,u),this.ctx=u,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const e=Mt(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...e);const i=vn.slice();ot.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],e,i),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(i)}}beginAnnotation(t,e,n,i,s,r){if(this.#bi(),En(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const s=n[2]-n[0],o=n[3]-n[1];if(r&&this.annotationCanvasMap){(i=i.slice())[4]-=n[0],i[5]-=n[1],(n=n.slice())[0]=n[1]=0,n[2]=s,n[3]=o,ot.singularValueDecompose2dScale(Mt(this.ctx),mn);const{viewportScale:t}=this,r=Math.ceil(s*this.outputScaleX*t),a=Math.ceil(o*this.outputScaleY*t);this.annotationCanvas=this.canvasFactory.create(r,a);const{canvas:c,context:l}=this.annotationCanvas;this.annotationCanvasMap.set(e,c),this.annotationCanvas.savedCtx=this.ctx,this.ctx=l,this.ctx.save(),this.ctx.setTransform(mn[0],0,0,-mn[1],0,o*mn[1]),En(this.ctx)}else{En(this.ctx),this.endPath(t);const e=new Path2D;e.rect(n[0],n[1],s,o),this.ctx.clip(e)}}this.current=new wn(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...i),this.transform(t,...s)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#wi(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const n=e.count;(e=this.getObject(t,e.data,e)).count=n;const i=this.ctx,s=this._createMaskCanvas(t,e),r=s.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(r,s.offsetX,s.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,s.offsetX,s.offsetX+r.width,s.offsetY,s.offsetY+r.height).recordOperation(t),i.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,n,i=0,s=0,r,o){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const a=this.ctx;a.save();const c=Mt(a);a.transform(n,i,s,r,0,0);const l=this._createMaskCanvas(t,e);a.setTransform(1,0,0,1,l.offsetX-c[4],l.offsetY-c[5]),this.dependencyTracker?.resetBBox(t);for(let e=0,h=o.length;e<h;e+=2){const h=ot.transform(c,[n,i,s,r,o[e],o[e+1]]);a.drawImage(l.canvas,h[4],h[5]),this.dependencyTracker?.recordBBox(t,this.ctx,h[4],h[4]+l.canvas.width,h[5],h[5]+l.canvas.height)}a.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const n=this.ctx,i=this.current.fillColor,s=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,tn);for(const r of e){const{data:e,width:o,height:a,transform:c}=r,l=this.cachedCanvases.getCanvas("maskCanvas",o,a),h=l.context;h.save(),xn(h,this.getObject(t,e,r)),h.globalCompositeOperation="source-in",h.fillStyle=s?i.getPattern(h,this,Dt(n),en,t):i,h.fillRect(0,0,o,a),h.restore(),n.save(),n.transform(...c),n.scale(1,-1),bn(n,l.canvas,0,0,o,a,0,-1,1,1),this.dependencyTracker?.recordBBox(t,n,0,o,0,a),n.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const n=this.getObject(t,e);n?this.paintInlineImageXObject(t,n):H("Dependent image isn't ready yet")}paintImageXObjectRepeat(t,e,n,i,s){if(!this.contentVisible)return;const r=this.getObject(t,e);if(!r)return void H("Dependent image isn't ready yet");const o=r.width,a=r.height,c=[];for(let t=0,e=s.length;t<e;t+=2)c.push({transform:[n,0,0,i,s[t],s[t+1]],x:0,y:0,w:o,h:a});this.paintInlineImageXObjectGroup(t,r,c)}applyTransferMapsToCanvas(t){return"none"!==this.current.transferMaps&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if("none"===this.current.transferMaps)return t.bitmap;const{bitmap:e,width:n,height:i}=t,s=this.cachedCanvases.getCanvas("inlineImage",n,i),r=s.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",s.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const n=e.width,i=e.height,s=this.ctx;this.save(t);const{filter:r}=s;let o;if("none"!==r&&""!==r&&(s.filter="none"),s.scale(1/n,-1/i),e.bitmap)o=this.applyTransferMapsToBitmap(e);else if("function"==typeof HTMLElement&&e instanceof HTMLElement||!e.data)o=e;else{const t=this.cachedCanvases.getCanvas("inlineImage",n,i).context;An(t,e),o=this.applyTransferMapsToCanvas(t)}const a=this._scaleImage(o,Dt(s));s.imageSmoothingEnabled=_n(Mt(s),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,s,0,n,-i,0).recordDependencies(t,Xe).recordOperation(t),bn(s,a.img,0,0,a.paintWidth,a.paintHeight,0,-i,n,i),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,n){if(!this.contentVisible)return;const i=this.ctx;let s;if(e.bitmap)s=e.bitmap;else{const t=e.width,n=e.height,i=this.cachedCanvases.getCanvas("inlineImage",t,n).context;An(i,e),s=this.applyTransferMapsToCanvas(i)}this.dependencyTracker?.resetBBox(t);for(const e of n)i.save(),i.transform(...e.transform),i.scale(1,-1),bn(i,s,e.x,e.y,e.w,e.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,i,0,1,-1,0),i.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,Ye).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,n){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,n){this.dependencyTracker?.beginMarkedContent(t),"OC"===e?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,n){const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const s=this.ctx;this.pendingClip?(i||(this.pendingClip===Rn?s.clip(e,"evenodd"):s.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=Mt(this.ctx);if(0===t[1]&&0===t[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),n=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(n,i)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){const{lineWidth:t}=this.current,{a:e,b:n,c:i,d:s}=this.ctx.getTransform();let r,o;if(0===n&&0===i){const n=Math.abs(e),i=Math.abs(s);if(n===i)if(0===t)r=o=1/n;else{const e=n*t;r=o=e<1?1/e:1}else if(0===t)r=1/n,o=1/i;else{const e=n*t,s=i*t;r=e<1?1/e:1,o=s<1?1/s:1}}else{const a=Math.abs(e*s-n*i),c=Math.hypot(e,n),l=Math.hypot(i,s);if(0===t)r=l/a,o=c/a;else{const e=t*a;r=l>e?l/e:1,o=c>e?c/e:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:n,current:{lineWidth:i}}=this,[s,r]=this.getScaleForStroking();if(s===r)return n.lineWidth=(i||1)*s,void n.stroke(t);const o=n.getLineDash();e&&n.save(),n.scale(s,r),fn.a=1/s,fn.d=1/r;const a=new Path2D;if(a.addPath(t,fn),o.length>0){const t=Math.max(s,r);n.setLineDash(o.map(e=>e/t)),n.lineDashOffset/=t}n.lineWidth=i||1,n.stroke(a),e&&n.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const t in B)void 0!==In.prototype[t]&&(In.prototype[B[t]]=In.prototype[t]);class Pn{#xi;#Si;#Ei;static strings=["fontFamily","fontWeight","italicAngle"];static write(t){const e=new TextEncoder,n={};let i=0;for(const s of Pn.strings){const r=e.encode(t[s]);n[s]=r,i+=4+r.length}const s=new ArrayBuffer(i),r=new Uint8Array(s),o=new DataView(s);let a=0;for(const t of Pn.strings){const e=n[t],i=e.length;o.setUint32(a,i),r.set(e,a+4),a+=4+i}return V(a===s.byteLength,"CssFontInfo.write: Buffer overflow"),s}constructor(t){this.#xi=t,this.#Si=new DataView(this.#xi),this.#Ei=new TextDecoder}#_i(t){V(t<Pn.strings.length,"Invalid string index");let e=0;for(let n=0;n<t;n++)e+=this.#Si.getUint32(e)+4;const n=this.#Si.getUint32(e);return this.#Ei.decode(new Uint8Array(this.#xi,e+4,n))}get fontFamily(){return this.#_i(0)}get fontWeight(){return this.#_i(1)}get italicAngle(){return this.#_i(2)}}class Mn{#xi;#Si;#Ei;static strings=["css","loadedName","baseFontName","src"];static write(t){const e=new TextEncoder,n={};let i=0;for(const s of Mn.strings){const r=e.encode(t[s]);n[s]=r,i+=4+r.length}i+=4;let s,r,o=1+i;t.style&&(s=e.encode(t.style.style),r=e.encode(t.style.weight),o+=4+s.length+4+r.length);const a=new ArrayBuffer(o),c=new Uint8Array(a),l=new DataView(a);let h=0;l.setUint8(h++,t.guessFallback?1:0),l.setUint32(h,0),h+=4,i=0;for(const t of Mn.strings){const e=n[t],s=e.length;i+=4+s,l.setUint32(h,s),c.set(e,h+4),h+=4+s}return l.setUint32(h-i-4,i),t.style&&(l.setUint32(h,s.length),c.set(s,h+4),h+=4+s.length,l.setUint32(h,r.length),c.set(r,h+4),h+=4+r.length),V(h<=a.byteLength,"SubstitionInfo.write: Buffer overflow"),a.transferToFixedLength(h)}constructor(t){this.#xi=t,this.#Si=new DataView(this.#xi),this.#Ei=new TextDecoder}get guessFallback(){return 0!==this.#Si.getUint8(0)}#_i(t){V(t<Mn.strings.length,"Invalid string index");let e=5;for(let n=0;n<t;n++)e+=this.#Si.getUint32(e)+4;const n=this.#Si.getUint32(e);return this.#Ei.decode(new Uint8Array(this.#xi,e+4,n))}get css(){return this.#_i(0)}get loadedName(){return this.#_i(1)}get baseFontName(){return this.#_i(2)}get src(){return this.#_i(3)}get style(){let t=1;t+=4+this.#Si.getUint32(t);const e=this.#Si.getUint32(t),n=this.#Ei.decode(new Uint8Array(this.#xi,t+4,e));t+=4+e;const i=this.#Si.getUint32(t);return{style:n,weight:this.#Ei.decode(new Uint8Array(this.#xi,t+4,i))}}}class Dn{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#Ci=Math.ceil(2*this.bools.length/8);static#Ti=this.#Ci+8*this.numbers.length;static#ki=this.#Ti+1+8;static#Ri=this.#ki+1+48;static#Ii=this.#Ri+1+6;#xi;#Ei;#Si;constructor({data:t,extra:e}){this.#xi=t,this.#Ei=new TextDecoder,this.#Si=new DataView(this.#xi),e&&Object.assign(this,e)}#Pi(t){V(t<Dn.bools.length,"Invalid boolean index");const e=Math.floor(t/4),n=2*t%8,i=this.#Si.getUint8(e)>>n&3;return 0===i?void 0:2===i}get black(){return this.#Pi(0)}get bold(){return this.#Pi(1)}get disableFontFace(){return this.#Pi(2)}get fontExtraProperties(){return this.#Pi(3)}get isInvalidPDFjsFont(){return this.#Pi(4)}get isType3Font(){return this.#Pi(5)}get italic(){return this.#Pi(6)}get missingFile(){return this.#Pi(7)}get remeasure(){return this.#Pi(8)}get vertical(){return this.#Pi(9)}#Mi(t){return V(t<Dn.numbers.length,"Invalid number index"),this.#Si.getFloat64(Dn.#Ci+8*t)}get ascent(){return this.#Mi(0)}get defaultWidth(){return this.#Mi(1)}get descent(){return this.#Mi(2)}get bbox(){let t=Dn.#Ti;if(0===this.#Si.getUint8(t))return;t+=1;const e=[];for(let n=0;n<4;n++)e.push(this.#Si.getInt16(t,!0)),t+=2;return e}get fontMatrix(){let t=Dn.#ki;if(0===this.#Si.getUint8(t))return;t+=1;const e=[];for(let n=0;n<6;n++)e.push(this.#Si.getFloat64(t,!0)),t+=8;return e}get defaultVMetrics(){let t=Dn.#Ri;if(0===this.#Si.getUint8(t))return;t+=1;const e=[];for(let n=0;n<3;n++)e.push(this.#Si.getInt16(t,!0)),t+=2;return e}#_i(t){V(t<Dn.strings.length,"Invalid string index");let e=Dn.#Ii+4;for(let n=0;n<t;n++)e+=this.#Si.getUint32(e)+4;const n=this.#Si.getUint32(e),i=new Uint8Array(n);return i.set(new Uint8Array(this.#xi,e+4,n)),this.#Ei.decode(i)}get fallbackName(){return this.#_i(0)}get loadedName(){return this.#_i(1)}get mimetype(){return this.#_i(2)}get name(){return this.#_i(3)}get data(){let t=Dn.#Ii;t+=4+this.#Si.getUint32(t),t+=4+this.#Si.getUint32(t),t+=4+this.#Si.getUint32(t);const e=this.#Si.getUint32(t);if(0!==e)return new Uint8Array(this.#xi,t+4,e)}clearData(){let t=Dn.#Ii;t+=4+this.#Si.getUint32(t),t+=4+this.#Si.getUint32(t),t+=4+this.#Si.getUint32(t);const e=this.#Si.getUint32(t);new Uint8Array(this.#xi,t+4,e).fill(0),this.#Si.setUint32(t,0)}get cssFontInfo(){let t=Dn.#Ii;t+=4+this.#Si.getUint32(t),t+=4+this.#Si.getUint32(t);const e=this.#Si.getUint32(t);if(0===e)return null;const n=new Uint8Array(e);return n.set(new Uint8Array(this.#xi,t+4,e)),new Pn(n.buffer)}get systemFontInfo(){let t=Dn.#Ii;t+=4+this.#Si.getUint32(t);const e=this.#Si.getUint32(t);if(0===e)return null;const n=new Uint8Array(e);return n.set(new Uint8Array(this.#xi,t+4,e)),new Mn(n.buffer)}static write(t){const e=t.systemFontInfo?Mn.write(t.systemFontInfo):null,n=t.cssFontInfo?Pn.write(t.cssFontInfo):null,i=new TextEncoder,s={};let r=0;for(const e of Dn.strings)s[e]=i.encode(t[e]),r+=4+s[e].length;const o=Dn.#Ii+4+r+4+(e?e.byteLength:0)+4+(n?n.byteLength:0)+4+(t.data?t.data.length:0),a=new ArrayBuffer(o),c=new Uint8Array(a),l=new DataView(a);let h=0;const d=Dn.bools.length;let u=0,p=0;for(let e=0;e<d;e++){const n=t[Dn.bools[e]];u|=(void 0===n?0:n?2:1)<<p,p+=2,8!==p&&e!==d-1||(l.setUint8(h++,u),u=0,p=0)}V(h===Dn.#Ci,"FontInfo.write: Boolean properties offset mismatch");for(const e of Dn.numbers)l.setFloat64(h,t[e]),h+=8;if(V(h===Dn.#Ti,"FontInfo.write: Number properties offset mismatch"),t.bbox){l.setUint8(h++,4);for(const e of t.bbox)l.setInt16(h,e,!0),h+=2}else l.setUint8(h++,0),h+=8;if(V(h===Dn.#ki,"FontInfo.write: BBox properties offset mismatch"),t.fontMatrix){l.setUint8(h++,6);for(const e of t.fontMatrix)l.setFloat64(h,e,!0),h+=8}else l.setUint8(h++,0),h+=48;if(V(h===Dn.#Ri,"FontInfo.write: FontMatrix properties offset mismatch"),t.defaultVMetrics){l.setUint8(h++,1);for(const e of t.defaultVMetrics)l.setInt16(h,e,!0),h+=2}else l.setUint8(h++,0),h+=6;V(h===Dn.#Ii,"FontInfo.write: DefaultVMetrics properties offset mismatch"),l.setUint32(Dn.#Ii,0),h+=4;for(const t of Dn.strings){const e=s[t],n=e.length;l.setUint32(h,n),c.set(e,h+4),h+=4+n}if(l.setUint32(Dn.#Ii,h-Dn.#Ii-4),e){const t=e.byteLength;l.setUint32(h,t),V(h+4+t<=a.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),c.set(new Uint8Array(e),h+4),h+=4+t}else l.setUint32(h,0),h+=4;if(n){const t=n.byteLength;l.setUint32(h,t),V(h+4+t<=a.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),c.set(new Uint8Array(n),h+4),h+=4+t}else l.setUint32(h,0),h+=4;return void 0===t.data?(l.setUint32(h,0),h+=4):(l.setUint32(h,t.data.length),c.set(t.data,h+4),h+=4+t.data.length),V(h<=a.byteLength,"FontInfo.write: Buffer overflow"),a.transferToFixedLength(h)}}class On{static#Di=null;static#Oi="";static get workerPort(){return this.#Di}static set workerPort(t){if(!("undefined"!=typeof Worker&&t instanceof Worker)&&null!==t)throw new Error("Invalid `workerPort` type.");this.#Di=t}static get workerSrc(){return this.#Oi}static set workerSrc(t){if("string"!=typeof t)throw new Error("Invalid `workerSrc` type.");this.#Oi=t}}class Ln{#Li;#Ni;constructor({parsedData:t,rawData:e}){this.#Li=t,this.#Ni=e}getRaw(){return this.#Ni}get(t){return this.#Li.get(t)??null}[Symbol.iterator](){return this.#Li.entries()}}const Nn=Symbol("INTERNAL");class Fn{#Fi=!1;#Bi=!1;#Ui=!1;#$i=!0;constructor(t,{name:e,intent:n,usage:i,rbGroups:s}){this.#Fi=!!(2&t),this.#Bi=!!(4&t),this.name=e,this.intent=n,this.usage=i,this.rbGroups=s}get visible(){if(this.#Ui)return this.#$i;if(!this.#$i)return!1;const{print:t,view:e}=this.usage;return this.#Fi?"OFF"!==e?.viewState:!this.#Bi||"OFF"!==t?.printState}_setVisible(t,e,n=!1){t!==Nn&&G("Internal method `_setVisible` called."),this.#Ui=n,this.#$i=e}}class Bn{#ji=null;#zi=new Map;#Hi=null;#Gi=null;constructor(t,e=2){if(this.renderingIntent=e,this.name=null,this.creator=null,null!==t){this.name=t.name,this.creator=t.creator,this.#Gi=t.order;for(const n of t.groups)this.#zi.set(n.id,new Fn(e,n));if("OFF"===t.baseState)for(const t of this.#zi.values())t._setVisible(Nn,!1);for(const e of t.on)this.#zi.get(e)._setVisible(Nn,!0);for(const e of t.off)this.#zi.get(e)._setVisible(Nn,!1);this.#Hi=this.getHash()}}#Vi(t){const e=t.length;if(e<2)return!0;const n=t[0];for(let i=1;i<e;i++){const e=t[i];let s;if(Array.isArray(e))s=this.#Vi(e);else{if(!this.#zi.has(e))return H(`Optional content group not found: ${e}`),!0;s=this.#zi.get(e).visible}switch(n){case"And":if(!s)return!1;break;case"Or":if(s)return!0;break;case"Not":return!s;default:return!0}}return"And"===n}isVisible(t){if(0===this.#zi.size)return!0;if(!t)return z("Optional content group not defined."),!0;if("OCG"===t.type)return this.#zi.has(t.id)?this.#zi.get(t.id).visible:(H(`Optional content group not found: ${t.id}`),!0);if("OCMD"===t.type){if(t.expression)return this.#Vi(t.expression);if(!t.policy||"AnyOn"===t.policy){for(const e of t.ids){if(!this.#zi.has(e))return H(`Optional content group not found: ${e}`),!0;if(this.#zi.get(e).visible)return!0}return!1}if("AllOn"===t.policy){for(const e of t.ids){if(!this.#zi.has(e))return H(`Optional content group not found: ${e}`),!0;if(!this.#zi.get(e).visible)return!1}return!0}if("AnyOff"===t.policy){for(const e of t.ids){if(!this.#zi.has(e))return H(`Optional content group not found: ${e}`),!0;if(!this.#zi.get(e).visible)return!0}return!1}if("AllOff"===t.policy){for(const e of t.ids){if(!this.#zi.has(e))return H(`Optional content group not found: ${e}`),!0;if(this.#zi.get(e).visible)return!1}return!0}return H(`Unknown optional content policy ${t.policy}.`),!0}return H(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,n=!0){const i=this.#zi.get(t);if(i){if(n&&e&&i.rbGroups.length)for(const e of i.rbGroups)for(const n of e)n!==t&&this.#zi.get(n)?._setVisible(Nn,!1,!0);i._setVisible(Nn,!!e,!0),this.#ji=null}else H(`Optional content group not found: ${t}`)}setOCGState({state:t,preserveRB:e}){let n;for(const i of t){switch(i){case"ON":case"OFF":case"Toggle":n=i;continue}const t=this.#zi.get(i);if(t)switch(n){case"ON":this.setVisibility(i,!0,e);break;case"OFF":this.setVisibility(i,!1,e);break;case"Toggle":this.setVisibility(i,!t.visible,e)}}this.#ji=null}get hasInitialVisibility(){return null===this.#Hi||this.getHash()===this.#Hi}getOrder(){return this.#zi.size?this.#Gi?this.#Gi.slice():[...this.#zi.keys()]:null}getGroup(t){return this.#zi.get(t)||null}getHash(){if(null!==this.#ji)return this.#ji;const t=new he;for(const[e,n]of this.#zi)t.update(`${e}:${n.visible}`);return this.#ji=t.hexdigest()}[Symbol.iterator](){return this.#zi.entries()}}class Un{constructor(t,{disableRange:e=!1,disableStream:n=!1}){V(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:s,progressiveDone:r,contentDispositionFilename:o}=t;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=o,s?.length>0){const t=s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer;this._queuedChunks.push(t)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!n,this._isRangeSupported=!e,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((t,e)=>{this._onReceiveData({begin:t,chunk:e})}),t.addProgressListener((t,e)=>{this._onProgress({loaded:t,total:e})}),t.addProgressiveReadListener(t=>{this._onReceiveData({chunk:t})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const n=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;void 0===t?this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n):V(this._rangeReaders.some(function(e){return e._begin===t&&(e._enqueue(n),!0)}),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){void 0===t.total?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){V(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new $n(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new jn(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class $n{constructor(t,e,n=!1,i=null){this._stream=t,this._done=n||!1,this._filename=xt(i)?i:null,this._queuedChunks=e||[],this._loaded=0;for(const t of this._queuedChunks)this._loaded+=t.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class jn{constructor(t,e,n){this._stream=t,this._begin=e,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(0===this._requests.length)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function zn(t,e){const n=new Headers;if(!t||!e||"object"!=typeof e)return n;for(const t in e){const i=e[t];void 0!==i&&n.append(t,i)}return n}function Hn(t){return URL.parse(t)?.origin??null}function Gn({responseHeaders:t,isHttp:e,rangeChunkSize:n,disableRange:i}){const s={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(t.get("Content-Length"),10);return Number.isInteger(r)?(s.suggestedLength=r,r<=2*n||i||!e||"bytes"!==t.get("Accept-Ranges")||"identity"!==(t.get("Content-Encoding")||"identity")||(s.allowRangeRequests=!0),s):s}function Vn(t){const e=t.get("Content-Disposition");if(e){let t=function(t){let e=!0,n=i("filename\\*","i").exec(t);if(n){n=n[1];let t=o(n);return t=unescape(t),t=a(t),t=c(t),r(t)}if(n=function(t){const e=[];let n;const s=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(n=s.exec(t));){let[,t,i,s]=n;if(t=parseInt(t,10),t in e){if(0===t)break}else e[t]=[i,s]}const r=[];for(let t=0;t<e.length&&t in e;++t){let[n,i]=e[t];i=o(i),n&&(i=unescape(i),0===t&&(i=a(i))),r.push(i)}return r.join("")}(t),n)return r(c(n));if(n=i("filename","i").exec(t),n){n=n[1];let t=o(n);return t=c(t),r(t)}function i(t,e){return new RegExp("(?:^|;)\\s*"+t+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',e)}function s(t,n){if(t){if(!/^[\x00-\xFF]+$/.test(n))return n;try{const i=new TextDecoder(t,{fatal:!0}),s=it(n);n=i.decode(s),e=!1}catch{}}return n}function r(t){return e&&/[\x80-\xff]/.test(t)&&(t=s("utf-8",t),e&&(t=s("iso-8859-1",t))),t}function o(t){if(t.startsWith('"')){const e=t.slice(1).split('\\"');for(let t=0;t<e.length;++t){const n=e[t].indexOf('"');-1!==n&&(e[t]=e[t].slice(0,n),e.length=t+1),e[t]=e[t].replaceAll(/\\(.)/g,"$1")}t=e.join('"')}return t}function a(t){const e=t.indexOf("'");return-1===e?t:s(t.slice(0,e),t.slice(e+1).replace(/^[^']*'/,""))}function c(t){return!t.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(t)?t:t.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(t,e,n,i){if("q"===n||"Q"===n)return s(e,i=(i=i.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,function(t,e){return String.fromCharCode(parseInt(e,16))}));try{i=atob(i)}catch{}return s(e,i)})}return""}(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(xt(t))return t}return null}function Wn(t,e){return new Z(`Unexpected server response (${t}) while retrieving PDF "${e}".`,t,404===t||0===t&&e.startsWith("file:"))}function qn(t){return 200===t||206===t}function Kn(t,e,n){return{method:"GET",headers:t,signal:n.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function Yn(t){return t instanceof Uint8Array?t.buffer:t instanceof ArrayBuffer?t:(H(`getArrayBuffer - unexpected data format: ${t}`),new Uint8Array(t).buffer)}class Xn{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=zn(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return V(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Jn(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new Qn(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Jn{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const n=new Headers(t.headers),i=e.url;fetch(i,Kn(n,this._withCredentials,this._abortController)).then(e=>{if(t._responseOrigin=Hn(e.url),!qn(e.status))throw Wn(e.status,i);this._reader=e.body.getReader(),this._headersCapability.resolve();const n=e.headers,{allowRangeRequests:s,suggestedLength:r}=Gn({responseHeaders:n,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=s,this._contentLength=r||this._contentLength,this._filename=Vn(n),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new et("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Yn(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class Qn{constructor(t,e,n){this._stream=t,this._reader=null,this._loaded=0;const i=t.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const s=new Headers(t.headers);s.append("Range",`bytes=${e}-${n-1}`);const r=i.url;fetch(r,Kn(s,this._withCredentials,this._abortController)).then(e=>{const n=Hn(e.url);if(n!==t._responseOrigin)throw new Error(`Expected range response-origin "${n}" to match "${t._responseOrigin}".`);if(!qn(e.status))throw Wn(e.status,r);this._readCapability.resolve(),this._reader=e.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Yn(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class Zn{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:n}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=zn(this.isHttp,e),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,n=this.currXhrId++,i=this.pendingRequests[n]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[t,n]of this.headers)e.setRequestHeader(t,n);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),i.expectedStatus=206):i.expectedStatus=200,e.responseType="arraybuffer",V(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,n),e.onprogress=this.onProgress.bind(this,n),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),n}onProgress(t,e){const n=this.pendingRequests[t];n&&n.onProgress?.(e)}onStateChange(t,e){const n=this.pendingRequests[t];if(!n)return;const i=n.xhr;if(i.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),4!==i.readyState)return;if(!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],0===i.status&&this.isHttp)return void n.onError(i.status);const s=i.status||200;if((200!==s||206!==n.expectedStatus)&&s!==n.expectedStatus)return void n.onError(i.status);const r=function(t){const e=t.response;return"string"!=typeof e?e:it(e).buffer}(i);if(206===s){const t=i.getResponseHeader("Content-Range"),e=/bytes (\d+)-(\d+)\/(\d+)/.exec(t);e?n.onDone({begin:parseInt(e[1],10),chunk:r}):(H('Missing or invalid "Content-Range" header.'),n.onError(0))}else r?n.onDone({begin:0,chunk:r}):n.onError(i.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class ti{constructor(t){this._source=t,this._manager=new Zn(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return V(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new ei(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const n=new ni(this._manager,t,e);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class ei{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=Hn(e.responseURL);const n=e.getAllResponseHeaders(),i=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(t=>{const[e,...n]=t.split(": ");return[e,n.join(": ")]}):[]),{allowRangeRequests:s,suggestedLength:r}=Gn({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=Vn(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Wn(t,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class ni{constructor(t,e,n){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=Hn(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=Wn(t,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const ii=/^[a-z][a-z0-9\-+.]+:/i;class si{constructor(t){this.source=t,this.url=function(t){if(ii.test(t))return new URL(t);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(t))}(t.url),V("file:"===this.url.protocol,"PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return V(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new ri(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new oi(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class ri{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(t=>{this._contentLength=t.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},t=>{"ENOENT"===t.code&&(t=Wn(0,this._url.href)),this._storedError=t,this._headersCapability.reject(t)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return null===t?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new et("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class oi{constructor(t,e,n){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=t.source;this._isStreamingSupported=!i.disableStream;const s=process.getBuiltinModule("fs");this._setReadableStream(s.createReadStream(this._url,{start:e,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return null===t?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const ai=Symbol("INITIAL_DATA");class ci{#Wi=Object.create(null);#qi(t){return this.#Wi[t]||={...Promise.withResolvers(),data:ai}}get(t,e=null){if(e){const n=this.#qi(t);return n.promise.then(()=>e(n.data)),null}const n=this.#Wi[t];if(!n||n.data===ai)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return n.data}has(t){const e=this.#Wi[t];return!!e&&e.data!==ai}delete(t){const e=this.#Wi[t];return!(!e||e.data===ai||(delete this.#Wi[t],0))}resolve(t,e=null){const n=this.#qi(t);n.data=e,n.resolve()}clear(){for(const t in this.#Wi){const{data:e}=this.#Wi[t];e?.bitmap?.close()}this.#Wi=Object.create(null)}*[Symbol.iterator](){for(const t in this.#Wi){const{data:e}=this.#Wi[t];e!==ai&&(yield[t,e])}}}class li{#Ki=Promise.withResolvers();#At=null;#Yi=!1;#Xi=!!globalThis.FontInspector?.enabled;#Ji=null;#Qi=null;#Zi=0;#ts=0;#es=null;#ns=null;#is=0;#ss=0;#rs=Object.create(null);#os=[];#as=null;#cs=[];#ls=new WeakMap;#hs=null;static#ds=new Map;static#us=new Map;static#ps=new WeakMap;static#gs=null;static#fs=new Set;constructor({textContentSource:t,container:e,viewport:n}){if(t instanceof ReadableStream)this.#as=t;else{if("object"!=typeof t)throw new Error('No "textContentSource" parameter specified.');this.#as=new ReadableStream({start(e){e.enqueue(t),e.close()}})}this.#At=this.#ns=e,this.#ss=n.scale*Lt.pixelRatio,this.#is=n.rotation,this.#Qi={div:null,properties:null,ctx:null};const{pageWidth:i,pageHeight:s,pageX:r,pageY:o}=n.rawDims;this.#hs=[1,0,0,-1,-r,o+s],this.#ts=i,this.#Zi=s,li.#ms(),Ot(e,n),this.#Ki.promise.finally(()=>{li.#fs.delete(this),this.#Qi=null,this.#rs=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=st.platform;return K(this,"fontFamilyMap",new Map([["sans-serif",(t&&e?"Calibri, ":"")+"sans-serif"],["monospace",(t&&e?"Lucida Console, ":"")+"monospace"]]))}render(){const t=()=>{this.#es.read().then(({value:e,done:n})=>{n?this.#Ki.resolve():(this.#Ji??=e.lang,Object.assign(this.#rs,e.styles),this.#vs(e.items),t())},this.#Ki.reject)};return this.#es=this.#as.getReader(),li.#fs.add(this),t(),this.#Ki.promise}update({viewport:t,onBefore:e=null}){const n=t.scale*Lt.pixelRatio,i=t.rotation;if(i!==this.#is&&(e?.(),this.#is=i,Ot(this.#ns,{rotation:i})),n!==this.#ss){e?.(),this.#ss=n;const t={div:null,properties:null,ctx:li.#ys(this.#Ji)};for(const e of this.#cs)t.properties=this.#ls.get(e),t.div=e,this.#bs(t)}}cancel(){const t=new et("TextLayer task cancelled.");this.#es?.cancel(t).catch(()=>{}),this.#es=null,this.#Ki.reject(t)}get textDivs(){return this.#cs}get textContentItemsStr(){return this.#os}#vs(t){if(this.#Yi)return;this.#Qi.ctx??=li.#ys(this.#Ji);const e=this.#cs,n=this.#os;for(const i of t){if(e.length>1e5)return H("Ignoring additional textDivs for performance reasons."),void(this.#Yi=!0);if(void 0!==i.str)n.push(i.str),this.#ws(i);else if("beginMarkedContentProps"===i.type||"beginMarkedContent"===i.type){const t=this.#At;this.#At=document.createElement("span"),this.#At.classList.add("markedContent"),i.id&&this.#At.setAttribute("id",`${i.id}`),t.append(this.#At)}else"endMarkedContent"===i.type&&(this.#At=this.#At.parentNode)}}#ws(t){const e=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:""!==t.str,hasEOL:t.hasEOL,fontSize:0};this.#cs.push(e);const i=ot.transform(this.#hs,t.transform);let s=Math.atan2(i[1],i[0]);const r=this.#rs[t.fontName];r.vertical&&(s+=Math.PI/2);let o=this.#Xi&&r.fontSubstitution||r.fontFamily;o=li.fontFamilyMap.get(o)||o;const a=Math.hypot(i[2],i[3]),c=a*li.#As(o,r,this.#Ji);let l,h;0===s?(l=i[4],h=i[5]-c):(l=i[4]+c*Math.sin(s),h=i[5]-c*Math.cos(s));const d="calc(var(--total-scale-factor) *",u=e.style;this.#At===this.#ns?(u.left=`${(100*l/this.#ts).toFixed(2)}%`,u.top=`${(100*h/this.#Zi).toFixed(2)}%`):(u.left=`${d}${l.toFixed(2)}px)`,u.top=`${d}${h.toFixed(2)}px)`),u.fontSize=`${d}${(li.#gs*a).toFixed(2)}px)`,u.fontFamily=o,n.fontSize=a,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#Xi&&(e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName),0!==s&&(n.angle=s*(180/Math.PI));let p=!1;if(t.str.length>1)p=!0;else if(" "!==t.str&&t.transform[0]!==t.transform[3]){const e=Math.abs(t.transform[0]),n=Math.abs(t.transform[3]);e!==n&&Math.max(e,n)/Math.min(e,n)>1.5&&(p=!0)}if(p&&(n.canvasWidth=r.vertical?t.height:t.width),this.#ls.set(e,n),this.#Qi.div=e,this.#Qi.properties=n,this.#bs(this.#Qi),n.hasText&&this.#At.append(e),n.hasEOL){const t=document.createElement("br");t.setAttribute("role","presentation"),this.#At.append(t)}}#bs(t){const{div:e,properties:n,ctx:i}=t,{style:s}=e;let r="";if(li.#gs>1&&(r=`scale(${1/li.#gs})`),0!==n.canvasWidth&&n.hasText){const{fontFamily:t}=s,{canvasWidth:o,fontSize:a}=n;li.#xs(i,a*this.#ss,t);const{width:c}=i.measureText(e.textContent);c>0&&(r=`scaleX(${o*this.#ss/c}) ${r}`)}0!==n.angle&&(r=`rotate(${n.angle}deg) ${r}`),r.length>0&&(s.transform=r)}static cleanup(){if(!(this.#fs.size>0)){this.#ds.clear();for(const{canvas:t}of this.#us.values())t.remove();this.#us.clear()}}static#ys(t=null){let e=this.#us.get(t||="");if(!e){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=t,document.body.append(n),e=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#us.set(t,e),this.#ps.set(e,{size:0,family:""})}return e}static#xs(t,e,n){const i=this.#ps.get(t);e===i.size&&n===i.family||(t.font=`${e}px ${n}`,i.size=e,i.family=n)}static#ms(){if(null!==this.#gs)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#gs=t.getBoundingClientRect().height,t.remove()}static#As(t,e,n){const i=this.#ds.get(t);if(i)return i;const s=this.#ys(n);s.canvas.width=s.canvas.height=30,this.#xs(s,30,t);const r=s.measureText(""),o=r.fontBoundingBoxAscent,a=Math.abs(r.fontBoundingBoxDescent);s.canvas.width=s.canvas.height=0;let c=.8;return o?c=o/(o+a):(st.platform.isFirefox&&H("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?c=e.ascent:e.descent&&(c=1+e.descent)),this.#ds.set(t,c),c}}function hi(t={}){"string"==typeof t||t instanceof URL?t={url:t}:(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});const e=new di,{docId:n}=e,i=t.url?function(t){if(t instanceof URL)return t.href;if("string"==typeof t){if(T)return t;const e=URL.parse(t,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(t.url):null,s=t.data?function(t){if(T&&"undefined"!=typeof Buffer&&t instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength)return t;if("string"==typeof t)return it(t);if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)||"object"==typeof t&&!isNaN(t?.length))return new Uint8Array(t);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(t.data):null,r=t.httpHeaders||null,o=!0===t.withCredentials,a=t.password??null,c=t.range instanceof ui?t.range:null,l=Number.isInteger(t.rangeChunkSize)&&t.rangeChunkSize>0?t.rangeChunkSize:65536;let h=t.worker instanceof mi?t.worker:null;const d=t.verbosity,u="string"!=typeof t.docBaseUrl||At(t.docBaseUrl)?null:t.docBaseUrl,p=me(t.cMapUrl),g=!1!==t.cMapPacked,f=t.CMapReaderFactory||(T?Ne:Ce),m=me(t.iccUrl),v=me(t.standardFontDataUrl),y=t.StandardFontDataFactory||(T?Fe:Ie),b=me(t.wasmUrl),w=t.WasmFactory||(T?Be:Me),A=!0!==t.stopAtErrors,x=Number.isInteger(t.maxImageSize)&&t.maxImageSize>-1?t.maxImageSize:-1,S=!1!==t.isEvalSupported,E="boolean"==typeof t.isOffscreenCanvasSupported?t.isOffscreenCanvasSupported:!T,_="boolean"==typeof t.isImageDecoderSupported?t.isImageDecoderSupported:!T&&(st.platform.isFirefox||!globalThis.chrome),C=Number.isInteger(t.canvasMaxAreaInBytes)?t.canvasMaxAreaInBytes:-1,k="boolean"==typeof t.disableFontFace?t.disableFontFace:T,R=!0===t.fontExtraProperties,I=!0===t.enableXfa,P=t.ownerDocument||globalThis.document,M=!0===t.disableRange,D=!0===t.disableStream,O=!0===t.disableAutoFetch,L=!0===t.pdfBug,N=t.CanvasFactory||(T?Le:Ee),F=t.FilterFactory||(T?Oe:ke),B=!0===t.enableHWA,U=!1!==t.useWasm,j=c?c.length:t.length??NaN,z="boolean"==typeof t.useSystemFonts?t.useSystemFonts:!T&&!k,H="boolean"==typeof t.useWorkerFetch?t.useWorkerFetch:!!(f===Ce&&y===Ie&&w===Me&&p&&v&&b&&Ct(p,document.baseURI)&&Ct(v,document.baseURI)&&Ct(b,document.baseURI));var G;G=d,Number.isInteger(G)&&($=G);const V={canvasFactory:new N({ownerDocument:P,enableHWA:B}),filterFactory:new F({docId:n,ownerDocument:P}),cMapReaderFactory:H?null:new f({baseUrl:p,isCompressed:g}),standardFontDataFactory:H?null:new y({baseUrl:v}),wasmFactory:H?null:new w({baseUrl:b})};h||(h=mi.create({verbosity:d,port:On.workerPort}),e._worker=h);const W={docId:n,apiVersion:"5.4.296",data:s,password:a,disableAutoFetch:O,rangeChunkSize:l,length:j,docBaseUrl:u,enableXfa:I,evaluatorOptions:{maxImageSize:x,disableFontFace:k,ignoreErrors:A,isEvalSupported:S,isOffscreenCanvasSupported:E,isImageDecoderSupported:_,canvasMaxAreaInBytes:C,fontExtraProperties:R,useSystemFonts:z,useWasm:U,useWorkerFetch:H,cMapUrl:p,iccUrl:m,standardFontDataUrl:v,wasmUrl:b}},q={ownerDocument:P,pdfBug:L,styleElement:null,loadingParams:{disableAutoFetch:O,enableXfa:I}};return h.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const t=h.messageHandler.sendWithPromise("GetDocRequest",W,s?[s.buffer]:null);let a;if(c)a=new Un(c,{disableRange:M,disableStream:D});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");const t=Ct(i)?Xn:T?si:ti;a=new t({url:i,length:j,httpHeaders:r,withCredentials:o,rangeChunkSize:l,disableRange:M,disableStream:D})}return t.then(t=>{if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const i=new xe(n,t,h.port),s=new vi(i,e,a,q,V,B);e._transport=s,i.send("Ready",null)})}).catch(e._capability.reject),e}class di{static#Ln=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId="d"+di.#Ln++;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await(this._transport?.destroy())}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class ui{#Ki=Promise.withResolvers();#Ss=[];#Es=[];#_s=[];#Cs=[];constructor(t,e,n=!1,i=null){this.length=t,this.initialData=e,this.progressiveDone=n,this.contentDispositionFilename=i}addRangeListener(t){this.#Cs.push(t)}addProgressListener(t){this.#_s.push(t)}addProgressiveReadListener(t){this.#Es.push(t)}addProgressiveDoneListener(t){this.#Ss.push(t)}onDataRange(t,e){for(const n of this.#Cs)n(t,e)}onDataProgress(t,e){this.#Ki.promise.then(()=>{for(const n of this.#_s)n(t,e)})}onDataProgressiveRead(t){this.#Ki.promise.then(()=>{for(const e of this.#Es)e(t)})}onDataProgressiveDone(){this.#Ki.promise.then(()=>{for(const t of this.#Ss)t()})}transportReady(){this.#Ki.resolve()}requestDataRange(t,e){G("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class pi{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return K(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class gi{#Ts=!1;constructor(t,e,n,i=!1){this._pageIndex=t,this._pageInfo=e,this._transport=n,this._stats=i?new _t:null,this._pdfBug=i,this.commonObjs=n.commonObjs,this.objs=new ci,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:n=0,offsetY:i=0,dontFlip:s=!1}={}){return new bt({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:i,dontFlip:s})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return K(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:n,intent:i="display",annotationMode:s=I.ENABLE,transform:r=null,background:o=null,optionalContentConfigPromise:a=null,annotationCanvasMap:c=null,pageColors:l=null,printAnnotationStorage:h=null,isEditing:d=!1,recordOperations:u=!1,operationsFilter:p=null}){this._stats?.time("Overall");const g=this._transport.getRenderingIntent(i,s,h,d),{renderingIntent:f,cacheKey:m}=g;this.#Ts=!1,a||=this._transport.getOptionalContentConfig(f);let v=this._intentStates.get(m);v||(v=Object.create(null),this._intentStates.set(m,v)),v.streamReaderCancelTimeout&&(clearTimeout(v.streamReaderCancelTimeout),v.streamReaderCancelTimeout=null);const y=!!(4&f);v.displayReadyCapability||(v.displayReadyCapability=Promise.withResolvers(),v.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(g));const b=Boolean(this._pdfBug&&globalThis.StepperManager?.enabled),w=!this.recordedBBoxes&&(u||b),A=t=>{if(v.renderTasks.delete(x),w){const t=x.gfx?.dependencyTracker.take();t&&(x.stepper&&x.stepper.setOperatorBBoxes(t,x.gfx.dependencyTracker.takeDebugMetadata()),u&&(this.recordedBBoxes=t))}y&&(this.#Ts=!0),this.#ks(),t?(x.capability.reject(t),this._abortOperatorList({intentState:v,reason:t instanceof Error?t:new Error(t)})):x.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},x=new bi({callback:A,params:{canvas:e,canvasContext:t,dependencyTracker:w?new We(e,v.operatorList.length,b):null,viewport:n,transform:r,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:v.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!y,pdfBug:this._pdfBug,pageColors:l,enableHWA:this._transport.enableHWA,operationsFilter:p});(v.renderTasks||=new Set).add(x);const S=x.task;return Promise.all([v.displayReadyCapability.promise,a]).then(([t,e])=>{if(this.destroyed)A();else{if(this._stats?.time("Rendering"),!(e.renderingIntent&f))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");x.initializeGraphics({transparency:t,optionalContentConfig:e}),x.operatorListChanged()}}).catch(A),S}getOperatorList({intent:t="display",annotationMode:e=I.ENABLE,printAnnotationStorage:n=null,isEditing:i=!1}={}){const s=this._transport.getRenderingIntent(t,e,n,i,!0);let r,o=this._intentStates.get(s.cacheKey);return o||(o=Object.create(null),this._intentStates.set(s.cacheKey,o)),o.opListReadCapability||(r=Object.create(null),r.operatorListChanged=function(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(r))},o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||=new Set).add(r),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(s)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===t,disableNormalization:!0===e},{highWaterMark:100,size:t=>t.items.length})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(t=>gt.textContent(t));const e=this.streamTextContent(t);return new Promise(function(t,n){const i=e.getReader(),s={items:[],styles:Object.create(null),lang:null};!function e(){i.read().then(function({value:n,done:i}){i?t(s):(s.lang??=n.lang,Object.assign(s.styles,n.styles),s.items.push(...n.items),e())},n)}()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const n of e.renderTasks)t.push(n.completed),n.cancel();return this.objs.clear(),this.#Ts=!1,Promise.all(t)}cleanup(t=!1){this.#Ts=!0;const e=this.#ks();return t&&e&&(this._stats&&=new _t),e}#ks(){if(!this.#Ts||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#Ts=!1,!0}_startRenderPage(t,e){const n=this._intentStates.get(e);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let n=0,i=t.length;n<i;n++)e.operatorList.fnArray.push(t.fnArray[n]),e.operatorList.argsArray.push(t.argsArray[n]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const t of e.renderTasks)t.operatorListChanged();t.lastChunk&&this.#ks()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:n,modifiedIds:i}){const{map:s,transfer:r}=n,o=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:s,modifiedIds:i},r).getReader(),a=this._intentStates.get(e);a.streamReader=o;const c=()=>{o.read().then(({value:t,done:e})=>{e?a.streamReader=null:this._transport.destroyed||(this._renderPageChunk(t,a),c())},t=>{if(a.streamReader=null,!this._transport.destroyed){if(a.operatorList){a.operatorList.lastChunk=!0;for(const t of a.renderTasks)t.operatorListChanged();this.#ks()}if(a.displayReadyCapability)a.displayReadyCapability.reject(t);else{if(!a.opListReadCapability)throw t;a.opListReadCapability.reject(t)}}})};c()}_abortOperatorList({intentState:t,reason:e,force:n=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!n){if(t.renderTasks.size>0)return;if(e instanceof wt){let n=100;return e.extraDelay>0&&e.extraDelay<1e3&&(n+=e.extraDelay),void(t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},n))}}if(t.streamReader.cancel(new et(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[e,n]of this._intentStates)if(n===t){this._intentStates.delete(e);break}this.cleanup()}}}get stats(){return this._stats}}const fi=class t{constructor({name:e=null,port:n=null,verbosity:a=j()}={}){if(w(this,h),w(this,i,Promise.withResolvers()),w(this,s,null),w(this,r,null),w(this,o,null),this.name=e,this.destroyed=!1,this.verbosity=a,n){if(b(t,l).has(n))throw new Error("Cannot use more than one PDFWorker per port.");b(t,l).set(n,this),x(this,h,u).call(this,n)}else x(this,h,p).call(this)}get promise(){return b(this,i).promise}get port(){return b(this,r)}get messageHandler(){return b(this,s)}destroy(){this.destroyed=!0,b(this,o)?.terminate(),A(this,o,null),b(t,l).delete(b(this,r)),A(this,r,null),b(this,s)?.destroy(),A(this,s,null)}static create(e){const n=b(this,l).get(e?.port);if(n){if(n._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return n}return new t(e)}static get workerSrc(){if(On.workerSrc)return On.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return K(this,"_setupFakeWorkerGlobal",(async()=>b(this,f,m)?b(this,f,m):(await n(4559)(this.workerSrc)).WorkerMessageHandler)())}};i=new WeakMap,s=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap,c=new WeakMap,l=new WeakMap,h=new WeakSet,d=function(){b(this,i).resolve(),b(this,s).send("configure",{verbosity:this.verbosity})},u=function(t){A(this,r,t),A(this,s,new xe("main","worker",t)),b(this,s).on("ready",()=>{}),x(this,h,d).call(this)},p=function(){if(b(fi,c)||b(fi,f,m))return void x(this,h,g).call(this);let{workerSrc:t}=fi;try{fi._isSameOrigin(window.location,t)||(t=fi._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),n=new xe("main","worker",e),a=()=>{c.abort(),n.destroy(),e.terminate(),this.destroyed?b(this,i).reject(new Error("Worker was destroyed")):x(this,h,g).call(this)},c=new AbortController;e.addEventListener("error",()=>{b(this,o)||a()},{signal:c.signal}),n.on("test",t=>{c.abort(),!this.destroyed&&t?(A(this,s,n),A(this,r,e),A(this,o,e),x(this,h,d).call(this)):a()}),n.on("ready",t=>{if(c.abort(),this.destroyed)a();else try{l()}catch{x(this,h,g).call(this)}});const l=()=>{const t=new Uint8Array;n.send("test",t,[t.buffer])};return void l()}catch{z("The worker has been disabled.")}x(this,h,g).call(this)},g=function(){b(fi,c)||(H("Setting up fake worker."),A(fi,c,!0)),fi._setupFakeWorkerGlobal.then(t=>{if(this.destroyed)return void b(this,i).reject(new Error("Worker was destroyed"));const e=new be;A(this,r,e);const n="fake"+(o=fi,c=a,{set _(t){A(o,c,t,void 0)},get _(){return b(o,c,void 0)}})._++;var o,c;const l=new xe(n+"_worker",n,e);t.setup(l,e),A(this,s,new xe(n,n+"_worker",e)),x(this,h,d).call(this)}).catch(t=>{b(this,i).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},f=new WeakSet,m=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},w(fi,f),w(fi,a,0),w(fi,c,!1),w(fi,l,new WeakMap),T&&(A(fi,c,!0),On.workerSrc||="./pdf.worker.mjs"),fi._isSameOrigin=(t,e)=>{const n=URL.parse(t);if(!n?.origin||"null"===n.origin)return!1;const i=new URL(e,n);return n.origin===i.origin},fi._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},fi.fromPort=t=>{if(console.log("Deprecated API usage: `PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return fi.create(t)};let mi=fi;class vi{#Rs=new Map;#Is=new Map;#Ps=new Map;#Ms=new Map;#Ds=null;constructor(t,e,n,i,s,r){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new ci,this.fontLoader=new ge({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.wasmFactory=s.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=r,this.setupMessageHandler()}#Os(t,e=null){const n=this.#Rs.get(t);if(n)return n;const i=this.messageHandler.sendWithPromise(t,e);return this.#Rs.set(t,i),i}get annotationStorage(){return K(this,"annotationStorage",new ue)}getRenderingIntent(t,e=I.ENABLE,n=null,i=!1,s=!1){let r=2,o=de;switch(t){case"any":r=1;break;case"display":break;case"print":r=4;break;default:H(`getRenderingIntent - invalid intent: ${t}`)}const a=4&r&&n instanceof pe?n:this.annotationStorage;switch(e){case I.DISABLE:r+=64;break;case I.ENABLE:break;case I.ENABLE_FORMS:r+=16;break;case I.ENABLE_STORAGE:r+=32,o=a.serializable;break;default:H(`getRenderingIntent - invalid annotationMode: ${e}`)}i&&(r+=128),s&&(r+=256);const{ids:c,hash:l}=a.modifiedIds;return{renderingIntent:r,cacheKey:[r,o.hash,l].join("_"),annotationStorageSerializable:o,modifiedIds:c}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#Ds?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const e of this.#Is.values())t.push(e._destroy());this.#Is.clear(),this.#Ps.clear(),this.#Ms.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#Rs.clear(),this.filterFactory.destroy(),li.cleanup(),this._networkStream?.cancelAllRequests(new et("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(t,e)=>{V(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=t=>{this._lastProgress={loaded:t.loaded,total:t.total}},e.onPull=()=>{this._fullReader.read().then(function({value:t,done:n}){n?e.close():(V(t instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),e.enqueue(new Uint8Array(t),1,[t]))}).catch(t=>{e.error(t)})},e.onCancel=t=>{this._fullReader.cancel(t),e.ready.catch(t=>{if(!this.destroyed)throw t})}}),t.on("ReaderHeadersReady",async t=>{await this._fullReader.headersReady;const{isStreamingSupported:n,isRangeSupported:i,contentLength:s}=this._fullReader;return n&&i||(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=t=>{e.onProgress?.({loaded:t.loaded,total:t.total})}),{isStreamingSupported:n,isRangeSupported:i,contentLength:s}}),t.on("GetRangeReader",(t,e)=>{V(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(t.begin,t.end);n?(e.onPull=()=>{n.read().then(function({value:t,done:n}){n?e.close():(V(t instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),e.enqueue(new Uint8Array(t),1,[t]))}).catch(t=>{e.error(t)})},e.onCancel=t=>{n.cancel(t),e.ready.catch(t=>{if(!this.destroyed)throw t})}):e.close()}),t.on("GetDoc",({pdfInfo:t})=>{this._numPages=t.numPages,this._htmlForXfa=t.htmlForXfa,delete t.htmlForXfa,e._capability.resolve(new pi(t,this))}),t.on("DocException",t=>{e._capability.reject(Ae(t))}),t.on("PasswordRequest",t=>{this.#Ds=Promise.withResolvers();try{if(!e.onPassword)throw Ae(t);const n=t=>{t instanceof Error?this.#Ds.reject(t):this.#Ds.resolve({password:t})};e.onPassword(n,t.code)}catch(t){this.#Ds.reject(t)}return this.#Ds.promise}),t.on("DataLoaded",t=>{e.onProgress?.({loaded:t.length,total:t.length}),this.downloadInfoCapability.resolve(t)}),t.on("StartRenderPage",t=>{this.destroyed||this.#Is.get(t.pageIndex)._startRenderPage(t.transparency,t.cacheKey)}),t.on("commonobj",([e,n,i])=>{if(this.destroyed)return null;if(this.commonObjs.has(e))return null;switch(n){case"Font":if("error"in i){const t=i.error;H(`Error during font loading: ${t}`),this.commonObjs.resolve(e,t);break}const s=new Dn(i),r=this._params.pdfBug&&globalThis.FontInspector?.enabled?(t,e)=>globalThis.FontInspector.fontAdded(t,e):null,o=new fe(s,r,i.extra,i.charProcOperatorList);this.fontLoader.bind(o).catch(()=>t.sendWithPromise("FontFallback",{id:e})).finally(()=>{!o.fontExtraProperties&&o.data&&o.clearData(),this.commonObjs.resolve(e,o)});break;case"CopyLocalImage":const{imageRef:a}=i;V(a,"The imageRef must be defined.");for(const t of this.#Is.values())for(const[,n]of t.objs)if(n?.ref===a)return n.dataLen?(this.commonObjs.resolve(e,structuredClone(n)),n.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(e,i);break;default:throw new Error(`Got unknown common object type ${n}`)}return null}),t.on("obj",([t,e,n,i])=>{if(this.destroyed)return;const s=this.#Is.get(e);if(!s.objs.has(t))if(0!==s._intentStates.size)switch(n){case"Image":case"Pattern":s.objs.resolve(t,i);break;default:throw new Error(`Got unknown object type ${n}`)}else i?.bitmap?.close()}),t.on("DocProgress",t=>{this.destroyed||e.onProgress?.({loaded:t.loaded,total:t.total})}),t.on("FetchBinaryData",async t=>{if(this.destroyed)throw new Error("Worker was destroyed.");const e=this[t.type];if(!e)throw new Error(`${t.type} not initialized, see the \`useWorkerFetch\` parameter.`);return e.fetch(t)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&H("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,n=this.#Ps.get(e);if(n)return n;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&this.#Ms.set(n.refStr,t);const i=new gi(e,n,this,this._params.pdfBug);return this.#Is.set(e,i),i});return this.#Ps.set(e,i),i}getPageIndex(t){return ve(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#Os("GetFieldObjects")}hasJSActions(){return this.#Os("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return"string"!=typeof t?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#Os("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#Os("GetOptionalContentConfig").then(e=>new Bn(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#Rs.get(t);if(e)return e;const n=this.messageHandler.sendWithPromise(t,null).then(t=>({info:t[0],metadata:t[1]?new Ln(t[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#Rs.set(t,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#Is.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#Rs.clear(),this.filterFactory.destroy(!0),li.cleanup()}}cachedPageNumber(t){if(!ve(t))return null;const e=0===t.gen?`${t.num}R`:`${t.num}R${t.gen}`;return this.#Ms.get(e)??null}}class yi{#Ls=null;onContinue=null;onError=null;constructor(t){this.#Ls=t}get promise(){return this.#Ls.capability.promise}cancel(t=0){this.#Ls.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#Ls.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#Ls;return t.form||t.canvas&&e?.size>0}}class bi{#Ns=null;static#Fs=new WeakSet;constructor({callback:t,params:e,objs:n,commonObjs:i,annotationCanvasMap:s,operatorList:r,pageIndex:o,canvasFactory:a,filterFactory:c,useRequestAnimationFrame:l=!1,pdfBug:h=!1,pageColors:d=null,enableHWA:u=!1,operationsFilter:p=null}){this.callback=t,this.params=e,this.objs=n,this.commonObjs=i,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=o,this.canvasFactory=a,this.filterFactory=c,this._pdfBug=h,this.pageColors=d,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===l&&"undefined"!=typeof window,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new yi(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=u,this._dependencyTracker=e.dependencyTracker,this._operationsFilter=p}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(bi.#Fs.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");bi.#Fs.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:i,background:s,dependencyTracker:r}=this.params,o=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new In(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,r),this.gfx.beginDrawing({transform:i,viewport:n,transparency:t,background:s}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#Ns&&(window.cancelAnimationFrame(this.#Ns),this.#Ns=null),bi.#Fs.delete(this._canvas),t||=new wt(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){this.graphicsReady?(this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||=this._continueBound}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#Ns=window.requestAnimationFrame(()=>{this.#Ns=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),bi.#Fs.delete(this._canvas),this.callback())))}}const wi="5.4.296",Ai="f56dc8601";class xi{#Bs=null;#Us=null;#$s;#js=null;#zs=!1;#Hs=!1;#r=null;#Gs;#Vs=null;#v=null;static#Ws=null;static get _keyboardManager(){return K(this,"_keyboardManager",new Zt([[["Escape","mac+Escape"],xi.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],xi.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],xi.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],xi.prototype._moveToPrevious],[["Home","mac+Home"],xi.prototype._moveToBeginning],[["End","mac+End"],xi.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#Hs=!1,this.#r=t):this.#Hs=!0,this.#v=t?._uiManager||e,this.#Gs=this.#v._eventBus,this.#$s=t?.color?.toUpperCase()||this.#v?.highlightColors.values().next().value||"#FFFF98",xi.#Ws||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#Bs=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#r&&(t.ariaControls=`${this.#r.id}_colorpicker_dropdown`);const e=this.#v._signal;t.addEventListener("click",this.#qs.bind(this),{signal:e}),t.addEventListener("keydown",this.#Ks.bind(this),{signal:e});const n=this.#Us=document.createElement("span");return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=this.#$s,t.append(n),t}renderMainDropdown(){const t=this.#js=this.#Ys();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#Ys(){const t=document.createElement("div"),e=this.#v._signal;t.addEventListener("contextmenu",Tt,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#r&&(t.id=`${this.#r.id}_colorpicker_dropdown`);for(const[n,i]of this.#v.highlightColors){const s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",i),s.title=n,s.setAttribute("data-l10n-id",xi.#Ws[n]);const r=document.createElement("span");s.append(r),r.className="swatch",r.style.backgroundColor=i,s.ariaSelected=i===this.#$s,s.addEventListener("click",this.#Xs.bind(this,i),{signal:e}),t.append(s)}return t.addEventListener("keydown",this.#Ks.bind(this),{signal:e}),t}#Xs(t,e){e.stopPropagation(),this.#Gs.dispatch("switchannotationeditorparams",{source:this,type:D.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#Bs)return void this.#qs(t);const e=t.target.getAttribute("data-color");e&&this.#Xs(e,t)}_moveToNext(t){this.#Js?t.target!==this.#Bs?t.target.nextSibling?.focus():this.#js.firstChild?.focus():this.#qs(t)}_moveToPrevious(t){t.target!==this.#js?.firstChild&&t.target!==this.#Bs?(this.#Js||this.#qs(t),t.target.previousSibling?.focus()):this.#Js&&this._hideDropdownFromKeyboard()}_moveToBeginning(t){this.#Js?this.#js.firstChild?.focus():this.#qs(t)}_moveToEnd(t){this.#Js?this.#js.lastChild?.focus():this.#qs(t)}#Ks(t){xi._keyboardManager.exec(this,t)}#qs(t){if(this.#Js)return void this.hideDropdown();if(this.#zs=0===t.detail,this.#Vs||(this.#Vs=new AbortController,window.addEventListener("pointerdown",this.#u.bind(this),{signal:this.#v.combinedSignal(this.#Vs)})),this.#Bs.ariaExpanded="true",this.#js)return void this.#js.classList.remove("hidden");const e=this.#js=this.#Ys();this.#Bs.append(e)}#u(t){this.#js?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#js?.classList.add("hidden"),this.#Bs.ariaExpanded="false",this.#Vs?.abort(),this.#Vs=null}get#Js(){return this.#js&&!this.#js.classList.contains("hidden")}_hideDropdownFromKeyboard(){this.#Hs||(this.#Js?(this.hideDropdown(),this.#Bs.focus({preventScroll:!0,focusVisible:this.#zs})):this.#r?.unselect())}updateColor(t){if(this.#Us&&(this.#Us.style.backgroundColor=t),!this.#js)return;const e=this.#v.highlightColors.values();for(const n of this.#js.children)n.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#Bs?.remove(),this.#Bs=null,this.#Us=null,this.#js?.remove(),this.#js=null}}class Si{#Qs=null;#r=null;#v=null;static#Ws=null;constructor(t){this.#r=t,this.#v=t._uiManager,Si.#Ws||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#Qs)return this.#Qs;const{editorType:t,colorType:e,colorValue:n}=this.#r,i=this.#Qs=document.createElement("input");return i.type="color",i.value=n||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",Si.#Ws[t]),i.addEventListener("input",()=>{this.#v.updateParams(e,i.value)},{signal:this.#v._signal}),i}update(t){this.#Qs&&(this.#Qs.value=t)}destroy(){this.#Qs?.remove(),this.#Qs=null}hideDropdown(){}}function Ei(t){return Math.floor(255*Math.max(0,Math.min(1,t))).toString(16).padStart(2,"0")}function _i(t){return Math.max(0,Math.min(255,255*t))}C(116),C(531);class Ci{static CMYK_G([t,e,n,i]){return["G",1-Math.min(1,.3*t+.59*n+.11*e+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return[t=_i(t),t,t]}static G_HTML([t]){const e=Ei(t);return`#${e}${e}${e}`}static RGB_G([t,e,n]){return["G",.3*t+.59*e+.11*n]}static RGB_rgb(t){return t.map(_i)}static RGB_HTML(t){return`#${t.map(Ei).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,n,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,n+i),1-Math.min(1,e+i)]}static CMYK_rgb([t,e,n,i]){return[_i(1-Math.min(1,t+i)),_i(1-Math.min(1,n+i)),_i(1-Math.min(1,e+i))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,n]){const i=1-t,s=1-e,r=1-n;return["CMYK",i,s,r,Math.min(i,s,r)]}}class Ti{create(t,e,n=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),n||(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${t} ${e}`),i}createElement(t){if("string"!=typeof t)throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){G("Abstract method `_createSVG` called.")}}class ki extends Ti{_createSVG(t){return document.createElementNS(mt,t)}}const Ri=new WeakSet,Ii=60*(new Date).getTimezoneOffset()*1e3;class Pi{static create(t){switch(t.data.annotationType){case N.LINK:return new Oi(t);case N.TEXT:return new Li(t);case N.WIDGET:switch(t.data.fieldType){case"Tx":return new Fi(t);case"Btn":return t.data.radioButton?new $i(t):t.data.checkBox?new Ui(t):new ji(t);case"Ch":return new zi(t);case"Sig":return new Bi(t)}return new Ni(t);case N.POPUP:return new Hi(t);case N.FREETEXT:return new Vi(t);case N.LINE:return new Wi(t);case N.SQUARE:return new qi(t);case N.CIRCLE:return new Ki(t);case N.POLYLINE:return new Yi(t);case N.CARET:return new Ji(t);case N.INK:return new Qi(t);case N.POLYGON:return new Xi(t);case N.HIGHLIGHT:return new Zi(t);case N.UNDERLINE:return new ts(t);case N.SQUIGGLY:return new es(t);case N.STRIKEOUT:return new ns(t);case N.STAMP:return new is(t);case N.FILEATTACHMENT:return new ss(t);default:return new Mi(t)}}}class Mi{#Zs=null;#tr=!1;#er=null;constructor(t,{isRenderable:e=!1,ignoreBorder:n=!1,createQuadrilaterals:i=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(n)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!(!t?.str&&!e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Mi._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:t}=this,e=this.annotationStorage?.getEditor(t.id);return e?e.getData():t}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const t=this.annotationStorage?.getEditor(this.data.id);if(t)return t.commentButtonPositionInPage;const{quadPoints:e,inkLists:n,rect:i}=this.data;let s=-1/0,r=-1/0;if(e?.length>=8){for(let t=0;t<e.length;t+=8)e[t+1]>r?(r=e[t+1],s=e[t+2]):e[t+1]===r&&(s=Math.max(s,e[t+2]));return[s,r]}if(n?.length>=1){for(const t of n)for(let e=0,n=t.length;e<n;e+=2)t[e+1]>r?(r=t[e+1],s=t[e]):t[e+1]===r&&(s=Math.max(s,t[e]));if(s!==1/0)return[s,r]}return i?[i[2],i[3]]:null}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:n,pageHeight:i,pageX:s,pageY:r}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-s)/n,t[1]=100*(t[1]-r)/i,t}get commentText(){const{data:t}=this;return this.annotationStorage.getRawValue(`${P}${t.id}`)?.popup?.contents||t.contentsObj?.str||""}set commentText(t){const{data:e}=this,n={deleted:!t,contents:t||""};this.annotationStorage.updateEditor(e.id,{popup:n})||this.annotationStorage.setValue(`${P}${e.id}`,{id:e.id,annotationType:e.annotationType,pageIndex:this.parent.page._pageIndex,popup:n,popupRef:e.popupRef,modificationDate:new Date}),t||this.removePopup()}removePopup(){(this.#er?.popup||this.popup)?.remove(),this.#er=this.popup=null}updateEdited(t){if(!this.container)return;t.rect&&(this.#Zs||={rect:this.data.rect.slice(0)});const{rect:e,popup:n}=t;e&&this.#nr(e);let i=this.#er?.popup||this.popup;!i&&n?.text&&(this._createPopup(n),i=this.#er.popup),i&&(i.updateEdited(t),n?.deleted&&(i.remove(),this.#er=null,this.popup=null))}resetEdited(){this.#Zs&&(this.#nr(this.#Zs.rect),this.#er?.popup.resetEdited(),this.#Zs=null)}#nr(t){const{container:{style:e},data:{rect:n,rotation:i},parent:{viewport:{rawDims:{pageWidth:s,pageHeight:r,pageX:o,pageY:a}}}}=this;n?.splice(0,4,...t),e.left=100*(t[0]-o)/s+"%",e.top=100*(r-t[3]+a)/r+"%",0===i?(e.width=100*(t[2]-t[0])/s+"%",e.height=100*(t[3]-t[1])/r+"%"):this.setRotation(i)}_createContainer(t){const{data:e,parent:{page:n,viewport:i}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",e.id),this instanceof Ni||this instanceof Oi||(s.tabIndex=0);const{style:r}=s;if(r.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(s.title=e.alternativeText),e.noRotate&&s.classList.add("norotate"),!e.rect||this instanceof Hi){const{rotation:t}=e;return e.hasOwnCanvas||0===t||this.setRotation(t,s),s}const{width:o,height:a}=this;if(!t&&e.borderStyle.width>0){r.borderWidth=`${e.borderStyle.width}px`;const t=e.borderStyle.horizontalCornerRadius,n=e.borderStyle.verticalCornerRadius;if(t>0||n>0){const e=`calc(${t}px * var(--total-scale-factor)) / calc(${n}px * var(--total-scale-factor))`;r.borderRadius=e}else if(this instanceof $i){const t=`calc(${o}px * var(--total-scale-factor)) / calc(${a}px * var(--total-scale-factor))`;r.borderRadius=t}switch(e.borderStyle.style){case 1:r.borderStyle="solid";break;case 2:r.borderStyle="dashed";break;case 3:H("Unimplemented border style: beveled");break;case 4:H("Unimplemented border style: inset");break;case 5:r.borderBottomStyle="solid"}const i=e.borderColor||null;i?(this.#tr=!0,r.borderColor=ot.makeHexColor(0|i[0],0|i[1],0|i[2])):r.borderWidth=0}const c=ot.normalizeRect([e.rect[0],n.view[3]-e.rect[1]+n.view[1],e.rect[2],n.view[3]-e.rect[3]+n.view[1]]),{pageWidth:l,pageHeight:h,pageX:d,pageY:u}=i.rawDims;r.left=100*(c[0]-d)/l+"%",r.top=100*(c[1]-u)/h+"%";const{rotation:p}=e;return e.hasOwnCanvas||0===p?(r.width=100*o/l+"%",r.height=100*a/h+"%"):this.setRotation(p,s),s}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:i}=this.parent.viewport.rawDims;let{width:s,height:r}=this;t%180!=0&&([s,r]=[r,s]),e.style.width=100*s/n+"%",e.style.height=100*r/i+"%",e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(t,e,n)=>{const i=n.detail[t],s=i[0],r=i.slice(1);n.target.style[e]=Ci[`${s}_HTML`](r),this.annotationStorage.setValue(this.data.id,{[e]:Ci[`${s}_rgb`](r)})};return K(this,"_commonActions",{display:t=>{const{display:e}=t.detail,n=e%2==1;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:1===e||2===e})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:e}=t.detail;this.container.style.visibility=e?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:e,noView:e})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:t=>{const e=t.detail.rotation;this.setRotation(e),this.annotationStorage.setValue(this.data.id,{rotation:e})}})}_dispatchEventFromSandbox(t,e){const n=this._commonActions;for(const i of Object.keys(e.detail)){const s=t[i]||n[i];s?.(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const n=this._commonActions;for(const[i,s]of Object.entries(e)){const r=n[i];r&&(r({detail:{[i]:s},target:t}),delete e[i])}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,n,i,s]=this.data.rect.map(t=>Math.fround(t));if(8===t.length){const[r,o,a,c]=t.subarray(2,6);if(i===r&&s===o&&e===a&&n===c)return}const{style:r}=this.container;let o;if(this.#tr){const{borderColor:t,borderWidth:e}=r;r.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${t}" stroke-width="${e}">`],this.container.classList.add("hasBorder")}const a=i-e,c=s-n,{svgFactory:l}=this,h=l.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0),h.role="none";const d=l.createElement("defs");h.append(d);const u=l.createElement("clipPath"),p=`clippath_${this.data.id}`;u.setAttribute("id",p),u.setAttribute("clipPathUnits","objectBoundingBox"),d.append(u);for(let n=2,i=t.length;n<i;n+=8){const i=t[n],r=t[n+1],h=t[n+2],d=t[n+3],p=l.createElement("rect"),g=(h-e)/a,f=(s-r)/c,m=(i-h)/a,v=(r-d)/c;p.setAttribute("x",g),p.setAttribute("y",f),p.setAttribute("width",m),p.setAttribute("height",v),u.append(p),o?.push(`<rect vector-effect="non-scaling-stroke" x="${g}" y="${f}" width="${m}" height="${v}"/>`)}this.#tr&&(o.push("</g></svg>')"),r.backgroundImage=o.join("")),this.container.append(h),this.container.style.clipPath=`url(#${p})`}_createPopup(t=null){const{data:e}=this;let n,i;t?(n={str:t.text},i=t.date):(n=e.contentsObj,i=e.modificationDate);const s=this.#er=new Hi({data:{color:e.color,titleObj:e.titleObj,modificationDate:i,contentsObj:n,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent._commentManager||this.parent.div.append(s.render())}get hasPopupElement(){return!!(this.#er||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#er}render(){G("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const n=[];if(this._fieldObjects){const i=this._fieldObjects[t];if(i)for(const{page:t,id:s,exportValues:r}of i){if(-1===t)continue;if(s===e)continue;const i="string"==typeof r?r:null,o=document.querySelector(`[data-element-id="${s}"]`);!o||Ri.has(o)?n.push({id:s,exportValue:i,domElement:o}):H(`_getElementsByName - element not allowed: ${s}`)}return n}for(const i of document.getElementsByName(t)){const{exportValue:t}=i,s=i.getAttribute("data-element-id");s!==e&&Ri.has(i)&&n.push({id:s,exportValue:t,domElement:i})}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class Di extends Mi{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.editor=t.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:t}=this;t.hasComment&&(this._createPopup(t.comment),this.extraPopupElement.popup.renderCommentButton())}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(t){this.editor.comment=t,t||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.container.remove(),this.container=null,this.removePopup()}}class Oi extends Mi{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,n=document.createElement("a");n.setAttribute("data-element-id",t.id);let i=!1;return t.url?(e.addLinkAttributes(n,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(n,t.action,t.overlaidText),i=!0):t.attachment?(this.#ir(n,t.attachment,t.overlaidText,t.attachmentDest),i=!0):t.setOCGState?(this.#sr(n,t.setOCGState,t.overlaidText),i=!0):t.dest?(this._bindLink(n,t.dest,t.overlaidText),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,t),i=!0),t.resetForm?(this._bindResetFormAction(n,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(n,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(n),this.container}#rr(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,n=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||""===e)&&this.#rr(),n&&(t.title=n)}_bindNamedAction(t,e,n=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),n&&(t.title=n),this.#rr()}#ir(t,e,n="",i=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:n&&(t.title=n),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,i),!1),this.#rr()}#sr(t,e,n=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),n&&(t.title=n),this.#rr()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(e.actions)){const s=n.get(i);s&&(t[s]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:i}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#rr()}_bindResetFormAction(t,e){const n=t.onclick;if(n||(t.href=this.linkService.getAnchorUrl("")),this.#rr(),!this._fieldObjects)return H('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(n||(t.onclick=()=>!1));t.onclick=()=>{n?.();const{fields:t,refs:i,include:s}=e,r=[];if(0!==t.length||0!==i.length){const e=new Set(i);for(const n of t){const t=this._fieldObjects[n]||[];for(const{id:n}of t)e.add(n)}for(const t of Object.values(this._fieldObjects))for(const n of t)e.has(n.id)===s&&r.push(n)}else for(const t of Object.values(this._fieldObjects))r.push(...t);const o=this.annotationStorage,a=[];for(const t of r){const{id:e}=t;switch(a.push(e),t.type){case"text":{const n=t.defaultValue||"";o.setValue(e,{value:n});break}case"checkbox":case"radiobutton":{const n=t.defaultValue===t.exportValues;o.setValue(e,{value:n});break}case"combobox":case"listbox":{const n=t.defaultValue||"";o.setValue(e,{value:n});break}default:continue}const n=document.querySelector(`[data-element-id="${e}"]`);n&&(Ri.has(n)?n.dispatchEvent(new Event("resetform")):H(`_bindResetFormAction - element not allowed: ${e}`))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:a,name:"ResetForm"}}),!1}}}class Li extends Mi{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class Ni extends Mi{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&("CANVAS"===t.previousSibling?.nodeName&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return st.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,n,i,s){n.includes("mouse")?t.addEventListener(n,t=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:s(t),shift:t.shiftKey,modifier:this._getKeyModifier(t)}})}):t.addEventListener(n,t=>{if("blur"===n){if(!e.focused||!t.relatedTarget)return;e.focused=!1}else if("focus"===n){if(e.focused)return;e.focused=!0}s&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:s(t)}})})}_setEventListeners(t,e,n,i){for(const[s,r]of n)("Action"===r||this.data.actions?.[r])&&("Focus"!==r&&"Blur"!==r||(e||={focused:!1}),this._setEventListener(t,e,s,r,i),"Focus"!==r||this.data.actions?.Blur?"Blur"!==r||this.data.actions?.Focus||this._setEventListener(t,e,"focus","Focus",null):this._setEventListener(t,e,"blur","Blur",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=null===e?"transparent":ot.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const{fontColor:e}=this.data.defaultAppearanceData,n=this.data.defaultAppearanceData.fontSize||9,i=t.style;let s;const r=t=>Math.round(10*t)/10;if(this.data.multiLine){const t=Math.abs(this.data.rect[3]-this.data.rect[1]-2),e=t/(Math.round(t/(R*n))||1);s=Math.min(n,r(e/R))}else{const t=Math.abs(this.data.rect[3]-this.data.rect[1]-2);s=Math.min(n,r(t/R))}i.fontSize=`calc(${s}px * var(--total-scale-factor))`,i.color=ot.makeHexColor(e[0],e[1],e[2]),null!==this.data.textAlignment&&(i.textAlign=["left","center","right"][this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class Fi extends Ni{constructor(t){super(t,{isRenderable:t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue})}setPropertyOnSiblings(t,e,n,i){const s=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id))r.domElement&&(r.domElement[e]=n),s.setValue(r.id,{[i]:n})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const i=t.getValue(e,{value:this.data.fieldValue});let s=i.value||"";const r=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;r&&s.length>r&&(s=s.slice(0,r));let o=i.formattedValue||this.data.textContent?.join("\n")||null;o&&this.data.comb&&(o=o.replaceAll(/\s+/g,""));const a={userValue:s,formattedValue:o,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=o??s,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",o??s),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Ri.add(n),n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:c,datetimeType:l,timeStep:h}=this.data,d=!!l&&this.enableScripting;c&&(n.title=c),this._setRequired(n,this.data.required),r&&(n.maxLength=r),n.addEventListener("input",i=>{t.setValue(e,{value:i.target.value}),this.setPropertyOnSiblings(n,"value",i.target.value,"value"),a.formattedValue=null}),n.addEventListener("resetform",t=>{const e=this.data.defaultFieldValue??"";n.value=a.userValue=e,a.formattedValue=null});let u=t=>{const{formattedValue:e}=a;null!=e&&(t.target.value=e),t.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",t=>{if(a.focused)return;const{target:e}=t;if(d&&(e.type=l,h&&(e.step=h)),a.userValue){const t=a.userValue;if(d)if("time"===l){const n=new Date(t),i=[n.getHours(),n.getMinutes(),n.getSeconds()];e.value=i.map(t=>t.toString().padStart(2,"0")).join(":")}else e.value=new Date(t-Ii).toISOString().split("date"===l?"T":".",1)[0];else e.value=t}a.lastCommittedValue=e.value,a.commitKey=1,this.data.actions?.Focus||(a.focused=!0)}),n.addEventListener("updatefromsandbox",n=>{this.showElementAndHideCanvas(n.target);const i={value(n){a.userValue=n.detail.value??"",d||t.setValue(e,{value:a.userValue.toString()}),n.target.value=a.userValue},formattedValue(n){const{formattedValue:i}=n.detail;a.formattedValue=i,null!=i&&n.target!==document.activeElement&&(n.target.value=i);const s={formattedValue:i};d&&(s.value=i),t.setValue(e,s)},selRange(t){t.target.setSelectionRange(...t.detail.selRange)},charLimit:n=>{const{charLimit:i}=n.detail,{target:s}=n;if(0===i)return void s.removeAttribute("maxLength");s.setAttribute("maxLength",i);let r=a.userValue;!r||r.length<=i||(r=r.slice(0,i),s.value=a.userValue=r,t.setValue(e,{value:r}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:r,willCommit:!0,commitKey:1,selStart:s.selectionStart,selEnd:s.selectionEnd}}))}};this._dispatchEventFromSandbox(i,n)}),n.addEventListener("keydown",t=>{a.commitKey=1;let n=-1;if("Escape"===t.key?n=0:"Enter"!==t.key||this.data.multiLine?"Tab"===t.key&&(a.commitKey=3):n=2,-1===n)return;const{value:i}=t.target;a.lastCommittedValue!==i&&(a.lastCommittedValue=i,a.userValue=i,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:i,willCommit:!0,commitKey:n,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}}))});const i=u;u=null,n.addEventListener("blur",t=>{if(!a.focused||!t.relatedTarget)return;this.data.actions?.Blur||(a.focused=!1);const{target:n}=t;let{value:s}=n;if(d){if(s&&"time"===l){const t=s.split(":").map(t=>parseInt(t,10));s=new Date(2e3,0,1,t[0],t[1],t[2]||0).valueOf(),n.step=""}else s.includes("T")||(s=`${s}T00:00`),s=new Date(s).valueOf();n.type="text"}a.userValue=s,a.lastCommittedValue!==s&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:s,willCommit:!0,commitKey:a.commitKey,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}}),i(t)}),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",t=>{a.lastCommittedValue=null;const{data:n,target:i}=t,{value:s,selectionStart:r,selectionEnd:o}=i;let c=r,l=o;switch(t.inputType){case"deleteWordBackward":{const t=s.substring(0,r).match(/\w*[^\w]*$/);t&&(c-=t[0].length);break}case"deleteWordForward":{const t=s.substring(r).match(/^[^\w]*\w*/);t&&(l+=t[0].length);break}case"deleteContentBackward":r===o&&(c-=1);break;case"deleteContentForward":r===o&&(l+=1)}t.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:s,change:n||"",willCommit:!1,selStart:c,selEnd:l}})}),this._setEventListeners(n,a,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],t=>t.target.value)}if(u&&n.addEventListener("blur",u),this.data.comb){const t=(this.data.rect[2]-this.data.rect[0])/r;n.classList.add("comb"),n.style.letterSpacing=`calc(${t}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Bi extends Ni{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class Ui extends Ni{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,n=e.id;let i=t.getValue(n,{value:e.exportValue===e.fieldValue}).value;"string"==typeof i&&(i="Off"!==i,t.setValue(n,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const s=document.createElement("input");return Ri.add(s),s.setAttribute("data-element-id",n),s.disabled=e.readOnly,this._setRequired(s,this.data.required),s.type="checkbox",s.name=e.fieldName,i&&s.setAttribute("checked",!0),s.setAttribute("exportValue",e.exportValue),s.tabIndex=0,s.addEventListener("change",i=>{const{name:s,checked:r}=i.target;for(const i of this._getElementsByName(s,n)){const n=r&&i.exportValue===e.exportValue;i.domElement&&(i.domElement.checked=n),t.setValue(i.id,{value:n})}t.setValue(n,{value:r})}),s.addEventListener("resetform",t=>{const n=e.defaultFieldValue||"Off";t.target.checked=n===e.exportValue}),this.enableScripting&&this.hasJSActions&&(s.addEventListener("updatefromsandbox",e=>{const i={value(e){e.target.checked="Off"!==e.detail.value,t.setValue(n,{value:e.target.checked})}};this._dispatchEventFromSandbox(i,e)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],t=>t.target.checked)),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class $i extends Ni{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,n=e.id;let i=t.getValue(n,{value:e.fieldValue===e.buttonValue}).value;if("string"==typeof i&&(i=i!==e.buttonValue,t.setValue(n,{value:i})),i)for(const i of this._getElementsByName(e.fieldName,n))t.setValue(i.id,{value:!1});const s=document.createElement("input");if(Ri.add(s),s.setAttribute("data-element-id",n),s.disabled=e.readOnly,this._setRequired(s,this.data.required),s.type="radio",s.name=e.fieldName,i&&s.setAttribute("checked",!0),s.tabIndex=0,s.addEventListener("change",e=>{const{name:i,checked:s}=e.target;for(const e of this._getElementsByName(i,n))t.setValue(e.id,{value:!1});t.setValue(n,{value:s})}),s.addEventListener("resetform",t=>{const n=e.defaultFieldValue;t.target.checked=null!=n&&n===e.buttonValue}),this.enableScripting&&this.hasJSActions){const i=e.buttonValue;s.addEventListener("updatefromsandbox",e=>{const s={value:e=>{const s=i===e.detail.value;for(const i of this._getElementsByName(e.target.name)){const e=s&&i.id===n;i.domElement&&(i.domElement.checked=e),t.setValue(i.id,{value:e})}}};this._dispatchEventFromSandbox(s,e)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],t=>t.target.checked)}return this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class ji extends Oi{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",t=>{this._dispatchEventFromSandbox({},t)})),t}}class zi extends Ni{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,n=t.getValue(e,{value:this.data.fieldValue}),i=document.createElement("select");Ri.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let s=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",t=>{const e=this.data.defaultFieldValue;for(const t of i.options)t.selected=t.value===e});for(const t of this.data.options){const e=document.createElement("option");e.textContent=t.displayValue,e.value=t.exportValue,n.value.includes(t.exportValue)&&(e.setAttribute("selected",!0),s=!1),i.append(e)}let r=null;if(s){const t=document.createElement("option");t.value=" ",t.setAttribute("hidden",!0),t.setAttribute("selected",!0),i.prepend(t),r=()=>{t.remove(),i.removeEventListener("input",r),r=null},i.addEventListener("input",r)}const o=t=>{const e=t?"value":"textContent",{options:n,multiple:s}=i;return s?Array.prototype.filter.call(n,t=>t.selected).map(t=>t[e]):-1===n.selectedIndex?null:n[n.selectedIndex][e]};let a=o(!1);const c=t=>{const e=t.target.options;return Array.prototype.map.call(e,t=>({displayValue:t.textContent,exportValue:t.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",n=>{const s={value(n){r?.();const s=n.detail.value,c=new Set(Array.isArray(s)?s:[s]);for(const t of i.options)t.selected=c.has(t.value);t.setValue(e,{value:o(!0)}),a=o(!1)},multipleSelection(t){i.multiple=!0},remove(n){const s=i.options,r=n.detail.remove;s[r].selected=!1,i.remove(r),s.length>0&&-1===Array.prototype.findIndex.call(s,t=>t.selected)&&(s[0].selected=!0),t.setValue(e,{value:o(!0),items:c(n)}),a=o(!1)},clear(n){for(;0!==i.length;)i.remove(0);t.setValue(e,{value:null,items:[]}),a=o(!1)},insert(n){const{index:s,displayValue:r,exportValue:l}=n.detail.insert,h=i.children[s],d=document.createElement("option");d.textContent=r,d.value=l,h?h.before(d):i.append(d),t.setValue(e,{value:o(!0),items:c(n)}),a=o(!1)},items(n){const{items:s}=n.detail;for(;0!==i.length;)i.remove(0);for(const t of s){const{displayValue:e,exportValue:n}=t,s=document.createElement("option");s.textContent=e,s.value=n,i.append(s)}i.options.length>0&&(i.options[0].selected=!0),t.setValue(e,{value:o(!0),items:c(n)}),a=o(!1)},indices(n){const i=new Set(n.detail.indices);for(const t of n.target.options)t.selected=i.has(t.index);t.setValue(e,{value:o(!0)}),a=o(!1)},editable(t){t.target.disabled=!t.detail.editable}};this._dispatchEventFromSandbox(s,n)}),i.addEventListener("input",n=>{const i=o(!0),s=o(!1);t.setValue(e,{value:i}),n.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:a,change:s,changeEx:i,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],t=>t.target.value)):i.addEventListener("input",function(n){t.setValue(e,{value:o(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Hi extends Mi{constructor(t){const{data:e,elements:n,parent:i}=t,s=!!i._commentManager;if(super(t,{isRenderable:!s&&Mi._hasPopupData(e)}),this.elements=n,s&&Mi._hasPopupData(e)){const t=this.popup=this.#or();for(const e of n)e.popup=t}else this.popup=null}#or(){return new Gi({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=this.#or(),n=[];for(const t of this.elements)t.popup=e,t.container.ariaHasPopup="dialog",n.push(t.data.id),t.addHighlightArea();return this.container.setAttribute("aria-controls",n.map(t=>`${dt}${t}`).join(",")),this.container}}class Gi{#U=null;#ar=this.#Ks.bind(this);#cr=this.#lr.bind(this);#hr=this.#dr.bind(this);#ur=this.#pr.bind(this);#gr=null;#At=null;#fr=null;#mr=null;#vr=null;#yr=null;#br=null;#wr=!1;#Ar=null;#xr=null;#k=null;#Sr=null;#Er=null;#pe=null;#_r=null;#le=null;#Cr=null;#Zs=null;#Tr=!1;#kr=null;#Rr=null;constructor({container:t,color:e,elements:n,titleObj:i,modificationDate:s,contentsObj:r,richText:o,parent:a,rect:c,parentRect:l,open:h,commentManager:d=null}){this.#At=t,this.#Cr=i,this.#fr=r,this.#le=o,this.#yr=a,this.#gr=e,this.#_r=c,this.#br=l,this.#vr=n,this.#U=d,this.#kr=n[0],this.#mr=Rt.toDateObject(s),this.trigger=n.flatMap(t=>t.getElementsToTriggerPopup()),d?this.renderCommentButton():(this.#Ir(),this.#At.hidden=!0,h&&this.#pr())}#Ir(){if(this.#xr)return;this.#xr=new AbortController;const{signal:t}=this.#xr;for(const e of this.trigger)e.addEventListener("click",this.#ur,{signal:t}),e.addEventListener("pointerenter",this.#hr,{signal:t}),e.addEventListener("pointerleave",this.#cr,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#vr)e.container?.addEventListener("keydown",this.#ar,{signal:t})}#Pr(){const t=this.#vr.find(t=>t.hasCommentButton);t&&(this.#Er=t._normalizePoint(t.commentButtonPosition))}renderCommentButton(){if(this.#Sr)return;if(this.#Er||this.#Pr(),!this.#Er)return;const{signal:t}=this.#xr=new AbortController,e=!!this.#kr.extraPopupElement,n=()=>{this.#U.toggleCommentPopup(this,!0,void 0,!e)},i=()=>{this.#U.toggleCommentPopup(this,!1,!0,!e)},s=()=>{this.#U.toggleCommentPopup(this,!1,!1)};if(e){this.#Sr=this.#kr.container;for(const e of this.trigger)e.ariaHasPopup="dialog",e.ariaControls="commentPopup",e.addEventListener("keydown",this.#ar,{signal:t}),e.addEventListener("click",n,{signal:t}),e.addEventListener("pointerenter",i,{signal:t}),e.addEventListener("pointerleave",s,{signal:t}),e.classList.add("popupTriggerArea")}else{const e=this.#Sr=document.createElement("button");e.className="annotationCommentButton";const r=this.#kr.container;e.style.zIndex=r.style.zIndex+1,e.tabIndex=0,e.ariaHasPopup="dialog",e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#Mr(),this.#Dr(),e.addEventListener("keydown",this.#ar,{signal:t}),e.addEventListener("click",n,{signal:t}),e.addEventListener("pointerenter",i,{signal:t}),e.addEventListener("pointerleave",s,{signal:t}),r.after(e)}}#Dr(){if(this.#kr.extraPopupElement&&!this.#kr.editor)return;this.renderCommentButton();const[t,e]=this.#Er,{style:n}=this.#Sr;n.left=`calc(${t}%)`,n.top=`calc(${e}% - var(--comment-button-dim))`}#Mr(){this.#kr.extraPopupElement||(this.renderCommentButton(),this.#Sr.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:t,opacity:e}=this.#kr.commentData;return t?this.#yr._commentManager.makeCommentColor(t,e):null}focusCommentButton(){setTimeout(()=>{this.#Sr?.focus()},0)}getData(){const{richText:t,color:e,opacity:n,creationDate:i,modificationDate:s}=this.#kr.commentData;return{contentsObj:{str:this.comment},richText:t,color:e,opacity:n,creationDate:i,modificationDate:s}}get elementBeforePopup(){return this.#Sr}get comment(){return this.#Rr||=this.#kr.commentText,this.#Rr}set comment(t){t!==this.comment&&(this.#kr.commentText=this.#Rr=t)}get parentBoundingClientRect(){return this.#kr.layer.getBoundingClientRect()}setCommentButtonStates({selected:t,hasPopup:e}){this.#Sr&&(this.#Sr.classList.toggle("selected",t),this.#Sr.ariaExpanded=e)}setSelectedCommentButton(t){this.#Sr.classList.toggle("selected",t)}get commentPopupPosition(){if(this.#pe)return this.#pe;const{x:t,y:e,height:n}=this.#Sr.getBoundingClientRect(),{x:i,y:s,width:r,height:o}=this.#kr.layer.getBoundingClientRect();return[(t-i)/r,(e+n-s)/o]}set commentPopupPosition(t){this.#pe=t}hasDefaultPopupPosition(){return null===this.#pe}get commentButtonPosition(){return this.#Er}get commentButtonWidth(){return this.#Sr.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(t){const[e,n]=this.#pe||this.commentButtonPosition.map(t=>t/100),i=this.parentBoundingClientRect,{x:s,y:r,width:o,height:a}=i;this.#U.showDialog(null,this,s+e*o,r+n*a,{...t,parentDimensions:i})}render(){if(this.#Ar)return;const t=this.#Ar=document.createElement("div");if(t.className="popup",this.#gr){const e=t.style.outlineColor=ot.makeHexColor(...this.#gr);t.style.backgroundColor=`color-mix(in srgb, ${e} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#Cr?.str){const t=document.createElement("span");t.className="title",e.append(t),({dir:t.dir,str:t.textContent}=this.#Cr)}if(t.append(e),this.#mr){const t=document.createElement("time");t.className="popupDate",t.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),t.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#mr.valueOf()})),t.dateTime=this.#mr.toISOString(),e.append(t)}Wt({html:this.#Or||this.#fr.str,dir:this.#fr?.dir,className:"popupContent"},t),this.#At.append(t)}get#Or(){const t=this.#le,e=this.#fr;return!t?.str||e?.str&&e.str!==t.str?null:this.#le.html||null}get#Lr(){return this.#Or?.attributes?.style?.fontSize||0}get#Nr(){return this.#Or?.attributes?.style?.color||null}#Fr(t){const e=[],n={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},i={style:{color:this.#Nr,fontSize:this.#Lr?`calc(${this.#Lr}px * var(--total-scale-factor))`:""}};for(const n of t.split("\n"))e.push({name:"span",value:n,attributes:i});return n}#Ks(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||("Enter"===t.key||"Escape"===t.key&&this.#wr)&&this.#pr()}updateEdited({rect:t,popup:e,deleted:n}){if(this.#U)return n?(this.remove(),this.#Rr=null):e&&(e.deleted?this.remove():(this.#Mr(),this.#Rr=e.text)),void(t&&(this.#Er=null,this.#Pr(),this.#Dr()));n||e?.deleted?this.remove():(this.#Ir(),this.#Zs||={contentsObj:this.#fr,richText:this.#le},t&&(this.#k=null),e&&e.text&&(this.#le=this.#Fr(e.text),this.#mr=Rt.toDateObject(e.date),this.#fr=null),this.#Ar?.remove(),this.#Ar=null)}resetEdited(){this.#Zs&&(({contentsObj:this.#fr,richText:this.#le}=this.#Zs),this.#Zs=null,this.#Ar?.remove(),this.#Ar=null,this.#k=null)}remove(){if(this.#xr?.abort(),this.#xr=null,this.#Ar?.remove(),this.#Ar=null,this.#Tr=!1,this.#wr=!1,this.#Sr?.remove(),this.#Sr=null,this.trigger)for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#Br(){if(null!==this.#k)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:n,pageX:i,pageY:s}}}=this.#yr;let r=!!this.#br,o=r?this.#br:this.#_r;for(const t of this.#vr)if(!o||null!==ot.intersect(t.data.rect,o)){o=t.data.rect,r=!0;break}const a=ot.normalizeRect([o[0],t[3]-o[1]+t[1],o[2],t[3]-o[3]+t[1]]),c=r?o[2]-o[0]+5:0,l=a[0]+c,h=a[1];this.#k=[100*(l-i)/e,100*(h-s)/n];const{style:d}=this.#At;d.left=`${this.#k[0]}%`,d.top=`${this.#k[1]}%`}#pr(){this.#U?this.#U.toggleCommentPopup(this,!1):(this.#wr=!this.#wr,this.#wr?(this.#dr(),this.#At.addEventListener("click",this.#ur),this.#At.addEventListener("keydown",this.#ar)):(this.#lr(),this.#At.removeEventListener("click",this.#ur),this.#At.removeEventListener("keydown",this.#ar)))}#dr(){this.#Ar||this.render(),this.isVisible?this.#wr&&this.#At.classList.add("focused"):(this.#Br(),this.#At.hidden=!1,this.#At.style.zIndex=parseInt(this.#At.style.zIndex)+1e3)}#lr(){this.#At.classList.remove("focused"),!this.#wr&&this.isVisible&&(this.#At.hidden=!0,this.#At.style.zIndex=parseInt(this.#At.style.zIndex)-1e3)}forceHide(){this.#Tr=this.isVisible,this.#Tr&&(this.#At.hidden=!0)}maybeShow(){this.#U||(this.#Ir(),this.#Tr&&(this.#Ar||this.#dr(),this.#Tr=!1,this.#At.hidden=!1))}get isVisible(){return!this.#U&&!1===this.#At.hidden}}class Vi extends Mi{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=M.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const n=document.createElement("span");n.textContent=e,t.append(n)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class Wi extends Mi{#Ur=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:n}=this,i=this.svgFactory.create(e,n,!0),s=this.#Ur=this.svgFactory.createElement("svg:line");return s.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),s.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),s.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),s.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),s.setAttribute("stroke-width",t.borderStyle.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),i.append(s),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#Ur}addHighlightArea(){this.container.classList.add("highlightArea")}}class qi extends Mi{#$r=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:n}=this,i=this.svgFactory.create(e,n,!0),s=t.borderStyle.width,r=this.#$r=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",s/2),r.setAttribute("y",s/2),r.setAttribute("width",e-s),r.setAttribute("height",n-s),r.setAttribute("stroke-width",s||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#$r}addHighlightArea(){this.container.classList.add("highlightArea")}}class Ki extends Mi{#jr=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:n}=this,i=this.svgFactory.create(e,n,!0),s=t.borderStyle.width,r=this.#jr=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",e/2),r.setAttribute("cy",n/2),r.setAttribute("rx",e/2-s/2),r.setAttribute("ry",n/2-s/2),r.setAttribute("stroke-width",s||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#jr}addHighlightArea(){this.container.classList.add("highlightArea")}}class Yi extends Mi{#zr=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:n,popupRef:i},width:s,height:r}=this;if(!e)return this.container;const o=this.svgFactory.create(s,r,!0);let a=[];for(let n=0,i=e.length;n<i;n+=2){const i=e[n]-t[0],s=t[3]-e[n+1];a.push(`${i},${s}`)}a=a.join(" ");const c=this.#zr=this.svgFactory.createElement(this.svgElementName);return c.setAttribute("points",a),c.setAttribute("stroke-width",n.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),o.append(c),this.container.append(o),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#zr}addHighlightArea(){this.container.classList.add("highlightArea")}}class Xi extends Yi{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Ji extends Mi{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Qi extends Mi{#Hr=null;#Gr=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType="InkHighlight"===this.data.it?M.HIGHLIGHT:M.INK}#Vr(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:n,borderStyle:i,popupRef:s}}=this,{transform:r,width:o,height:a}=this.#Vr(e,t),c=this.svgFactory.create(o,a,!0),l=this.#Hr=this.svgFactory.createElement("svg:g");c.append(l),l.setAttribute("stroke-width",i.width||1),l.setAttribute("stroke-linecap","round"),l.setAttribute("stroke-linejoin","round"),l.setAttribute("stroke-miterlimit",10),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),l.setAttribute("transform",r);for(let t=0,e=n.length;t<e;t++){const e=this.svgFactory.createElement(this.svgElementName);this.#Gr.push(e),e.setAttribute("points",n[t].join(",")),l.append(e)}return!s&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:n,rect:i}=t,s=this.#Hr;if(e>=0&&s.setAttribute("stroke-width",e||1),n)for(let t=0,e=this.#Gr.length;t<e;t++)this.#Gr[t].setAttribute("points",n[t].join(","));if(i){const{transform:t,width:e,height:n}=this.#Vr(this.data.rotation,i);s.parentElement.setAttribute("viewBox",`0 0 ${e} ${n}`),s.setAttribute("transform",t)}}getElementsToTriggerPopup(){return this.#Gr}addHighlightArea(){this.container.classList.add("highlightArea")}}class Zi extends Mi{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=M.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const e=document.createElement("mark");e.classList.add("overlaidText"),e.textContent=t,this.container.append(e)}return this.container}}class ts extends Mi{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),t){const e=document.createElement("u");e.classList.add("overlaidText"),e.textContent=t,this.container.append(e)}return this.container}}class es extends Mi{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),t){const e=document.createElement("u");e.classList.add("overlaidText"),e.textContent=t,this.container.append(e)}return this.container}}class ns extends Mi{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),t){const e=document.createElement("s");e.classList.add("overlaidText"),e.textContent=t,this.container.append(e)}return this.container}}class is extends Mi{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=M.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class ss extends Mi{#Wr=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let n;e.hasAppearance||0===e.fillAlpha?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(100*e.fillAlpha)}%);`)),n.addEventListener("dblclick",this.#qr.bind(this)),this.#Wr=n;const{isMac:i}=st.platform;return t.addEventListener("keydown",t=>{"Enter"===t.key&&(i?t.metaKey:t.ctrlKey)&&this.#qr()}),!e.popupRef&&this.hasPopupData?this._createPopup():n.classList.add("popupTriggerArea"),t.append(n),t}getElementsToTriggerPopup(){return this.#Wr}addHighlightArea(){this.container.classList.add("highlightArea")}#qr(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class rs{#Kr=null;#Yr=null;#N=null;#Xr=new Map;#Jr=null;#Qr=null;constructor({div:t,accessibilityManager:e,annotationCanvasMap:n,annotationEditorUIManager:i,page:s,viewport:r,structTreeLayer:o,commentManager:a,linkService:c,annotationStorage:l}){this.div=t,this.#Kr=e,this.#Yr=n,this.#Jr=o||null,this.#Qr=c||null,this.#N=l||new ue,this.page=s,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=i,this._commentManager=a||null}hasEditableAnnotations(){return this.#Xr.size>0}async#Zr(t,e,n){const i=t.firstChild||t,s=i.id=`${dt}${e}`,r=await(this.#Jr?.getAriaAttributes(s));if(r)for(const[t,e]of r)i.setAttribute(t,e);n?n.at(-1).container.after(t):(this.div.append(t),this.#Kr?.moveElementInDOM(this.div,t,i,!1))}async render(t){const{annotations:e}=t,n=this.div;Ot(n,this.viewport);const i=new Map,s={data:null,layer:n,linkService:this.#Qr,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:!1!==t.renderForms,svgFactory:new ki,annotationStorage:this.#N,enableComment:!0===t.enableComment,enableScripting:!0===t.enableScripting,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const t of e){if(t.noHTML)continue;const e=t.annotationType===N.POPUP;if(e){const e=i.get(t.id);if(!e)continue;s.elements=e}else if(t.rect[2]===t.rect[0]||t.rect[3]===t.rect[1])continue;s.data=t;const n=Pi.create(s);if(!n.isRenderable)continue;if(!e&&t.popupRef){const e=i.get(t.popupRef);e?e.push(n):i.set(t.popupRef,[n])}const r=n.render();t.hidden&&(r.style.visibility="hidden"),await this.#Zr(r,t.id,s.elements),n.extraPopupElement?.popup?.renderCommentButton(),n._isEditable&&(this.#Xr.set(n.data.id,n),this._annotationEditorUIManager?.renderAnnotationElement(n))}this.#to()}async addLinkAnnotations(t){const e={data:null,layer:this.div,linkService:this.#Qr,svgFactory:new ki,parent:this};for(const n of t){n.borderStyle||=rs._defaultBorderStyle,e.data=n;const t=Pi.create(e);if(!t.isRenderable)continue;const i=t.render();await this.#Zr(i,n.id,null)}}update({viewport:t}){const e=this.div;this.viewport=t,Ot(e,{rotation:t.rotation}),this.#to(),e.hidden=!1}#to(){if(!this.#Yr)return;const t=this.div;for(const[e,n]of this.#Yr){const i=t.querySelector(`[data-annotation-id="${e}"]`);if(!i)continue;n.className="annotationContent";const{firstChild:s}=i;s?"CANVAS"===s.nodeName?s.replaceWith(n):s.classList.contains("annotationContent")?s.after(n):s.before(n):i.append(n);const r=this.#Xr.get(e);r&&(r._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,i.id,n),r._hasNoCanvas=!1):r.canvas=n)}this.#Yr.clear()}getEditableAnnotations(){return Array.from(this.#Xr.values())}getEditableAnnotation(t){return this.#Xr.get(t)}addFakeAnnotation(t){const{div:e}=this,{id:n,rotation:i}=t,s=new Di({data:{id:n,rect:t.getPDFRect(),rotation:i},editor:t,layer:e,parent:this,enableComment:!!this._commentManager,linkService:this.#Qr,annotationStorage:this.#N}),r=s.render();return e.append(r),this.#Kr?.moveElementInDOM(e,r,r,!1),s.createOrUpdatePopup(),s}static get _defaultBorderStyle(){return K(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:1,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const os=/\r\n?|\n/g;class as extends re{#eo="";#no=`${this.id}-editor`;#io=null;#Lr;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=as.prototype,e=t=>t.isEmpty(),n=ee.TRANSLATE_SMALL,i=ee.TRANSLATE_BIG;return K(this,"_keyboardManager",new Zt([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[n,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,n],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}]]))}static _type="freetext";static _editorType=M.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.color=t.color||as._defaultColor||re._defaultLineColor,this.#Lr=t.fontSize||as._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(t,e){re.initialize(t,e);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case D.FREETEXT_SIZE:as._defaultFontSize=e;break;case D.FREETEXT_COLOR:as._defaultColor=e}}updateParams(t,e){switch(t){case D.FREETEXT_SIZE:this.#so(e);break;case D.FREETEXT_COLOR:this.#Mr(e)}}static get defaultPropertiesToUpdate(){return[[D.FREETEXT_SIZE,as._defaultFontSize],[D.FREETEXT_COLOR,as._defaultColor||re._defaultLineColor]]}get propertiesToUpdate(){return[[D.FREETEXT_SIZE,this.#Lr],[D.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new Si(this),[["colorPicker",this._colorPicker]]}get colorType(){return D.FREETEXT_COLOR}#so(t){const e=t=>{this.editorDiv.style.fontSize=`calc(${t}px * var(--total-scale-factor))`,this.translate(0,-(t-this.#Lr)*this.parentScale),this.#Lr=t,this.#ro()},n=this.#Lr;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:D.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#Mr(t){const e=t=>{this.color=t,this.onUpdatedColor()},n=this.color;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:D.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-as._internalPadding*t,-(as._internalPadding+this.#Lr)*t]}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#io=new AbortController;const t=this._uiManager.combinedSignal(this.#io);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return!!super.disableEditMode()&&(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#no),this._isDraggable=!0,this.#io?.abort(),this.#io=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0)}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#oo(){const t=[];this.editorDiv.normalize();let e=null;for(const n of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&"BR"===n.nodeName||(t.push(as.#ao(n)),e=n);return t.join("\n")}#ro(){const[t,e]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:t,div:e}=this,i=e.style.display,s=e.classList.contains("hidden");e.classList.remove("hidden"),e.style.display="hidden",t.div.append(this.div),n=e.getBoundingClientRect(),e.remove(),e.style.display=i,e.classList.toggle("hidden",s)}this.rotation%180==this.parentRotation%180?(this.width=n.width/t,this.height=n.height/e):(this.width=n.height/t,this.height=n.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#eo,e=this.#eo=this.#oo().trimEnd();if(t===e)return;const n=t=>{this.#eo=t,t?(this.#co(),this._uiManager.rebuild(this),this.#ro()):this.remove()};this.addCommands({cmd:()=>{n(e)},undo:()=>{n(t)},mustExec:!1}),this.#ro()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&"Enter"===t.key&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){as._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#no),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#Lr}px * var(--total-scale-factor))`,n.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[n,i]=this.parentDimensions;if(this.annotationElementId){const{position:s}=this._initialData;let[r,o]=this.getInitialTranslation();[r,o]=this.pageTranslationToScreen(r,o);const[a,c]=this.pageDimensions,[l,h]=this.pageTranslation;let d,u;switch(this.rotation){case 0:d=t+(s[0]-l)/a,u=e+this.height-(s[1]-h)/c;break;case 90:d=t+(s[0]-l)/a,u=e-(s[1]-h)/c,[r,o]=[o,-r];break;case 180:d=t-this.width+(s[0]-l)/a,u=e-(s[1]-h)/c,[r,o]=[-r,-o];break;case 270:d=t+(s[0]-l-this.height*c)/a,u=e+(s[1]-h-this.width*a)/c,[r,o]=[-o,r]}this.setAt(d*n,u*i,r,o)}else this._moveAfterPaste(t,e);this.#co(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#ao(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(os,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:n}=e;if(1===n.length&&"text/plain"===n[0])return;t.preventDefault();const i=as.#lo(e.getData("text")||"").replaceAll(os,"\n");if(!i)return;const s=window.getSelection();if(!s.rangeCount)return;this.editorDiv.normalize(),s.deleteFromDocument();const r=s.getRangeAt(0);if(!i.includes("\n"))return r.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),void s.collapseToStart();const{startContainer:o,startOffset:a}=r,c=[],l=[];if(o.nodeType===Node.TEXT_NODE){const t=o.parentElement;if(l.push(o.nodeValue.slice(a).replaceAll(os,"")),t!==this.editorDiv){let e=c;for(const n of this.editorDiv.childNodes)n!==t?e.push(as.#ao(n)):e=l}c.push(o.nodeValue.slice(0,a).replaceAll(os,""))}else if(o===this.editorDiv){let t=c,e=0;for(const n of this.editorDiv.childNodes)e++===a&&(t=l),t.push(as.#ao(n))}this.#eo=`${c.join("\n")}${i}${l.join("\n")}`,this.#co();const h=new Range;let d=Math.sumPrecise(c.map(t=>t.length));for(const{firstChild:t}of this.editorDiv.childNodes)if(t.nodeType===Node.TEXT_NODE){const e=t.nodeValue.length;if(d<=e){h.setStart(t,d),h.setEnd(t,d);break}d-=e}s.removeAllRanges(),s.addRange(h)}#co(){if(this.editorDiv.replaceChildren(),this.#eo)for(const t of this.#eo.split("\n")){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#ho(){return this.#eo.replaceAll(""," ")}static#lo(t){return t.replaceAll(" ","")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=as._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,n){let i=null;if(t instanceof Vi){const{data:{defaultAppearanceData:{fontSize:e,fontColor:n},rect:s,rotation:r,id:o,popupRef:a,richText:c,contentsObj:l,creationDate:h,modificationDate:d},textContent:u,textPosition:p,parent:{page:{pageNumber:g}}}=t;if(!u||0===u.length)return null;i=t={annotationType:M.FREETEXT,color:Array.from(n),fontSize:e,value:u.join("\n"),position:p,pageIndex:g-1,rect:s.slice(0),rotation:r,annotationElementId:o,id:o,deleted:!1,popupRef:a,comment:l?.str||null,richText:c,creationDate:h,modificationDate:d}}const s=await super.deserialize(t,e,n);return s.#Lr=t.fontSize,s.color=ot.makeHexColor(...t.color),s.#eo=as.#lo(t.value),s._initialData=i,t.comment&&s.setCommentData(t),s}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=re._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),n=Object.assign(super.serialize(t),{color:e,fontSize:this.#Lr,value:this.#ho()});return this.addComment(n),t?(n.isCopy=!0,n):this.annotationElementId&&!this.#do(n)?null:(n.id=this.annotationElementId,n)}#do(t){const{value:e,fontSize:n,color:i,pageIndex:s}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==n||t.color.some((t,e)=>t!==i[e])||t.pageIndex!==s}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:n}=e;n.fontSize=`calc(${this.#Lr}px * var(--total-scale-factor))`,n.color=this.color,e.replaceChildren();for(const t of this.#eo.split("\n")){const n=document.createElement("div");n.append(t?document.createTextNode(t):document.createElement("br")),e.append(n)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#eo}}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class cs{static PRECISION=1e-4;toSVGPath(){G("Abstract method `toSVGPath` must be implemented.")}get box(){G("Abstract getter `box` must be implemented.")}serialize(t,e){G("Abstract method `serialize` must be implemented.")}static _rescale(t,e,n,i,s,r){r||=new Float32Array(t.length);for(let o=0,a=t.length;o<a;o+=2)r[o]=e+t[o]*i,r[o+1]=n+t[o+1]*s;return r}static _rescaleAndSwap(t,e,n,i,s,r){r||=new Float32Array(t.length);for(let o=0,a=t.length;o<a;o+=2)r[o]=e+t[o+1]*i,r[o+1]=n+t[o]*s;return r}static _translate(t,e,n,i){i||=new Float32Array(t.length);for(let s=0,r=t.length;s<r;s+=2)i[s]=e+t[s],i[s+1]=n+t[s+1];return i}static svgRound(t){return Math.round(1e4*t)}static _normalizePoint(t,e,n,i,s){switch(s){case 90:return[1-e/n,t/i];case 180:return[1-t/n,1-e/i];case 270:return[e/n,1-t/i];default:return[t/n,e/i]}}static _normalizePagePoint(t,e,n){switch(n){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,n,i,s,r){return[(t+5*n)/6,(e+5*i)/6,(5*n+s)/6,(5*i+r)/6,(n+s)/2,(i+r)/2]}}class ls{#uo;#po=[];#go;#fo;#mo=[];#vo=new Float32Array(18);#yo;#bo;#wo;#Ao;#xo;#So;#Eo=[];static#_o=8;static#Co=2;static#To=ls.#_o+ls.#Co;constructor({x:t,y:e},n,i,s,r,o=0){this.#uo=n,this.#So=s*i,this.#fo=r,this.#vo.set([NaN,NaN,NaN,NaN,t,e],6),this.#go=o,this.#Ao=ls.#_o*i,this.#wo=ls.#To*i,this.#xo=i,this.#Eo.push(t,e)}isEmpty(){return isNaN(this.#vo[8])}#ko(){const t=this.#vo.subarray(4,6),e=this.#vo.subarray(16,18),[n,i,s,r]=this.#uo;return[(this.#yo+(t[0]-e[0])/2-n)/s,(this.#bo+(t[1]-e[1])/2-i)/r,(this.#yo+(e[0]-t[0])/2-n)/s,(this.#bo+(e[1]-t[1])/2-i)/r]}add({x:t,y:e}){this.#yo=t,this.#bo=e;const[n,i,s,r]=this.#uo;let[o,a,c,l]=this.#vo.subarray(8,12);const h=t-c,d=e-l,u=Math.hypot(h,d);if(u<this.#wo)return!1;const p=u-this.#Ao,g=p/u,f=g*h,m=g*d;let v=o,y=a;o=c,a=l,c+=f,l+=m,this.#Eo?.push(t,e);const b=f/p,w=-m/p*this.#So,A=b*this.#So;return this.#vo.set(this.#vo.subarray(2,8),0),this.#vo.set([c+w,l+A],4),this.#vo.set(this.#vo.subarray(14,18),12),this.#vo.set([c-w,l-A],16),isNaN(this.#vo[6])?(0===this.#mo.length&&(this.#vo.set([o+w,a+A],2),this.#mo.push(NaN,NaN,NaN,NaN,(o+w-n)/s,(a+A-i)/r),this.#vo.set([o-w,a-A],14),this.#po.push(NaN,NaN,NaN,NaN,(o-w-n)/s,(a-A-i)/r)),this.#vo.set([v,y,o,a,c,l],6),!this.isEmpty()):(this.#vo.set([v,y,o,a,c,l],6),Math.abs(Math.atan2(y-a,v-o)-Math.atan2(m,f))<Math.PI/2?([o,a,c,l]=this.#vo.subarray(2,6),this.#mo.push(NaN,NaN,NaN,NaN,((o+c)/2-n)/s,((a+l)/2-i)/r),[o,a,v,y]=this.#vo.subarray(14,18),this.#po.push(NaN,NaN,NaN,NaN,((v+o)/2-n)/s,((y+a)/2-i)/r),!0):([v,y,o,a,c,l]=this.#vo.subarray(0,6),this.#mo.push(((v+5*o)/6-n)/s,((y+5*a)/6-i)/r,((5*o+c)/6-n)/s,((5*a+l)/6-i)/r,((o+c)/2-n)/s,((a+l)/2-i)/r),[c,l,o,a,v,y]=this.#vo.subarray(12,18),this.#po.push(((v+5*o)/6-n)/s,((y+5*a)/6-i)/r,((5*o+c)/6-n)/s,((5*a+l)/6-i)/r,((o+c)/2-n)/s,((a+l)/2-i)/r),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#mo,e=this.#po;if(isNaN(this.#vo[6])&&!this.isEmpty())return this.#Ro();const n=[];n.push(`M${t[4]} ${t[5]}`);for(let e=6;e<t.length;e+=6)isNaN(t[e])?n.push(`L${t[e+4]} ${t[e+5]}`):n.push(`C${t[e]} ${t[e+1]} ${t[e+2]} ${t[e+3]} ${t[e+4]} ${t[e+5]}`);this.#Io(n);for(let t=e.length-6;t>=6;t-=6)isNaN(e[t])?n.push(`L${e[t+4]} ${e[t+5]}`):n.push(`C${e[t]} ${e[t+1]} ${e[t+2]} ${e[t+3]} ${e[t+4]} ${e[t+5]}`);return this.#Po(n),n.join(" ")}#Ro(){const[t,e,n,i]=this.#uo,[s,r,o,a]=this.#ko();return`M${(this.#vo[2]-t)/n} ${(this.#vo[3]-e)/i} L${(this.#vo[4]-t)/n} ${(this.#vo[5]-e)/i} L${s} ${r} L${o} ${a} L${(this.#vo[16]-t)/n} ${(this.#vo[17]-e)/i} L${(this.#vo[14]-t)/n} ${(this.#vo[15]-e)/i} Z`}#Po(t){const e=this.#po;t.push(`L${e[4]} ${e[5]} Z`)}#Io(t){const[e,n,i,s]=this.#uo,r=this.#vo.subarray(4,6),o=this.#vo.subarray(16,18),[a,c,l,h]=this.#ko();t.push(`L${(r[0]-e)/i} ${(r[1]-n)/s} L${a} ${c} L${l} ${h} L${(o[0]-e)/i} ${(o[1]-n)/s}`)}newFreeDrawOutline(t,e,n,i,s,r){return new hs(t,e,n,i,s,r)}getOutlines(){const t=this.#mo,e=this.#po,n=this.#vo,[i,s,r,o]=this.#uo,a=new Float32Array((this.#Eo?.length??0)+2);for(let t=0,e=a.length-2;t<e;t+=2)a[t]=(this.#Eo[t]-i)/r,a[t+1]=(this.#Eo[t+1]-s)/o;if(a[a.length-2]=(this.#yo-i)/r,a[a.length-1]=(this.#bo-s)/o,isNaN(n[6])&&!this.isEmpty())return this.#Mo(a);const c=new Float32Array(this.#mo.length+24+this.#po.length);let l=t.length;for(let e=0;e<l;e+=2)isNaN(t[e])?c[e]=c[e+1]=NaN:(c[e]=t[e],c[e+1]=t[e+1]);l=this.#Do(c,l);for(let t=e.length-6;t>=6;t-=6)for(let n=0;n<6;n+=2)isNaN(e[t+n])?(c[l]=c[l+1]=NaN,l+=2):(c[l]=e[t+n],c[l+1]=e[t+n+1],l+=2);return this.#Oo(c,l),this.newFreeDrawOutline(c,a,this.#uo,this.#xo,this.#go,this.#fo)}#Mo(t){const e=this.#vo,[n,i,s,r]=this.#uo,[o,a,c,l]=this.#ko(),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(e[2]-n)/s,(e[3]-i)/r,NaN,NaN,NaN,NaN,(e[4]-n)/s,(e[5]-i)/r,NaN,NaN,NaN,NaN,o,a,NaN,NaN,NaN,NaN,c,l,NaN,NaN,NaN,NaN,(e[16]-n)/s,(e[17]-i)/r,NaN,NaN,NaN,NaN,(e[14]-n)/s,(e[15]-i)/r],0),this.newFreeDrawOutline(h,t,this.#uo,this.#xo,this.#go,this.#fo)}#Oo(t,e){const n=this.#po;return t.set([NaN,NaN,NaN,NaN,n[4],n[5]],e),e+6}#Do(t,e){const n=this.#vo.subarray(4,6),i=this.#vo.subarray(16,18),[s,r,o,a]=this.#uo,[c,l,h,d]=this.#ko();return t.set([NaN,NaN,NaN,NaN,(n[0]-s)/o,(n[1]-r)/a,NaN,NaN,NaN,NaN,c,l,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,(i[0]-s)/o,(i[1]-r)/a],e),e+24}}class hs extends cs{#uo;#Lo=new Float32Array(4);#go;#fo;#Eo;#xo;#No;constructor(t,e,n,i,s,r){super(),this.#No=t,this.#Eo=e,this.#uo=n,this.#xo=i,this.#go=s,this.#fo=r,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#Fo(r);const[o,a,c,l]=this.#Lo;for(let e=0,n=t.length;e<n;e+=2)t[e]=(t[e]-o)/c,t[e+1]=(t[e+1]-a)/l;for(let t=0,n=e.length;t<n;t+=2)e[t]=(e[t]-o)/c,e[t+1]=(e[t+1]-a)/l}toSVGPath(){const t=[`M${this.#No[4]} ${this.#No[5]}`];for(let e=6,n=this.#No.length;e<n;e+=6)isNaN(this.#No[e])?t.push(`L${this.#No[e+4]} ${this.#No[e+5]}`):t.push(`C${this.#No[e]} ${this.#No[e+1]} ${this.#No[e+2]} ${this.#No[e+3]} ${this.#No[e+4]} ${this.#No[e+5]}`);return t.push("Z"),t.join(" ")}serialize([t,e,n,i],s){const r=n-t,o=i-e;let a,c;switch(s){case 0:a=cs._rescale(this.#No,t,i,r,-o),c=cs._rescale(this.#Eo,t,i,r,-o);break;case 90:a=cs._rescaleAndSwap(this.#No,t,e,r,o),c=cs._rescaleAndSwap(this.#Eo,t,e,r,o);break;case 180:a=cs._rescale(this.#No,n,e,-r,o),c=cs._rescale(this.#Eo,n,e,-r,o);break;case 270:a=cs._rescaleAndSwap(this.#No,n,i,-r,-o),c=cs._rescaleAndSwap(this.#Eo,n,i,-r,-o)}return{outline:Array.from(a),points:[Array.from(c)]}}#Fo(t){const e=this.#No;let n=e[4],i=e[5];const s=[n,i,n,i];let r=n,o=i,a=n,c=i;const l=t?Math.max:Math.min,h=new Float32Array(4);for(let t=6,d=e.length;t<d;t+=6){const d=e[t+4],u=e[t+5];isNaN(e[t])?(ot.pointBoundingBox(d,u,s),o>u?(r=d,o=u):o===u&&(r=l(r,d)),c<u?(a=d,c=u):c===u&&(a=l(a,d))):(h[0]=h[1]=1/0,h[2]=h[3]=-1/0,ot.bezierBoundingBox(n,i,...e.slice(t,t+6),h),ot.rectBoundingBox(h[0],h[1],h[2],h[3],s),o>h[1]?(r=h[0],o=h[1]):o===h[1]&&(r=l(r,h[0])),c<h[3]?(a=h[2],c=h[3]):c===h[3]&&(a=l(a,h[2]))),n=d,i=u}const d=this.#Lo;d[0]=s[0]-this.#go,d[1]=s[1]-this.#go,d[2]=s[2]-s[0]+2*this.#go,d[3]=s[3]-s[1]+2*this.#go,this.firstPoint=[r,o],this.lastPoint=[a,c]}get box(){return this.#Lo}newOutliner(t,e,n,i,s,r=0){return new ls(t,e,n,i,s,r)}getNewOutline(t,e){const[n,i,s,r]=this.#Lo,[o,a,c,l]=this.#uo,h=s*c,d=r*l,u=n*c+o,p=i*l+a,g=this.newOutliner({x:this.#Eo[0]*h+u,y:this.#Eo[1]*d+p},this.#uo,this.#xo,t,this.#fo,e??this.#go);for(let t=2;t<this.#Eo.length;t+=2)g.add({x:this.#Eo[t]*h+u,y:this.#Eo[t+1]*d+p});return g.getOutlines()}}class ds{#uo;#Bo;#Uo;#$o=[];#jo=[];constructor(t,e=0,n=0,i=!0){const s=[1/0,1/0,-1/0,-1/0],r=10**-4;for(const{x:n,y:i,width:o,height:a}of t){const t=Math.floor((n-e)/r)*r,c=Math.ceil((n+o+e)/r)*r,l=Math.floor((i-e)/r)*r,h=Math.ceil((i+a+e)/r)*r,d=[t,l,h,!0],u=[c,l,h,!1];this.#$o.push(d,u),ot.rectBoundingBox(t,l,c,h,s)}const o=s[2]-s[0]+2*n,a=s[3]-s[1]+2*n,c=s[0]-n,l=s[1]-n;let h=i?-1/0:1/0,d=1/0;const u=this.#$o.at(i?-1:-2),p=[u[0],u[2]];for(const t of this.#$o){const[e,n,s,r]=t;!r&&i?n<d?(d=n,h=e):n===d&&(h=Math.max(h,e)):r&&!i&&(n<d?(d=n,h=e):n===d&&(h=Math.min(h,e))),t[0]=(e-c)/o,t[1]=(n-l)/a,t[2]=(s-l)/a}this.#uo=new Float32Array([c,l,o,a]),this.#Bo=[h,d],this.#Uo=p}getOutlines(){this.#$o.sort((t,e)=>t[0]-e[0]||t[1]-e[1]||t[2]-e[2]);const t=[];for(const e of this.#$o)e[3]?(t.push(...this.#zo(e)),this.#Ho(e)):(this.#Go(e),t.push(...this.#zo(e)));return this.#Vo(t)}#Vo(t){const e=[],n=new Set;for(const n of t){const[t,i,s]=n;e.push([t,i,n],[t,s,n])}e.sort((t,e)=>t[1]-e[1]||t[0]-e[0]);for(let t=0,i=e.length;t<i;t+=2){const i=e[t][2],s=e[t+1][2];i.push(s),s.push(i),n.add(i),n.add(s)}const i=[];let s;for(;n.size>0;){const t=n.values().next().value;let[e,r,o,a,c]=t;n.delete(t);let l=e,h=r;for(s=[e,o],i.push(s);;){let t;if(n.has(a))t=a;else{if(!n.has(c))break;t=c}n.delete(t),[e,r,o,a,c]=t,l!==e&&(s.push(l,h,e,h===r?r:o),l=e),h=h===r?o:r}s.push(l,h)}return new us(i,this.#uo,this.#Bo,this.#Uo)}#Wo(t){const e=this.#jo;let n=0,i=e.length-1;for(;n<=i;){const s=n+i>>1,r=e[s][0];if(r===t)return s;r<t?n=s+1:i=s-1}return i+1}#Ho([,t,e]){const n=this.#Wo(t);this.#jo.splice(n,0,[t,e])}#Go([,t,e]){const n=this.#Wo(t);for(let i=n;i<this.#jo.length;i++){const[n,s]=this.#jo[i];if(n!==t)break;if(n===t&&s===e)return void this.#jo.splice(i,1)}for(let i=n-1;i>=0;i--){const[n,s]=this.#jo[i];if(n!==t)break;if(n===t&&s===e)return void this.#jo.splice(i,1)}}#zo(t){const[e,n,i]=t,s=[[e,n,i]],r=this.#Wo(i);for(let t=0;t<r;t++){const[n,i]=this.#jo[t];for(let t=0,r=s.length;t<r;t++){const[,o,a]=s[t];if(!(i<=o||a<=n))if(o>=n)if(a>i)s[t][1]=i;else{if(1===r)return[];s.splice(t,1),t--,r--}else s[t][2]=n,a>i&&s.push([e,i,a])}}return s}}class us extends cs{#uo;#qo;constructor(t,e,n,i){super(),this.#qo=t,this.#uo=e,this.firstPoint=n,this.lastPoint=i}toSVGPath(){const t=[];for(const e of this.#qo){let[n,i]=e;t.push(`M${n} ${i}`);for(let s=2;s<e.length;s+=2){const r=e[s],o=e[s+1];r===n?(t.push(`V${o}`),i=o):o===i&&(t.push(`H${r}`),n=r)}t.push("Z")}return t.join(" ")}serialize([t,e,n,i],s){const r=[],o=n-t,a=i-e;for(const e of this.#qo){const n=new Array(e.length);for(let s=0;s<e.length;s+=2)n[s]=t+e[s]*o,n[s+1]=i-e[s+1]*a;r.push(n)}return r}get box(){return this.#uo}get classNamesForOutlining(){return["highlightOutline"]}}class ps extends ls{newFreeDrawOutline(t,e,n,i,s,r){return new gs(t,e,n,i,s,r)}}class gs extends hs{newOutliner(t,e,n,i,s,r=0){return new ps(t,e,n,i,s,r)}}class fs extends re{#Ko=null;#Yo=0;#Xo;#Jo=null;#s=null;#Qo=null;#Zo=null;#ta=0;#ea=null;#na=null;#A=null;#ia=!1;#Bo=null;#Uo=null;#sa=null;#he="";#So;#ra="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=M.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=fs.prototype;return K(this,"_keyboardManager",new Zt([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||fs._defaultColor,this.#So=t.thickness||fs._defaultThickness,this.opacity=t.opacity||fs._defaultOpacity,this.#Xo=t.boxes||null,this.#ra=t.methodOfCreation||"",this.#he=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#ia=!0,this.#oa(t),this.#aa()):this.#Xo&&(this.#Ko=t.anchorNode,this.#Yo=t.anchorOffset,this.#Zo=t.focusNode,this.#ta=t.focusOffset,this.#ca(),this.#aa(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#ia?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#So,methodOfCreation:this.#ra}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#ca(){const t=new ds(this.#Xo,.001);this.#na=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#na.box;const e=new ds(this.#Xo,.0025,.001,"ltr"===this._uiManager.direction);this.#Qo=e.getOutlines();const{firstPoint:n}=this.#na;this.#Bo=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height];const{lastPoint:i}=this.#Qo;this.#Uo=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]}#oa({highlightOutlines:t,highlightId:e,clipPathId:n}){if(this.#na=t,this.#Qo=t.getNewOutline(this.#So/2+1.5,.0025),e>=0)this.#A=e,this.#Jo=n,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#sa=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#Qo.box,path:{d:this.#Qo.toSVGPath()}},!0);else if(this.parent){const e=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#A,{bbox:fs.#la(this.#na.box,(e-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#sa,{bbox:fs.#la(this.#Qo.box,e),path:{d:this.#Qo.toSVGPath()}})}const[i,s,r,o]=t.box;switch(this.rotation){case 0:this.x=i,this.y=s,this.width=r,this.height=o;break;case 90:{const[t,e]=this.parentDimensions;this.x=s,this.y=1-i,this.width=r*e/t,this.height=o*t/e;break}case 180:this.x=1-i,this.y=1-s,this.width=r,this.height=o;break;case 270:{const[t,e]=this.parentDimensions;this.x=1-s,this.y=i,this.width=r*e/t,this.height=o*t/e;break}}const{firstPoint:a}=t;this.#Bo=[(a[0]-i)/r,(a[1]-s)/o];const{lastPoint:c}=this.#Qo;this.#Uo=[(c[0]-i)/r,(c[1]-s)/o]}static initialize(t,e){re.initialize(t,e),fs._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case D.HIGHLIGHT_COLOR:fs._defaultColor=e;break;case D.HIGHLIGHT_THICKNESS:fs._defaultThickness=e}}translateInPage(t,e){}get toolbarPosition(){return this.#Uo}get commentButtonPosition(){return this.#Bo}updateParams(t,e){switch(t){case D.HIGHLIGHT_COLOR:this.#Mr(e);break;case D.HIGHLIGHT_THICKNESS:this.#ha(e)}}static get defaultPropertiesToUpdate(){return[[D.HIGHLIGHT_COLOR,fs._defaultColor],[D.HIGHLIGHT_THICKNESS,fs._defaultThickness]]}get propertiesToUpdate(){return[[D.HIGHLIGHT_COLOR,this.color||fs._defaultColor],[D.HIGHLIGHT_THICKNESS,this.#So||fs._defaultThickness],[D.HIGHLIGHT_FREE,this.#ia]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#A,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#s?.updateColor(this.color),super.onUpdatedColor()}#Mr(t){const e=(t,e)=>{this.color=t,this.opacity=e,this.onUpdatedColor()},n=this.color,i=this.opacity;this.addCommands({cmd:e.bind(this,t,fs._defaultOpacity),undo:e.bind(this,n,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:D.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#ha(t){const e=this.#So,n=t=>{this.#So=t,this.#da(t)};this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:D.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#s=new xi({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#ua())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#ua())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#pa(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.#aa(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#pa():t&&(this.#aa(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#da(t){this.#ia&&(this.#oa({highlightOutlines:this.#na.getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims(this.width,this.height))}#pa(){null!==this.#A&&this.parent&&(this.parent.drawLayer.remove(this.#A),this.#A=null,this.parent.drawLayer.remove(this.#sa),this.#sa=null)}#aa(t=this.parent){null===this.#A&&(({id:this.#A,clipPathId:this.#Jo}=t.drawLayer.draw({bbox:this.#na.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#ia},path:{d:this.#na.toSVGPath()}},!1,!0)),this.#sa=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#ia},bbox:this.#Qo.box,path:{d:this.#Qo.toSVGPath()}},this.#ia),this.#ea&&(this.#ea.style.clipPath=this.#Jo))}static#la([t,e,n,i],s){switch(s){case 90:return[1-e-i,t,i,n];case 180:return[1-t-n,1-e-i,n,i];case 270:return[e,1-t-n,i,n]}return[t,e,n,i]}rotate(t){const{drawLayer:e}=this.parent;let n;this.#ia?(t=(t-this.rotation+360)%360,n=fs.#la(this.#na.box,t)):n=fs.#la([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#A,{bbox:n,root:{"data-main-rotation":t}}),e.updateProperties(this.#sa,{bbox:fs.#la(this.#Qo.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#he&&(t.setAttribute("aria-label",this.#he),t.setAttribute("role","mark")),this.#ia?t.classList.add("free"):this.div.addEventListener("keydown",this.#ga.bind(this),{signal:this._uiManager._signal});const e=this.#ea=document.createElement("div");return t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#Jo,this.setDims(this.width,this.height),Yt(this,this.#ea,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#sa,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#sa,{rootClass:{hovered:!1}})}#ga(t){fs._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#fa(!0);break;case 1:case 3:this.#fa(!1)}}#fa(t){if(!this.#Ko)return;const e=window.getSelection();t?e.setPosition(this.#Ko,this.#Yo):e.setPosition(this.#Zo,this.#ta)}select(){super.select(),this.#sa&&this.parent?.drawLayer.updateProperties(this.#sa,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#sa&&(this.parent?.drawLayer.updateProperties(this.#sa,{rootClass:{selected:!1}}),this.#ia||this.#fa(!1))}get _mustFixPosition(){return!this.#ia}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#A,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#sa,{rootClass:{hidden:!t}}))}#ua(){return this.#ia?this.rotation:0}#ma(){if(this.#ia)return null;const[t,e]=this.pageDimensions,[n,i]=this.pageTranslation,s=this.#Xo,r=new Float32Array(8*s.length);let o=0;for(const{x:a,y:c,width:l,height:h}of s){const s=a*t+n,d=(1-c)*e+i;r[o]=r[o+4]=s,r[o+1]=r[o+3]=d,r[o+2]=r[o+6]=s+l*t,r[o+5]=r[o+7]=d-h*e,o+=8}return r}#va(t){return this.#na.serialize(t,this.#ua())}static startHighlighting(t,e,{target:n,x:i,y:s}){const{x:r,y:o,width:a,height:c}=n.getBoundingClientRect(),l=new AbortController,h=t.combinedSignal(l),d=e=>{l.abort(),this.#ya(t,e)};window.addEventListener("blur",d,{signal:h}),window.addEventListener("pointerup",d,{signal:h}),window.addEventListener("pointerdown",kt,{capture:!0,passive:!1,signal:h}),window.addEventListener("contextmenu",Tt,{signal:h}),n.addEventListener("pointermove",this.#ba.bind(this,t),{signal:h}),this._freeHighlight=new ps({x:i,y:s},[r,o,a,c],t.scale,this._defaultThickness/2,e,.001),({id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0))}static#ba(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#ya(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,n){let i=null;if(t instanceof Zi){const{data:{quadPoints:e,rect:n,rotation:s,id:r,color:o,opacity:a,popupRef:c,richText:l,contentsObj:h,creationDate:d,modificationDate:u},parent:{page:{pageNumber:p}}}=t;i=t={annotationType:M.HIGHLIGHT,color:Array.from(o),opacity:a,quadPoints:e,boxes:null,pageIndex:p-1,rect:n.slice(0),rotation:s,annotationElementId:r,id:r,deleted:!1,popupRef:c,richText:l,comment:h?.str||null,creationDate:d,modificationDate:u}}else if(t instanceof Qi){const{data:{inkLists:e,rect:n,rotation:s,id:r,color:o,borderStyle:{rawWidth:a},popupRef:c,richText:l,contentsObj:h,creationDate:d,modificationDate:u},parent:{page:{pageNumber:p}}}=t;i=t={annotationType:M.HIGHLIGHT,color:Array.from(o),thickness:a,inkLists:e,boxes:null,pageIndex:p-1,rect:n.slice(0),rotation:s,annotationElementId:r,id:r,deleted:!1,popupRef:c,richText:l,comment:h?.str||null,creationDate:d,modificationDate:u}}const{color:s,quadPoints:r,inkLists:o,opacity:a}=t,c=await super.deserialize(t,e,n);c.color=ot.makeHexColor(...s),c.opacity=a||1,o&&(c.#So=t.thickness),c._initialData=i,t.comment&&c.setCommentData(t);const[l,h]=c.pageDimensions,[d,u]=c.pageTranslation;if(r){const t=c.#Xo=[];for(let e=0;e<r.length;e+=8)t.push({x:(r[e]-d)/l,y:1-(r[e+1]-u)/h,width:(r[e+2]-r[e])/l,height:(r[e+1]-r[e+5])/h});c.#ca(),c.#aa(),c.rotate(c.rotation)}else if(o){c.#ia=!0;const t=o[0],n={x:t[0]-d,y:h-(t[1]-u)},i=new ps(n,[0,0,l,h],1,c.#So/2,!0,.001);for(let e=0,s=t.length;e<s;e+=2)n.x=t[e]-d,n.y=h-(t[e+1]-u),i.add(n);const{id:s,clipPathId:r}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:i.toSVGPath()}},!0,!0);c.#oa({highlightOutlines:i.getOutlines(),highlightId:s,clipPathId:r}),c.#aa(),c.rotate(c.parentRotation)}return c}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=re._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),n=super.serialize(t);return Object.assign(n,{color:e,opacity:this.opacity,thickness:this.#So,quadPoints:this.#ma(),outlines:this.#va(n.rect)}),this.addComment(n),this.annotationElementId&&!this.#do(n)?null:(n.id=this.annotationElementId,n)}#do(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((t,n)=>t!==e[n])}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class ms{#wa=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,n]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,n)}updateSVGProperty(t,e){this.#wa[t]=e}toSVGProperties(){const t=this.#wa;return this.#wa=Object.create(null),{root:t}}reset(){this.#wa=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){G("Not implemented")}}class vs extends re{#Aa=null;#xa;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#Sa=null;static#Ea=null;static#_a=null;static#Ca=NaN;static#Ta=null;static#ka=null;static#Ra=NaN;static _INNER_MARGIN=3;constructor(t){super(t),this.#xa=t.mustBeCommitted||!1,this._addOutlines(t)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(this.#Ia(t),this.#aa())}#Ia({drawOutlines:t,drawId:e,drawingOptions:n}){this.#Aa=t,this._drawingOptions||=n,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#Pa(t,this.parent),this.#Ma(t.box)}#Pa(t,e){const{id:n}=e.drawLayer.draw(vs._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return n}static _mergeSVGProperties(t,e){const n=new Set(Object.keys(t));for(const[i,s]of Object.entries(e))n.has(i)?Object.assign(t[i],s):t[i]=s;return t}static getDefaultDrawingOptions(t){G("Not implemented")}static get typesMap(){G("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const n=this.typesMap.get(t);n&&this._defaultDrawingOptions.updateProperty(n,e),this._currentParent&&(vs.#Sa.updateProperty(n,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const n=this.constructor.typesMap.get(t);n&&this._updateProperty(t,n,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[n,i]of this.typesMap)t.push([n,e[i]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[n,i]of this.constructor.typesMap)t.push([n,e[i]]);return t}_updateProperty(t,e,n){const i=this._drawingOptions,s=i[e],r=n=>{i.updateProperty(e,n);const s=this.#Aa.updateProperty(e,n);s&&this.#Ma(s),this.parent?.drawLayer.updateProperties(this._drawId,i.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:r.bind(this,n),undo:r.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,vs._mergeSVGProperties(this.#Aa.getPathResizingSVGProperties(this.#Da()),{bbox:this.#Oa()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,vs._mergeSVGProperties(this.#Aa.getPathResizedSVGProperties(this.#Da()),{bbox:this.#Oa()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#Oa()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,vs._mergeSVGProperties(this.#Aa.getPathTranslatedSVGProperties(this.#Da(),this.parentDimensions),{bbox:this.#Oa()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#xa&&(this.#xa=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#pa(),super.remove()}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.#aa(),this.#Ma(this.#Aa.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#pa()):t&&(this._uiManager.addShouldRescale(this),this.#aa(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#pa(){null!==this._drawId&&this.parent&&(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#aa(t=this.parent){null!==this._drawId&&this.parent===t||(null===this._drawId?(this._drawingOptions.updateAll(),this._drawId=this.#Pa(this.#Aa,t)):this.parent.drawLayer.updateParent(this._drawId,t.drawLayer))}#La([t,e,n,i]){const{parentDimensions:[s,r],rotation:o}=this;switch(o){case 90:return[e,1-t,n*(r/s),i*(s/r)];case 180:return[1-t,1-e,n,i];case 270:return[1-e,t,n*(r/s),i*(s/r)];default:return[t,e,n,i]}}#Da(){const{x:t,y:e,width:n,height:i,parentDimensions:[s,r],rotation:o}=this;switch(o){case 90:return[1-e,t,n*(s/r),i*(r/s)];case 180:return[1-t,1-e,n,i];case 270:return[e,1-t,n*(s/r),i*(r/s)];default:return[t,e,n,i]}}#Ma(t){[this.x,this.y,this.width,this.height]=this.#La(t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#Oa(){const{x:t,y:e,width:n,height:i,rotation:s,parentRotation:r,parentDimensions:[o,a]}=this;switch((4*s+r)/90){case 1:return[1-e-i,t,i,n];case 2:return[1-t-n,1-e-i,n,i];case 3:return[e,1-t-n,i,n];case 4:return[t,e-n*(o/a),i*(a/o),n*(o/a)];case 5:return[1-e,t,n*(o/a),i*(a/o)];case 6:return[1-t-i*(a/o),1-e,i*(a/o),n*(o/a)];case 7:return[e-n*(o/a),1-t-i*(a/o),n*(o/a),i*(a/o)];case 8:return[t-n,e-i,n,i];case 9:return[1-e,t-n,i,n];case 10:return[1-t,1-e,n,i];case 11:return[e-i,1-t,i,n];case 12:return[t-i*(a/o),e,i*(a/o),n*(o/a)];case 13:return[1-e-n*(o/a),t-i*(a/o),n*(o/a),i*(a/o)];case 14:return[1-t,1-e-n*(o/a),i*(a/o),n*(o/a)];case 15:return[e,1-t,n*(o/a),i*(a/o)];default:return[t,e,n,i]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,vs._mergeSVGProperties({bbox:this.#Oa()},this.#Aa.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#Ma(this.#Aa.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const n=super.render();n.classList.add("draw");const i=document.createElement("div");return n.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),n}static createDrawerInstance(t,e,n,i,s){G("Not implemented")}static startDrawing(t,e,n,i){const{target:s,offsetX:r,offsetY:o,pointerId:a,pointerType:c}=i;if(vs.#Ta&&vs.#Ta!==c)return;const{viewport:{rotation:l}}=t,{width:h,height:d}=s.getBoundingClientRect(),u=vs.#Ea=new AbortController,p=t.combinedSignal(u);vs.#Ca||=a,vs.#Ta??=c,window.addEventListener("pointerup",t=>{vs.#Ca===t.pointerId?this._endDraw(t):vs.#ka?.delete(t.pointerId)},{signal:p}),window.addEventListener("pointercancel",t=>{vs.#Ca===t.pointerId?this._currentParent.endDrawingSession():vs.#ka?.delete(t.pointerId)},{signal:p}),window.addEventListener("pointerdown",t=>{vs.#Ta===t.pointerType&&((vs.#ka||=new Set).add(t.pointerId),vs.#Sa.isCancellable()&&(vs.#Sa.removeLastElement(),vs.#Sa.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",Tt,{signal:p}),s.addEventListener("pointermove",this._drawMove.bind(this),{signal:p}),s.addEventListener("touchmove",t=>{t.timeStamp===vs.#Ra&&kt(t)},{signal:p}),t.toggleDrawing(),e._editorUndoBar?.hide(),vs.#Sa?t.drawLayer.updateProperties(this._currentDrawId,vs.#Sa.startNew(r,o,h,d,l)):(e.updateUIForDefaultProperties(this),vs.#Sa=this.createDrawerInstance(r,o,h,d,l),vs.#_a=this.getDefaultDrawingOptions(),this._currentParent=t,({id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(vs.#_a.toSVGProperties(),vs.#Sa.defaultSVGProperties),!0,!1)))}static _drawMove(t){if(vs.#Ra=-1,!vs.#Sa)return;const{offsetX:e,offsetY:n,pointerId:i}=t;vs.#Ca===i&&(vs.#ka?.size>=1?this._endDraw(t):(this._currentParent.drawLayer.updateProperties(this._currentDrawId,vs.#Sa.add(e,n)),vs.#Ra=t.timeStamp,kt(t)))}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,vs.#Sa=null,vs.#_a=null,vs.#Ta=null,vs.#Ra=NaN),vs.#Ea&&(vs.#Ea.abort(),vs.#Ea=null,vs.#Ca=NaN,vs.#ka=null)}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,vs.#Sa.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const t=vs.#Sa,n=this._currentDrawId,i=t.getLastElement();return void e.addCommands({cmd:()=>{e.drawLayer.updateProperties(n,t.setLastElement(i))},undo:()=>{e.drawLayer.updateProperties(n,t.removeLastElement())},mustExec:!1,type:D.DRAW_STEP})}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(D.DRAW_STEP),!vs.#Sa.isEmpty()){const{pageDimensions:[n,i],scale:s}=e,r=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:vs.#Sa.getOutlines(n*s,i*s,s,this._INNER_MARGIN),drawingOptions:vs.#_a,mustBeCommitted:!t});return this._cleanup(!0),r}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,n,i,s,r){G("Not implemented")}static async deserialize(t,e,n){const{rawDims:{pageWidth:i,pageHeight:s,pageX:r,pageY:o}}=e.viewport,a=this.deserializeDraw(r,o,i,s,this._INNER_MARGIN,t),c=await super.deserialize(t,e,n);return c.createDrawingOptions(t),c.#Ia({drawOutlines:a}),c.#aa(),c.onScaleChanging(),c.rotate(),c}serializeDraw(t){const[e,n]=this.pageTranslation,[i,s]=this.pageDimensions;return this.#Aa.serialize([e,n,i,s],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class ys{#vo=new Float64Array(6);#Ur;#Na;#is;#So;#Eo;#Fa="";#Ba=0;#qo=new bs;#Ua;#$a;constructor(t,e,n,i,s,r){this.#Ua=n,this.#$a=i,this.#is=s,this.#So=r,[t,e]=this.#ja(t,e);const o=this.#Ur=[NaN,NaN,NaN,NaN,t,e];this.#Eo=[t,e],this.#Na=[{line:o,points:this.#Eo}],this.#vo.set(o,0)}updateProperty(t,e){"stroke-width"===t&&(this.#So=e)}#ja(t,e){return cs._normalizePoint(t,e,this.#Ua,this.#$a,this.#is)}isEmpty(){return!this.#Na||0===this.#Na.length}isCancellable(){return this.#Eo.length<=10}add(t,e){[t,e]=this.#ja(t,e);const[n,i,s,r]=this.#vo.subarray(2,6),o=t-s,a=e-r;return Math.hypot(this.#Ua*o,this.#$a*a)<=2?null:(this.#Eo.push(t,e),isNaN(n)?(this.#vo.set([s,r,t,e],2),this.#Ur.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#vo[0])&&this.#Ur.splice(6,6),this.#vo.set([n,i,s,r,t,e],0),this.#Ur.push(...cs.createBezierPoints(n,i,s,r,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){return this.add(t,e)||(2===this.#Eo.length?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,n,i,s){this.#Ua=n,this.#$a=i,this.#is=s,[t,e]=this.#ja(t,e);const r=this.#Ur=[NaN,NaN,NaN,NaN,t,e];this.#Eo=[t,e];const o=this.#Na.at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),this.#Na.push({line:r,points:this.#Eo}),this.#vo.set(r,0),this.#Ba=0,this.toSVGPath(),null}getLastElement(){return this.#Na.at(-1)}setLastElement(t){return this.#Na?(this.#Na.push(t),this.#Ur=t.line,this.#Eo=t.points,this.#Ba=0,{path:{d:this.toSVGPath()}}):this.#qo.setLastElement(t)}removeLastElement(){if(!this.#Na)return this.#qo.removeLastElement();this.#Na.pop(),this.#Fa="";for(let t=0,e=this.#Na.length;t<e;t++){const{line:e,points:n}=this.#Na[t];this.#Ur=e,this.#Eo=n,this.#Ba=0,this.toSVGPath()}return{path:{d:this.#Fa}}}toSVGPath(){const t=cs.svgRound(this.#Ur[4]),e=cs.svgRound(this.#Ur[5]);if(2===this.#Eo.length)return this.#Fa=`${this.#Fa} M ${t} ${e} Z`,this.#Fa;if(this.#Eo.length<=6){const n=this.#Fa.lastIndexOf("M");this.#Fa=`${this.#Fa.slice(0,n)} M ${t} ${e}`,this.#Ba=6}if(4===this.#Eo.length){const t=cs.svgRound(this.#Ur[10]),e=cs.svgRound(this.#Ur[11]);return this.#Fa=`${this.#Fa} L ${t} ${e}`,this.#Ba=12,this.#Fa}const n=[];0===this.#Ba&&(n.push(`M ${t} ${e}`),this.#Ba=6);for(let t=this.#Ba,e=this.#Ur.length;t<e;t+=6){const[e,i,s,r,o,a]=this.#Ur.slice(t,t+6).map(cs.svgRound);n.push(`C${e} ${i} ${s} ${r} ${o} ${a}`)}return this.#Fa+=n.join(" "),this.#Ba=this.#Ur.length,this.#Fa}getOutlines(t,e,n,i){const s=this.#Na.at(-1);return s.line=new Float32Array(s.line),s.points=new Float32Array(s.points),this.#qo.build(this.#Na,t,e,n,this.#is,this.#So,i),this.#vo=null,this.#Ur=null,this.#Na=null,this.#Fa=null,this.#qo}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class bs extends cs{#Lo;#za=0;#go;#Na;#Ua;#$a;#Ha;#is;#So;build(t,e,n,i,s,r,o){this.#Ua=e,this.#$a=n,this.#Ha=i,this.#is=s,this.#So=r,this.#go=o??0,this.#Na=t,this.#Ga()}get thickness(){return this.#So}setLastElement(t){return this.#Na.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#Na.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#Na)if(t.push(`M${cs.svgRound(e[4])} ${cs.svgRound(e[5])}`),6!==e.length)if(12===e.length&&isNaN(e[6]))t.push(`L${cs.svgRound(e[10])} ${cs.svgRound(e[11])}`);else for(let n=6,i=e.length;n<i;n+=6){const[i,s,r,o,a,c]=e.subarray(n,n+6).map(cs.svgRound);t.push(`C${i} ${s} ${r} ${o} ${a} ${c}`)}else t.push("Z");return t.join("")}serialize([t,e,n,i],s){const r=[],o=[],[a,c,l,h]=this.#Va();let d,u,p,g,f,m,v,y,b;switch(this.#is){case 0:b=cs._rescale,d=t,u=e+i,p=n,g=-i,f=t+a*n,m=e+(1-c-h)*i,v=t+(a+l)*n,y=e+(1-c)*i;break;case 90:b=cs._rescaleAndSwap,d=t,u=e,p=n,g=i,f=t+c*n,m=e+a*i,v=t+(c+h)*n,y=e+(a+l)*i;break;case 180:b=cs._rescale,d=t+n,u=e,p=-n,g=i,f=t+(1-a-l)*n,m=e+c*i,v=t+(1-a)*n,y=e+(c+h)*i;break;case 270:b=cs._rescaleAndSwap,d=t+n,u=e+i,p=-n,g=-i,f=t+(1-c-h)*n,m=e+(1-a-l)*i,v=t+(1-c)*n,y=e+(1-a)*i}for(const{line:t,points:e}of this.#Na)r.push(b(t,d,u,p,g,s?new Array(t.length):null)),o.push(b(e,d,u,p,g,s?new Array(e.length):null));return{lines:r,points:o,rect:[f,m,v,y]}}static deserialize(t,e,n,i,s,{paths:{lines:r,points:o},rotation:a,thickness:c}){const l=[];let h,d,u,p,g;switch(a){case 0:g=cs._rescale,h=-t/n,d=e/i+1,u=1/n,p=-1/i;break;case 90:g=cs._rescaleAndSwap,h=-e/i,d=-t/n,u=1/i,p=1/n;break;case 180:g=cs._rescale,h=t/n+1,d=-e/i,u=-1/n,p=1/i;break;case 270:g=cs._rescaleAndSwap,h=e/i+1,d=t/n+1,u=-1/i,p=-1/n}if(!r){r=[];for(const t of o){const e=t.length;if(2===e){r.push(new Float32Array([NaN,NaN,NaN,NaN,t[0],t[1]]));continue}if(4===e){r.push(new Float32Array([NaN,NaN,NaN,NaN,t[0],t[1],NaN,NaN,NaN,NaN,t[2],t[3]]));continue}const n=new Float32Array(3*(e-2));r.push(n);let[i,s,o,a]=t.subarray(0,4);n.set([NaN,NaN,NaN,NaN,i,s],0);for(let r=4;r<e;r+=2){const e=t[r],c=t[r+1];n.set(cs.createBezierPoints(i,s,o,a,e,c),3*(r-2)),[i,s,o,a]=[o,a,e,c]}}}for(let t=0,e=r.length;t<e;t++)l.push({line:g(r[t].map(t=>t??NaN),h,d,u,p),points:g(o[t].map(t=>t??NaN),h,d,u,p)});const f=new this.prototype.constructor;return f.build(l,n,i,1,a,c,s),f}#Wa(t=this.#So){const e=this.#go+t/2*this.#Ha;return this.#is%180==0?[e/this.#Ua,e/this.#$a]:[e/this.#$a,e/this.#Ua]}#Va(){const[t,e,n,i]=this.#Lo,[s,r]=this.#Wa(0);return[t+s,e+r,n-2*s,i-2*r]}#Ga(){const t=this.#Lo=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:e}of this.#Na){if(e.length<=12){for(let n=4,i=e.length;n<i;n+=6)ot.pointBoundingBox(e[n],e[n+1],t);continue}let n=e[4],i=e[5];for(let s=6,r=e.length;s<r;s+=6){const[r,o,a,c,l,h]=e.subarray(s,s+6);ot.bezierBoundingBox(n,i,r,o,a,c,l,h,t),n=l,i=h}}const[e,n]=this.#Wa();t[0]=ut(t[0]-e,0,1),t[1]=ut(t[1]-n,0,1),t[2]=ut(t[2]+e,0,1),t[3]=ut(t[3]+n,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#Lo}updateProperty(t,e){return"stroke-width"===t?this.#ha(e):null}#ha(t){const[e,n]=this.#Wa();this.#So=t;const[i,s]=this.#Wa(),[r,o]=[i-e,s-n],a=this.#Lo;return a[0]-=r,a[1]-=o,a[2]+=2*r,a[3]+=2*o,a}updateParentDimensions([t,e],n){const[i,s]=this.#Wa();this.#Ua=t,this.#$a=e,this.#Ha=n;const[r,o]=this.#Wa(),a=r-i,c=o-s,l=this.#Lo;return l[0]-=a,l[1]-=c,l[2]+=2*a,l[3]+=2*c,l}updateRotation(t){return this.#za=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#Lo.map(cs.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#Lo;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${cs.svgRound(t)} ${cs.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#Lo;let n=0,i=0,s=0,r=0,o=0,a=0;switch(this.#za){case 90:i=e/t,s=-t/e,o=t;break;case 180:n=-1,r=-1,o=t,a=e;break;case 270:i=-e/t,s=t/e,a=e;break;default:return""}return`matrix(${n} ${i} ${s} ${r} ${cs.svgRound(o)} ${cs.svgRound(a)})`}getPathResizingSVGProperties([t,e,n,i]){const[s,r]=this.#Wa(),[o,a,c,l]=this.#Lo;if(Math.abs(c-s)<=cs.PRECISION||Math.abs(l-r)<=cs.PRECISION){const s=t+n/2-(o+c/2),r=e+i/2-(a+l/2);return{path:{"transform-origin":`${cs.svgRound(t)} ${cs.svgRound(e)}`,transform:`${this.rotationTransform} translate(${s} ${r})`}}}const h=(n-2*s)/(c-2*s),d=(i-2*r)/(l-2*r),u=c/n,p=l/i;return{path:{"transform-origin":`${cs.svgRound(o)} ${cs.svgRound(a)}`,transform:`${this.rotationTransform} scale(${u} ${p}) translate(${cs.svgRound(s)} ${cs.svgRound(r)}) scale(${h} ${d}) translate(${cs.svgRound(-s)} ${cs.svgRound(-r)})`}}}getPathResizedSVGProperties([t,e,n,i]){const[s,r]=this.#Wa(),o=this.#Lo,[a,c,l,h]=o;if(o[0]=t,o[1]=e,o[2]=n,o[3]=i,Math.abs(l-s)<=cs.PRECISION||Math.abs(h-r)<=cs.PRECISION){const s=t+n/2-(a+l/2),r=e+i/2-(c+h/2);for(const{line:t,points:e}of this.#Na)cs._translate(t,s,r,t),cs._translate(e,s,r,e);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${cs.svgRound(t)} ${cs.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const d=(n-2*s)/(l-2*s),u=(i-2*r)/(h-2*r),p=-d*(a+s)+t+s,g=-u*(c+r)+e+r;if(1!==d||1!==u||0!==p||0!==g)for(const{line:t,points:e}of this.#Na)cs._rescale(t,p,g,d,u,t),cs._rescale(e,p,g,d,u,e);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${cs.svgRound(t)} ${cs.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],n){const[i,s]=n,r=this.#Lo,o=t-r[0],a=e-r[1];if(this.#Ua===i&&this.#$a===s)for(const{line:t,points:e}of this.#Na)cs._translate(t,o,a,t),cs._translate(e,o,a,e);else{const t=this.#Ua/i,e=this.#$a/s;this.#Ua=i,this.#$a=s;for(const{line:n,points:i}of this.#Na)cs._rescale(n,o,a,t,e,n),cs._rescale(i,o,a,t,e,i);r[2]*=t,r[3]*=e}return r[0]=t,r[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${cs.svgRound(t)} ${cs.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#Lo;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${cs.svgRound(t[0])} ${cs.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class ws extends ms{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:re._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){"stroke-width"===t&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new ws(this._viewParameters);return t.updateAll(this),t}}class As extends vs{static _type="ink";static _editorType=M.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){re.initialize(t,e),this._defaultDrawingOptions=new ws(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return K(this,"typesMap",new Map([[D.INK_THICKNESS,"stroke-width"],[D.INK_COLOR,"stroke"],[D.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,n,i,s){return new ys(t,e,n,i,s,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,n,i,s,r){return bs.deserialize(t,e,n,i,s,r)}static async deserialize(t,e,n){let i=null;if(t instanceof Qi){const{data:{inkLists:e,rect:n,rotation:s,id:r,color:o,opacity:a,borderStyle:{rawWidth:c},popupRef:l,richText:h,contentsObj:d,creationDate:u,modificationDate:p},parent:{page:{pageNumber:g}}}=t;i=t={annotationType:M.INK,color:Array.from(o),thickness:c,opacity:a,paths:{points:e},boxes:null,pageIndex:g-1,rect:n.slice(0),rotation:s,annotationElementId:r,id:r,deleted:!1,popupRef:l,richText:h,comment:d?.str||null,creationDate:u,modificationDate:p}}const s=await super.deserialize(t,e,n);return s._initialData=i,t.comment&&s.setCommentData(t),s}get toolbarButtons(){return this._colorPicker||=new Si(this),[["colorPicker",this._colorPicker]]}get colorType(){return D.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:n}=this;e.updateSVGProperty("stroke-width"),n.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:n}){this._drawingOptions=As.getDefaultDrawingOptions({stroke:ot.makeHexColor(...t),"stroke-width":e,"stroke-opacity":n})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:n}=this.serializeDraw(t),{_drawingOptions:{stroke:i,"stroke-opacity":s,"stroke-width":r}}=this,o=Object.assign(super.serialize(t),{color:re._colorManager.convert(i),opacity:s,thickness:r,paths:{lines:e,points:n}});return this.addComment(o),t?(o.isCopy=!0,o):this.annotationElementId&&!this.#do(o)?null:(o.id=this.annotationElementId,o)}#do(t){const{color:e,thickness:n,opacity:i,pageIndex:s}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((t,n)=>t!==e[n])||t.thickness!==n||t.opacity!==i||t.pageIndex!==s}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:n}=this.serializeDraw(!1);return t.updateEdited({rect:n,thickness:this._drawingOptions["stroke-width"],points:e,popup:this.comment}),null}}class xs extends bs{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}class Ss{static#qa={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#Ka(t,e,n,i){return i-=e,0===(n-=t)?i>0?0:4:1===n?i+6:2-i}static#Ya=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#Xa(t,e,n,i,s,r,o){const a=this.#Ka(n,i,s,r);for(let s=0;s<8;s++){const r=(-s+a-o+16)%8;if(0!==t[(n+this.#Ya[2*r])*e+(i+this.#Ya[2*r+1])])return r}return-1}static#Ja(t,e,n,i,s,r,o){const a=this.#Ka(n,i,s,r);for(let s=0;s<8;s++){const r=(s+a+o+16)%8;if(0!==t[(n+this.#Ya[2*r])*e+(i+this.#Ya[2*r+1])])return r}return-1}static#Qa(t,e,n,i){const s=t.length,r=new Int32Array(s);for(let e=0;e<s;e++)r[e]=t[e]<=i?1:0;for(let t=1;t<n-1;t++)r[t*e]=r[t*e+e-1]=0;for(let t=0;t<e;t++)r[t]=r[e*n-1-t]=0;let o,a=1;const c=[];for(let t=1;t<n-1;t++){o=1;for(let n=1;n<e-1;n++){const i=t*e+n,s=r[i];if(0===s)continue;let l=t,h=n;if(1===s&&0===r[i-1])a+=1,h-=1;else{if(!(s>=1&&0===r[i+1])){1!==s&&(o=Math.abs(s));continue}a+=1,h+=1,s>1&&(o=s)}const d=[n,t],u=h===n+1,p={isHole:u,points:d,id:a,parent:0};let g;c.push(p);for(const t of c)if(t.id===o){g=t;break}g?g.isHole?p.parent=u?g.parent:o:p.parent=u?o:g.parent:p.parent=u?o:0;const f=this.#Xa(r,e,t,n,l,h,0);if(-1===f){r[i]=-a,1!==r[i]&&(o=Math.abs(r[i]));continue}let m=this.#Ya[2*f],v=this.#Ya[2*f+1];const y=t+m,b=n+v;l=y,h=b;let w=t,A=n;for(;;){const s=this.#Ja(r,e,w,A,l,h,1);m=this.#Ya[2*s],v=this.#Ya[2*s+1];const c=w+m,u=A+v;d.push(u,c);const p=w*e+A;if(0===r[p+1]?r[p]=-a:1===r[p]&&(r[p]=a),c===t&&u===n&&w===y&&A===b){1!==r[i]&&(o=Math.abs(r[i]));break}l=w,h=A,w=c,A=u}}}return c}static#Za(t,e,n,i){if(n-e<=4){for(let s=e;s<n-2;s+=2)i.push(t[s],t[s+1]);return}const s=t[e],r=t[e+1],o=t[n-4]-s,a=t[n-3]-r,c=Math.hypot(o,a),l=o/c,h=a/c,d=l*r-h*s,u=a/o,p=1/c,g=Math.atan(u),f=Math.cos(g),m=Math.sin(g),v=p*(Math.abs(f)+Math.abs(m)),y=p*(1-v+v**2),b=Math.max(Math.atan(Math.abs(m+f)*y),Math.atan(Math.abs(m-f)*y));let w=0,A=e;for(let i=e+2;i<n-2;i+=2){const e=Math.abs(d-l*t[i+1]+h*t[i]);e>w&&(A=i,w=e)}w>(c*b)**2?(this.#Za(t,e,A+2,i),this.#Za(t,A,n,i)):i.push(s,r)}static#tc(t){const e=[],n=t.length;return this.#Za(t,0,n,e),e.push(t[n-2],t[n-1]),e.length<=4?null:e}static#ec(t,e,n,i,s,r){const o=new Float32Array(r**2),a=-2*i**2,c=r>>1;for(let t=0;t<r;t++){const e=(t-c)**2;for(let n=0;n<r;n++)o[t*r+n]=Math.exp((e+(n-c)**2)/a)}const l=new Float32Array(256),h=-2*s**2;for(let t=0;t<256;t++)l[t]=Math.exp(t**2/h);const d=t.length,u=new Uint8Array(d),p=new Uint32Array(256);for(let i=0;i<n;i++)for(let s=0;s<e;s++){const a=i*e+s,h=t[a];let d=0,g=0;for(let a=0;a<r;a++){const u=i+a-c;if(!(u<0||u>=n))for(let n=0;n<r;n++){const i=s+n-c;if(i<0||i>=e)continue;const p=t[u*e+i],f=o[a*r+n]*l[Math.abs(p-h)];d+=p*f,g+=f}}p[u[a]=Math.round(d/g)]++}return[u,p]}static#nc(t){const e=new Uint32Array(256);for(const n of t)e[n]++;return e}static#ic(t){const e=t.length,n=new Uint8ClampedArray(e>>2);let i=-1/0,s=1/0;for(let e=0,r=n.length;e<r;e++){const r=n[e]=t[e<<2];i=Math.max(i,r),s=Math.min(s,r)}const r=255/(i-s);for(let t=0,e=n.length;t<e;t++)n[t]=(n[t]-s)*r;return n}static#sc(t){let e,n=-1/0,i=-1/0;const s=t.findIndex(t=>0!==t);let r=s,o=s;for(e=s;e<256;e++){const s=t[e];s>n&&(e-r>i&&(i=e-r,o=e-1),n=s,r=e)}for(e=o-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#rc(t){const e=t,{width:n,height:i}=t,{maxDim:s}=this.#qa;let r=n,o=i;if(n>s||i>s){let a=n,c=i,l=Math.log2(Math.max(n,i)/s);const h=Math.floor(l);l=l===h?h-1:h;for(let n=0;n<l;n++){r=Math.ceil(a/2),o=Math.ceil(c/2);const n=new OffscreenCanvas(r,o);n.getContext("2d").drawImage(t,0,0,a,c,0,0,r,o),a=r,c=o,t!==e&&t.close(),t=n.transferToImageBitmap()}const d=Math.min(s/r,s/o);r=Math.round(r*d),o=Math.round(o*d)}const a=new OffscreenCanvas(r,o).getContext("2d",{willReadFrequently:!0});a.fillStyle="white",a.fillRect(0,0,r,o),a.filter="grayscale(1)",a.drawImage(t,0,0,t.width,t.height,0,0,r,o);const c=a.getImageData(0,0,r,o).data;return[this.#ic(c),r,o]}static extractContoursFromText(t,{fontFamily:e,fontStyle:n,fontWeight:i},s,r,o,a){let c=new OffscreenCanvas(1,1),l=c.getContext("2d",{alpha:!1});const h=l.font=`${n} ${i} 200px ${e}`,{actualBoundingBoxLeft:d,actualBoundingBoxRight:u,actualBoundingBoxAscent:p,actualBoundingBoxDescent:g,fontBoundingBoxAscent:f,fontBoundingBoxDescent:m,width:v}=l.measureText(t),y=Math.ceil(1.5*Math.max(Math.abs(d)+Math.abs(u)||0,v)),b=Math.ceil(1.5*Math.max(Math.abs(p)+Math.abs(g)||200,Math.abs(f)+Math.abs(m)||200));c=new OffscreenCanvas(y,b),l=c.getContext("2d",{alpha:!0,willReadFrequently:!0}),l.font=h,l.filter="grayscale(1)",l.fillStyle="white",l.fillRect(0,0,y,b),l.fillStyle="black",l.fillText(t,.5*y/2,1.5*b/2);const w=this.#ic(l.getImageData(0,0,y,b).data),A=this.#nc(w),x=this.#sc(A),S=this.#Qa(w,y,b,x);return this.processDrawnLines({lines:{curves:S,width:y,height:b},pageWidth:s,pageHeight:r,rotation:o,innerMargin:a,mustSmooth:!0,areContours:!0})}static process(t,e,n,i,s){const[r,o,a]=this.#rc(t),[c,l]=this.#ec(r,o,a,Math.hypot(o,a)*this.#qa.sigmaSFactor,this.#qa.sigmaR,this.#qa.kernelSize),h=this.#sc(l),d=this.#Qa(c,o,a,h);return this.processDrawnLines({lines:{curves:d,width:o,height:a},pageWidth:e,pageHeight:n,rotation:i,innerMargin:s,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:i,innerMargin:s,mustSmooth:r,areContours:o}){i%180!=0&&([e,n]=[n,e]);const{curves:a,width:c,height:l}=t,h=t.thickness??0,d=[],u=Math.min(e/c,n/l),p=u/e,g=u/n,f=[];for(const{points:t}of a){const e=r?this.#tc(t):t;if(!e)continue;f.push(e);const n=e.length,i=new Float32Array(n),s=new Float32Array(3*(2===n?2:n-2));if(d.push({line:s,points:i}),2===n){i[0]=e[0]*p,i[1]=e[1]*g,s.set([NaN,NaN,NaN,NaN,i[0],i[1]],0);continue}let[o,a,c,l]=e;o*=p,a*=g,c*=p,l*=g,i.set([o,a,c,l],0),s.set([NaN,NaN,NaN,NaN,o,a],0);for(let t=4;t<n;t+=2){const n=i[t]=e[t]*p,r=i[t+1]=e[t+1]*g;s.set(cs.createBezierPoints(o,a,c,l,n,r),3*(t-2)),[o,a,c,l]=[c,l,n,r]}}if(0===d.length)return null;const m=o?new xs:new bs;return m.build(d,e,n,1,i,o?0:h,s),{outline:m,newCurves:f,areContours:o,thickness:h,width:c,height:l}}static async compressSignature({outlines:t,areContours:e,thickness:n,width:i,height:s}){let r,o=1/0,a=-1/0,c=0;for(const e of t){c+=e.length;for(let t=2,n=e.length;t<n;t++){const n=e[t]-e[t-2];o=Math.min(o,n),a=Math.max(a,n)}}r=o>=-128&&a<=127?Int8Array:o>=-32768&&a<=32767?Int16Array:Int32Array;const l=t.length,h=8+3*l,d=new Uint32Array(h);let u=0;d[u++]=h*Uint32Array.BYTES_PER_ELEMENT+(c-2*l)*r.BYTES_PER_ELEMENT,d[u++]=0,d[u++]=i,d[u++]=s,d[u++]=e?0:1,d[u++]=Math.max(0,Math.floor(n??0)),d[u++]=l,d[u++]=r.BYTES_PER_ELEMENT;for(const e of t)d[u++]=e.length-2,d[u++]=e[0],d[u++]=e[1];const p=new CompressionStream("deflate-raw"),g=p.writable.getWriter();await g.ready,g.write(d);const f=r.prototype.constructor;for(const e of t){const t=new f(e.length-2);for(let n=2,i=e.length;n<i;n++)t[n-2]=e[n]-e[n-2];g.write(t)}g.close();const m=await new Response(p.readable).arrayBuffer();return pt(new Uint8Array(m))}static async decompressSignature(t){try{const n=(e=t,Uint8Array.fromBase64?Uint8Array.fromBase64(e):it(atob(e))),{readable:i,writable:s}=new DecompressionStream("deflate-raw"),r=s.getWriter();await r.ready,r.write(n).then(async()=>{await r.ready,await r.close()}).catch(()=>{});let o=null,a=0;for await(const t of i)o||=new Uint8Array(new Uint32Array(t.buffer,0,4)[0]),o.set(t,a),a+=t.length;const c=new Uint32Array(o.buffer,0,o.length>>2),l=c[1];if(0!==l)throw new Error(`Invalid version: ${l}`);const h=c[2],d=c[3],u=0===c[4],p=c[5],g=c[6],f=c[7],m=[],v=(8+3*g)*Uint32Array.BYTES_PER_ELEMENT;let y;switch(f){case Int8Array.BYTES_PER_ELEMENT:y=new Int8Array(o.buffer,v);break;case Int16Array.BYTES_PER_ELEMENT:y=new Int16Array(o.buffer,v);break;case Int32Array.BYTES_PER_ELEMENT:y=new Int32Array(o.buffer,v)}a=0;for(let t=0;t<g;t++){const e=c[3*t+8],n=new Float32Array(e+2);m.push(n);for(let e=0;e<2;e++)n[e]=c[3*t+8+e+1];for(let t=0;t<e;t++)n[t+2]=n[t]+y[a++]}return{areContours:u,thickness:p,outlines:m,width:h,height:d}}catch(t){return H(`decompressSignature: ${t}`),null}var e}}class Es extends ms{constructor(){super(),super.updateProperties({fill:re._defaultLineColor,"stroke-width":0})}clone(){const t=new Es;return t.updateAll(this),t}}class _s extends ws{constructor(t){super(t),super.updateProperties({stroke:re._defaultLineColor,"stroke-width":1})}clone(){const t=new _s(this._viewParameters);return t.updateAll(this),t}}class Cs extends vs{#oc=!1;#ac=null;#cc=null;#lc=null;static _type="signature";static _editorType=M.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#cc=t.signatureData||null,this.#ac=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){re.initialize(t,e),this._defaultDrawingOptions=new Es,this._defaultDrawnSignatureOptions=new _s(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return K(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#ac}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){null!==this._drawId&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:n}=this;if(n&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),null===this._drawId)if(this.#cc){const{lines:t,mustSmooth:e,areContours:n,description:i,uuid:s,heightInPage:r}=this.#cc,{rawDims:{pageWidth:o,pageHeight:a},rotation:c}=this.parent.viewport,l=Ss.processDrawnLines({lines:t,pageWidth:o,pageHeight:a,rotation:c,innerMargin:Cs._INNER_MARGIN,mustSmooth:e,areContours:n});this.addSignature(l,r,i,s)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#ac||""}));return n&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#lc=t,this.addEditToolbar()}getUuid(){return this.#lc}get description(){return this.#ac}set description(t){this.#ac=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:n,width:i,height:s}=this.#cc,r=Math.max(i,s);return{areContours:e,outline:Ss.processDrawnLines({lines:{curves:t.map(t=>({points:t})),thickness:n,width:i,height:s},pageWidth:r,pageHeight:r,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e}).outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,n,i){const{x:s,y:r}=this,{outline:o}=this.#cc=t;let a;this.#oc=o instanceof xs,this.description=n,this.#oc?a=Cs.getDefaultDrawingOptions():(a=Cs._defaultDrawnSignatureOptions.clone(),a.updateProperties({"stroke-width":o.thickness})),this._addOutlines({drawOutlines:o,drawingOptions:a});const[,c]=this.pageDimensions;let l=e/c;l=l>=1?.5:l,this.width*=l/this.height,this.width>=1&&(l*=.9/this.width,this.width=.9),this.height=l,this.setDims(),this.x=s,this.y=r,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(i),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!i,hasDescription:!!n}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:i}=this.parent.viewport;return Ss.process(t,e,n,i,Cs._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:n,pageHeight:i},rotation:s}=this.parent.viewport;return Ss.extractContoursFromText(t,e,n,i,s,Cs._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:i}=this.parent.viewport;return Ss.processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:i,innerMargin:Cs._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=Cs.getDefaultDrawingOptions():(this._drawingOptions=Cs._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:n}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":i}}=this,s=Object.assign(super.serialize(t),{isSignature:!0,areContours:this.#oc,color:[0,0,0],thickness:this.#oc?0:i});return this.addComment(s),t?(s.paths={lines:e,points:n},s.uuid=this.#lc,s.isCopy=!0):s.lines=e,this.#ac&&(s.accessibilityData={type:"Figure",alt:this.#ac}),s}static deserializeDraw(t,e,n,i,s,r){return r.areContours?xs.deserialize(t,e,n,i,s,r):bs.deserialize(t,e,n,i,s,r)}static async deserialize(t,e,n){const i=await super.deserialize(t,e,n);return i.#oc=t.areContours,i.description=t.accessibilityData?.alt||"",i.#lc=t.uuid,i}}class Ts extends re{#hc=null;#dc=null;#uc=null;#pc=null;#gc=null;#fc="";#mc=null;#vc=!1;#yc=null;#bc=!1;#wc=!1;static _type="stamp";static _editorType=M.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#pc=t.bitmapUrl,this.#gc=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){re.initialize(t,e)}static isHandlingMimeForPasting(t){return Nt.includes(t)}static paste(t,e){e.pasteEditor({mode:M.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#Ac(t,e=!1){t?(this.#hc=t.bitmap,e||(this.#dc=t.id,this.#bc=t.isSvg),t.file&&(this.#fc=t.file.name),this.#xc()):this.remove()}#Sc(){if(this.#uc=null,this._uiManager.enableWaiting(!1),this.#mc)if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#hc)this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});else{if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#hc){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:s,height:r}=t||this.copyCanvas(null,null,!0).imageData,o=await n.guess({name:"altText",request:{data:i,width:s,height:r,channels:i.length/(s*r)}});if(!o)throw new Error("No response from the AI service.");if(o.error)throw new Error("Error from the AI service.");if(o.cancel)return null;if(!o.output)throw new Error("No valid response from the AI service.");const a=o.output;return await this.setGuessedAltText(a),e&&!this.hasAltTextData()&&(this.altTextData={alt:a,decorative:!1}),a}#Ec(){if(this.#dc)return this._uiManager.enableWaiting(!0),void this._uiManager.imageManager.getFromId(this.#dc).then(t=>this.#Ac(t,!0)).finally(()=>this.#Sc());if(this.#pc){const t=this.#pc;return this.#pc=null,this._uiManager.enableWaiting(!0),void(this.#uc=this._uiManager.imageManager.getFromUrl(t).then(t=>this.#Ac(t)).finally(()=>this.#Sc()))}if(this.#gc){const t=this.#gc;return this.#gc=null,this._uiManager.enableWaiting(!0),void(this.#uc=this._uiManager.imageManager.getFromFile(t).then(t=>this.#Ac(t)).finally(()=>this.#Sc()))}const t=document.createElement("input");t.type="file",t.accept=Nt.join(",");const e=this._uiManager._signal;this.#uc=new Promise(n=>{t.addEventListener("change",async()=>{if(t.files&&0!==t.files.length){this._uiManager.enableWaiting(!0);const e=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#Ac(e)}else this.remove();n()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),n()},{signal:e})}).finally(()=>this.#Sc()),t.click()}remove(){this.#dc&&(this.#hc=null,this._uiManager.imageManager.deleteId(this.#dc),this.#mc?.remove(),this.#mc=null,this.#yc&&(clearTimeout(this.#yc),this.#yc=null)),super.remove()}rebuild(){this.parent?(super.rebuild(),null!==this.div&&(this.#dc&&null===this.#mc&&this.#Ec(),this.isAttachedToDOM||this.parent.add(this))):this.#dc&&this.#Ec()}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#uc||this.#hc||this.#pc||this.#gc||this.#dc||this.#vc)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#vc||(this.#hc?this.#xc():this.#Ec()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:n,bitmap:i}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),n&&this._uiManager.imageManager.isValidId(n)&&(this.#dc=n,i&&(this.#hc=i),this.#vc=!1,this.#xc())}_onResized(){this.onScaleChanging()}onScaleChanging(){this.parent&&(null!==this.#yc&&clearTimeout(this.#yc),this.#yc=setTimeout(()=>{this.#yc=null,this.#_c()},200))}#xc(){const{div:t}=this;let{width:e,height:n}=this.#hc;const[i,s]=this.pageDimensions,r=.75;if(this.width)e=this.width*i,n=this.height*s;else if(e>r*i||n>r*s){const t=Math.min(r*i/e,r*s/n);e*=t,n*=t}this._uiManager.enableWaiting(!1);const o=this.#mc=document.createElement("canvas");o.setAttribute("role","img"),this.addContainer(o),this.width=e/i,this.height=n/s,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&!this.annotationElementId||(t.hidden=!1),this.#_c(),this.#wc||(this.parent.addUndoableEditor(this),this.#wc=!0),this._reportTelemetry({action:"inserted_image"}),this.#fc&&this.div.setAttribute("aria-description",this.#fc),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,n=!1){t||(t=224);const{width:i,height:s}=this.#hc,r=new Lt;let o=this.#hc,a=i,c=s,l=null;if(e){if(i>e||s>e){const t=Math.min(e/i,e/s);a=Math.floor(i*t),c=Math.floor(s*t)}l=document.createElement("canvas");const t=l.width=Math.ceil(a*r.sx),n=l.height=Math.ceil(c*r.sy);this.#bc||(o=this.#Cc(t,n));const h=l.getContext("2d");h.filter=this._uiManager.hcmFilter;let d="white",u="#cfcfd8";"none"!==this._uiManager.hcmFilter?u="black":Ft.isDarkMode&&(d="#8f8f9d",u="#42414d");const p=15,g=p*r.sx,f=p*r.sy,m=new OffscreenCanvas(2*g,2*f),v=m.getContext("2d");v.fillStyle=d,v.fillRect(0,0,2*g,2*f),v.fillStyle=u,v.fillRect(0,0,g,f),v.fillRect(g,f,g,f),h.fillStyle=h.createPattern(m,"repeat"),h.fillRect(0,0,t,n),h.drawImage(o,0,0,o.width,o.height,0,0,t,n)}let h=null;if(n){let e,n;if(r.symmetric&&o.width<t&&o.height<t)e=o.width,n=o.height;else if(o=this.#hc,i>t||s>t){const r=Math.min(t/i,t/s);e=Math.floor(i*r),n=Math.floor(s*r),this.#bc||(o=this.#Cc(e,n))}const a=new OffscreenCanvas(e,n).getContext("2d",{willReadFrequently:!0});a.drawImage(o,0,0,o.width,o.height,0,0,e,n),h={width:e,height:n,data:a.getImageData(0,0,e,n).data}}return{canvas:l,width:a,height:c,imageData:h}}#Cc(t,e){const{width:n,height:i}=this.#hc;let s=n,r=i,o=this.#hc;for(;s>2*t||r>2*e;){const n=s,i=r;s>2*t&&(s=s>=16384?Math.floor(s/2)-1:Math.ceil(s/2)),r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));const a=new OffscreenCanvas(s,r);a.getContext("2d").drawImage(o,0,0,n,i,0,0,s,r),o=a.transferToImageBitmap()}return o}#_c(){const[t,e]=this.parentDimensions,{width:n,height:i}=this,s=new Lt,r=Math.ceil(n*t*s.sx),o=Math.ceil(i*e*s.sy),a=this.#mc;if(!a||a.width===r&&a.height===o)return;a.width=r,a.height=o;const c=this.#bc?this.#hc:this.#Cc(r,o),l=a.getContext("2d");l.filter=this._uiManager.hcmFilter,l.drawImage(c,0,0,c.width,c.height,0,0,r,o)}#Tc(t){if(t){if(this.#bc){const t=this._uiManager.imageManager.getSvgUrl(this.#dc);if(t)return t}const t=document.createElement("canvas");return({width:t.width,height:t.height}=this.#hc),t.getContext("2d").drawImage(this.#hc,0,0),t.toDataURL()}if(this.#bc){const[t,e]=this.pageDimensions,n=Math.round(this.width*t*vt.PDF_TO_CSS_UNITS),i=Math.round(this.height*e*vt.PDF_TO_CSS_UNITS),s=new OffscreenCanvas(n,i);return s.getContext("2d").drawImage(this.#hc,0,0,this.#hc.width,this.#hc.height,0,0,n,i),s.transferToImageBitmap()}return structuredClone(this.#hc)}static async deserialize(t,e,n){let i=null,s=!1;if(t instanceof is){const{data:{rect:r,rotation:o,id:a,structParent:c,popupRef:l,richText:h,contentsObj:d,creationDate:u,modificationDate:p},container:g,parent:{page:{pageNumber:f}},canvas:m}=t;let v,y;m?(delete t.canvas,({id:v,bitmap:y}=n.imageManager.getFromCanvas(g.id,m)),m.remove()):(s=!0,t._hasNoCanvas=!0);const b=(await e._structTree.getAriaAttributes(`${dt}${a}`))?.get("aria-label")||"";i=t={annotationType:M.STAMP,bitmapId:v,bitmap:y,pageIndex:f-1,rect:r.slice(0),rotation:o,annotationElementId:a,id:a,deleted:!1,accessibilityData:{decorative:!1,altText:b},isSvg:!1,structParent:c,popupRef:l,richText:h,comment:d?.str||null,creationDate:u,modificationDate:p}}const r=await super.deserialize(t,e,n),{rect:o,bitmap:a,bitmapUrl:c,bitmapId:l,isSvg:h,accessibilityData:d}=t;s?(n.addMissingCanvas(t.id,r),r.#vc=!0):l&&n.imageManager.isValidId(l)?(r.#dc=l,a&&(r.#hc=a)):r.#pc=c,r.#bc=h;const[u,p]=r.pageDimensions;return r.width=(o[2]-o[0])/u,r.height=(o[3]-o[1])/p,d&&(r.altTextData=d),r._initialData=i,t.comment&&r.setCommentData(t),r.#wc=!!i,r}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=Object.assign(super.serialize(t),{bitmapId:this.#dc,isSvg:this.#bc});if(this.addComment(n),t)return n.bitmapUrl=this.#Tc(!0),n.accessibilityData=this.serializeAltText(!0),n.isCopy=!0,n;const{decorative:i,altText:s}=this.serializeAltText(!1);if(!i&&s&&(n.accessibilityData={type:"Figure",alt:s}),this.annotationElementId){const t=this.#do(n);return t.isSame?null:(t.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1,n.id=this.annotationElementId,delete n.bitmapId,n)}if(null===e)return n;e.stamps||=new Map;const r=this.#bc?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(e.stamps.has(this.#dc)){if(this.#bc){const t=e.stamps.get(this.#dc);r>t.area&&(t.area=r,t.serialized.bitmap.close(),t.serialized.bitmap=this.#Tc(!1))}}else e.stamps.set(this.#dc,{area:r,serialized:n}),n.bitmap=this.#Tc(!1);return n}#do(t){const{pageIndex:e,accessibilityData:{altText:n}}=this._initialData,i=t.pageIndex===e,s=(t.accessibilityData?.alt||"")===n;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&i&&s,isSameAltText:s}}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class ks{#Kr;#kc=!1;#Rc=null;#Ic=null;#Pc=null;#Mc=new Map;#Dc=!1;#Oc=!1;#Lc=!1;#Nc=null;#Fc=null;#Bc=null;#Uc=null;#$c=null;#jc=-1;#v;static _initialized=!1;static#V=new Map([as,As,Ts,fs,Cs].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:n,structTreeLayer:i,accessibilityManager:s,annotationLayer:r,drawLayer:o,textLayer:a,viewport:c,l10n:l}){const h=[...ks.#V.values()];if(!ks._initialized){ks._initialized=!0;for(const e of h)e.initialize(l,t)}t.registerEditorTypes(h),this.#v=t,this.pageIndex=e,this.div=n,this.#Kr=s,this.#Rc=r,this.viewport=c,this.#Bc=a,this.drawLayer=o,this._structTree=i,this.#v.addLayer(this)}get isEmpty(){return 0===this.#Mc.size}get isInvisible(){return this.isEmpty&&this.#v.getMode()===M.NONE}updateToolbar(t){this.#v.updateToolbar(t)}updateMode(t=this.#v.getMode()){switch(this.#zc(),t){case M.NONE:return this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),void this.disableClick();case M.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case M.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;if(e.toggle("nonEditing",!1),t===M.POPUP)e.toggle("commentEditing",!0);else{e.toggle("commentEditing",!1);for(const n of ks.#V.values())e.toggle(`${n._type}Editing`,t===n._editorType)}this.div.hidden=!1}hasTextLayer(t){return t===this.#Bc?.div}setEditingState(t){this.#v.setEditingState(t)}addCommands(t){this.#v.addCommands(t)}cleanUndoStack(t){this.#v.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#Rc?.div.classList.toggle("disabled",!t)}get#Hc(){return 0!==this.#Mc.size?this.#Mc.values():this.#v.getEditors(this.pageIndex)}async enable(){this.#Lc=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#$c?.abort(),this.#$c=null;const t=new Set;for(const e of this.#Hc)e.enableEditing(),e.show(!0),e.annotationElementId&&(this.#v.removeChangedExistingAnnotation(e),t.add(e.annotationElementId));const e=this.#Rc;if(e)for(const n of e.getEditableAnnotations()){if(n.hide(),this.#v.isDeletedAnnotationElement(n.data.id))continue;if(t.has(n.data.id))continue;const e=await this.deserialize(n);e&&(this.addOrRebuild(e),e.enableEditing())}this.#Lc=!1,this.#v._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#Oc=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#Bc&&!this.#$c){this.#$c=new AbortController;const t=this.#v.combinedSignal(this.#$c);this.#Bc.div.addEventListener("pointerdown",t=>{const{clientX:e,clientY:n,timeStamp:i}=t;if(i-this.#jc>500)return void(this.#jc=i);this.#jc=-1;const{classList:s}=this.div;s.toggle("getElements",!0);const r=document.elementsFromPoint(e,n);if(s.toggle("getElements",!1),!this.div.contains(r[0]))return;let o;const a=new RegExp(`^${P}[0-9]+$`);for(const t of r)if(a.test(t.id)){o=t.id;break}if(!o)return;const c=this.#Mc.get(o);null===c?.annotationElementId&&(t.stopPropagation(),t.preventDefault(),c.dblclick(t))},{signal:t,capture:!0})}const t=this.#Rc;if(t){const e=new Map,n=new Map;for(const i of this.#Hc)i.disableEditing(),i.annotationElementId?null===i.serialize()?(n.set(i.annotationElementId,i),this.getEditableAnnotation(i.annotationElementId)?.show(),i.remove()):e.set(i.annotationElementId,i):i.updateFakeAnnotationElement(t);const i=t.getEditableAnnotations();for(const t of i){const{id:i}=t.data;if(this.#v.isDeletedAnnotationElement(i)){t.updateEdited({deleted:!0});continue}let s=n.get(i);s?(s.resetAnnotationElement(t),s.show(!1),t.show()):(s=e.get(i),s&&(this.#v.addChangedExistingAnnotation(s),s.renderAnnotationElement(t)&&s.show(!1)),t.show())}}this.#zc(),this.isEmpty&&(this.div.hidden=!0);const{classList:e}=this.div;for(const t of ks.#V.values())e.remove(`${t._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#Oc=!1}getEditableAnnotation(t){return this.#Rc?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#v.getActive()!==t&&this.#v.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#Bc?.div&&!this.#Uc){this.#Uc=new AbortController;const t=this.#v.combinedSignal(this.#Uc);this.#Bc.div.addEventListener("pointerdown",this.#Gc.bind(this),{signal:t}),this.#Bc.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#Bc?.div&&this.#Uc&&(this.#Uc.abort(),this.#Uc=null,this.#Bc.div.classList.remove("highlighting"))}#Gc(t){this.#v.unselectAll();const{target:e}=t;if(e===this.#Bc.div||("img"===e.getAttribute("role")||e.classList.contains("endOfContent"))&&this.#Bc.div.contains(e)){const{isMac:e}=st.platform;if(0!==t.button||t.ctrlKey&&e)return;this.#v.showAllEditors("highlight",!0,!0),this.#Bc.div.classList.add("free"),this.toggleDrawing(),fs.startHighlighting(this,"ltr"===this.#v.direction,{target:this.#Bc.div,x:t.x,y:t.y}),this.#Bc.div.addEventListener("pointerup",()=>{this.#Bc.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#v._signal}),t.preventDefault()}}enableClick(){if(this.#Ic)return;this.#Ic=new AbortController;const t=this.#v.combinedSignal(this.#Ic);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#Ic?.abort(),this.#Ic=null}attach(t){this.#Mc.set(t.id,t);const{annotationElementId:e}=t;e&&this.#v.isDeletedAnnotationElement(e)&&this.#v.removeDeletedAnnotationElement(t)}detach(t){this.#Mc.delete(t.id),this.#Kr?.removePointerInTextLayer(t.contentDiv),!this.#Oc&&t.annotationElementId&&this.#v.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#v.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#v.addDeletedAnnotationElement(t.annotationElementId),re.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(t.parent!==this||!t.isAttachedToDOM){if(this.changeParent(t),this.#v.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#Lc),this.#v.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#Pc&&(t._focusEventsAllowed=!1,this.#Pc=setTimeout(()=>{this.#Pc=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#v._signal}),e.focus())},0)),t._structTreeParentId=this.#Kr?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){this.addCommands({cmd:()=>t._uiManager.rebuild(t),undo:()=>{t.remove()},mustExec:!1})}getEditorByUID(t){for(const e of this.#Mc.values())if(e.uid===t)return e;return null}getNextId(){return this.#v.getId()}get#Vc(){return ks.#V.get(this.#v.getMode())}combinedSignal(t){return this.#v.combinedSignal(t)}#Wc(t){const e=this.#Vc;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#Vc?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#v.updateMode(t.mode);const{offsetX:n,offsetY:i}=this.#qc(),s=this.getNextId(),r=this.#Wc({parent:this,id:s,x:n,y:i,uiManager:this.#v,isCentered:!0,...e});r&&this.add(r)}async deserialize(t){return await(ks.#V.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#v))||null}createAndAddNewEditor(t,e,n={}){const i=this.getNextId(),s=this.#Wc({parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:this.#v,isCentered:e,...n});return s&&this.add(s),s}get boundingClientRect(){return this.div.getBoundingClientRect()}#qc(){const{x:t,y:e,width:n,height:i}=this.boundingClientRect,s=Math.max(0,t),r=Math.max(0,e),o=(s+Math.min(window.innerWidth,t+n))/2-t,a=(r+Math.min(window.innerHeight,e+i))/2-e,[c,l]=this.viewport.rotation%180==0?[o,a]:[a,o];return{offsetX:c,offsetY:l}}addNewEditor(t={}){this.createAndAddNewEditor(this.#qc(),!0,t)}setSelected(t){this.#v.setSelected(t)}toggleSelected(t){this.#v.toggleSelected(t)}unselect(t){this.#v.unselect(t)}pointerup(t){const{isMac:e}=st.platform;if(0!==t.button||t.ctrlKey&&e)return;if(t.target!==this.div)return;if(!this.#Dc)return;if(this.#Dc=!1,this.#Vc?.isDrawer&&this.#Vc.supportMultipleDrawings)return;if(!this.#kc)return void(this.#kc=!0);const n=this.#v.getMode();n!==M.STAMP&&n!==M.SIGNATURE?this.createAndAddNewEditor(t,!1):this.#v.unselectAll()}pointerdown(t){if(this.#v.getMode()===M.HIGHLIGHT&&this.enableTextSelection(),this.#Dc)return void(this.#Dc=!1);const{isMac:e}=st.platform;if(0!==t.button||t.ctrlKey&&e)return;if(t.target!==this.div)return;if(this.#Dc=!0,this.#Vc?.isDrawer)return void this.startDrawingSession(t);const n=this.#v.getActive();this.#kc=!n||n.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#Nc)return void this.#Vc.startDrawing(this,this.#v,!1,t);this.#v.setCurrentDrawingSession(this),this.#Nc=new AbortController;const e=this.#v.combinedSignal(this.#Nc);this.div.addEventListener("blur",({relatedTarget:t})=>{t&&!this.div.contains(t)&&(this.#Fc=null,this.commitOrRemove())},{signal:e}),this.#Vc.startDrawing(this,this.#v,!1,t)}pause(t){if(t){const{activeElement:t}=document;return void(this.div.contains(t)&&(this.#Fc=t))}this.#Fc&&setTimeout(()=>{this.#Fc?.focus(),this.#Fc=null},0)}endDrawingSession(t=!1){return this.#Nc?(this.#v.setCurrentDrawingSession(null),this.#Nc.abort(),this.#Nc=null,this.#Fc=null,this.#Vc.endDrawing(t)):null}findNewParent(t,e,n){const i=this.#v.findParent(e,n);return null!==i&&i!==this&&(i.changeParent(t),!0)}commitOrRemove(){return!!this.#Nc&&(this.endDrawingSession(),!0)}onScaleChanging(){this.#Nc&&this.#Vc.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#v.getActive()?.parent===this&&(this.#v.commitOrRemove(),this.#v.setActiveEditor(null)),this.#Pc&&(clearTimeout(this.#Pc),this.#Pc=null);for(const t of this.#Mc.values())this.#Kr?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#Mc.clear(),this.#v.removeLayer(this)}#zc(){for(const t of this.#Mc.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,Ot(this.div,t);for(const t of this.#v.getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:t}){this.#v.commitOrRemove(),this.#zc();const e=this.viewport.rotation,n=t.rotation;if(this.viewport=t,Ot(this.div,{rotation:n}),e!==n)for(const t of this.#Mc.values())t.rotate(n)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#v.viewParameters.realScale}}class Rs{#yr=null;#Kc=new Map;#Yc=new Map;static#A=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(this.#yr){if(this.#yr!==t){if(this.#Kc.size>0)for(const e of this.#Kc.values())e.remove(),t.append(e);this.#yr=t}}else this.#yr=t}static get _svgFactory(){return K(this,"_svgFactory",new ki)}static#Xc(t,[e,n,i,s]){const{style:r}=t;r.top=100*n+"%",r.left=100*e+"%",r.width=100*i+"%",r.height=100*s+"%"}#Jc(){const t=Rs._svgFactory.create(1,1,!0);return this.#yr.append(t),t.setAttribute("aria-hidden",!0),t}#Qc(t,e){const n=Rs._svgFactory.createElement("clipPath");t.append(n);const i=`clip_${e}`;n.setAttribute("id",i),n.setAttribute("clipPathUnits","objectBoundingBox");const s=Rs._svgFactory.createElement("use");return n.append(s),s.setAttribute("href",`#${e}`),s.classList.add("clip"),i}#Zc(t,e){for(const[n,i]of Object.entries(e))null===i?t.removeAttribute(n):t.setAttribute(n,i)}draw(t,e=!1,n=!1){const i=Rs.#A++,s=this.#Jc(),r=Rs._svgFactory.createElement("defs");s.append(r);const o=Rs._svgFactory.createElement("path");r.append(o);const a=`path_p${this.pageIndex}_${i}`;o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#Yc.set(i,o);const c=n?this.#Qc(r,a):null,l=Rs._svgFactory.createElement("use");return s.append(l),l.setAttribute("href",`#${a}`),this.updateProperties(s,t),this.#Kc.set(i,s),{id:i,clipPathId:`url(#${c})`}}drawOutline(t,e){const n=Rs.#A++,i=this.#Jc(),s=Rs._svgFactory.createElement("defs");i.append(s);const r=Rs._svgFactory.createElement("path");s.append(r);const o=`path_p${this.pageIndex}_${n}`;let a;if(r.setAttribute("id",o),r.setAttribute("vector-effect","non-scaling-stroke"),e){const t=Rs._svgFactory.createElement("mask");s.append(t),a=`mask_p${this.pageIndex}_${n}`,t.setAttribute("id",a),t.setAttribute("maskUnits","objectBoundingBox");const e=Rs._svgFactory.createElement("rect");t.append(e),e.setAttribute("width","1"),e.setAttribute("height","1"),e.setAttribute("fill","white");const i=Rs._svgFactory.createElement("use");t.append(i),i.setAttribute("href",`#${o}`),i.setAttribute("stroke","none"),i.setAttribute("fill","black"),i.setAttribute("fill-rule","nonzero"),i.classList.add("mask")}const c=Rs._svgFactory.createElement("use");i.append(c),c.setAttribute("href",`#${o}`),a&&c.setAttribute("mask",`url(#${a})`);const l=c.cloneNode();return i.append(l),c.classList.add("mainOutline"),l.classList.add("secondaryOutline"),this.updateProperties(i,t),this.#Kc.set(n,i),n}finalizeDraw(t,e){this.#Yc.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:n,bbox:i,rootClass:s,path:r}=e,o="number"==typeof t?this.#Kc.get(t):t;if(o){if(n&&this.#Zc(o,n),i&&Rs.#Xc(o,i),s){const{classList:t}=o;for(const[e,n]of Object.entries(s))t.toggle(e,n)}if(r){const t=o.firstChild.firstChild;this.#Zc(t,r)}}}updateParent(t,e){if(e===this)return;const n=this.#Kc.get(t);n&&(e.#yr.append(n),this.#Kc.delete(t),e.#Kc.set(t,n))}remove(t){this.#Yc.delete(t),null!==this.#yr&&(this.#Kc.get(t).remove(),this.#Kc.delete(t))}destroy(){this.#yr=null;for(const t of this.#Kc.values())t.remove();this.#Kc.clear(),this.#Yc.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:ds},globalThis.pdfjsLib={AbortException:et,AnnotationEditorLayer:ks,AnnotationEditorParamsType:D,AnnotationEditorType:M,AnnotationEditorUIManager:ee,AnnotationLayer:rs,AnnotationMode:I,AnnotationType:N,applyOpacity:Ut,build:Ai,ColorPicker:xi,createValidAbsoluteUrl:W,CSSConstants:Bt,DOMSVGFactory:ki,DrawLayer:Rs,FeatureTest:st,fetchData:yt,findContrastColor:Vt,getDocument:hi,getFilenameFromUrl:St,getPdfFilenameFromUrl:Et,getRGB:Pt,getUuid:ht,getXfaPageViewport:It,GlobalWorkerOptions:On,ImageKind:L,InvalidPDFException:Q,isDataScheme:At,isPdfFile:xt,isValidExplicitDest:ye,MathClamp:ut,noContextMenu:Tt,normalizeUnicode:lt,OPS:B,OutputScale:Lt,PasswordResponses:U,PDFDataRangeTransport:ui,PDFDateString:Rt,PDFWorker:mi,PermissionFlag:O,PixelsPerInch:vt,RenderingCancelledException:wt,renderRichText:Wt,ResponseException:Z,setLayerDimensions:Ot,shadow:K,SignatureExtractor:Ss,stopEvent:kt,SupportedImageMimeTypes:Nt,TextLayer:li,TouchManager:se,updateUrlHash:q,Util:ot,VerbosityLevel:F,version:wi,XfaLayer:ft};const Is=Object.freeze(Object.defineProperty({__proto__:null,AbortException:et,AnnotationEditorLayer:ks,AnnotationEditorParamsType:D,AnnotationEditorType:M,AnnotationEditorUIManager:ee,AnnotationLayer:rs,AnnotationMode:I,AnnotationType:N,CSSConstants:Bt,ColorPicker:xi,DOMSVGFactory:ki,DrawLayer:Rs,FeatureTest:st,GlobalWorkerOptions:On,ImageKind:L,InvalidPDFException:Q,MathClamp:ut,OPS:B,OutputScale:Lt,PDFDataRangeTransport:ui,PDFDateString:Rt,PDFWorker:mi,PasswordResponses:U,PermissionFlag:O,PixelsPerInch:vt,RenderingCancelledException:wt,ResponseException:Z,SignatureExtractor:Ss,SupportedImageMimeTypes:Nt,TextLayer:li,TouchManager:se,Util:ot,VerbosityLevel:F,XfaLayer:ft,applyOpacity:Ut,build:Ai,createValidAbsoluteUrl:W,fetchData:yt,findContrastColor:Vt,getDocument:hi,getFilenameFromUrl:St,getPdfFilenameFromUrl:Et,getRGB:Pt,getUuid:ht,getXfaPageViewport:It,isDataScheme:At,isPdfFile:xt,isValidExplicitDest:ye,noContextMenu:Tt,normalizeUnicode:lt,renderRichText:Wt,setLayerDimensions:Ot,shadow:K,stopEvent:kt,updateUrlHash:q,version:wi},Symbol.toStringTag,{value:"Module"}));class Ps extends Error{constructor(t,e){void 0!==e?super(t??"Invalid PDF",{cause:e}):super(t??"Invalid PDF"),this.name="InvalidPDFException",Object.setPrototypeOf(this,Ps.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,Ps)}}class Ms extends Error{constructor(t,e){void 0!==e?super(t??"Password required or incorrect",{cause:e}):super(t??"Password required or incorrect"),this.name="PasswordException",Object.setPrototypeOf(this,Ms.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,Ms)}}class Ds extends Error{constructor(t,e){void 0!==e?super(t??"PDF format error",{cause:e}):super(t??"PDF format error"),this.name="FormatError",Object.setPrototypeOf(this,Ds.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,Ds)}}class Os extends Error{constructor(t,e,n){void 0!==n?super(t??"Unknown error",{cause:n}):super(t??"Unknown error"),this.name="UnknownErrorException",Object.setPrototypeOf(this,Os.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,Os),this.details=e}}class Ls extends Error{constructor(t,e,n,i){void 0!==i?super(t??"Response error",{cause:i}):super(t??"Response error"),this.name="ResponseException",Object.setPrototypeOf(this,Ls.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,Ls),this.status=e,this.missing=n}}class Ns extends Error{constructor(t,e){void 0!==e?super(t??"Operation aborted",{cause:e}):super(t??"Operation aborted"),this.name="AbortException",Object.setPrototypeOf(this,Ns.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,Ns)}}function Fs(t){if(t instanceof Error)switch(t.name){case"InvalidPDFException":return new Ps(t.message,t);case"PasswordException":return new Ms(t.message,t);case"FormatError":return new Ds(t.message,t);case"UnknownErrorException":return new Os(t.message,t.details,t);case"ResponseException":return new Ls(t.message,t.status,t.missing,t);case"AbortException":return new Ns(t.message,t);default:return t}return new Error(String(t))}class Bs{static tolerance=2;static applyTransform(t,e){return[t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]}}class Us extends Bs{x;y;constructor(t,e){super(),this.x=t,this.y=e}equal(t){return t.x===this.x&&t.y===this.y}transform(t){const e=Bs.applyTransform([this.x,this.y],t);return this.x=e[0],this.y=e[1],this}}var $s=(t=>(t[t.None=0]="None",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical",t))($s||{});class js extends Bs{from;to;direction=0;length=0;intersections=[];gaps=[];constructor(t,e){super(),this.from=t,this.to=e,this.init()}init(){let t=this.from,e=this.to;if(Math.abs(t.y-e.y)<Bs.tolerance){if(this.direction=1,e.y=t.y,t.x>e.x){const n=t;t=e,e=n}this.length=e.x-t.x}else if(Math.abs(t.x-e.x)<Bs.tolerance){if(this.direction=2,e.x=t.x,t.y>e.y){const n=t;t=e,e=n}this.length=e.y-t.y}this.from=t,this.to=e}_valid=void 0;get valid(){return void 0===this._valid&&(this._valid=0!==this.direction&&this.length>Bs.tolerance),this._valid}get normalized(){return 1===this.direction?new js(new Us(this.from.x-Bs.tolerance,this.from.y),new Us(this.to.x+Bs.tolerance,this.from.y)):2===this.direction?new js(new Us(this.from.x,this.from.y-Bs.tolerance),new Us(this.from.x,this.to.y+Bs.tolerance)):this}addGap(t){this.gaps.push(t)}containsPoint(t){return 2===this.direction?this.from.x===t.x&&t.y>=this.from.y&&t.y<=this.to.y:1===this.direction&&this.from.y===t.y&&t.x>=this.from.x&&t.x<=this.to.x}addIntersectionPoint(t){for(const e of this.intersections)if(e.equal(t))return;this.intersections.push(t)}intersection(t){let e;if(!this.valid||!t.valid)return e;const n=this.normalized,i=t.normalized;if(1===this.direction&&2===t.direction){const s=i.from.x,r=n.from.y;if(s>n.from.x&&s<n.to.x&&r>i.from.y&&r<i.to.y){const n=new Us(s,r);this.addIntersectionPoint(n),t.addIntersectionPoint(n),e=n}}else if(2===this.direction&&1===t.direction){const s=n.from.x,r=i.from.y;if(s>i.from.x&&s<i.to.x&&r>n.from.y&&r<n.to.y){const n=new Us(s,r);this.addIntersectionPoint(n),t.addIntersectionPoint(n),e=n}}return e}transform(t){const e=this.from.transform(t),n=this.to.transform(t),i=Math.min(e.x,n.x),s=Math.min(e.y,n.y),r=Math.abs(e.x-n.x),o=Math.abs(e.y-n.y);return this.from=new Us(i,s),this.to=new Us(i+r,s+o),this.init(),this}}class zs{minXY;maxXY;rows;rowPivots;colPivots;constructor(t,e,n,i){this.minXY=t,this.maxXY=e,this.rows=[],this.rowPivots=n,this.colPivots=i}findCell(t,e){if(t>=this.minXY.x&&e>=this.minXY.y&&t<=this.maxXY.x&&e<=this.maxXY.y)for(const n of this.rows)for(const i of n)if(i.minXY.x<=t&&i.minXY.y<=e&&i.maxXY.x>=t&&i.maxXY.y>=e)return i}get cellCount(){return this.rows.reduce((t,e)=>t+e.length,0)}get rowCount(){return this.rows.length}check(){const t=(this.colPivots.length-1)*(this.rowPivots.length-1);let e=0;for(const t of this.rows)for(const n of t)e+=(n.colspan||1)*(n.rowspan||1);return t===e}toArray(){const t=[];for(const e of this.rows){const n=[];for(const t of e){let e=t.text.join("");e=e.replace(/^[\s]+|[\s]+$/g,""),e=e.trim(),n.push(e)}t.push(n)}return t}}class Hs{hLines=[];vLines=[];constructor(t){t.direction===$s.Horizontal?this.hLines.push(t):t.direction===$s.Vertical&&this.vLines.push(t)}get isValid(){return this.hLines.length+this.vLines.length>4}get rowPivots(){const t=new Set;for(const e of this.hLines)t.add(e.from.y);return[...t].sort((t,e)=>t-e)}get colPivots(){const t=new Set;for(const e of this.vLines)t.add(e.from.x);return[...t].sort((t,e)=>t-e)}add(t){if(this.intersection(t)){if(t.direction===$s.Horizontal)return this.hLines.push(t),!0;if(t.direction===$s.Vertical)return this.vLines.push(t),!0}return!1}intersection(t){let e=!1;if(!t.valid)return e;if(t.direction===$s.Horizontal)for(const n of this.vLines)t.intersection(n)&&(e=!0);else if(t.direction===$s.Vertical)for(const n of this.hLines)t.intersection(n)&&(e=!0);return e}getSameHorizontal(t){const e=[t],n=[];for(;this.hLines.length>0;){const i=this.hLines.shift();i&&(i.from.y===t.from.y?e.push(i):n.push(i))}return this.hLines=n,e}getSameVertical(t){const e=[t],n=[];for(;this.vLines.length>0;){const i=this.vLines.shift();i&&(i.from.x===t.from.x?e.push(i):n.push(i))}return this.vLines=n,e}mergeHorizontalLines(t){t.sort((t,e)=>t.from.x-e.from.x);const e=t[0].from.x,n=t[t.length-1].to.x,i=new js(new Us(e,t[0].from.y),new Us(n,t[0].from.y));for(let e=1;e<t.length;e++){const n=t[e-1],s=t[e];if(Math.abs(n.to.x-s.from.x)>Bs.tolerance){const t=new js(new Us(n.to.x,n.from.y),new Us(s.from.x,s.from.y));i.addGap(t)}}return i}mergeVerticalLines(t){t.sort((t,e)=>t.from.y-e.from.y);const e=t[0].from.y,n=t[t.length-1].to.y,i=new js(new Us(t[0].from.x,e),new Us(t[0].from.x,n));for(let e=1;e<t.length;e++){const n=t[e-1],s=t[e];if(Math.abs(n.to.y-s.from.y)>Bs.tolerance){const t=new js(new Us(n.to.x,n.to.y),new Us(n.to.x,s.from.y));i.addGap(t)}}return i}normalize(){this.hLines=this.hLines.filter(t=>t.intersections.length>1),this.vLines=this.vLines.filter(t=>t.intersections.length>1),this.hLines.sort((t,e)=>t.from.y-e.from.y),this.vLines.sort((t,e)=>t.from.x-e.from.x);const t=[];for(;this.hLines.length>0;){const e=this.hLines.shift();if(!e)continue;const n=this.getSameHorizontal(e),i=this.mergeHorizontalLines(n);t.push(i)}this.hLines=t;const e=[];for(;this.vLines.length>0;){const t=this.vLines.shift();if(!t)continue;const n=this.getSameVertical(t),i=this.mergeVerticalLines(n);e.push(i)}this.vLines=e}verticalExists(t,e,n){if(t.direction!==$s.Vertical)throw new Error("Line is not vertical");if(e>=n)throw new Error("y1 must be less than y2");if(t.from.y<=e&&t.to.y>=n){for(const i of t.gaps)if(i.from.y<=e&&i.to.y>=n)return!1;return!0}return!1}horizontalExists(t,e,n){if(t.direction!==$s.Horizontal)throw new Error("Line is not horizontal");if(e>=n)throw new Error("x1 must be less than x2");if(t.from.x<=e&&t.to.x>=n){for(const i of t.gaps)if(i.from.x<=e&&i.to.x>=n)return!1;return!0}return!1}findBottomLineIndex(t,e){for(let n=t;n<this.hLines.length;n++){const t=this.hLines[n];if(t.from.x<=e&&t.to.x>=e)return n}return-1}findVerticalLineIndexs(t,e){const n=[];for(let i=0;i<this.vLines.length;i++){const s=this.vLines[i];s.from.y<=e&&s.to.y>=e&&t.intersection(s)&&n.push(i)}return n}getRow(t,e,n){const i=[],s=this.hLines[t],r=this.findVerticalLineIndexs(s,n);for(let n=1;n<r.length;n++){const o=this.vLines[r[n-1]],a=this.vLines[r[n]],c=(o.from.x+a.from.x)/2,l=this.findBottomLineIndex(e,c),h=this.hLines[l],d={minXY:new Us(o.from.x,s.from.y),maxXY:new Us(a.from.x,h.from.y),width:a.from.x-o.from.x,height:h.from.y-s.from.y,text:[]},u=r[n]-r[n-1],p=l-t;u>1&&(d.colspan=u),p>1&&(d.rowspan=p),i.push(d)}return i}toData(){const t=this.rowPivots,e=this.colPivots,n=new Us(e[0],t[0]),i=new Us(e[e.length-1],t[t.length-1]),s=new zs(n,i,t,e);for(let t=1;t<this.hLines.length;t++){const e=this.hLines[t-1],n=this.hLines[t],i=(e.from.y+n.from.y)/2,r=this.getRow(t-1,t,i);s.rows.push(r)}return s}}class Gs{hLines=[];vLines=[];add(t){t.valid&&(t.direction===$s.Horizontal?this.hLines.push(t):t.direction===$s.Vertical&&this.vLines.push(t))}addRectangle(t){for(const e of t.getLines())this.add(e)}getTableData(){const t=[],e=this.getTables();for(const n of e){const e=n.toData();e&&t.push(e)}return t}getTables(){const t=[];for(;0!==this.hLines.length;){const e=this.hLines.shift();if(!e)continue;if(this.tryFill(t,e))continue;const n=new Hs(e);this.fillTable(n),t.push(n)}for(;0!==this.vLines.length;){const e=this.vLines.shift();if(!e)continue;if(this.tryFill(t,e))continue;const n=new Hs(e);this.fillTable(n),t.push(n)}const e=t.filter(t=>t.isValid);for(const t of e)t.normalize();return e}normalize(){this.normalizeHorizontal(),this.normalizeVertical()}normalizeHorizontal(){this.hLines.sort((t,e)=>t.from.y-e.from.y);const t=[];let e=[];for(const n of this.hLines)if(0===e.length)e.push(n);else if(Math.abs(e[0]?.from.y-n.from.y)<Bs.tolerance)e.push(n);else{const i=this.margeHorizontalLines(e);t.push(...i),e=[n]}if(e.length>0){const n=this.margeHorizontalLines(e);t.push(...n)}this.hLines=t}normalizeVertical(){this.vLines.sort((t,e)=>t.from.x-e.from.x);const t=[];let e=[];for(const n of this.vLines)if(0===e.length)e.push(n);else if(Math.abs(e[0]?.from.x-n.from.x)<Bs.tolerance)e.push(n);else{const i=this.margeVerticalLines(e);t.push(...i),e=[n]}if(e.length>0){const n=this.margeVerticalLines(e);t.push(...n)}this.vLines=t}fillTable(t){const e=[],n=[];for(const n of this.vLines)t.add(n)||e.push(n);for(const e of this.hLines)t.add(e)||n.push(e);this.hLines=n,this.vLines=e}tryFill(t,e){for(const n of t)if(n.add(e))return this.fillTable(n),!0;return!1}margeHorizontalLines(t){const e=[];t.sort((t,e)=>t.from.x-e.from.x);const n=t[0]?.from.y;if(void 0===n)return e;let i=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;for(const r of t)r.from.x-s<Bs.tolerance?(r.from.x<i&&(i=r.from.x),r.to.x>s&&(s=r.to.x)):(s>i&&e.push(new js(new Us(i,n),new Us(s,n))),i=r.from.x,s=r.to.x);const r=e[e.length-1];return r?r.from.x!==i&&r.to.x!==s&&e.push(new js(new Us(i,n),new Us(s,n))):e.push(new js(new Us(i,n),new Us(s,n))),e}margeVerticalLines(t){const e=[];t.sort((t,e)=>t.from.y-e.from.y);const n=t[0]?.from.x;if(void 0===n)return e;let i=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;for(const r of t)r.from.y-s<Bs.tolerance?(r.from.y<i&&(i=r.from.y),r.to.y>s&&(s=r.to.y)):(s>i&&e.push(new js(new Us(n,i),new Us(n,s))),i=r.from.y,s=r.to.y);const r=e[e.length-1];return r?r.from.y!==i&&r.to.y!==s&&e.push(new js(new Us(n,i),new Us(n,s))):e.push(new js(new Us(n,i),new Us(n,s))),e}}class Vs extends Bs{from;width;height;constructor(t,e,n){super(),this.from=t,this.width=e,this.height=n}get to(){return new Us(this.from.x+this.width,this.from.y+this.height)}getLines(){const t=this.to;return[new js(this.from,new Us(t.x,this.from.y)),new js(this.from,new Us(this.from.x,t.y)),new js(new Us(t.x,this.from.y),t),new js(new Us(this.from.x,t.y),t)].filter(t=>t.valid)}transform(t){const e=Bs.applyTransform([this.from.x,this.from.y],t),n=Bs.applyTransform([this.from.x+this.width,this.from.y+this.height],t),i=Math.min(e[0],n[0]),s=Math.min(e[1],n[1]),r=Math.abs(e[0]-n[0]),o=Math.abs(e[1]-n[1]);return this.from=new Us(i,s),this.width=r,this.height=o,this}}class Ws{pages=[];total=0;getPageImage(t,e){for(const n of this.pages)if(n.pageNumber===t)for(const t of n.images)if(t.name===e)return t;return null}constructor(t){this.total=t}}const qs=["xmp:createdate","xmp:modifydate","xmp:metadatadate","xap:createdate","xap:modifydate","xap:metadatadate"];class Ks{total;info;metadata;fingerprints;permission;outline;pages=[];getDateNode(){const t={},e=this.info?.CreationDate;e&&(t.CreationDate=Rt.toDateObject(e));const n=this.info?.ModDate;if(n&&(t.ModDate=Rt.toDateObject(n)),!this.metadata)return t;for(const e of qs){const n=this.metadata?.get(e),i=this.parseISODateString(n);switch(e){case qs[0]:t.XmpCreateDate=i;break;case qs[1]:t.XmpModifyDate=i;break;case qs[2]:t.XmpMetadataDate=i;break;case qs[3]:t.XapCreateDate=i;break;case qs[4]:t.XapModifyDate=i;break;case qs[5]:t.XapMetadataDate=i}}return t}parseISODateString(t){if(!t)return;const e=Date.parse(t);return Number.isNaN(e)?void 0:new Date(e)}constructor(t){this.total=t}}function Ys(t){return t.lineThreshold=t?.lineThreshold??4.6,t.cellThreshold=t?.cellThreshold??7,t.cellSeparator=t?.cellSeparator??"\t",t.lineEnforce=t?.lineEnforce??!0,t.pageJoiner=t?.pageJoiner??"\n-- page_number of total_number --",t.imageThreshold=t?.imageThreshold??80,t.imageDataUrl=t?.imageDataUrl??!0,t.imageBuffer=t?.imageBuffer??!0,t.scale=t?.scale??1,t}var Xs=(t=>(t[t[void 0]=0]="undefined",t[t.hline=1]="hline",t[t.vline=2]="vline",t[t.rectangle=3]="rectangle",t))(Xs||{});class Js{pages=[];total=0;constructor(t){this.total=t}}class Qs{pages=[];mergedTables=[];total=0;constructor(t){this.total=t}}class Zs{pages=[];text="";total=0;getPageText(t){for(const e of this.pages)if(e.num===t)return e.text;return""}constructor(t){this.total=t}}e.AbortException=Ns,e.FormatError=Ds,e.InvalidPDFException=Ps,e.Line=js,e.LineDirection=$s,e.LineStore=Gs,e.PDFParse=class{options;doc;progress={loaded:-1,total:0};constructor(t){void 0===t.verbosity&&(t.verbosity=F.ERRORS),"undefined"!=typeof Buffer&&t.data instanceof Buffer&&(t.data=new Uint8Array(t.data)),this.options=t}async destroy(){this.doc&&(await this.doc.destroy(),this.doc=void 0)}static get isNodeJS(){return!("object"!=typeof process||"[object process]"!=`${process}`||process.versions.nw||process.versions.electron&&void 0!==process.type&&"browser"!==process.type)}static setWorker(t){return void 0===globalThis.pdfjs&&(globalThis.pdfjs=Is),null===On?"":void 0!==t?(On.workerSrc=t,On.workerSrc):On.workerSrc}async getInfo(t={}){const e=await this.load(),n=new Ks(e.numPages),{info:i,metadata:s}=await e.getMetadata();n.info=i,n.metadata=s,n.fingerprints=e.fingerprints,n.outline=await e.getOutline(),n.permission=await e.getPermissions();const r=await e.getPageLabels();if(t.parsePageInfo)for(let i=1;i<=n.total;i++)if(this.shouldParse(i,n.total,t)){const t=await e.getPage(i),s=await this.getPageLinks(t);s.pageLabel=r?.[t.pageNumber],n.pages.push(s),t.cleanup()}return n}async getPageLinks(t){const e=t.getViewport({scale:1}),n={pageNumber:t.pageNumber,links:[],width:e.width,height:e.height},i=await t.getAnnotations({intent:"display"})||[];for(const t of i){if("Link"!==t.subtype)continue;const e=t.url??t.unsafeUrl;if(!e)continue;const i=t.overlaidText||"";n.links.push({url:e,text:i})}return n}async getText(t={}){const e=await this.load(),n=new Zs(e.numPages);for(let i=1;i<=n.total;i++)if(this.shouldParse(i,n.total,t)){const s=await e.getPage(i),r=await this.getPageText(s,t,n.total);n.pages.push({text:r,num:i}),s.cleanup()}for(const e of n.pages)if(t.pageJoiner){let i=t.pageJoiner.replace("page_number",`${e.num}`);i=i.replace("total_number",`${n.total}`),n.text+=`${e.text}\n${i}\n\n`}else n.text+=`${e.text}\n\n`;return n}async load(){try{if(void 0===this.doc){const t=hi(this.options);t.onProgress=t=>{this.progress=t},this.doc=await t.promise}return this.doc}catch(t){throw Fs(t)}}shouldParse(t,e,n){return n.partial=n?.partial??[],n.first=n?.first??0,n.last=n?.last??0,n.partial.length>0?!!n.partial.includes(t):n.first>0&&n.last>0?t>=n.first&&t<=n.last:n.first>0?t<=n.first:!(n.last>0)||t>e-n.last}async getPageText(t,e,n){const i=t.getViewport({scale:1}),s=Ys(e),r=await t.getTextContent({includeMarkedContent:!!s.includeMarkedContent,disableNormalization:!!s.disableNormalization});let o=new Map;s.parseHyperlinks&&(o=await this.getHyperlinks(t,i));const a=[];let c,l,h=0;for(const t of r.items){if(!("str"in t))continue;const e=t.transform??t.transform,[n,r]=i.convertToViewportPoint(e[4],e[5]);if(s.parseHyperlinks){const e=(o.get(t.str)||[]).find(t=>n>=t.rect.left&&n<=t.rect.right&&r>=t.rect.top&&r<=t.rect.bottom);e&&(t.str=`[${t.str}](${e.url})`)}if(s.lineEnforce&&void 0!==l&&Math.abs(l-r)>s.lineThreshold){const e=a.length?a[a.length-1]:void 0,n=t.str.startsWith("\n")||""===t.str.trim()&&t.hasEOL;!1!==e?.endsWith("\n")||n||Math.abs(l-r)-1>h&&(a.push("\n"),h=0)}s.cellSeparator&&void 0!==l&&Math.abs(l-r)<s.lineThreshold&&void 0!==c&&Math.abs(c-n)>s.cellThreshold&&(t.str=`${s.cellSeparator}${t.str}`),a.push(t.str),c=n+t.width,l=r,h=Math.max(h,t.height),t.hasEOL&&a.push("\n"),(t.hasEOL||t.str.endsWith("\n"))&&(h=0)}return s.itemJoiner?a.join(s.itemJoiner):a.join("")}async getHyperlinks(t,e){const n=new Map,i=await t.getAnnotations({intent:"display"})||[];for(const t of i){if("Link"!==t.subtype)continue;const i=t.url??t.unsafeUrl;if(!i)continue;const s=t.overlaidText;if(!s)continue;const r=e.convertToViewportRectangle(t.rect),o={rect:{left:Math.min(r[0],r[2])-.5,top:Math.min(r[1],r[3])-.5,right:Math.max(r[0],r[2])+.5,bottom:Math.max(r[1],r[3])+.5},url:i,text:s,used:!1},a=n.get(s);a?a.push(o):n.set(s,[o])}return n}async getImage(t={}){const e=await this.load(),n=new Ws(e.numPages);Ys(t);for(let i=1;i<=n.total;i++)if(this.shouldParse(i,n.total,t)){const s=await e.getPage(i),r=await s.getOperatorList(),o={pageNumber:i,images:[]};n.pages.push(o);for(let n=0;n<r.fnArray.length;n++)if(r.fnArray[n]===B.paintInlineImageXObject||r.fnArray[n]===B.paintImageXObject){const i=r.argsArray[n][0],a=s.commonObjs.has(i)?this.resolveEmbeddedImage(s.commonObjs,i):this.resolveEmbeddedImage(s.objs,i),{width:c,height:l,kind:h,data:d}=await a;if(t.imageThreshold&&(t.imageThreshold>=c||t.imageThreshold>=l))continue;const u=e.canvasFactory.create(c,l),p=u.context;let g=null;h===L.RGBA_32BPP?(g=p.createImageData(c,l),g.data.set(d)):(g=p.createImageData(c,l),this.convertToRGBA({src:d,dest:new Uint32Array(g.data.buffer),width:c,height:l,kind:h})),p.putImageData(g,0,0);let f=new Uint8Array,m="";if("function"==typeof u.canvas.toBuffer){let e;t.imageBuffer&&(e=u.canvas.toBuffer("image/png"),f=new Uint8Array(e)),t.imageDataUrl&&(e||(e=u.canvas.toBuffer("image/png"),f=new Uint8Array(e)),m=`data:image/png;base64,${e.toString("base64")}`)}else{if(t.imageBuffer){const t=u.context.getImageData(0,0,u.canvas.width,u.canvas.height);f=new Uint8Array(t.data)}t.imageDataUrl&&(m=u.canvas.toDataURL("image/png"))}o.images.push({data:f,dataUrl:m,name:i,height:l,width:c,kind:h})}}return n}convertToRGBA({src:t,dest:e,width:n,height:i,kind:s}){if(s===L.RGB_24BPP)for(let n=0,i=0;n<t.length;n+=3,i++){const s=t[n],r=t[n+1],o=t[n+2];e[i]=255<<24|o<<16|r<<8|s}else if(s===L.GRAYSCALE_1BPP){let s=0;for(let r=0;r<t.length;r++){const o=t[r];for(let t=7;t>=0&&!(s>=n*i);t--){const n=1==(o>>t&1)?255:0;e[s++]=255<<24|n<<16|n<<8|n}}}else{if(null!=s)throw new Error(`convertToRGBA: Unsupported image kind: ${s}. Available kinds: GRAYSCALE_1BPP=${L.GRAYSCALE_1BPP}, RGB_24BPP=${L.RGB_24BPP}, RGBA_32BPP=${L.RGBA_32BPP}`);{const r=t.length/(n*i);if(Math.abs(r-3)<.1)for(let n=0,i=0;n<t.length;n+=3,i++){const s=t[n],r=t[n+1],o=t[n+2];e[i]=255<<24|o<<16|r<<8|s}else if(Math.abs(r-4)<.1)for(let n=0,i=0;n<t.length;n+=4,i++){const s=t[n],r=t[n+1],o=t[n+2],a=t[n+3];e[i]=a<<24|o<<16|r<<8|s}else{if(!(Math.abs(r-1)<.1))throw new Error(`convertToRGBA: Cannot infer image format. kind: ${s}, bytesPerPixel: ${r}, width: ${n}, height: ${i}, dataLength: ${t.length}`);for(let n=0;n<t.length;n++){const i=t[n];e[n]=255<<24|i<<16|i<<8|i}}}}}resolveEmbeddedImage(t,e){return new Promise((n,i)=>{t.get(e,t=>{if(t){let s;if(t.data instanceof Uint8Array)s=t.data;else if(t.data instanceof Uint8ClampedArray)s=new Uint8Array(t.data);else if(t.data?.buffer)s=new Uint8Array(t.data.buffer);else if(t.bitmap){const e=this.doc.canvasFactory.create(t.bitmap.width,t.bitmap.height);e.context.drawImage(t.bitmap,0,0);const n=e.context.getImageData(0,0,t.bitmap.width,t.bitmap.height);s=new Uint8Array(n.data.buffer)}else ArrayBuffer.isView(t.data)&&(s=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.byteLength));if(!s)return void i(new Error(`Image object ${e}: data field is empty or invalid. Available fields: ${Object.keys(t).join(", ")}`));if(0===s.length)return void i(new Error(`Image object ${e}: data buffer is empty (length: 0)`));n({width:t.width,height:t.height,kind:t.kind,data:s})}else i(new Error(`Image object ${e} not found`))})})}async getScreenshot(t={}){const e=Ys(t),n=await this.load(),i=new Js(n.numPages);if(void 0===this.doc)throw new Error("PDF document not loaded");for(let t=1;t<=i.total;t++)if(this.shouldParse(t,i.total,e)){const n=await this.doc.getPage(t);let s=n.getViewport({scale:e.scale});if(e.desiredWidth){s=n.getViewport({scale:1});const t=e.desiredWidth/s.width;s=n.getViewport({scale:t})}const r=this.doc.canvasFactory.create(s.width,s.height),o={canvasContext:r.context,viewport:s,canvas:r.canvas},a=n.render(o);await a.promise;let c=new Uint8Array,l="";if("function"==typeof r.canvas.toBuffer){let t;e.imageBuffer&&(t=r.canvas.toBuffer("image/png"),c=new Uint8Array(t)),e.imageDataUrl&&(t||(t=r.canvas.toBuffer("image/png"),c=new Uint8Array(t)),l=`data:image/png;base64,${t.toString("base64")}`)}else{if(e.imageBuffer){const t=r.context.getImageData(0,0,r.canvas.width,r.canvas.height);c=new Uint8Array(t.data)}e.imageDataUrl&&(l=r.canvas.toDataURL("image/png"))}i.pages.push({data:c,dataUrl:l,pageNumber:t,width:s.width,height:s.height,scale:s.scale}),n.cleanup()}return i}async getTable(t={}){const e=await this.load(),n=new Qs(e.numPages);if(void 0===this.doc)throw new Error("PDF document not loaded");for(let e=1;e<=n.total;e++)if(this.shouldParse(e,n.total,t)){const t=await this.doc.getPage(e),i=await this.getPageTables(t);i.normalize();const s=i.getTableData();await this.fillPageTables(t,s);const r={num:e,tables:[]};for(const t of s)r.tables.push(t.toArray());n.pages.push(r),t.cleanup()}return n}getPathGeometry(t){const e=t[2]-t[0],n=t[3]-t[1];return t[0]===1/0?Xs.undefined:e>5&&n>5?Xs.rectangle:e>5&&0===n?Xs.hline:0===e&&n>5?Xs.vline:Xs.undefined}async getPageTables(t){const e=new Gs,n=t.getViewport({scale:1});let i=[1,0,0,1,0,0];const s=[],r=await t.getOperatorList();for(let t=0;t<r.fnArray.length;t++){const o=r.fnArray[t],a=r.argsArray[t],c=a?.[0]??0,l=a?.[2]??[1/0,1/0,-1/0,-1/0];if(o===B.constructPath){if(c!==B.stroke)continue;const t=this.getPathGeometry(l);if(t===Xs.rectangle){const t=new Vs(new Us(l[0],l[1]),l[2]-l[0],l[3]-l[1]);t.transform(i),t.transform(n.transform),e.addRectangle(t)}else if(t===Xs.hline||t===Xs.vline){const t=new Us(l[0],l[1]),s=new Us(l[2],l[3]),r=new js(t,s);r.transform(i),r.transform(n.transform),e.add(r)}}else if(o===B.setLineWidth);else if(o===B.save)s.push(i);else if(o===B.restore){const t=s.pop();t&&(i=t)}else o===B.transform&&(i=ot.transform(i,a))}return e}async fillPageTables(t,e){const n=t.getViewport({scale:1}),i=await t.getTextContent({includeMarkedContent:!1,disableNormalization:!1});for(const t of i.items){if(!("str"in t))continue;const i=ot.transform(ot.transform(n.transform,t.transform),[1,0,0,-1,0,0]);for(const n of e){const e=n.findCell(i[4],i[5]);if(e){e.text.push(t.str),t.hasEOL&&e.text.push("\n");break}}}}},e.PasswordException=Ms,e.Point=Us,e.Rectangle=Vs,e.ResponseException=Ls,e.Shape=Bs,e.Table=Hs,e.UnknownErrorException=Os,e.VerbosityLevel=F,e.getException=Fs},9718:(t,e,n)=>{"use strict";n.d(e,{n:()=>r});var i=n(9290),s=n(7459);const r=t=>{let e;if(e="string"==typeof t?(0,s.a)(t):t,"object"!=typeof e||"number"!=typeof e.byteOffset||"number"!=typeof e.byteLength)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");return(0,i.Q)(e.buffer,e.byteOffset,e.byteLength).toString("base64")}},9774:(t,e,n)=>{"use strict";n.d(e,{ey:()=>f});var i=n(7324),s=n(4094),r=n(4542),o=n(4098),a=n(7072),c=n(6851),l=n(2203);const h=t=>t?.body instanceof l.Readable||"undefined"!=typeof ReadableStream&&t?.body instanceof ReadableStream,d=t=>t instanceof Error?t:t instanceof Object?Object.assign(new Error,t):"string"==typeof t?new Error(t):new Error(`AWS SDK error wrapper for ${t}`),u=t=>{const e={error:t,errorType:p(t)},n=m(t.$response);return n&&(e.retryAfterHint=n),e},p=t=>(0,r.Qb)(t)?"THROTTLING":(0,r.bV)(t)?"TRANSIENT":(0,r.GQ)(t)?"SERVER_ERROR":"CLIENT_ERROR",g={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},f=t=>({applyToStack:e=>{e.add((t=>(e,n)=>async s=>{let r=await t.retryStrategy();const l=await t.maxAttempts();if(!(t=>void 0!==t.acquireInitialRetryToken&&void 0!==t.refreshRetryTokenForRetry&&void 0!==t.recordSuccess)(r))return r?.mode&&(n.userAgent=[...n.userAgent||[],["cfg/retry-mode",r.mode]]),r.retry(e,s);{let t=await r.acquireInitialRetryToken(n.partition_id),p=new Error,g=0,f=0;const{request:m}=s,v=i.K.isInstance(m);for(v&&(m.headers[a.l5]=(0,c.v4)());;)try{v&&(m.headers[a.ok]=`attempt=${g+1}; max=${l}`);const{response:n,output:i}=await e(s);return r.recordSuccess(t),i.$metadata.attempts=g+1,i.$metadata.totalRetryDelay=f,{response:n,output:i}}catch(e){const i=u(e);if(p=d(e),v&&h(m))throw(n.logger instanceof o.N?console:n.logger)?.warn("An error was encountered in a non-retryable streaming request."),p;try{t=await r.refreshRetryTokenForRetry(t,i)}catch(t){throw p.$metadata||(p.$metadata={}),p.$metadata.attempts=g+1,p.$metadata.totalRetryDelay=f,p}g=t.getRetryCount();const s=t.getRetryDelay();f+=s,await new Promise(t=>setTimeout(t,s))}}})(t),g)}}),m=t=>{if(!s.c.isInstance(t))return;const e=Object.keys(t.headers).find(t=>"retry-after"===t.toLowerCase());if(!e)return;const n=t.headers[e],i=Number(n);return Number.isNaN(i)?new Date(n):new Date(1e3*i)}},9896:t=>{"use strict";t.exports=require("fs")},9915:(t,e,n)=>{"use strict";n.d(e,{hV:()=>i});const i={environmentVariableSelector:t=>t.AWS_SDK_UA_APP_ID,configFileSelector:t=>t.sdk_ua_app_id??t["sdk-ua-app-id"],default:n(7287).b}},9984:(t,e,n)=>{"use strict";var i;n.d(e,{xA:()=>s,uv:()=>r}),function(t){t.MD5="md5",t.CRC32="crc32",t.CRC32C="crc32c",t.SHA1="sha1",t.SHA256="sha256"}(i||(i={}));const s=t=>Object.assign((t=>{const e=[];for(const n in i){const s=i[n];void 0!==t[s]&&e.push({algorithmId:()=>s,checksumConstructor:()=>t[s]})}return{addChecksumAlgorithm(t){e.push(t)},checksumAlgorithms:()=>e}})(t),(t=>({setRetryStrategy(e){t.retryStrategy=e},retryStrategy:()=>t.retryStrategy}))(t)),r=t=>Object.assign((t=>{const e={};return t.checksumAlgorithms().forEach(t=>{e[t.algorithmId()]=t.checksumConstructor()}),e})(t),(t=>{const e={};return e.retryStrategy=t.retryStrategy(),e})(t))}},n={};function i(t){var s=n[t];if(void 0!==s)return s.exports;var r=n[t]={exports:{}};return e[t].call(r.exports,r,r.exports,i),r.exports}i.m=e,i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.f={},i.e=t=>Promise.all(Object.keys(i.f).reduce((e,n)=>(i.f[n](t,e),e),[])),i.u=t=>t+".extension.js",i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},t={792:1},i.f.require=(e,n)=>{if(!t[e]){var s=require("./"+i.u(e));t[e]||(e=>{var n=e.modules,s=e.ids,r=e.runtime;for(var o in n)i.o(n,o)&&(i.m[o]=n[o]);r&&r(i);for(var a=0;a<s.length;a++)t[s[a]]=1})(s)}};var s=i(4265);module.exports=s})();