"use strict";exports.id=703,exports.ids=[703],exports.modules={4649:(e,t,o)=>{o.d(t,{$:()=>d});var r=o(4094),n=o(5901),s=o(8611),a=o(5692);const i=["ECONNRESET","EPIPE","ETIMEDOUT"];var c=o(6035),u=o(7260),l=o(3360);class d{config;configProvider;socketWarningTimestamp=0;externalAgent=!1;metadata={handlerProtocol:"http/1.1"};static create(e){return"function"==typeof e?.handle?e:new d(e)}static checkSocketUsage(e,t,o=console){const{sockets:r,requests:n,maxSockets:s}=e;if("number"!=typeof s||s===1/0)return t;if(Date.now()-15e3<t)return t;if(r&&n)for(const e in r){const t=r[e]?.length??0,a=n[e]?.length??0;if(t>=s&&a>=2*s)return o?.warn?.(`@smithy/node-http-handler:WARN - socket usage at capacity=${t} and ${a} additional requests are enqueued.\nSee https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/node-configuring-maxsockets.html\nor increase socketAcquisitionWarningTimeout=(millis) in the NodeHttpHandler config.`),Date.now()}return t}constructor(e){this.configProvider=new Promise((t,o)=>{"function"==typeof e?e().then(e=>{t(this.resolveDefaultConfig(e))}).catch(o):t(this.resolveDefaultConfig(e))})}resolveDefaultConfig(e){const{requestTimeout:t,connectionTimeout:o,socketTimeout:r,socketAcquisitionWarningTimeout:n,httpAgent:i,httpsAgent:c,throwOnRequestTimeout:u}=e||{},l=!0;return{connectionTimeout:o,requestTimeout:t,socketTimeout:r,socketAcquisitionWarningTimeout:n,throwOnRequestTimeout:u,httpAgent:(()=>i instanceof s.Agent||"function"==typeof i?.destroy?(this.externalAgent=!0,i):new s.Agent({keepAlive:l,maxSockets:50,...i}))(),httpsAgent:(()=>c instanceof a.Agent||"function"==typeof c?.destroy?(this.externalAgent=!0,c):new a.Agent({keepAlive:l,maxSockets:50,...c}))(),logger:console}}destroy(){this.config?.httpAgent?.destroy(),this.config?.httpsAgent?.destroy()}async handle(e,{abortSignal:t,requestTimeout:o}={}){return this.config||(this.config=await this.configProvider),new Promise((h,f)=>{const m=this.config;let g;const p=[],w=async e=>{await g,p.forEach(u.N.clearTimeout),f(e)};if(t?.aborted){const e=new Error("Request aborted");return e.name="AbortError",void w(e)}const T="https:"===e.protocol,y=e.headers??{},A="100-continue"===(y.Expect??y.expect);let b=T?m.httpsAgent:m.httpAgent;A&&!this.externalAgent&&(b=new(T?a.Agent:s.Agent)({keepAlive:!1,maxSockets:1/0})),p.push(u.N.setTimeout(()=>{this.socketWarningTimestamp=d.checkSocketUsage(b,this.socketWarningTimestamp,m.logger)},m.socketAcquisitionWarningTimeout??(m.requestTimeout??2e3)+(m.connectionTimeout??1e3)));const E=(0,n.G)(e.query||{});let k;null==e.username&&null==e.password||(k=`${e.username??""}:${e.password??""}`);let v=e.path;E&&(v+=`?${E}`),e.fragment&&(v+=`#${e.fragment}`);let C=e.hostname??"";C="["===C[0]&&C.endsWith("]")?e.hostname.slice(1,-1):e.hostname;const R={headers:e.headers,host:C,method:e.method,path:v,port:e.port,agent:b,auth:k},S=(T?a.request:s.request)(R,e=>{(async e=>{await g,p.forEach(u.N.clearTimeout),h(e)})({response:new r.c({statusCode:e.statusCode||-1,reason:e.statusMessage,headers:(0,c.u)(e.headers),body:e})})});if(S.on("error",e=>{i.includes(e.code)?w(Object.assign(e,{name:"TimeoutError"})):w(e)}),t){const e=()=>{S.destroy();const e=new Error("Request aborted");e.name="AbortError",w(e)};if("function"==typeof t.addEventListener){const o=t;o.addEventListener("abort",e,{once:!0}),S.once("close",()=>o.removeEventListener("abort",e))}else t.onabort=e}const N=o??m.requestTimeout;p.push(((e,t,o=0)=>{if(!o)return-1;const r=r=>{const n=u.N.setTimeout(()=>{e.destroy(),t(Object.assign(new Error(`@smithy/node-http-handler - the request socket did not establish a connection with the server within the configured timeout of ${o} ms.`),{name:"TimeoutError"}))},o-r),s=e=>{e?.connecting?e.on("connect",()=>{u.N.clearTimeout(n)}):u.N.clearTimeout(n)};e.socket?s(e.socket):e.on("socket",s)};return o<2e3?(r(0),0):u.N.setTimeout(r.bind(null,1e3),1e3)})(S,w,m.connectionTimeout)),p.push(((e,t,o=0,r,n)=>o?u.N.setTimeout(()=>{let s=`@smithy/node-http-handler - [${r?"ERROR":"WARN"}] a request has exceeded the configured ${o} ms requestTimeout.`;if(r){const o=Object.assign(new Error(s),{name:"TimeoutError",code:"ETIMEDOUT"});e.destroy(o),t(o)}else s+=" Init client requestHandler with throwOnRequestTimeout=true to turn this into an error.",n?.warn?.(s)},o):-1)(S,w,N,m.throwOnRequestTimeout,m.logger??console)),p.push(((e,t,o=0)=>{const r=r=>{const n=o-r,s=()=>{e.destroy(),t(Object.assign(new Error(`@smithy/node-http-handler - the request socket timed out after ${o} ms of inactivity (configured by client requestHandler).`),{name:"TimeoutError"}))};e.socket?(e.socket.setTimeout(n,s),e.on("close",()=>e.socket?.removeListener("timeout",s))):e.setTimeout(n,s)};return 0<o&&o<6e3?(r(0),0):u.N.setTimeout(r.bind(null,0===o?0:3e3),3e3)})(S,w,m.socketTimeout));const I=R.agent;"object"==typeof I&&"keepAlive"in I&&p.push(((e,{keepAlive:t,keepAliveMsecs:o},r=3e3)=>{if(!0!==t)return-1;const n=()=>{e.socket?e.socket.setKeepAlive(t,o||0):e.on("socket",e=>{e.setKeepAlive(t,o||0)})};return 0===r?(n(),0):u.N.setTimeout(n,r)})(S,{keepAlive:I.keepAlive,keepAliveMsecs:I.keepAliveMsecs})),g=(0,l.f)(S,e,N,this.externalAgent).catch(e=>(p.forEach(u.N.clearTimeout),f(e)))})}updateHttpClientConfig(e,t){this.config=void 0,this.configProvider=this.configProvider.then(o=>({...o,[e]:t}))}httpHandlerConfigs(){return this.config??{}}}},8703:(e,t,o)=>{o.d(t,{fromHttp:()=>E});var r=o(244),n=o(4649),s=o(3052),a=o(1943),i=o.n(a),c=o(7324),u=o(1871),l=o(5178),d=o(9290),h=o(2203),f=o(1395);var m=o(9718),g=o(8004),p=o(7638);const w=e=>"function"==typeof ReadableStream&&(e?.constructor?.name===ReadableStream.name||e instanceof ReadableStream),T="The stream has already been transformed.",y=e=>{if(!A(e)&&!w(e))throw new Error(`Unexpected stream implementation, expect Blob or ReadableStream, got ${e?.__proto__?.constructor?.name||e}`);let t=!1;const o=async()=>{if(t)throw new Error(T);return t=!0,await(async e=>"function"==typeof Blob&&e instanceof Blob||"Blob"===e.constructor?.name?void 0!==Blob.prototype.arrayBuffer?new Uint8Array(await e.arrayBuffer()):async function(e){const t=await function(e){return new Promise((t,o)=>{const r=new FileReader;r.onloadend=()=>{if(2!==r.readyState)return o(new Error("Reader aborted too early"));const e=r.result??"",n=e.indexOf(","),s=n>-1?n+1:e.length;t(e.substring(s))},r.onabort=()=>o(new Error("Read aborted")),r.onerror=()=>o(r.error),r.readAsDataURL(e)})}(e),o=(0,f.E)(t);return new Uint8Array(o)}(e):async function(e){const t=[],o=e.getReader();let r=!1,n=0;for(;!r;){const{done:e,value:s}=await o.read();s&&(t.push(s),n+=s.length),r=e}const s=new Uint8Array(n);let a=0;for(const e of t)s.set(e,a),a+=e.length;return s}(e))(e)};return Object.assign(e,{transformToByteArray:o,transformToString:async e=>{const t=await o();if("base64"===e)return(0,m.n)(t);if("hex"===e)return(0,g.n)(t);if(void 0===e||"utf8"===e||"utf-8"===e)return(0,p.P)(t);if("function"==typeof TextDecoder)return new TextDecoder(e).decode(t);throw new Error("TextDecoder is not available, please make sure polyfill is provided.")},transformToWebStream:()=>{if(t)throw new Error(T);if(t=!0,A(e))return(e=>{if("function"!=typeof e.stream)throw new Error("Cannot transform payload Blob to web stream. Please make sure the Blob.stream() is polyfilled.\nIf you are using React Native, this API is not yet supported, see: https://react-native.canny.io/feature-requests/p/fetch-streaming-body");return e.stream()})(e);if(w(e))return e;throw new Error(`Cannot transform payload to web stream, got ${e}`)}})},A=e=>"function"==typeof Blob&&e instanceof Blob,b="The stream has already been transformed.";const E=(e={})=>{let t;e.logger?.debug("@aws-sdk/credential-provider-http - fromHttp");const o=e.awsContainerCredentialsRelativeUri??process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI,a=e.awsContainerCredentialsFullUri??process.env.AWS_CONTAINER_CREDENTIALS_FULL_URI,f=e.awsContainerAuthorizationToken??process.env.AWS_CONTAINER_AUTHORIZATION_TOKEN,m=e.awsContainerAuthorizationTokenFile??process.env.AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE,g="NoOpLogger"!==e.logger?.constructor?.name&&e.logger?.warn?e.logger.warn.bind(e.logger):console.warn;if(o&&a&&(g("@aws-sdk/credential-provider-http: you have set both awsContainerCredentialsRelativeUri and awsContainerCredentialsFullUri."),g("awsContainerCredentialsFullUri will take precedence.")),f&&m&&(g("@aws-sdk/credential-provider-http: you have set both awsContainerAuthorizationToken and awsContainerAuthorizationTokenFile."),g("awsContainerAuthorizationToken will take precedence.")),a)t=a;else{if(!o)throw new s.C("No HTTP credential provider host provided.\nSet AWS_CONTAINER_CREDENTIALS_FULL_URI or AWS_CONTAINER_CREDENTIALS_RELATIVE_URI.",{logger:e.logger});t=`http://169.254.170.2${o}`}const p=new URL(t);((e,t)=>{if("https:"!==e.protocol&&"169.254.170.2"!==e.hostname&&"169.254.170.23"!==e.hostname&&"[fd00:ec2::23]"!==e.hostname){if(e.hostname.includes("[")){if("[::1]"===e.hostname||"[0000:0000:0000:0000:0000:0000:0000:0001]"===e.hostname)return}else{if("localhost"===e.hostname)return;const t=e.hostname.split("."),o=e=>{const t=parseInt(e,10);return 0<=t&&t<=255};if("127"===t[0]&&o(t[1])&&o(t[2])&&o(t[3])&&4===t.length)return}throw new s.C("URL not accepted. It must either be HTTPS or match one of the following:\n  - loopback CIDR 127.0.0.0/8 or [::1/128]\n  - ECS container host 169.254.170.2\n  - EKS container host 169.254.170.23 or [fd00:ec2::23]",{logger:t})}})(p,e.logger);const w=n.$.create({requestTimeout:e.timeout??1e3,connectionTimeout:e.timeout??1e3});return T=async()=>{const t=function(e){return new c.K({protocol:e.protocol,hostname:e.hostname,port:Number(e.port),path:e.pathname,query:Array.from(e.searchParams.entries()).reduce((e,[t,o])=>(e[t]=o,e),{}),fragment:e.hash})}(p);f?t.headers.Authorization=f:m&&(t.headers.Authorization=(await i().readFile(m)).toString());try{return async function(e,t){const o=(e=>{if(!(e instanceof h.Readable))try{return y(e)}catch(t){throw new Error(`Unexpected stream implementation, expect Stream.Readable instance, got ${e?.__proto__?.constructor?.name||e}`)}let t=!1;const o=async()=>{if(t)throw new Error(b);return t=!0,await(0,l.k)(e)};return Object.assign(e,{transformToByteArray:o,transformToString:async e=>{const t=await o();return void 0===e||Buffer.isEncoding(e)?(0,d.Q)(t.buffer,t.byteOffset,t.byteLength).toString(e):new TextDecoder(e).decode(t)},transformToWebStream:()=>{if(t)throw new Error(b);if(null!==e.readableFlowing)throw new Error("The stream has been consumed by other callbacks.");if("function"!=typeof h.Readable.toWeb)throw new Error("Readable.toWeb() is not supported. Please ensure a polyfill is available.");return t=!0,h.Readable.toWeb(e)}})})(e.body),r=await o.transformToString();if(200===e.statusCode){const e=JSON.parse(r);if("string"!=typeof e.AccessKeyId||"string"!=typeof e.SecretAccessKey||"string"!=typeof e.Token||"string"!=typeof e.Expiration)throw new s.C("HTTP credential provider response not of the required format, an object matching: { AccessKeyId: string, SecretAccessKey: string, Token: string, Expiration: string(rfc3339) }",{logger:t});return{accessKeyId:e.AccessKeyId,secretAccessKey:e.SecretAccessKey,sessionToken:e.Token,expiration:(0,u.EI)(e.Expiration)}}if(e.statusCode>=400&&e.statusCode<500){let o={};try{o=JSON.parse(r)}catch(e){}throw Object.assign(new s.C(`Server responded with status: ${e.statusCode}`,{logger:t}),{Code:o.Code,Message:o.Message})}throw new s.C(`Server responded with status: ${e.statusCode}`,{logger:t})}((await w.handle(t)).response).then(e=>(0,r.g)(e,"CREDENTIALS_HTTP","z"))}catch(t){throw new s.C(String(t),{logger:e.logger})}},A=e.maxRetries??3,E=e.timeout??1e3,async()=>{for(let e=0;e<A;++e)try{return await T()}catch(e){await new Promise(e=>setTimeout(e,E))}return await T()};var T,A,E}}};